{"version":3,"file":"113.bundle.js","mappings":"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","sources":["webpack://react-awesome-query-builder-demo-local/../modules/components/operators/Proximity.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/WidgetFactory.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/Widget.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/utils.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/ValueField.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/FuncSelect.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/FuncWidget.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaBoolean.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaText.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaTextArea.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaDate.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaTime.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaDateTime.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaMultiSelect.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaSelect.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaNumber.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/value/VanillaSlider.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/core/VanillaFieldSelect.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/core/VanillaConjs.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/core/VanillaButton.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/core/VanillaButtonGroup.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/core/VanillaValueSources.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/core/VanillaSwitch.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/core/vanillaConfirm.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/vanilla/index.js","webpack://react-awesome-query-builder-demo-local/../modules/config/basic.js","webpack://react-awesome-query-builder-demo-local/../modules/config/default.js","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialAutocomplete.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialFieldAutocomplete.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialValueSources.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/index.js","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialText.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialTextArea.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialDate.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialDateTime.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialTime.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialSelect.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialNumber.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialSlider.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialRange.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialBoolean.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/value/MaterialMultiSelect.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialFieldSelect.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialButton.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialButtonGroup.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialConjs.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialSwitch.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/widgets/material/core/MaterialConfirm.jsx","webpack://react-awesome-query-builder-demo-local/../modules/config/material/index.js","webpack://react-awesome-query-builder-demo-local/../modules/hooks/useListValuesAutocomplete.jsx","webpack://react-awesome-query-builder-demo-local/../modules/constants.js","webpack://react-awesome-query-builder-demo-local/../modules/stores/tree.js","webpack://react-awesome-query-builder-demo-local/../modules/stores/context.js","webpack://react-awesome-query-builder-demo-local/../modules/actions/tree.js","webpack://react-awesome-query-builder-demo-local/../modules/actions/group.js","webpack://react-awesome-query-builder-demo-local/../modules/actions/rule.js","webpack://react-awesome-query-builder-demo-local/../modules/actions/drag.js","webpack://react-awesome-query-builder-demo-local/../modules/components/Query.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/QueryContainer.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/containers/RuleContainer.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/containers/Draggable.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/Operator.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/OperatorWrapper.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/Field.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/FieldWrapper.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/rule/OperatorOptions.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/Rule.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/containers/GroupContainer.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/GroupActions.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/Group.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/RuleGroupActions.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/RuleGroup.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/RuleGroupExtActions.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/RuleGroupExt.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/SwitchGroupActions.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/SwitchGroup.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/CaseGroup.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/item/Item.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/containers/SortableContainer.jsx","webpack://react-awesome-query-builder-demo-local/../modules/components/Builder.jsx","webpack://react-awesome-query-builder-demo-local/../modules/export/queryBuilder.js","webpack://react-awesome-query-builder-demo-local/../modules/export/jsonLogic.js","webpack://react-awesome-query-builder-demo-local/../modules/export/mongoDb.js","webpack://react-awesome-query-builder-demo-local/../modules/export/sql.js","webpack://react-awesome-query-builder-demo-local/../modules/export/spel.js","webpack://react-awesome-query-builder-demo-local/../modules/export/queryString.js","webpack://react-awesome-query-builder-demo-local/../modules/export/elasticSearch.js","webpack://react-awesome-query-builder-demo-local/../modules/import/tree.js","webpack://react-awesome-query-builder-demo-local/../modules/import/jsonLogic.js","webpack://react-awesome-query-builder-demo-local/../modules/import/spel.js","webpack://react-awesome-query-builder-demo-local/../modules/config/funcs.js","webpack://react-awesome-query-builder-demo-local/../modules/index.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/autocomplete.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/configUtils.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/defaultUtils.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/export.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/funcUtils.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/reactUtils.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/ruleUtils.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/stuff.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/treeUtils.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/uuid.js","webpack://react-awesome-query-builder-demo-local/../modules/utils/validation.js","webpack://react-awesome-query-builder-demo-local/../node_modules/moment/locale/ sync [/\\\\](es-us(\\.js)"],"sourcesContent":["import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport range from \"lodash/range\";\n\nexport default class Proximity extends PureComponent {\n  static propTypes = {\n    config: PropTypes.object.isRequired,\n    setOption: PropTypes.func.isRequired,\n    options: PropTypes.any.isRequired, //instanceOf(Immutable.Map)\n    minProximity: PropTypes.number,\n    maxProximity: PropTypes.number,\n    optionPlaceholder: PropTypes.string,\n    optionTextBefore: PropTypes.string,\n    optionLabel: PropTypes.string,\n    customProps: PropTypes.object,\n    readonly: PropTypes.bool,\n    //children\n  };\n\n  static defaultProps = {\n    customProps: {},\n    minProximity: 2,\n    maxProximity: 10,\n    optionPlaceholder: \"Select words between\",\n    optionLabel: \"Words between\",\n    optionTextBefore: null,\n  };\n\n  handleChange = (value) => {\n    this.props.setOption(\"proximity\", parseInt(value));\n  };\n\n  render() {\n    const {\n      defaults, options, config, optionLabel, optionPlaceholder, customProps, \n      minProximity, maxProximity, optionTextBefore, readonly\n    } = this.props;\n    const {settings, widgets} = config;\n    const defaultProximity = defaults ? defaults.proximity : undefined;\n    const {showLabels} = settings;\n    const selectedProximity = options.get(\"proximity\", defaultProximity);\n    const proxValues = range(minProximity, maxProximity + 1).map((item) => ({title: item, value: item}));\n    const Select = widgets.select.factory;\n\n    return (\n      <div className=\"operator--PROXIMITY\">\n        <div className=\"operator--options\">\n          { showLabels\n            && <label className=\"rule--label\">{optionLabel}</label>\n          }\n          { !showLabels && optionTextBefore\n            && <div className=\"operator--options--sep\">\n              <span>{optionTextBefore}</span>\n            </div>\n          }\n          <Select\n            config={config}\n            value={selectedProximity}\n            listValues={proxValues}\n            setValue={this.handleChange}\n            readonly={readonly}\n            placeholder={optionPlaceholder}\n            {...customProps}\n          />\n        </div>\n        <div className=\"operator--widgets\">{this.props.children}</div>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport {getTitleInListValues} from \"../../utils/stuff\";\n\nexport default ({\n  delta, isFuncArg, valueSrc,\n  value: immValue, valueError: immValueError, asyncListValues,\n  isSpecialRange, fieldDefinition,\n  widget, widgetDefinition, widgetValueLabel, valueLabels, textSeparators, setValueHandler,\n  config, field, operator, readonly, parentField, parentFuncs, id, groupId\n}) => {\n  const {factory: widgetFactory, ...fieldWidgetProps} = widgetDefinition;\n  const isConst = isFuncArg && fieldDefinition.valueSources && fieldDefinition.valueSources.length == 1 && fieldDefinition.valueSources[0] == \"const\";\n  const defaultValue = fieldDefinition.defaultValue;\n\n  if (!widgetFactory) {\n    return \"?\";\n  }\n    \n  let value = isSpecialRange \n    ? [immValue.get(0), immValue.get(1)] \n    : (immValue ? immValue.get(delta) : undefined);\n  const valueError = immValueError && (isSpecialRange \n    ? [immValueError.get(0), immValueError.get(1)]\n    : immValueError.get(delta)\n  ) || null;\n  if (isSpecialRange && value[0] === undefined && value[1] === undefined)\n    value = undefined;\n  const {fieldSettings} = fieldDefinition || {};\n  const widgetProps = Object.assign({}, fieldWidgetProps, fieldSettings, {\n    config: config,\n    field: field,\n    parentField: parentField,\n    parentFuncs: parentFuncs,\n    fieldDefinition: fieldDefinition,\n    operator: operator,\n    delta: delta,\n    isSpecialRange: isSpecialRange,\n    isFuncArg: isFuncArg,\n    value: value,\n    valueError: valueError,\n    label: widgetValueLabel.label,\n    placeholder: widgetValueLabel.placeholder,\n    placeholders: valueLabels ? valueLabels.placeholder : null,\n    textSeparators: textSeparators,\n    setValue: setValueHandler,\n    readonly: readonly,\n    asyncListValues: asyncListValues,\n    id, groupId\n  });\n    \n  if (widget == \"field\") {\n    //\n  }\n\n  if (isConst && defaultValue) {\n    if (typeof defaultValue == \"boolean\") {\n      return defaultValue ? (widgetProps.labelYes || \"YES\") : (widgetProps.labelNo || \"NO\");\n    } else if (fieldSettings.listValues) {\n      if (Array.isArray(defaultValue))\n        return defaultValue.map(v => getTitleInListValues(fieldSettings.listValues, v) || v).join(\", \");\n      else\n        return (getTitleInListValues(fieldSettings.listValues, defaultValue) || defaultValue);  \n    }\n    return \"\"+defaultValue;\n  }\n    \n  return widgetFactory(widgetProps);\n};\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport range from \"lodash/range\";\nimport {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig\n} from \"../../utils/configUtils\";\nimport {\n  getValueSourcesForFieldOp, getWidgetsForFieldOp, getWidgetForFieldOp, getValueLabel\n} from \"../../utils/ruleUtils\";\nimport {defaultValue} from \"../../utils/stuff\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport pick from \"lodash/pick\";\nimport Immutable from \"immutable\";\nimport WidgetFactory from \"./WidgetFactory\";\nimport {Col} from \"../utils\";\n\nconst funcArgDummyOpDef = {cardinality: 1};\n\nexport default class Widget extends PureComponent {\n  static propTypes = {\n    config: PropTypes.object.isRequired,\n    value: PropTypes.any, //instanceOf(Immutable.List)\n    valueSrc: PropTypes.any, //instanceOf(Immutable.List)\n    valueError: PropTypes.any,\n    field: PropTypes.string,\n    operator: PropTypes.string,\n    readonly: PropTypes.bool,\n    asyncListValues: PropTypes.array,\n    id: PropTypes.string,\n    groupId: PropTypes.string,\n    //actions\n    setValue: PropTypes.func,\n    setValueSrc: PropTypes.func,\n    // for isFuncArg\n    isFuncArg: PropTypes.bool,\n    fieldFunc: PropTypes.string,\n    fieldArg: PropTypes.string,\n    leftField: PropTypes.string,\n    // for RuleGroupExt\n    isForRuleGruop: PropTypes.bool,\n    parentField: PropTypes.string,\n    // for func in func\n    parentFuncs: PropTypes.array,\n    // for case_value\n    isCaseValue: PropTypes.bool,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n    const prevProps = this.props;\n    const keysForMeta = [\n      \"config\", \"field\", \"fieldFunc\", \"fieldArg\", \"leftField\", \"operator\", \"valueSrc\", \"isFuncArg\", \"asyncListValues\"\n    ];\n    const needUpdateMeta = !this.meta \n          || keysForMeta\n            .map(k => (\n              nextProps[k] !== prevProps[k] \n                  //tip: for isFuncArg we need to wrap value in Imm list\n                  || k == \"isFuncArg\" && nextProps[\"isFuncArg\"] && nextProps[\"value\"] !== prevProps[\"value\"])\n            )\n            .filter(ch => ch).length > 0;\n\n    if (needUpdateMeta) {\n      this.meta = this.getMeta(nextProps);\n    }\n  }\n\n  _setValue = (isSpecialRange, delta, widgetType, value, asyncListValues, __isInternal) => {\n    if (isSpecialRange && Array.isArray(value)) {\n      const oldRange = [this.props.value.get(0), this.props.value.get(1)];\n      if (oldRange[0] != value[0])\n        this.props.setValue(0, value[0], widgetType, asyncListValues, __isInternal);\n      if (oldRange[1] != value[1])\n        this.props.setValue(1, value[1], widgetType, asyncListValues, __isInternal);\n    } else {\n      this.props.setValue(delta, value, widgetType, asyncListValues, __isInternal);\n    }\n  };\n\n  _onChangeValueSrc = (delta, srcKey) => {\n    this.props.setValueSrc(delta, srcKey);\n  };\n\n  getMeta({\n    config, field: simpleField, fieldFunc, fieldArg, operator, valueSrc: valueSrcs, value: values, \n    isForRuleGruop, isCaseValue, isFuncArg, leftField, asyncListValues\n  }) {\n    const field = isFuncArg ? {func: fieldFunc, arg: fieldArg} : simpleField;\n    let iValueSrcs = valueSrcs;\n    let iValues = values;\n    if (isFuncArg || isForRuleGruop || isCaseValue) {\n      iValueSrcs = Immutable.List([valueSrcs]);\n      iValues = Immutable.List([values]);\n    }\n\n    const fieldDefinition = getFieldConfig(config, field);\n    const defaultWidget = getWidgetForFieldOp(config, field, operator);\n    const _widgets = getWidgetsForFieldOp(config, field, operator);\n    const operatorDefinition = isFuncArg ? funcArgDummyOpDef : getOperatorConfig(config, operator, field);\n    if ((fieldDefinition == null || operatorDefinition == null) && !isCaseValue) {\n      return null;\n    }\n    const isSpecialRange = operatorDefinition?.isSpecialRange;\n    const isSpecialRangeForSrcField = isSpecialRange && (iValueSrcs.get(0) == \"field\" || iValueSrcs.get(1) == \"field\");\n    const isTrueSpecialRange = isSpecialRange && !isSpecialRangeForSrcField;\n    const cardinality = isTrueSpecialRange ? 1 : defaultValue(operatorDefinition?.cardinality, 1);\n    if (cardinality === 0) {\n      return null;\n    }\n\n    const valueSources = getValueSourcesForFieldOp(config, field, operator, fieldDefinition, isFuncArg ? leftField : null);\n\n    const widgets = range(0, cardinality).map(delta => {\n      const valueSrc = iValueSrcs.get(delta) || null;\n      let widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n      let widgetDefinition = getFieldWidgetConfig(config, field, operator, widget, valueSrc);\n      if (isSpecialRangeForSrcField) {\n        widget = widgetDefinition.singleWidget;\n        widgetDefinition = getFieldWidgetConfig(config, field, operator, widget, valueSrc);\n      }\n      const widgetType = widgetDefinition?.type;\n      const valueLabel = getValueLabel(config, field, operator, delta, valueSrc, isTrueSpecialRange);\n      const widgetValueLabel = getValueLabel(config, field, operator, delta, null, isTrueSpecialRange);\n      const sepText = operatorDefinition?.textSeparators ? operatorDefinition?.textSeparators[delta] : null;\n      const setValueSrcHandler = this._onChangeValueSrc.bind(this, delta);\n\n      let valueLabels = null;\n      let textSeparators = null;\n      if (isSpecialRange) {\n        valueLabels = [\n          getValueLabel(config, field, operator, 0),\n          getValueLabel(config, field, operator, 1)\n        ];\n        valueLabels = {\n          placeholder: [ valueLabels[0].placeholder, valueLabels[1].placeholder ],\n          label: [ valueLabels[0].label, valueLabels[1].label ],\n        };\n        textSeparators = operatorDefinition?.textSeparators;\n      }\n\n      const setValueHandler = this._setValue.bind(this, isSpecialRange, delta, widgetType);\n\n      return {\n        valueSrc,\n        valueLabel,\n        widget,\n        sepText,\n        setValueSrcHandler,\n        widgetDefinition,\n        widgetValueLabel,\n        valueLabels,\n        textSeparators,\n        setValueHandler\n      };\n    });\n      \n    return {\n      defaultWidget,\n      fieldDefinition,\n      operatorDefinition,\n      isSpecialRange: isTrueSpecialRange,\n      cardinality,\n      valueSources,\n      widgets,\n      iValues, //correct for isFuncArg\n      aField: field, //correct for isFuncArg\n      asyncListValues,\n    };\n  }\n\n  renderWidget = (delta, meta, props) => {\n    const {config, isFuncArg, leftField, operator, value: values, valueError, readonly, parentField, parentFuncs, id, groupId} = props;\n    const {settings} = config;\n    const { widgets, iValues, aField } = meta;\n    const value = isFuncArg ? iValues : values;\n    const field = isFuncArg ? leftField : aField;\n    const {valueSrc, valueLabel} = widgets[delta];\n \n    const widgetLabel = settings.showLabels\n      ? <label className=\"rule--label\">{valueLabel.label}</label>\n      : null;\n\n    return (\n      <div key={\"widget-\"+field+\"-\"+delta} className=\"widget--widget\">\n        {valueSrc == \"func\" ? null : widgetLabel}\n        <WidgetFactory\n          id={id}\n          groupId={groupId}\n          valueSrc={valueSrc}\n          delta={delta}\n          value={value}\n          valueError={valueError}\n          isFuncArg={isFuncArg}\n          {...pick(meta, [\"isSpecialRange\", \"fieldDefinition\", \"asyncListValues\"])}\n          {...pick(widgets[delta], [\"widget\", \"widgetDefinition\", \"widgetValueLabel\", \"valueLabels\", \"textSeparators\", \"setValueHandler\"])}\n          config={config}\n          field={field}\n          parentField={parentField}\n          parentFuncs={parentFuncs}\n          operator={operator}\n          readonly={readonly}\n        />\n      </div>\n    );\n  };\n\n  renderValueSources = (delta, meta, props) => {\n    const {config, isFuncArg, leftField, operator, readonly} = props;\n    const {settings} = config;\n    const { valueSources, widgets, aField } = meta;\n    const field = isFuncArg ? leftField : aField;\n    const {valueSrc, setValueSrcHandler} = widgets[delta];\n    const {valueSourcesInfo, renderValueSources: ValueSources} = settings;\n    const valueSourcesOptions = valueSources.map(srcKey => [srcKey, {\n      label: valueSourcesInfo[srcKey].label\n    }]);\n\n    const sourceLabel = settings.showLabels\n      ? <label className=\"rule--label\">&nbsp;</label>\n      : null;\n\n    return valueSources.length > 1 && !readonly\n      && <div key={\"valuesrc-\"+field+\"-\"+delta} className=\"widget--valuesrc\">\n        {sourceLabel}\n        <ValueSources\n          key={\"valuesrc-\"+delta}\n          delta={delta}\n          valueSources={valueSourcesOptions}\n          valueSrc={valueSrc}\n          config={config}\n          field={field}\n          operator={operator}\n          setValueSrc={setValueSrcHandler}\n          readonly={readonly}\n          title={settings.valueSourcesPopupTitle}\n        />\n      </div>;\n  };\n\n  renderSep = (delta, meta, props) => {\n    const {config} = props;\n    const {widgets} = meta;\n    const {settings} = config;\n    const {sepText} = widgets[delta];\n\n    const sepLabel = settings.showLabels\n      ? <label className=\"rule--label\">&nbsp;</label>\n      : null;\n\n    return sepText\n      && <div key={\"widget-separators-\"+delta} className=\"widget--sep\" >\n        {sepLabel}\n        <span>{sepText}</span>\n      </div>;\n  };\n\n  renderWidgetDelta = (delta) => {\n    const sep = this.renderSep(delta, this.meta, this.props);\n    const sources = this.renderValueSources(delta, this.meta, this.props);\n    const widgetCmp = this.renderWidget(delta, this.meta, this.props);\n\n    return [\n      sep,\n      sources,\n      widgetCmp,\n    ];\n  };\n\n  render() {\n    if (!this.meta) return null;\n    const { defaultWidget, cardinality } = this.meta;\n    if (!defaultWidget) return null;\n    const name = defaultWidget;\n\n    return (\n      <Col\n        className={`rule--widget rule--widget--${name.toUpperCase()}`}\n        key={\"widget-col-\"+name}\n      >\n        {range(0, cardinality).map(this.renderWidgetDelta)}\n      </Col>\n    );\n  }\n\n}\n","import React from \"react\";\n\nconst Col = ({children, ...props}) => (<div {...props}>{children}</div>);\n\nconst dummyFn = () => {};\n\nconst DragIcon = () => (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"gray\" width=\"18px\" height=\"18px\">\n    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n    <path d=\"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z\"/>\n  </svg>\n);\n\nconst ConfirmFn = (Cmp) => (\n  props => {\n    const {useConfirm} = props.config.settings;\n    const confirmFn = useConfirm ? useConfirm() : null;\n    return <Cmp {...props} confirmFn={confirmFn} />;\n  }\n);\n\nexport {\n  Col, dummyFn, DragIcon, ConfirmFn\n};\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport {getFieldConfig} from \"../../utils/configUtils\";\nimport {getFieldPath, getFieldPathLabels, getWidgetForFieldOp} from \"../../utils/ruleUtils\";\nimport {truncateString} from \"../../utils/stuff\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport last from \"lodash/last\";\nimport keys from \"lodash/keys\";\nimport clone from \"clone\";\n\n//tip: this.props.value - right value, this.props.field - left value\n\nexport default class ValueField extends PureComponent {\n  static propTypes = {\n    id: PropTypes.string,\n    groupId: PropTypes.string,\n    setValue: PropTypes.func.isRequired,\n    config: PropTypes.object.isRequired,\n    field: PropTypes.string.isRequired,\n    value: PropTypes.string,\n    operator: PropTypes.string,\n    customProps: PropTypes.object,\n    readonly: PropTypes.bool,\n    parentField: PropTypes.string,\n    fieldDefinition: PropTypes.object,\n    isFuncArg: PropTypes.bool,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n    const prevProps = this.props;\n    const keysForItems = [\"config\", \"field\", \"operator\", \"isFuncArg\", \"parentField\"];\n    const keysForMeta = [\"config\", \"field\", \"operator\", \"value\", \"placeholder\", \"isFuncArg\", \"parentField\"];\n    const needUpdateItems = !this.items || keysForItems.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n    const needUpdateMeta = !this.meta || keysForMeta.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n\n    if (needUpdateItems) {\n      this.items = this.getItems(nextProps);\n    }\n    if (needUpdateMeta) {\n      this.meta = this.getMeta(nextProps);\n    }\n  }\n\n  getItems({config, field, operator, parentField, isFuncArg, fieldDefinition}) {\n    const {canCompareFieldWithField} = config.settings;\n    const fieldSeparator = config.settings.fieldSeparator;\n    const parentFieldPath = typeof parentField == \"string\" ? parentField.split(fieldSeparator) : parentField;\n    const parentFieldConfig = parentField ? getFieldConfig(config, parentField) : null;\n    const sourceFields = parentField ? parentFieldConfig && parentFieldConfig.subfields : config.fields;\n\n    const filteredFields = this.filterFields(config, sourceFields, field, parentField, parentFieldPath, operator, canCompareFieldWithField, isFuncArg, fieldDefinition);\n    const items = this.buildOptions(parentFieldPath, config, filteredFields, parentFieldPath);\n    return items;\n  }\n\n  getMeta({config, field, operator, value, placeholder: customPlaceholder, isFuncArg, parentField}) {\n    const {fieldPlaceholder, fieldSeparatorDisplay} = config.settings;\n    const selectedKey = value;\n    const isFieldSelected = !!value;\n\n    const leftFieldConfig = getFieldConfig(config, field);\n    const leftFieldWidgetField = leftFieldConfig.widgets.field;\n    const leftFieldWidgetFieldProps = leftFieldWidgetField && leftFieldWidgetField.widgetProps || {};\n    const placeholder = isFieldSelected ? null \n      : (isFuncArg && customPlaceholder || leftFieldWidgetFieldProps.valuePlaceholder || fieldPlaceholder);\n    const currField = isFieldSelected ? getFieldConfig(config, selectedKey) : null;\n    const selectedOpts = currField || {};\n\n    const selectedKeys = getFieldPath(selectedKey, config);\n    const selectedPath = getFieldPath(selectedKey, config, true);\n    const selectedLabel = this.getFieldLabel(currField, selectedKey, config);\n    const partsLabels = getFieldPathLabels(selectedKey, config);\n    let selectedFullLabel = partsLabels ? partsLabels.join(fieldSeparatorDisplay) : null;\n    if (selectedFullLabel == selectedLabel || parentField)\n      selectedFullLabel = null;\n    const selectedAltLabel = selectedOpts.label2;\n\n    return {\n      placeholder,\n      selectedKey, selectedKeys, selectedPath, selectedLabel, selectedOpts, selectedAltLabel, selectedFullLabel,\n    };\n  }\n\n  filterFields(config, fields, leftFieldFullkey, parentField, parentFieldPath, operator, canCompareFieldWithField, isFuncArg, fieldDefinition) {\n    fields = clone(fields);\n    const fieldSeparator = config.settings.fieldSeparator;\n    const leftFieldConfig = getFieldConfig(config, leftFieldFullkey);\n    let expectedType;\n    const widget = getWidgetForFieldOp(config, leftFieldFullkey, operator, \"value\");\n    if (isFuncArg && fieldDefinition) {\n      expectedType = fieldDefinition.type;\n    } else if (widget) {\n      let widgetConfig = config.widgets[widget];\n      let widgetType = widgetConfig.type;\n      //expectedType = leftFieldConfig.type;\n      expectedType = widgetType;\n    } else {\n      expectedType = leftFieldConfig.type;\n    }\n    \n    function _filter(list, path) {\n      for (let rightFieldKey in list) {\n        let subfields = list[rightFieldKey].subfields;\n        let subpath = (path ? path : []).concat(rightFieldKey);\n        let rightFieldFullkey = subpath.join(fieldSeparator);\n        let rightFieldConfig = getFieldConfig(config, rightFieldFullkey);\n        if (!rightFieldConfig) {\n          delete list[rightFieldKey];\n        } else if (rightFieldConfig.type == \"!struct\" || rightFieldConfig.type == \"!group\") {\n          if(_filter(subfields, subpath) == 0)\n            delete list[rightFieldKey];\n        } else {\n          // tip: LHS field can be used as arg in RHS function\n          let canUse = rightFieldConfig.type == expectedType && (isFuncArg ? true : rightFieldFullkey != leftFieldFullkey);\n          let fn = canCompareFieldWithField || config.settings.canCompareFieldWithField;\n          if (fn)\n            canUse = canUse && fn(leftFieldFullkey, leftFieldConfig, rightFieldFullkey, rightFieldConfig, operator);\n          if (!canUse)\n            delete list[rightFieldKey];\n        }\n      }\n      return keys(list).length;\n    }\n\n    _filter(fields, parentFieldPath || []);\n\n    return fields;\n  }\n\n  buildOptions(parentFieldPath, config, fields, path = null, optGroupLabel = null) {\n    if (!fields)\n      return null;\n    const {fieldSeparator, fieldSeparatorDisplay} = config.settings;\n    const prefix = path ? path.join(fieldSeparator) + fieldSeparator : \"\";\n\n    return keys(fields).map(fieldKey => {\n      const field = fields[fieldKey];\n      const label = this.getFieldLabel(field, fieldKey, config);\n      const partsLabels = getFieldPathLabels(fieldKey, config);\n      let fullLabel = partsLabels.join(fieldSeparatorDisplay);\n      if (fullLabel == label || parentFieldPath)\n        fullLabel = null;\n      const altLabel = field.label2;\n      const tooltip = field.tooltip;\n      const subpath = (path ? path : []).concat(fieldKey);\n\n      if (field.hideForCompare)\n        return undefined;\n\n      if (field.type == \"!struct\" || field.type == \"!group\") {\n        return {\n          key: fieldKey,\n          path: prefix+fieldKey,\n          label,\n          fullLabel,\n          altLabel,\n          tooltip,\n          items: this.buildOptions(parentFieldPath, config, field.subfields, subpath, label)\n        };\n      } else {\n        return {\n          key: fieldKey,\n          path: prefix+fieldKey,\n          label,\n          fullLabel,\n          altLabel,\n          tooltip,\n          grouplabel: optGroupLabel\n        };\n      }\n    }).filter(o => !!o);\n  }\n\n  getFieldLabel(fieldOpts, fieldKey, config) {\n    if (!fieldKey) return null;\n    let fieldSeparator = config.settings.fieldSeparator;\n    let maxLabelsLength = config.settings.maxLabelsLength;\n    let fieldParts = Array.isArray(fieldKey) ? fieldKey : fieldKey.split(fieldSeparator);\n    let label = fieldOpts.label || last(fieldParts);\n    label = truncateString(label, maxLabelsLength);\n    return label;\n  }\n\n  render() {\n    const {config, customProps, setValue, readonly, id, groupId} = this.props;\n    const {renderField} = config.settings;\n    const renderProps = {\n      config,\n      customProps,\n      setField: setValue,\n      readonly,\n      items: this.items,\n      id,\n      groupId,\n      ...this.meta\n    };\n    return renderField(renderProps);\n  }\n\n}\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport {getFieldConfig, getFuncConfig} from \"../../utils/configUtils\";\nimport {\n  getFieldPath, getFuncPathLabels, getFieldPathLabels, getValueSourcesForFieldOp, getWidgetForFieldOp\n} from \"../../utils/ruleUtils\";\nimport {truncateString} from \"../../utils/stuff\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport last from \"lodash/last\";\nimport keys from \"lodash/keys\";\nimport clone from \"clone\";\n\n//tip: this.props.value - right value, this.props.field - left value\n\nexport default class FuncSelect extends PureComponent {\n  static propTypes = {\n    id: PropTypes.string,\n    groupId: PropTypes.string,\n    config: PropTypes.object.isRequired,\n    field: PropTypes.string.isRequired,\n    operator: PropTypes.string,\n    customProps: PropTypes.object,\n    value: PropTypes.string,\n    setValue: PropTypes.func.isRequired,\n    readonly: PropTypes.bool,\n    parentFuncs: PropTypes.array,\n    fieldDefinition: PropTypes.object,\n    isFuncArg: PropTypes.bool,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n      \n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n    const prevProps = this.props;\n    const keysForItems = [\"config\", \"field\", \"operator\", \"isFuncArg\"];\n    const keysForMeta = [\"config\", \"field\", \"value\"];\n    const needUpdateItems = !this.items || keysForItems.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n    const needUpdateMeta = !this.meta || keysForMeta.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n\n    if (needUpdateMeta) {\n      this.meta = this.getMeta(nextProps);\n    }\n    if (needUpdateItems) {\n      this.items = this.getItems(nextProps);\n    }\n  }\n\n  getItems({config, field, operator, parentFuncs, fieldDefinition, isFuncArg}) {\n    const {canUseFuncForField} = config.settings;\n    const filteredFuncs = this.filterFuncs(config, config.funcs, field, operator, canUseFuncForField, parentFuncs, isFuncArg, fieldDefinition);\n    const items = this.buildOptions(config, filteredFuncs);\n    return items;\n  }\n\n  getMeta({config, field, value}) {\n    const {funcPlaceholder, fieldSeparatorDisplay} = config.settings;\n    const selectedFuncKey = value;\n    const isFuncSelected = !!value;\n\n    const leftFieldConfig = getFieldConfig(config, field);\n    const leftFieldWidgetField = leftFieldConfig.widgets.field;\n    const leftFieldWidgetFieldProps = leftFieldWidgetField && leftFieldWidgetField.widgetProps || {};\n    const placeholder = !isFuncSelected ? funcPlaceholder : null;\n\n    const currFunc = isFuncSelected ? getFuncConfig(config, selectedFuncKey) : null;\n    const selectedOpts = currFunc || {};\n\n    const selectedKeys = getFieldPath(selectedFuncKey, config);\n    const selectedPath = getFieldPath(selectedFuncKey, config, true);\n    const selectedLabel = this.getFuncLabel(currFunc, selectedFuncKey, config);\n    const partsLabels = getFuncPathLabels(selectedFuncKey, config);\n    let selectedFullLabel = partsLabels ? partsLabels.join(fieldSeparatorDisplay) : null;\n    if (selectedFullLabel == selectedLabel)\n      selectedFullLabel = null;\n    \n    return {\n      placeholder,\n      selectedKey: selectedFuncKey, selectedKeys, selectedPath, selectedLabel, selectedOpts, selectedFullLabel,\n    };\n  }\n\n  filterFuncs(config, funcs, leftFieldFullkey, operator, canUseFuncForField, parentFuncs, isFuncArg, fieldDefinition) {\n    funcs = clone(funcs);\n    const fieldSeparator = config.settings.fieldSeparator;\n    const leftFieldConfig = getFieldConfig(config, leftFieldFullkey);\n    let expectedType;\n    let targetDefinition = leftFieldConfig;\n    const widget = getWidgetForFieldOp(config, leftFieldFullkey, operator, \"value\");\n    if (isFuncArg && fieldDefinition) {\n      targetDefinition = fieldDefinition;\n      expectedType = fieldDefinition.type;\n    } else if (widget) {\n      let widgetConfig = config.widgets[widget];\n      let widgetType = widgetConfig.type;\n      //expectedType = leftFieldConfig.type;\n      expectedType = widgetType;\n    } else {\n      expectedType = leftFieldConfig.type;\n    }\n\n    function _filter(list, path) {\n      for (let funcKey in list) {\n        let subfields = list[funcKey].subfields;\n        let subpath = (path ? path : []).concat(funcKey);\n        let funcFullkey = subpath.join(fieldSeparator);\n        let funcConfig = getFuncConfig(config, funcFullkey);\n        if (funcConfig.type == \"!struct\") {\n          if(_filter(subfields, subpath) == 0)\n            delete list[funcKey];\n        } else {\n          let canUse = funcConfig.returnType == expectedType;\n          if (targetDefinition.funcs)\n            canUse = canUse && targetDefinition.funcs.includes(funcFullkey);\n          if (canUseFuncForField)\n            canUse = canUse && canUseFuncForField(leftFieldFullkey, leftFieldConfig, funcFullkey, funcConfig, operator);\n          // don't use func in func (can be configurable, but usually users don't need this)\n          if (!funcConfig.allowSelfNesting && parentFuncs && parentFuncs.map(([func, _arg]) => func).includes(funcFullkey))\n            canUse = false;\n          if (!canUse)\n            delete list[funcKey];\n        }\n      }\n      return keys(list).length;\n    }\n\n    _filter(funcs, []);\n\n    return funcs;\n  }\n\n  buildOptions(config, funcs, path = null, optGroupLabel = null) {\n    if (!funcs)\n      return null;\n    const {fieldSeparator, fieldSeparatorDisplay} = config.settings;\n    const prefix = path ? path.join(fieldSeparator) + fieldSeparator : \"\";\n\n    return keys(funcs).map(funcKey => {\n      const func = funcs[funcKey];\n      const label = this.getFuncLabel(func, funcKey, config);\n      const partsLabels = getFuncPathLabels(funcKey, config);\n      let fullLabel = partsLabels.join(fieldSeparatorDisplay);\n      if (fullLabel == label)\n        fullLabel = null;\n      const tooltip = func.tooltip;\n      const subpath = (path ? path : []).concat(funcKey);\n\n      if (func.type == \"!struct\") {\n        return {\n          key: funcKey,\n          path: prefix+funcKey,\n          label,\n          fullLabel,\n          tooltip,\n          items: this.buildOptions(config, func.subfields, subpath, label)\n        };\n      } else {\n        return {\n          key: funcKey,\n          path: prefix+funcKey,\n          label,\n          fullLabel,\n          tooltip,\n          grouplabel: optGroupLabel\n        };\n      }\n    });\n  }\n\n  getFuncLabel(funcOpts, funcKey, config) {\n    if (!funcKey) return null;\n    let fieldSeparator = config.settings.fieldSeparator;\n    let maxLabelsLength = config.settings.maxLabelsLength;\n    let funcParts = Array.isArray(funcKey) ? funcKey : funcKey.split(fieldSeparator);\n    let label = funcOpts.label || last(funcParts);\n    label = truncateString(label, maxLabelsLength);\n    return label;\n  }\n\n  render() {\n    const {config, customProps, setValue, readonly, id, groupId} = this.props;\n    const {renderFunc} = config.settings;\n    const renderProps = {\n      config,\n      customProps,\n      readonly,\n      setField: setValue,\n      items: this.items,\n      id,\n      groupId,\n      ...this.meta\n    };\n    return renderFunc(renderProps);\n  }\n\n}\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport FuncSelect from \"./FuncSelect\";\nimport {\n  getFuncConfig\n} from \"../../utils/configUtils\";\nimport Widget from \"./Widget\";\nimport {Col} from \"../utils\";\nimport {setFunc, setArgValue, setArgValueSrc} from \"../../utils/funcUtils\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\n\n\nexport default class FuncWidget extends PureComponent {\n  static propTypes = {\n    id: PropTypes.string,\n    groupId: PropTypes.string,\n    config: PropTypes.object.isRequired,\n    field: PropTypes.string.isRequired,\n    operator: PropTypes.string,\n    customProps: PropTypes.object,\n    value: PropTypes.object, //instanceOf(Immutable.Map) //with keys 'func' and `args`\n    setValue: PropTypes.func.isRequired,\n    readonly: PropTypes.bool,\n    parentFuncs: PropTypes.array,\n    fieldDefinition: PropTypes.object,\n    isFuncArg: PropTypes.bool,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n    const prevProps = this.props;\n    const keysForMeta = [\"config\", \"field\", \"operator\", \"value\"];\n    const needUpdateMeta = !this.meta || keysForMeta.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n\n    if (needUpdateMeta) {\n      this.meta = this.getMeta(nextProps);\n    }\n  }\n\n  getMeta({config, field, operator, value}) {\n    const funcKey = value ? value.get(\"func\") : null;\n    const funcDefinition = funcKey ? getFuncConfig(config, funcKey) : null;\n\n    return {\n      funcDefinition, funcKey\n    };\n  }\n\n  setFunc = (funcKey) => {\n    this.props.setValue( setFunc(this.props.value, funcKey, this.props.config) );\n  };\n\n  setArgValue = (argKey, argVal) => {\n    const {config} = this.props;\n    const {funcDefinition} = this.meta;\n    const {args} = funcDefinition;\n    const argDefinition = args[argKey];\n\n    this.props.setValue( setArgValue(this.props.value, argKey, argVal, argDefinition, config) );\n  };\n\n  setArgValueSrc = (argKey, argValSrc) => {\n    const {config} = this.props;\n    const {funcDefinition} = this.meta;\n    const {args} = funcDefinition;\n    const argDefinition = args[argKey];\n\n    this.props.setValue( setArgValueSrc(this.props.value, argKey, argValSrc, argDefinition, config) );\n  };\n\n  renderFuncSelect = () => {\n    const {config, field, operator, customProps, value, readonly, parentFuncs, id, groupId, isFuncArg, fieldDefinition} = this.props;\n    const funcKey = value ? value.get(\"func\") : null;\n    const selectProps = {\n      value: funcKey,\n      setValue: this.setFunc,\n      config, field, operator, customProps, readonly, parentFuncs, \n      isFuncArg, fieldDefinition,\n      id, groupId,\n    };\n    const {showLabels, funcLabel} = config.settings;\n    const widgetLabel = showLabels\n      ? <label className=\"rule--label\">{funcLabel}</label>\n      : null;\n\n    return (\n      <Col key=\"func\" className=\"rule--func\">\n        {widgetLabel}\n        <FuncSelect {...selectProps} />\n      </Col>\n    );\n  };\n\n  renderArgLabel = (argKey, argDefinition) => {\n    const {valueSources, type, showPrefix, label} = argDefinition;\n    const {config} = this.props;\n    const isConst = valueSources && valueSources.length == 1 && valueSources[0] == \"const\";\n    const forceShow = !config.settings.showLabels && (type == \"boolean\" || isConst) && showPrefix;\n    if (!forceShow) return null;\n    return (\n      <Col className=\"rule--func--arg-label\">\n        {label || argKey}\n      </Col>\n    );\n  };\n\n  renderArgLabelSep = (argKey, argDefinition) => {\n    const {valueSources, type, showPrefix} = argDefinition;\n    const {config} = this.props;\n    const isConst = valueSources && valueSources.length == 1 && valueSources[0] == \"const\";\n    const forceShow = !config.settings.showLabels && (type == \"boolean\" || isConst) && showPrefix;\n    if (!forceShow) return null;\n    return (\n      <Col className=\"rule--func--arg-label-sep\">\n        {\":\"}\n      </Col>\n    );\n  };\n\n  renderArgVal = (funcKey, argKey, argDefinition) => {\n    const {config, field, operator, value, readonly, parentFuncs, id, groupId} = this.props;\n    const arg = value ? value.getIn([\"args\", argKey]) : null;\n    const argVal = arg ? arg.get(\"value\") : undefined;\n    const defaultValueSource = argDefinition.valueSources.length == 1 ? argDefinition.valueSources[0] : undefined;\n    const argValSrc = arg ? (arg.get(\"valueSrc\") || defaultValueSource || \"value\") : defaultValueSource;\n\n    const widgetProps = {\n      config, \n      fieldFunc: funcKey,\n      fieldArg: argKey,\n      leftField: field,\n      operator: null,\n      value: argVal,\n      valueSrc: argValSrc,\n      setValue: this.setArgValue,\n      setValueSrc: this.setArgValueSrc,\n      funcKey,\n      argKey,\n      argDefinition,\n      readonly,\n      parentFuncs,\n      id,\n      groupId,\n    };\n    //tip: value & valueSrc will be converted to Immutable.List at <Widget>\n\n    return (\n      <Col className=\"rule--func--arg-value\">\n        <ArgWidget {...widgetProps} />\n      </Col>\n    );\n  };\n\n  renderArgSep = (argKey, argDefinition, argIndex, {renderSeps}) => {\n    if (!argIndex) return null;\n    return (\n      <Col className=\"rule--func--arg-sep\">\n        {renderSeps ? renderSeps[argIndex - 1] : \", \"}\n      </Col>\n    );\n  };\n\n  renderBracketBefore = ({renderBrackets}) => {\n    return (\n      <Col key=\"before_args\" className=\"rule--func--bracket-before\">\n        {renderBrackets ? renderBrackets[0] : \"(\"}\n      </Col>\n    );\n  };\n\n  renderBracketAfter = ({renderBrackets}) => {\n    return (\n      <Col key=\"after_args\" className=\"rule--func--bracket-after\">\n        {renderBrackets ? renderBrackets[1] : \")\"}\n      </Col>\n    );\n  };\n\n  renderFuncArgs = () => {\n    const {funcDefinition, funcKey} = this.meta;\n    if (!funcKey) return null;\n    const {args} = funcDefinition;\n    if (!args) return null;\n\n    return (\n      <>\n        {this.renderBracketBefore(funcDefinition)}\n        <Col key=\"args\" className=\"rule--func--args\">\n          {Object.keys(args).map((argKey, argIndex) => (\n            <Col key={`arg-${argKey}-${argIndex}`} className=\"rule--func--arg\">\n              {this.renderArgSep(argKey, args[argKey], argIndex, funcDefinition)}\n              {this.renderArgLabel(argKey, args[argKey])}\n              {this.renderArgLabelSep(argKey, args[argKey])}\n              {this.renderArgVal(funcKey, argKey, args[argKey])}\n            </Col>\n          ))}\n        </Col>\n        {this.renderBracketAfter(funcDefinition)}\n      </>\n    );\n  };\n\n  render() {\n    return (\n      <Col className=\"rule--func--wrapper\">\n        {this.renderFuncSelect()}\n        {this.renderFuncArgs()}\n      </Col>\n    );\n  }\n}\n\n\nclass ArgWidget extends PureComponent {\n  static propTypes = {\n    funcKey: PropTypes.string.isRequired,\n    argKey: PropTypes.string.isRequired,\n    setValue: PropTypes.func.isRequired,\n    setValueSrc: PropTypes.func.isRequired,\n    readonly: PropTypes.bool,\n    parentFuncs: PropTypes.array,\n    id: PropTypes.string,\n    groupId: PropTypes.string,\n  };\n\n  setValue = (_delta, value, _widgetType) => {\n    const {setValue, argKey} = this.props;\n    setValue(argKey, value);\n  };\n\n  setValueSrc = (_delta, valueSrc, _widgetType) => {\n    const {setValueSrc, argKey} = this.props;\n    setValueSrc(argKey, valueSrc);\n  };\n\n  render() {\n    const {funcKey, argKey, parentFuncs} = this.props;\n    return (\n      <Widget\n        {...this.props} \n        setValue={this.setValue} \n        setValueSrc={this.setValueSrc} \n        isFuncArg={true}\n        parentFuncs={[...(parentFuncs || []), [funcKey, argKey]]}\n      />\n    );\n  }\n}\n","import React from \"react\";\nimport uuid from \"../../../../utils/uuid\";\n\nexport default (props) => {\n  const {value, setValue, config, labelYes, labelNo, readonly, customProps = {}} = props;\n  const customRadioYesProps = customProps.radioYes || {};\n  const customRadioNoProps = customProps.radioNo || {};\n\n  const onCheckboxChange = e => setValue(e.target.checked);\n  const onRadioChange = e => setValue(e.target.value == \"true\");\n  const id = uuid(), id2 = uuid();\n\n  // return <>\n  //     <input key={id}  type=\"checkbox\" id={id} checked={!!value} disabled={readonly} onChange={onCheckboxChange} />\n  //     <label style={{display: \"inline\"}} key={id+\"label\"}  htmlFor={id}>{value ? labelYes : labelNo}</label>\n  // </>;\n\n  return <>\n    <input key={id}  type=\"radio\" id={id} value={true} checked={!!value} disabled={readonly} onChange={onRadioChange} { ...customRadioYesProps }/>\n    <label style={{display: \"inline\"}} key={id+\"label\"}  htmlFor={id}>{labelYes}</label>\n    <input key={id2}  type=\"radio\" id={id2} value={false} checked={!value} disabled={readonly} onChange={onRadioChange} { ...customRadioNoProps } />\n    <label style={{display: \"inline\"}} key={id2+\"label\"}  htmlFor={id2}>{labelNo}</label>\n  </>;\n\n};\n","import React from \"react\";\n\nexport default (props) => {\n  const {value, setValue, config, readonly, placeholder, maxLength, customProps, } = props;\n  const onChange = e => {\n    let val = e.target.value;\n    if (val === \"\")\n      val = undefined; // don't allow empty value\n    setValue(val);\n  };\n  const textValue = value || \"\";\n  return (\n    <input\n      type=\"text\" \n      value={textValue} \n      placeholder={placeholder} \n      disabled={readonly} \n      onChange={onChange}\n      maxLength={maxLength}\n      {...customProps}\n    />\n  );\n};\n","import React from \"react\";\n\nexport default (props) => {\n  const {value, setValue, config, readonly, placeholder, maxLength, maxRows, fullWidth, customProps, } = props;\n  const onChange = e => {\n    let val = e.target.value;\n    if (val === \"\")\n      val = undefined; // don't allow empty value\n    setValue(val);\n  };\n  const textValue = value || \"\";\n  return (\n    <textarea\n      value={textValue} \n      placeholder={placeholder}\n      disabled={readonly}\n      onChange={onChange}\n      maxLength={maxLength}\n      style={{\n        width: fullWidth ? \"100%\" : undefined\n      }}\n      {...customProps}\n    />\n  );\n};\n","import React from \"react\";\nimport moment from \"moment\";\n\nexport default (props) => {\n  const {value, setValue, config, valueFormat, readonly, customProps, } = props;\n\n  const onChange = e => {\n    let value = e.target.value;\n    if (value == \"\")\n      value = undefined;\n    setValue(value);\n  };\n  \n  return (\n    <input type=\"date\"  value={value || \"\"}  disabled={readonly} onChange={onChange} {...customProps} />\n  );\n};\n","import React from \"react\";\n\nexport default (props) => {\n  const {value, setValue, config, valueFormat, use12Hours, readonly, customProps } = props;\n\n  const onChange = e => {\n    let value = e.target.value;\n    if (value == \"\")\n      value = undefined;\n    setValue(value);\n  };\n  \n  return (\n    <input type=\"time\"  value={value || \"\"}  disabled={readonly} onChange={onChange} {...customProps} />\n  );\n};\n","import React from \"react\";\nimport moment from \"moment\";\n\nexport default (props) => {\n  const {value, setValue, config, valueFormat, use12Hours, readonly, customProps, } = props;\n\n  const onChange = e => {\n    let value = e.target.value;\n    if (value == \"\")\n      value = undefined;\n    else\n      value = moment(new Date(value)).format(valueFormat);\n    setValue(value);\n  };\n\n  let dtValue = value;\n  if (!value)\n    dtValue = \"\";\n  else\n    dtValue = moment(value).format(\"YYYY-MM-DDTHH:mm\");\n  \n  return (\n    <input type=\"datetime-local\"  value={dtValue}  disabled={readonly} onChange={onChange} {...customProps} />\n  );\n};\n","import React from \"react\";\nimport {mapListValues} from \"../../../../utils/stuff\";\nimport omit from \"lodash/omit\";\n\nexport default ({listValues, value, setValue, allowCustomValues, readonly, customProps,}) => {\n  const renderOptions = () => \n    mapListValues(listValues, ({title, value}) => {\n      return <option key={value} value={value}>{title}</option>;\n    });\n\n  const getMultiSelectValues = (multiselect) => {\n    let values = [];\n    const options = multiselect.options;\n    for (let i = 0 ; i < options.length ; i++) {\n      const opt = options[i];\n      if (opt.selected) {\n        values.push(opt.value);\n      }\n    }\n    if (!values.length)\n      values = undefined; //not allow []\n    return values;\n  };\n\n  const onChange = e => setValue(getMultiSelectValues(e.target));\n  \n  return (\n    <select multiple\n      onChange={onChange}\n      value={value}\n      disabled={readonly}\n      {...omit(customProps, [\"showSearch\", \"input\", \"showCheckboxes\"])}\n    >\n      {renderOptions()}\n    </select>\n  );\n};\n","import React from \"react\";\nimport {mapListValues} from \"../../../../utils/stuff\";\nimport omit from \"lodash/omit\";\n\nexport default ({listValues, value, setValue, allowCustomValues, readonly, customProps,}) => {\n  const renderOptions = () => \n    mapListValues(listValues, ({title, value}) => {\n      return <option key={value} value={value}>{title}</option>;\n    });\n\n  const onChange = e => setValue(e.target.value);\n  \n  const hasValue = value != null;\n  return (\n    <select\n      onChange={onChange}\n      value={hasValue ? value : \"\"}\n      disabled={readonly}\n      {...omit(customProps, [\"showSearch\", \"input\"])}\n    >\n      {!hasValue && <option disabled value={\"\"}></option>}\n      {renderOptions()}\n    </select>\n  );\n};\n","import React from \"react\";\n\nexport default (props) => {\n  const {value, setValue, config, readonly, min, max, step, placeholder, customProps, } = props;\n  const onChange = e => {\n    let val = e.target.value;\n    if (val === \"\" || val === null)\n      val = undefined;\n    else\n      val = Number(val);\n    setValue(val);\n  };\n  const numberValue = value == undefined ? \"\" : value;\n  return (\n    <input type=\"number\"  value={numberValue} placeholder={placeholder} disabled={readonly} min={min} max={max} step={step} onChange={onChange} {...customProps} />\n  );\n};\n","import React from \"react\";\n\nexport default (props) => {\n  const {value, setValue, config, readonly, min, max, step, placeholder, customProps = {}, } = props;\n  const customInputProps = customProps.input || {};\n  const customSliderProps = customProps.slider || customProps;\n  const onChange = e => {\n    let val = e.target.value;\n    if (val === \"\" || val === null)\n      val = undefined;\n    else\n      val = Number(val);\n    setValue(val);\n  };\n  const numberValue = value == undefined ? \"\" : value;\n  return [\n    <input key={\"number\"} type=\"number\"  value={numberValue} placeholder={placeholder} disabled={readonly} min={min} max={max} step={step} onChange={onChange} {...customInputProps} />\n    ,\n    <input key={\"range\"} type=\"range\"  value={numberValue} disabled={readonly} min={min} max={max} step={step} onChange={onChange} {...customSliderProps} />\n  ];\n};\n","import React from \"react\";\n\nexport default ({items, setField, selectedKey, readonly}) => {\n  const renderOptions = (fields) => (\n    fields.map(field => {\n      const {items, path, label, disabled} = field;\n      if (items) {\n        return <optgroup disabled={disabled} key={path} label={label}>{renderOptions(items)}</optgroup>;\n      } else {\n        return <option disabled={disabled} key={path} value={path}>{label}</option>;\n      }\n    })\n  );\n\n  const onChange = e => setField(e.target.value);\n  \n  const hasValue = selectedKey != null;\n  return (\n    <select \n      onChange={onChange}\n      value={hasValue ? selectedKey : \"\"}\n      disabled={readonly}\n    >\n      {!hasValue && <option disabled value={\"\"}></option>}\n      {renderOptions(items)}\n    </select>\n  );\n};\n","import React from \"react\";\n\nexport default ({id, not, setNot, conjunctionOptions, setConjunction, disabled, readonly, config, showNot, notLabel}) => {\n  const conjsCount = Object.keys(conjunctionOptions).length;\n  const lessThenTwo = disabled;\n  const {forceShowConj} = config.settings;\n  const showConj = forceShowConj || conjsCount > 1 && !lessThenTwo;\n\n  const renderOptions = () => \n    Object.keys(conjunctionOptions).map(key => {\n      const {id, name, label, checked} = conjunctionOptions[key];\n      const postfix = setConjunction.isDummyFn ? \"__dummy\" : \"\";\n      if ((readonly || disabled) && !checked)\n        return null;\n      return [\n        <input key={id+postfix} type=\"radio\" id={id+postfix} name={name+postfix} checked={checked} disabled={readonly || disabled} value={key} onChange={onChange} />\n        ,\n        <label key={id+postfix+\"label\"} htmlFor={id+postfix}>{label}</label>\n      ];\n    });\n  \n  const renderNot = () => {\n    const postfix = \"not\";\n    return [\n      <input key={id+postfix}  type=\"checkbox\" id={id+postfix} checked={not} disabled={readonly} onChange={onNotChange} />\n      ,\n      <label key={id+postfix+\"label\"}  htmlFor={id+postfix}>{notLabel || \"NOT\"}</label>\n    ];\n  };\n\n  const onChange = e => setConjunction(e.target.value);\n\n  const onNotChange = e => setNot(e.target.checked);\n\n  return [\n    showNot && renderNot(),\n    showConj && renderOptions()\n  ];\n  \n};\n","import React from \"react\";\n\nexport default ({type, label, onClick, readonly, config}) => {\n  const typeToLabel = {\n    \"addRuleGroup\": \"+\",\n    \"addRuleGroupExt\": \"+\",\n    \"delGroup\": \"x\",\n    \"delRuleGroup\": \"x\",\n    \"delRule\": \"x\",\n  };\n  const btnLabel = label || typeToLabel[type];\n  return <button onClick={onClick} type=\"button\" disabled={readonly}>{btnLabel}</button>;\n};\n","import React from \"react\";\n\nexport default ({children, config}) => {\n  return <>{children}</>;\n};\n","import React from \"react\";\n\nexport default ({config, valueSources, valueSrc, title, setValueSrc, readonly}) => {\n  const renderOptions = (valueSources) => (\n    valueSources.map(([srcKey, info]) => (\n      <option key={srcKey} value={srcKey}>{info.label}</option>\n    ))\n  );\n\n  const onChange = e => setValueSrc(e.target.value);\n  \n  return (\n    <select \n      onChange={onChange}\n      value={valueSrc}\n      disabled={readonly}\n    >\n      {renderOptions(valueSources)}\n    </select>\n  );\n};\n","import React from \"react\";\n\nexport default ({value, setValue, label, id, config, type}) => {\n  const onChange = e => setValue(e.target.checked);\n  const postfix = type;\n  return [\n    <input key={id+postfix}  type=\"checkbox\" id={id+postfix} checked={!!value} onChange={onChange} />\n    ,\n    <label key={id+postfix+\"label\"}  htmlFor={id+postfix}>{label}</label>\n  ];\n};\n","export default ({onOk, okText, cancelText, title}) => {\n  if (confirm(title)) {\n    onOk();\n  }\n};\n","import React from \"react\";\n\n// value widgets\nexport {default as VanillaBooleanWidget} from \"./value/VanillaBoolean\";\nexport {default as VanillaTextWidget} from \"./value/VanillaText\";\nexport {default as VanillaTextAreaWidget} from \"./value/VanillaTextArea\";\nexport {default as VanillaDateWidget} from \"./value/VanillaDate\";\nexport {default as VanillaTimeWidget} from \"./value/VanillaTime\";\nexport {default as VanillaDateTimeWidget} from \"./value/VanillaDateTime\";\nexport {default as VanillaMultiSelectWidget} from \"./value/VanillaMultiSelect\";\nexport {default as VanillaSelectWidget} from \"./value/VanillaSelect\";\nexport {default as VanillaNumberWidget} from \"./value/VanillaNumber\";\nexport {default as VanillaSliderWidget} from \"./value/VanillaSlider\";\n\n// field select widget\nexport {default as VanillaFieldSelect} from \"./core/VanillaFieldSelect\";\n\n// core components\nexport {default as VanillaConjs} from \"./core/VanillaConjs\";\nexport {default as VanillaButton} from \"./core/VanillaButton\";\nexport {default as VanillaButtonGroup} from \"./core/VanillaButtonGroup\";\nexport {default as VanillaValueSources} from \"./core/VanillaValueSources\";\nexport {default as VanillaSwitch} from \"./core/VanillaSwitch\";\nexport {default as vanillaConfirm} from \"./core/vanillaConfirm\";\n\nexport const VanillaProvider = ({config, children}) => children;\n","import React from \"react\";\nimport * as Widgets from \"../components/widgets\";\nimport * as Operators from \"../components/operators\";\nimport {SqlString, sqlEmptyValue, mongoEmptyValue, spelEscape, spelFixList} from \"../utils/export\";\nimport {escapeRegExp, getTitleInListValues} from \"../utils/stuff\";\nimport moment from \"moment\";\nimport {settings as defaultSettings} from \"../config/default\";\n\nconst {\n  //vanilla\n  VanillaBooleanWidget,\n  VanillaTextWidget,\n  VanillaTextAreaWidget,\n  VanillaDateWidget,\n  VanillaTimeWidget,\n  VanillaDateTimeWidget,\n  VanillaMultiSelectWidget,\n  VanillaSelectWidget,\n  VanillaNumberWidget,\n  VanillaSliderWidget,\n\n  //common\n  ValueFieldWidget,\n  FuncWidget\n} = Widgets;\nconst { ProximityOperator } = Operators;\n\n\n//----------------------------  conjunctions\n\nconst conjunctions = {\n  AND: {\n    label: \"And\",\n    mongoConj: \"$and\",\n    jsonLogicConj: \"and\",\n    sqlConj: \"AND\",\n    spelConj: \"and\",\n    spelConjs: [\"and\", \"&&\"],\n    reversedConj: \"OR\",\n    formatConj: (children, conj, not, isForDisplay) => {\n      return children.size > 1\n        ? (not ? \"NOT \" : \"\") + \"(\" + children.join(\" \" + (isForDisplay ? \"AND\" : \"&&\") + \" \") + \")\"\n        : (not ? \"NOT (\" : \"\") + children.first() + (not ? \")\" : \"\");\n    },\n    sqlFormatConj: (children, conj, not) => {\n      return children.size > 1\n        ? (not ? \"NOT \" : \"\") + \"(\" + children.join(\" \" + \"AND\" + \" \") + \")\"\n        : (not ? \"NOT (\" : \"\") + children.first() + (not ? \")\" : \"\");\n    },\n    spelFormatConj: (children, conj, not, omitBrackets) => {\n      if (not) omitBrackets = false;\n      return children.size > 1\n        ? (not ? \"!\" : \"\") + (omitBrackets ? \"\" : \"(\") + children.join(\" \" + \"&&\" + \" \") + (omitBrackets ? \"\" : \")\")\n        : (not ? \"!(\" : \"\") + children.first() + (not ? \")\" : \"\");\n    },\n  },\n  OR: {\n    label: \"Or\",\n    mongoConj: \"$or\",\n    jsonLogicConj: \"or\",\n    sqlConj: \"OR\",\n    spelConj: \"or\",\n    spelConjs: [\"or\", \"||\"],\n    reversedConj: \"AND\",\n    formatConj: (children, conj, not, isForDisplay) => {\n      return children.size > 1\n        ? (not ? \"NOT \" : \"\") + \"(\" + children.join(\" \" + (isForDisplay ? \"OR\" : \"||\") + \" \") + \")\"\n        : (not ? \"NOT (\" : \"\") + children.first() + (not ? \")\" : \"\");\n    },\n    sqlFormatConj: (children, conj, not) => {\n      return children.size > 1\n        ? (not ? \"NOT \" : \"\") + \"(\" + children.join(\" \" + \"OR\" + \" \") + \")\"\n        : (not ? \"NOT (\" : \"\") + children.first() + (not ? \")\" : \"\");\n    },\n    spelFormatConj: (children, conj, not, omitBrackets) => {\n      if (not) omitBrackets = false;\n      return children.size > 1\n        ? (not ? \"!\" : \"\") + (omitBrackets ? \"\" : \"(\") + children.join(\" \" + \"||\" + \" \") + (omitBrackets ? \"\" : \")\")\n        : (not ? \"!(\" : \"\") + children.first() + (not ? \")\" : \"\");\n    },\n  },\n};\n\n//----------------------------  operators\n\n// helpers for mongo format\nexport const mongoFormatOp1 = (mop, mc, not,  field, _op, value, useExpr, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n  const $field = typeof field == \"string\" && !field.startsWith(\"$\") ? \"$\"+field : field;\n  const mv = mc(value, fieldDef);\n  if (mv === undefined)\n    return undefined;\n  if (not) {\n    if (!useExpr && (!mop || mop == \"$eq\"))\n      return { [field]: { \"$ne\": mv } }; // short form\n    return !useExpr\n      ? { [field]: { \"$not\": { [mop]: mv } } } \n      : { \"$not\": { [mop]: [$field, mv] } };\n  } else {\n    if (!useExpr && (!mop || mop == \"$eq\"))\n      return { [field]: mv }; // short form\n    return !useExpr\n      ? { [field]: { [mop]: mv } } \n      : { [mop]: [$field, mv] };\n  }\n};\n\nexport const mongoFormatOp2 = (mops, not,  field, _op, values, useExpr, valueSrcs, valueTypes, opDef, operatorOptions, fieldDef) => {\n  const $field = typeof field == \"string\" && !field.startsWith(\"$\") ? \"$\"+field : field;\n  if (not) {\n    return !useExpr\n      ? { [field]: { \"$not\": { [mops[0]]: values[0], [mops[1]]: values[1] } } } \n      : {\"$not\":\n                {\"$and\": [\n                  { [mops[0]]: [ $field, values[0] ] },\n                  { [mops[1]]: [ $field, values[1] ] },\n                ]}\n      };\n  } else {\n    return !useExpr\n      ? { [field]: { [mops[0]]: values[0], [mops[1]]: values[1] } } \n      : {\"$and\": [\n        { [mops[0]]: [ $field, values[0] ] },\n        { [mops[1]]: [ $field, values[1] ] },\n      ]};\n  }\n};\n\n\nconst operators = {\n  equal: {\n    label: \"==\",\n    labelForFormat: \"==\",\n    sqlOp: \"=\",\n    spelOp: \"==\",\n    spelOps: [\"==\", \"eq\"],\n    reversedOp: \"not_equal\",\n    formatOp: (field, op, value, valueSrcs, valueTypes, opDef, operatorOptions, isForDisplay, fieldDef) => {\n      const opStr = isForDisplay ? \"=\" : opDef.label;\n      if (valueTypes == \"boolean\" && isForDisplay)\n        return value == \"No\" ? `NOT ${field}` : `${field}`;\n      else\n        return `${field} ${opStr} ${value}`;\n    },\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$eq\", v => v, false),\n    jsonLogic: \"==\",\n    elasticSearchQueryType: \"term\",\n  },\n  not_equal: {\n    isNotOp: true,\n    label: \"!=\",\n    labelForFormat: \"!=\",\n    sqlOp: \"<>\",\n    spelOp: \"!=\",\n    spelOps: [\"!=\", \"ne\"],\n    reversedOp: \"equal\",\n    formatOp: (field, op, value, valueSrcs, valueTypes, opDef, operatorOptions, isForDisplay, fieldDef) => {\n      if (valueTypes == \"boolean\" && isForDisplay)\n        return value == \"No\" ? `${field}` : `NOT ${field}`;\n      else\n        return `${field} ${opDef.label} ${value}`;\n    },\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$ne\", v => v, false),\n    jsonLogic: \"!=\",\n  },\n  less: {\n    label: \"<\",\n    labelForFormat: \"<\",\n    sqlOp: \"<\",\n    spelOp: \"<\",\n    spelOps: [\"<\", \"lt\"],\n    reversedOp: \"greater_or_equal\",\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$lt\", v => v, false),\n    jsonLogic: \"<\",\n    elasticSearchQueryType: \"range\",\n  },\n  less_or_equal: {\n    label: \"<=\",\n    labelForFormat: \"<=\",\n    sqlOp: \"<=\",\n    spelOp: \"<=\",\n    spelOps: [\"<=\", \"le\"],\n    reversedOp: \"greater\",\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$lte\", v => v, false),\n    jsonLogic: \"<=\",\n    elasticSearchQueryType: \"range\",\n  },\n  greater: {\n    label: \">\",\n    labelForFormat: \">\",\n    sqlOp: \">\",\n    spelOp: \">\",\n    spelOps: [\">\", \"gt\"],\n    reversedOp: \"less_or_equal\",\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$gt\", v => v, false),\n    jsonLogic: \">\",\n    elasticSearchQueryType: \"range\",\n  },\n  greater_or_equal: {\n    label: \">=\",\n    labelForFormat: \">=\",\n    sqlOp: \">=\",\n    spelOp: \">=\",\n    spelOps: [\">=\", \"ge\"],\n    reversedOp: \"less\",\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$gte\", v => v, false),\n    jsonLogic: \">=\",\n    elasticSearchQueryType: \"range\",\n  },\n  like: {\n    label: \"Contains\",\n    labelForFormat: \"Contains\",\n    reversedOp: \"not_like\",\n    sqlOp: \"LIKE\",\n    spelOp: \".contains\",\n    spelOps: [\"matches\", \".contains\"],\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$regex\", v => (typeof v == \"string\" ? escapeRegExp(v) : undefined), false),\n    //jsonLogic: (field, op, val) => ({ \"in\": [val, field] }),\n    jsonLogic: \"in\",\n    _jsonLogicIsRevArgs: true,\n    valueSources: [\"value\"],\n    elasticSearchQueryType: \"regexp\",\n  },\n  not_like: {\n    isNotOp: true,\n    label: \"Not contains\",\n    reversedOp: \"like\",\n    labelForFormat: \"Not Contains\",\n    sqlOp: \"NOT LIKE\",\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$regex\", v => (typeof v == \"string\" ? escapeRegExp(v) : undefined), true),\n    valueSources: [\"value\"],\n  },\n  starts_with: {\n    label: \"Starts with\",\n    labelForFormat: \"Starts with\",\n    sqlOp: \"LIKE\",\n    spelOp: \".startsWith\",\n    spelOps: [\"matches\", \".startsWith\"],\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$regex\", v => (typeof v == \"string\" ? \"^\" + escapeRegExp(v) : undefined), false),\n    jsonLogic: undefined, // not supported\n    valueSources: [\"value\"],\n  },\n  ends_with: {\n    label: \"Ends with\",\n    labelForFormat: \"Ends with\",\n    sqlOp: \"LIKE\",\n    spelOp: \".endsWith\",\n    spelOps: [\"matches\", \".endsWith\"],\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$regex\", v => (typeof v == \"string\" ? escapeRegExp(v) + \"$\" : undefined), false),\n    jsonLogic: undefined, // not supported\n    valueSources: [\"value\"],\n  },\n  between: {\n    label: \"Between\",\n    labelForFormat: \"BETWEEN\",\n    sqlOp: \"BETWEEN\",\n    cardinality: 2,\n    formatOp: (field, op, values, valueSrcs, valueTypes, opDef, operatorOptions, isForDisplay) => {\n      let valFrom = values.first();\n      let valTo = values.get(1);\n      if (isForDisplay)\n        return `${field} BETWEEN ${valFrom} AND ${valTo}`;\n      else\n        return `${field} >= ${valFrom} && ${field} <= ${valTo}`;\n    },\n    spelFormatOp: (field, op, values, valueSrc, valueTypes, opDef, operatorOptions, fieldDef) => {\n      const valFrom = values[0];\n      const valTo = values[1];\n      return `${field} >= ${valFrom} && ${field} <= ${valTo}`;\n    },\n    mongoFormatOp: mongoFormatOp2.bind(null, [\"$gte\", \"$lte\"], false),\n    valueLabels: [\n      \"Value from\",\n      \"Value to\"\n    ],\n    textSeparators: [\n      null,\n      \"and\"\n    ],\n    reversedOp: \"not_between\",\n    jsonLogic: \"<=\",\n    validateValues: (values) => {\n      if (values[0] != undefined && values[1] != undefined) {\n        return values[0] <= values[1] ? null : \"Invalid range\";\n      }\n      return null;\n    },\n    elasticSearchQueryType: function elasticSearchQueryType(type) {\n      return type === \"time\" ? \"filter\" : \"range\";\n    },\n  },\n  not_between: {\n    isNotOp: true,\n    label: \"Not between\",\n    labelForFormat: \"NOT BETWEEN\",\n    sqlOp: \"NOT BETWEEN\",\n    cardinality: 2,\n    formatOp: (field, op, values, valueSrcs, valueTypes, opDef, operatorOptions, isForDisplay) => {\n      let valFrom = values.first();\n      let valTo = values.get(1);\n      if (isForDisplay)\n        return `${field} NOT BETWEEN ${valFrom} AND ${valTo}`;\n      else\n        return `(${field} < ${valFrom} || ${field} > ${valTo})`;\n    },\n    spelFormatOp: (field, op, values, valueSrc, valueTypes, opDef, operatorOptions, fieldDef) => {\n      const valFrom = values[0];\n      const valTo = values[1];\n      return `(${field} < ${valFrom} || ${field} > ${valTo})`;\n    },\n    mongoFormatOp: mongoFormatOp2.bind(null, [\"$gte\", \"$lte\"], true),\n    valueLabels: [\n      \"Value from\",\n      \"Value to\"\n    ],\n    textSeparators: [\n      null,\n      \"and\"\n    ],\n    reversedOp: \"between\",\n    validateValues: (values) => {\n      if (values[0] != undefined && values[1] != undefined) {\n        return values[0] <= values[1] ? null : \"Invalid range\";\n      }\n      return null;\n    },\n  },\n  is_empty: {\n    label: \"Is empty\",\n    labelForFormat: \"IS EMPTY\",\n    cardinality: 0,\n    reversedOp: \"is_not_empty\",\n    formatOp: (field, op, value, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      return isForDisplay ? `${field} IS EMPTY` : `!${field}`;\n    },\n    sqlFormatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      const empty = sqlEmptyValue(fieldDef);\n      return `COALESCE(${field}, ${empty}) = ${empty}`;\n    },\n    spelFormatOp: (field, op, values, valueSrc, valueTypes, opDef, operatorOptions, fieldDef) => {\n      //tip: is empty or null\n      return `${field} <= ''`;\n    },\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$in\", (v, fieldDef) => [mongoEmptyValue(fieldDef), null], false),\n    jsonLogic: \"!\",\n  },\n  is_not_empty: {\n    isNotOp: true,\n    label: \"Is not empty\",\n    labelForFormat: \"IS NOT EMPTY\",\n    cardinality: 0,\n    reversedOp: \"is_empty\",\n    formatOp: (field, op, value, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      return isForDisplay ? `${field} IS NOT EMPTY` : `!!${field}`;\n    },\n    sqlFormatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      const empty = sqlEmptyValue(fieldDef);\n      return `COALESCE(${field}, ${empty}) <> ${empty}`;\n    },\n    spelFormatOp: (field, op, values, valueSrc, valueTypes, opDef, operatorOptions, fieldDef) => {\n      //tip: is not empty and not null\n      return `${field} > ''`;\n    },\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$nin\", (v, fieldDef) => [mongoEmptyValue(fieldDef), null], false),\n    jsonLogic: \"!!\",\n    elasticSearchQueryType: \"exists\",\n  },\n  is_null: {\n    label: \"Is null\",\n    labelForFormat: \"IS NULL\",\n    sqlOp: \"IS NULL\",\n    cardinality: 0,\n    reversedOp: \"is_not_null\",\n    formatOp: (field, op, value, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      return isForDisplay ? `${field} IS NULL` : `!${field}`;\n    },\n    spelFormatOp: (field, op, values, valueSrc, valueTypes, opDef, operatorOptions, fieldDef) => {\n      return `${field} == null`;\n    },\n    // check if value is null OR not exists\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$eq\", v => null, false),\n    jsonLogic: \"==\",\n  },\n  is_not_null: {\n    label: \"Is not null\",\n    labelForFormat: \"IS NOT NULL\",\n    sqlOp: \"IS NOT NULL\",\n    cardinality: 0,\n    reversedOp: \"is_null\",\n    formatOp: (field, op, value, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      return isForDisplay ? `${field} IS NOT NULL` : `!!${field}`;\n    },\n    spelFormatOp: (field, op, values, valueSrc, valueTypes, opDef, operatorOptions, fieldDef) => {\n      return `${field} != null`;\n    },\n    // check if value exists and is not null\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$ne\", v => null, false),\n    jsonLogic: \"!=\",\n    elasticSearchQueryType: \"exists\",\n  },\n  select_equals: {\n    label: \"==\",\n    labelForFormat: \"==\",\n    sqlOp: \"=\", // enum/set\n    formatOp: (field, op, value, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      const opStr = isForDisplay ? \"=\" : \"==\";\n      return `${field} ${opStr} ${value}`;\n    },\n    spelOp: \"==\",\n    spelOps: [\"==\", \"eq\"],\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$eq\", v => v, false),\n    reversedOp: \"select_not_equals\",\n    jsonLogic: \"==\",\n    elasticSearchQueryType: \"term\",\n  },\n  select_not_equals: {\n    isNotOp: true,\n    label: \"!=\",\n    labelForFormat: \"!=\",\n    sqlOp: \"<>\", // enum/set\n    formatOp: (field, op, value, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      return `${field} != ${value}`;\n    },\n    spelOp: \"!=\",\n    spelOps: [\"!=\", \"ne\"],\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$ne\", v => v, false),\n    reversedOp: \"select_equals\",\n    jsonLogic: \"!=\",\n  },\n  select_any_in: {\n    label: \"Any in\",\n    labelForFormat: \"IN\",\n    sqlOp: \"IN\",\n    formatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      if (valueSrc == \"value\")\n        return `${field} IN (${values.join(\", \")})`;\n      else\n        return `${field} IN (${values})`;\n    },\n    sqlFormatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      if (valueSrc == \"value\") {\n        return `${field} IN (${values.join(\", \")})`;\n      } else return undefined; // not supported\n    },\n    spelOp: \"$contains\", // tip: $ means first arg is object\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$in\", v => v, false),\n    reversedOp: \"select_not_any_in\",\n    jsonLogic: \"in\",\n    elasticSearchQueryType: \"term\",\n  },\n  select_not_any_in: {\n    isNotOp: true,\n    label: \"Not in\",\n    labelForFormat: \"NOT IN\",\n    sqlOp: \"NOT IN\",\n    formatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      if (valueSrc == \"value\")\n        return `${field} NOT IN (${values.join(\", \")})`;\n      else\n        return `${field} NOT IN (${values})`;\n    },\n    sqlFormatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      if (valueSrc == \"value\") {\n        return `${field} NOT IN (${values.join(\", \")})`;\n      } else return undefined; // not supported\n    },\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$nin\", v => v, false),\n    reversedOp: \"select_any_in\",\n  },\n  //todo: multiselect_contains - for SpEL it would be `.containsAll`\n  multiselect_equals: {\n    label: \"Equals\",\n    labelForFormat: \"==\",\n    sqlOp: \"=\",\n    formatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      const opStr = isForDisplay ? \"=\" : \"==\";\n      if (valueSrc == \"value\")\n        return `${field} ${opStr} [${values.join(\", \")}]`;\n      else\n        return `${field} ${opStr} ${values}`;\n    },\n    sqlFormatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      if (valueSrc == \"value\")\n      // set\n        return `${field} = '${values.map(v => SqlString.trim(v)).join(\",\")}'`;\n      else\n        return undefined; //not supported\n    },\n    spelOp: \".equals\",\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$eq\", v => v, false),\n    reversedOp: \"multiselect_not_equals\",\n    jsonLogic2: \"all-in\",\n    jsonLogic: (field, op, vals) => ({\n      // it's not \"equals\", but \"includes\" operator - just for example\n      \"all\": [ field, {\"in\": [{\"var\": \"\"}, vals]} ]\n    }),\n    elasticSearchQueryType: \"term\",\n  },\n  multiselect_not_equals: {\n    isNotOp: true,\n    label: \"Not equals\",\n    labelForFormat: \"!=\",\n    sqlOp: \"<>\",\n    formatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      if (valueSrc == \"value\")\n        return `${field} != [${values.join(\", \")}]`;\n      else\n        return `${field} != ${values}`;\n    },\n    sqlFormatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      if (valueSrc == \"value\")\n      // set\n        return `${field} != '${values.map(v => SqlString.trim(v)).join(\",\")}'`;\n      else\n        return undefined; //not supported\n    },\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$ne\", v => v, false),\n    reversedOp: \"multiselect_equals\",\n  },\n  proximity: {\n    label: \"Proximity search\",\n    cardinality: 2,\n    valueLabels: [\n      { label: \"Word 1\", placeholder: \"Enter first word\" },\n      { label: \"Word 2\", placeholder: \"Enter second word\" },\n    ],\n    textSeparators: [\n      //'Word 1',\n      //'Word 2'\n    ],\n    formatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      const val1 = values.first();\n      const val2 = values.get(1);\n      const prox = operatorOptions.get(\"proximity\");\n      return `${field} ${val1} NEAR/${prox} ${val2}`;\n    },\n    sqlFormatOp: (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      const val1 = values.first();\n      const val2 = values.get(1);\n      const aVal1 = SqlString.trim(val1);\n      const aVal2 = SqlString.trim(val2);\n      const prox = operatorOptions.get(\"proximity\");\n      return `CONTAINS(${field}, 'NEAR((${aVal1}, ${aVal2}), ${prox})')`;\n    },\n    mongoFormatOp: undefined, // not supported\n    jsonLogic: undefined, // not supported\n    options: {\n      optionLabel: \"Near\", // label on top of \"near\" selectbox (for config.settings.showLabels==true)\n      optionTextBefore: \"Near\", // label before \"near\" selectbox (for config.settings.showLabels==false)\n      optionPlaceholder: \"Select words between\", // placeholder for \"near\" selectbox\n      factory: (props) => <ProximityOperator {...props} />,\n      minProximity: 2,\n      maxProximity: 10,\n      defaults: {\n        proximity: 2\n      },\n    },\n  },\n  some: {\n    label: \"Some\",\n    labelForFormat: \"SOME\",\n    cardinality: 0,\n    jsonLogic: \"some\",\n    spelFormatOp: (filteredSize) => `${filteredSize} > 0`,\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$gt\", v => 0, false),\n  },\n  all: {\n    label: \"All\",\n    labelForFormat: \"ALL\",\n    cardinality: 0,\n    jsonLogic: \"all\",\n    spelFormatOp: (filteredSize, op, fullSize) => `${filteredSize} == ${fullSize}`,\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$eq\", v => v, false),\n  },\n  none: {\n    label: \"None\",\n    labelForFormat: \"NONE\",\n    cardinality: 0,\n    jsonLogic: \"none\",\n    spelFormatOp: (filteredSize) => `${filteredSize} == 0`,\n    mongoFormatOp: mongoFormatOp1.bind(null, \"$eq\", v => 0, false),\n  }\n};\n\n\n//----------------------------  widgets\n\nexport const stringifyForDisplay = (v) => (v == null ? \"NULL\" : v.toString());\n\nconst widgets = {\n  text: {\n    type: \"text\",\n    jsType: \"string\",\n    valueSrc: \"value\",\n    valueLabel: \"String\",\n    valuePlaceholder: \"Enter string\",\n    factory: (props) => <VanillaTextWidget {...props} />,\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      return isForDisplay ? stringifyForDisplay(val) : JSON.stringify(val);\n    },\n    spelFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      if (opDef.spelOp == \"matches\" && op != \"regex\") {\n        let regex;\n        if (op == \"starts_with\") {\n          regex = `(?s)^${escapeRegExp(val)}.*`;\n        } else if (op == \"ends_with\") {\n          regex = `(?s).*${escapeRegExp(val)}$`;\n        } else { // op == 'like'\n          regex = `(?s).*${escapeRegExp(val)}.*`; //tip: can use (?sui) for case-insensitive\n        }\n        return spelEscape(regex);\n      } else {\n        return spelEscape(val);\n      }\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      if (opDef.sqlOp == \"LIKE\" || opDef.sqlOp == \"NOT LIKE\") {\n        return SqlString.escapeLike(val, op != \"starts_with\", op != \"ends_with\");\n      } else {\n        return SqlString.escape(val);\n      }\n    },\n    toJS: (val, fieldSettings) => (val),\n    mongoFormatValue: (val, fieldDef, wgtDef) => (val),\n  },\n  textarea: {\n    type: \"text\",\n    jsType: \"string\",\n    valueSrc: \"value\",\n    valueLabel: \"Text\",\n    valuePlaceholder: \"Enter text\",\n    factory: (props) => <VanillaTextAreaWidget {...props} />,\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      return isForDisplay ? stringifyForDisplay(val) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      if (opDef.sqlOp == \"LIKE\" || opDef.sqlOp == \"NOT LIKE\") {\n        return SqlString.escapeLike(val, op != \"starts_with\", op != \"ends_with\");\n      } else {\n        return SqlString.escape(val);\n      }\n    },\n    spelFormatValue: (val) => spelEscape(val),\n    toJS: (val, fieldSettings) => (val),\n    mongoFormatValue: (val, fieldDef, wgtDef) => (val),\n    fullWidth: true,\n  },\n  number: {\n    type: \"number\",\n    jsType: \"number\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaNumberWidget {...props} />,\n    valueLabel: \"Number\",\n    valuePlaceholder: \"Enter number\",\n    valueLabels: [\n      { label: \"Number from\", placeholder: \"Enter number from\" },\n      { label: \"Number to\", placeholder: \"Enter number to\" },\n    ],\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      return isForDisplay ? stringifyForDisplay(val) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      return SqlString.escape(val);\n    },\n    spelFormatValue: (val, fieldDef, wgtDef) => {\n      const isFloat = wgtDef.step && !Number.isInteger(wgtDef.step);\n      return spelEscape(val, isFloat);\n    },\n    toJS: (val, fieldSettings) => (val),\n    mongoFormatValue: (val, fieldDef, wgtDef) => (val),\n  },\n  slider: {\n    type: \"number\",\n    jsType: \"number\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaSliderWidget {...props} />,\n    valueLabel: \"Number\",\n    valuePlaceholder: \"Enter number or move slider\",\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      return isForDisplay ? stringifyForDisplay(val) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      return SqlString.escape(val);\n    },\n    spelFormatValue: (val) => spelEscape(val),\n    toJS: (val, fieldSettings) => (val),\n    mongoFormatValue: (val, fieldDef, wgtDef) => (val),\n  },\n  select: {\n    type: \"select\",\n    jsType: \"string\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaSelectWidget {...props} />,\n    valueLabel: \"Value\",\n    valuePlaceholder: \"Select value\",\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      let valLabel = getTitleInListValues(fieldDef.fieldSettings.listValues || fieldDef.asyncListValues, val);\n      return isForDisplay ? stringifyForDisplay(valLabel) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      return SqlString.escape(val);\n    },\n    spelFormatValue: (val) => spelEscape(val),\n    toJS: (val, fieldSettings) => (val),\n    mongoFormatValue: (val, fieldDef, wgtDef) => (val),\n  },\n  multiselect: {\n    type: \"multiselect\",\n    jsType: \"array\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaMultiSelectWidget {...props} />,\n    valueLabel: \"Values\",\n    valuePlaceholder: \"Select values\",\n    formatValue: (vals, fieldDef, wgtDef, isForDisplay) => {\n      let valsLabels = vals.map(v => getTitleInListValues(fieldDef.fieldSettings.listValues || fieldDef.asyncListValues, v));\n      return isForDisplay ? valsLabels.map(stringifyForDisplay) : vals.map(JSON.stringify);\n    },\n    sqlFormatValue: (vals, fieldDef, wgtDef, op, opDef) => {\n      return vals.map(v => SqlString.escape(v));\n    },\n    spelFormatValue: (vals, fieldDef, wgtDef, op, opDef) => {\n      const isCallable = opDef.spelOp && opDef.spelOp[0] == \"$\";\n      let res = spelEscape(vals); // inline list\n      if (isCallable) {\n        // `{1,2}.contains(1)` NOT works\n        // `{1,2}.?[true].contains(1)` works\n        res = spelFixList(res);\n      }\n      return res;\n    },\n    toJS: (val, fieldSettings) => (val),\n    mongoFormatValue: (val, fieldDef, wgtDef) => (val),\n  },\n  date: {\n    type: \"date\",\n    jsType: \"string\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaDateWidget {...props} />,\n    dateFormat: \"DD.MM.YYYY\",\n    valueFormat: \"YYYY-MM-DD\",\n    useKeyboard: true,\n    valueLabel: \"Date\",\n    valuePlaceholder: \"Enter date\",\n    valueLabels: [\n      { label: \"Date from\", placeholder: \"Enter date from\" },\n      { label: \"Date to\", placeholder: \"Enter date to\" },\n    ],\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return isForDisplay ? dateVal.format(wgtDef.dateFormat) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return SqlString.escape(dateVal.format(\"YYYY-MM-DD\"));\n    },\n    spelFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return `new java.text.SimpleDateFormat('yyyy-MM-dd').parse('${dateVal.format(\"YYYY-MM-DD\")}')`;\n    },\n    jsonLogic: (val, fieldDef, wgtDef) => moment(val, wgtDef.valueFormat).toDate(),\n    toJS: (val, fieldSettings) => {\n      const dateVal = moment(val, fieldSettings.valueFormat);\n      return dateVal.isValid() ? dateVal.toDate() : undefined;\n    },\n    mongoFormatValue: (val, fieldDef, wgtDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return dateVal.isValid() ? dateVal.toDate() : undefined;\n    }\n  },\n  time: {\n    type: \"time\",\n    jsType: \"string\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaTimeWidget {...props} />,\n    timeFormat: \"HH:mm\",\n    valueFormat: \"HH:mm:ss\",\n    use12Hours: false,\n    useKeyboard: true,\n    valueLabel: \"Time\",\n    valuePlaceholder: \"Enter time\",\n    valueLabels: [\n      { label: \"Time from\", placeholder: \"Enter time from\" },\n      { label: \"Time to\", placeholder: \"Enter time to\" },\n    ],\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return isForDisplay ? dateVal.format(wgtDef.timeFormat) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return SqlString.escape(dateVal.format(\"HH:mm:ss\"));\n    },\n    spelFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return `T(java.time.LocalTime).parse('${dateVal.format(\"HH:mm:ss\")}')`;\n      //return `new java.text.SimpleDateFormat('HH:mm:ss').parse('${dateVal.format(\"HH:mm:ss\")}')`;\n    },\n    jsonLogic: (val, fieldDef, wgtDef) => {\n      // return seconds of day\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return dateVal.get(\"hour\") * 60 * 60 + dateVal.get(\"minute\") * 60 + dateVal.get(\"second\");\n    },\n    toJS: (val, fieldSettings) => {\n      // return seconds of day\n      const dateVal = moment(val, fieldSettings.valueFormat);\n      return dateVal.isValid() ? dateVal.get(\"hour\") * 60 * 60 + dateVal.get(\"minute\") * 60 + dateVal.get(\"second\") : undefined;\n    },\n    mongoFormatValue: (val, fieldDef, wgtDef) => {\n      // return seconds of day\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return dateVal.get(\"hour\") * 60 * 60 + dateVal.get(\"minute\") * 60 + dateVal.get(\"second\");\n    },\n    elasticSearchFormatValue: function elasticSearchFormatValue(queryType, value, operator, fieldName) {\n      return {\n        script: {\n          script: {\n            source: \"doc[\".concat(fieldName, \"][0].getHour() >== params.min && doc[\").concat(fieldName, \"][0].getHour() <== params.max\"),\n            params: {\n              min: value[0],\n              max: value[1]\n            }\n          }\n        }\n      };\n    },\n  },\n  datetime: {\n    type: \"datetime\",\n    jsType: \"string\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaDateTimeWidget {...props} />,\n    timeFormat: \"HH:mm\",\n    dateFormat: \"DD.MM.YYYY\",\n    valueFormat: \"YYYY-MM-DD HH:mm:ss\",\n    use12Hours: false,\n    useKeyboard: true,\n    valueLabel: \"Datetime\",\n    valuePlaceholder: \"Enter datetime\",\n    valueLabels: [\n      { label: \"Datetime from\", placeholder: \"Enter datetime from\" },\n      { label: \"Datetime to\", placeholder: \"Enter datetime to\" },\n    ],\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return isForDisplay ? dateVal.format(wgtDef.dateFormat + \" \" + wgtDef.timeFormat) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return SqlString.escape(dateVal.toDate());\n    },\n    spelFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return `new java.text.SimpleDateFormat('yyyy-MM-dd HH:mm:ss').parse('${dateVal.format(\"YYYY-MM-DD HH:mm:ss\")}')`;\n    },\n    jsonLogic: (val, fieldDef, wgtDef) => moment(val, wgtDef.valueFormat).toDate(),\n    toJS: (val, fieldSettings) => {\n      const dateVal = moment(val, fieldSettings.valueFormat);\n      return dateVal.isValid() ? dateVal.toDate() : undefined;\n    },\n    mongoFormatValue: (val, fieldDef, wgtDef) => {\n      const dateVal = moment(val, wgtDef.valueFormat);\n      return dateVal.isValid() ? dateVal.toDate() : undefined;\n    }\n  },\n  boolean: {\n    type: \"boolean\",\n    jsType: \"boolean\",\n    valueSrc: \"value\",\n    factory: (props) => <VanillaBooleanWidget {...props} />,\n    labelYes: \"Yes\",\n    labelNo: \"No\",\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      return isForDisplay ? (val ? \"Yes\" : \"No\") : JSON.stringify(!!val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      return SqlString.escape(val);\n    },\n    spelFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      return spelEscape(val);\n    },\n    defaultValue: false,\n    toJS: (val, fieldSettings) => (val),\n    mongoFormatValue: (val, fieldDef, wgtDef) => (val),\n  },\n  field: {\n    valueSrc: \"field\",\n    factory: (props) => <ValueFieldWidget {...props} />,\n    formatValue: (val, fieldDef, wgtDef, isForDisplay, op, opDef, rightFieldDef) => {\n      return isForDisplay ? (rightFieldDef.label || val) : val;\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef, rightFieldDef) => {\n      return val;\n    },\n    spelFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      return val;\n    },\n    valueLabel: \"Field to compare\",\n    valuePlaceholder: \"Select field to compare\",\n    customProps: {\n      showSearch: true\n    }\n  },\n  func: {\n    valueSrc: \"func\",\n    factory: (props) => <FuncWidget {...props} />,\n    valueLabel: \"Function\",\n    valuePlaceholder: \"Select function\",\n    customProps: {\n      //showSearch: true\n    }\n  },\n  case_value: {\n    valueSrc: \"value\",\n    type: \"case_value\",\n    spelFormatValue: (val) => {\n      return spelEscape(val === \"\" ? null : val);\n    },\n    spelImportValue: (val) => {\n      return [val.value, []];\n    },\n    factory: ({value, setValue}) =>  \n      <input \n        type=\"text\" \n        value={value || \"\"} \n        onChange={e => setValue(e.target.value)} \n      />\n  }\n};\n\n//----------------------------  types\n\nconst types = {\n  text: {\n    defaultOperator: \"equal\",\n    mainWidget: \"text\",\n    widgets: {\n      text: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"like\",\n          \"not_like\",\n          \"starts_with\",\n          \"ends_with\",\n          \"proximity\",\n          \"is_empty\",\n          \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n        widgetProps: {},\n        opProps: {},\n      },\n      textarea: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"like\",\n          \"not_like\",\n          \"starts_with\",\n          \"ends_with\",\n          \"is_empty\",\n          \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n        widgetProps: {},\n        opProps: {},\n      },\n      field: {\n        operators: [\n          //unary ops (like `is_empty`) will be excluded anyway, see getWidgetsForFieldOp()\n          \"equal\",\n          \"not_equal\",\n          \"proximity\", //can exclude if you want\n        ],\n      }\n    },\n  },\n  number: {\n    defaultOperator: \"equal\",\n    mainWidget: \"number\",\n    widgets: {\n      number: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"less\",\n          \"less_or_equal\",\n          \"greater\",\n          \"greater_or_equal\",\n          \"between\",\n          \"not_between\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n      },\n      slider: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"less\",\n          \"less_or_equal\",\n          \"greater\",\n          \"greater_or_equal\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\"\n        ],\n      },\n    },\n  },\n  date: {\n    defaultOperator: \"equal\",\n    widgets: {\n      date: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"less\",\n          \"less_or_equal\",\n          \"greater\",\n          \"greater_or_equal\",\n          \"between\",\n          \"not_between\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\"\n        ]\n      }\n    },\n  },\n  time: {\n    defaultOperator: \"equal\",\n    widgets: {\n      time: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"less\",\n          \"less_or_equal\",\n          \"greater\",\n          \"greater_or_equal\",\n          \"between\",\n          \"not_between\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ]\n      }\n    },\n  },\n  datetime: {\n    defaultOperator: \"equal\",\n    widgets: {\n      datetime: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"less\",\n          \"less_or_equal\",\n          \"greater\",\n          \"greater_or_equal\",\n          \"between\",\n          \"not_between\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n      }\n    },\n  },\n  select: {\n    mainWidget: \"select\",\n    defaultOperator: \"select_equals\",\n    widgets: {\n      select: {\n        operators: [\n          \"select_equals\",\n          \"select_not_equals\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n        widgetProps: {\n          customProps: {\n            showSearch: true\n          }\n        },\n      },\n      multiselect: {\n        operators: [\n          \"select_any_in\",\n          \"select_not_any_in\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n      },\n    },\n  },\n  multiselect: {\n    defaultOperator: \"multiselect_equals\",\n    widgets: {\n      multiselect: {\n        operators: [\n          \"multiselect_equals\",\n          \"multiselect_not_equals\",\n          // \"is_empty\",\n          // \"is_not_empty\",\n          \"is_null\",\n          \"is_not_null\",\n        ]\n      }\n    },\n  },\n  boolean: {\n    defaultOperator: \"equal\",\n    widgets: {\n      boolean: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n        widgetProps: {\n          //you can enable this if you don't use fields as value sources\n          // hideOperator: true,\n          // operatorInlineLabel: \"is\",\n        }\n      },\n      field: {\n        operators: [\n          \"equal\",\n          \"not_equal\",\n        ],\n      }\n    },\n  },\n  \"!group\": {\n    defaultOperator: \"some\",\n    mainWidget: \"number\",\n    widgets: {\n      number: {\n        widgetProps: {\n          min: 0\n        },\n        operators: [\n          // w/o operand\n          \"some\",\n          \"all\",\n          \"none\",\n\n          // w/ operand - count\n          \"equal\",\n          \"not_equal\",\n          \"less\",\n          \"less_or_equal\",\n          \"greater\",\n          \"greater_or_equal\",\n          \"between\",\n          \"not_between\",\n        ],\n        opProps: {\n          equal: {\n            label: \"Count ==\"\n          },\n          not_equal: {\n            label: \"Count !=\"\n          },\n          less: {\n            label: \"Count <\"\n          },\n          less_or_equal: {\n            label: \"Count <=\"\n          },\n          greater: {\n            label: \"Count >\"\n          },\n          greater_or_equal: {\n            label: \"Count >=\"\n          },\n          between: {\n            label: \"Count between\"\n          },\n          not_between: {\n            label: \"Count not between\"\n          }\n        }\n      }\n    }\n  },\n  \"case_value\": {\n    mainWidget: \"case_value\",\n    widgets: {\n      case_value: {}\n    }\n  },\n};\n\n//----------------------------  settings\n\nconst settings = {\n  ...defaultSettings,\n\n  formatField: (field, parts, label2, fieldDefinition, config, isForDisplay) => {\n    if (isForDisplay)\n      return label2;\n    else\n      return field;\n  },\n  formatSpelField: (field, parentField, parts, partsExt, fieldDefinition, config) => {\n    let fieldName = partsExt.map(({key, parent}, ind) => {\n      if (ind == 0) {\n        if (parent == \"[map]\")\n          return `#this[${spelEscape(key)}]`;\n        else if (parent == \"[class]\")\n          return key;\n        else\n          return key;\n      } else {\n        if (parent == \"map\" || parent == \"[map]\")\n          return `[${spelEscape(key)}]`;\n        else if (parent == \"class\" || parent == \"[class]\")\n          return `.${key}`;\n        else\n          return `.${key}`;\n      }\n    }).join(\"\");\n    if (fieldDefinition.isSpelVariable) {\n      fieldName = \"#\" + fieldName;\n    }\n    return fieldName;\n  },\n  sqlFormatReverse: (q) => {\n    if (q == undefined) return undefined;\n    return \"NOT(\" + q + \")\";\n  },\n  spelFormatReverse: (q) => {\n    if (q == undefined) return undefined;\n    return \"!(\" + q + \")\";\n  },\n  formatReverse: (q, operator, reversedOp, operatorDefinition, revOperatorDefinition, isForDisplay) => {\n    if (q == undefined) return undefined;\n    if (isForDisplay)\n      return \"NOT (\" + q + \")\";\n    else\n      return \"!(\" + q + \")\";\n  },\n  formatAggr: (whereStr, aggrField, operator, value, valueSrc, valueType, opDef, operatorOptions, isForDisplay, aggrFieldDef) => {\n    const {labelForFormat, cardinality} = opDef;\n    if (cardinality == 0) {\n      const cond = whereStr ? ` HAVE ${whereStr}` : \"\";\n      return `${labelForFormat} OF ${aggrField}${cond}`;\n    } else if (cardinality == undefined || cardinality == 1) {\n      const cond = whereStr ? ` WHERE ${whereStr}` : \"\";\n      return `COUNT OF ${aggrField}${cond} ${labelForFormat} ${value}`;\n    } else if (cardinality == 2) {\n      const cond = whereStr ? ` WHERE ${whereStr}` : \"\";\n      let valFrom = value.first();\n      let valTo = value.get(1);\n      return `COUNT OF ${aggrField}${cond} ${labelForFormat} ${valFrom} AND ${valTo}`;\n    }\n  },\n  canCompareFieldWithField: (leftField, leftFieldConfig, rightField, rightFieldConfig) => {\n    //for type == 'select'/'multiselect' you can check listValues\n    return true;\n  },\n\n  // enable compare fields\n  valueSourcesInfo: {\n    value: {\n      label: \"Value\"\n    },\n    field: {\n      label: \"Field\",\n      widget: \"field\",\n    },\n    func: {\n      label: \"Function\",\n      widget: \"func\",\n    }\n  },\n  customFieldSelectProps: {\n    showSearch: true\n  },\n\n  defaultSliderWidth: \"200px\",\n  defaultSelectWidth: \"200px\",\n  defaultSearchWidth: \"100px\",\n  defaultMaxRows: 5,\n};\n\n//----------------------------\n\nexport default {\n  conjunctions,\n  operators,\n  widgets,\n  types,\n  settings,\n};\n","import * as Widgets from \"../components/widgets\";\nimport React from \"react\";\nconst {\n  VanillaFieldSelect,\n  VanillaConjs,\n  VanillaButton,\n  VanillaButtonGroup,\n  VanillaProvider,\n  VanillaValueSources,\n  vanillaConfirm,\n  VanillaSwitch,\n} = Widgets;\n\nexport const settings = {\n  formatField: (field, parts, label2, fieldDefinition, config, isForDisplay) => {\n    if (isForDisplay)\n      return label2;\n    else\n      return field;\n  },\n\n  renderField: (props) => <VanillaFieldSelect {...props} />,\n  renderOperator: (props) => <VanillaFieldSelect {...props} />,\n  renderFunc: (props) => <VanillaFieldSelect {...props} />,\n  renderConjs: (props) => <VanillaConjs {...props} />,\n  renderSwitch: (props) => <VanillaSwitch {...props} />,\n  renderButton: (props) => <VanillaButton {...props} />,\n  renderButtonGroup: (props) => <VanillaButtonGroup {...props} />,\n  renderProvider: (props) => <VanillaProvider {...props} />,\n  renderValueSources: (props) => <VanillaValueSources {...props} />,\n  renderConfirm: vanillaConfirm,\n  renderSwitchPrefix: () => <>{\"Conditions\"}</>,\n\n  valueSourcesInfo: {\n    value: {},\n  },\n  fieldSeparator: \".\",\n  fieldSeparatorDisplay: \".\",\n  renderSize: \"small\",\n  maxLabelsLength: 100,\n  canReorder: true,\n  canRegroup: true,\n  showLock: false,\n  canDeleteLocked: false,\n  showNot: true,\n  canLeaveEmptyGroup: true,\n  shouldCreateEmptyGroup: false,\n  forceShowConj: false,\n  canShortMongoQuery: true,\n  removeEmptyGroupsOnLoad: true,\n  removeIncompleteRulesOnLoad: true,\n  removeInvalidMultiSelectValuesOnLoad: true,\n  groupActionsPosition: \"topRight\", // oneOf [topLeft, topCenter, topRight, bottomLeft, bottomCenter, bottomRight]\n  setOpOnChangeField: [\"keep\", \"default\"], // 'default' (default if present), 'keep' (keep prev from last field), 'first', 'none'\n  groupOperators: [\"some\", \"all\", \"none\"],\n\n  convertableWidgets: {\n    \"number\": [\"slider\", \"rangeslider\"],\n    \"slider\": [\"number\", \"rangeslider\"],\n    \"rangeslider\": [\"number\", \"slider\"],\n    \"text\": [\"textarea\"],\n    \"textarea\": [\"text\"]\n  },\n\n  // localization\n  locale: {\n    moment: \"en\",\n  },\n  valueLabel: \"Value\",\n  valuePlaceholder: \"Value\",\n  fieldLabel: \"Field\",\n  operatorLabel: \"Operator\",\n  funcLabel: \"Function\",\n  fieldPlaceholder: \"Select field\",\n  funcPlaceholder: \"Select function\",\n  operatorPlaceholder: \"Select operator\",\n  lockLabel: \"Lock\",\n  lockedLabel: \"Locked\",\n  deleteLabel: null,\n  addGroupLabel: \"Add group\",\n  addCaseLabel: \"Add condition\",\n  addDefaultCaseLabel: \"Add default condition\",\n  defaultCaseLabel: \"Default:\",\n  addRuleLabel: \"Add rule\",\n  addSubRuleLabel: \"Add sub rule\",\n  delGroupLabel: \"\",\n  notLabel: \"Not\",\n  valueSourcesPopupTitle: \"Select value source\",\n  removeRuleConfirmOptions: null,\n  removeGroupConfirmOptions: null,\n\n  defaultGroupConjunction: \"AND\",\n  jsonLogic: {\n    groupVarKey: \"var\",\n    altVarKey: \"var\",\n    lockedOp: \"locked\"\n  }\n};\n","import React from \"react\";\nimport omit from \"lodash/omit\";\nimport TextField from \"@material-ui/core/TextField\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport Autocomplete, { createFilterOptions } from \"@material-ui/lab/Autocomplete\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport Chip from \"@material-ui/core/Chip\";\nimport Checkbox from \"@material-ui/core/Checkbox\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\nimport CheckBoxIcon from \"@material-ui/icons/CheckBox\";\n\nimport useListValuesAutocomplete from \"../../../../hooks/useListValuesAutocomplete\";\n\nconst nonCheckedIcon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\nconst defaultFilterOptions = createFilterOptions();\nconst emptyArray = [];\n\nexport default (props) => {\n  const {\n    allowCustomValues, multiple,\n    value: selectedValue, customProps, readonly, config, groupBy, filterOptionsConfig\n  } = props;\n  const filterOptionsFn = filterOptionsConfig ? createFilterOptions(filterOptionsConfig) : defaultFilterOptions;\n\n  // hook\n  const {\n    open,\n    onOpen,\n    onClose,\n    onChange,\n    onInputChange,\n    inputValue,\n    options,\n    isInitialLoading,\n    isLoading,\n    aPlaceholder,\n    extendOptions,\n    getOptionSelected,\n    getOptionDisabled,\n    getOptionLabel,\n  } = useListValuesAutocomplete(props, {\n    debounceTimeout: 100,\n    multiple\n  });\n\n  // setings\n  const {defaultSelectWidth, defaultSearchWidth} = config.settings;\n  const {width, showCheckboxes, ...rest} = customProps || {};\n  let customInputProps = rest.input || {};\n  const inputWidth = customInputProps.width || defaultSearchWidth;\n  customInputProps = omit(customInputProps, [\"width\"]);\n  const customAutocompleteProps = omit(rest, [\"showSearch\", \"showCheckboxes\"]);\n\n  const fullWidth = true;\n  const minWidth = width || defaultSelectWidth;\n  const style = {\n    width: (multiple ? undefined : minWidth),\n    minWidth: minWidth\n  };\n  const placeholder = !readonly ? aPlaceholder : \"\";\n  const hasValue = selectedValue != null;\n  // should be simple value to prevent re-render!s\n  const value = hasValue ? selectedValue : (multiple ? emptyArray : null);\n  \n  const filterOptions = (options, params) => {\n    const filtered = filterOptionsFn(options, params);\n    const extended = extendOptions(filtered);\n    return extended;\n  };\n\n  // styles\n  const useStyles = makeStyles((theme) => ({\n    // fix too small width\n    input: {\n      minWidth: inputWidth + \" !important\",\n    }\n  }));\n\n  const useStylesChip = makeStyles((theme) => ({\n    // fix height\n    root: {\n      height: \"auto\"\n    },\n    label: {\n      marginTop: \"3px\",\n      marginBottom: \"3px\",\n    }\n  }));\n\n  const classesChip = useStylesChip();\n  const classes = useStyles();\n\n  // render\n  const renderInput = (params) => {\n    return (\n      <TextField \n        {...params} \n        InputProps={{\n          ...params.InputProps,\n          readOnly: readonly,\n          endAdornment: (\n            <React.Fragment>\n              {isLoading ? <CircularProgress color=\"inherit\" size={20} /> : null}\n              {params.InputProps.endAdornment}\n            </React.Fragment>\n          ),\n        }}\n        disabled={readonly}\n        placeholder={placeholder}\n        //onChange={onInputChange}\n        {...customInputProps}\n      />\n    );\n  };\n\n  const renderTags = (value, getTagProps) => value.map((option, index) => {\n    return <Chip\n      key={index}\n      classes={classesChip}\n      label={getOptionLabel(option)}\n      {...getTagProps({ index })}\n    />;\n  });\n\n  const renderOption = (option, { selected }) => {\n    if (option.specialValue) {\n      return <React.Fragment>{option.renderTitle || option.title}</React.Fragment>;\n    } else if (multiple && showCheckboxes != false) {\n      return <React.Fragment>\n        <Checkbox\n          icon={nonCheckedIcon}\n          checkedIcon={checkedIcon}\n          style={{ marginRight: 8 }}\n          checked={selected}\n        />\n        {option.title}\n      </React.Fragment>;\n    } else {\n      return <React.Fragment>{option.renderTitle || option.title}</React.Fragment>;\n    }\n  };\n\n  return (\n    <FormControl fullWidth={fullWidth}>\n      <Autocomplete\n        disableCloseOnSelect={multiple}\n        fullWidth={fullWidth}\n        multiple={multiple}\n        style={style}\n        classes={classes}\n        freeSolo={allowCustomValues}\n        loading={isInitialLoading}\n        open={open}\n        onOpen={onOpen}\n        onClose={onClose}\n        inputValue={inputValue}\n        onInputChange={onInputChange}\n        label={placeholder}\n        onChange={onChange}\n        value={value}\n        getOptionSelected={getOptionSelected}\n        disabled={readonly}\n        readOnly={readonly}\n        options={options}\n        groupBy={groupBy}\n        getOptionLabel={getOptionLabel}\n        getOptionDisabled={getOptionDisabled}\n        renderInput={renderInput}\n        renderTags={renderTags}\n        renderOption={renderOption}\n        filterOptions={filterOptions}\n        {...customAutocompleteProps}\n      ></Autocomplete>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport MaterialAutocomplete from \"../value/MaterialAutocomplete\";\n\nconst itemsToListValues = (items, level = 0) => (\n  items.map(item => {\n    const {items, path, label, disabled, grouplabel} = item;\n    const prefix = \"\\u00A0\\u00A0\".repeat(level);\n    if (items) {\n      return itemsToListValues(items, level+1);\n    } else {\n      return {\n        title: label,\n        renderTitle: prefix+label,\n        value: path,\n        disabled,\n        groupTitle: level > 0 ? prefix+grouplabel : null,\n      };\n    }\n  }).flat(Infinity)\n);\n\nconst filterOptionsConfig = {\n  stringify: (option) => {\n    const keysForFilter = [\"title\", \"value\", \"grouplabel\", \"label\"];\n    const valueForFilter = keysForFilter\n      .map(k => (typeof option[k] == \"string\" ? option[k] : \"\"))\n      .join(\"\\0\");\n    return valueForFilter;\n  }\n};\n\nconst fieldAdapter = ({items, selectedKey, setField, ...rest}) => {\n  const listValues = itemsToListValues(items);\n  const groupBy = (option) => option.groupTitle;\n  const value = selectedKey;\n  const setValue = (value, _asyncValues) => {\n    if (!value) return undefined;\n    return setField(value);\n  };\n\n  return {\n    ...rest,\n    listValues,\n    setValue,\n    groupBy,\n    filterOptionsConfig,\n    allowCustomValues: false,\n    multiple: false,\n    value,\n  };\n};\n\nexport default (props) => {\n  return <MaterialAutocomplete  {...fieldAdapter(props)} />;\n};\n","import React from \"react\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport ExpandMoreSharpIcon from \"@material-ui/icons/ExpandMoreSharp\";\nimport Popover from \"@material-ui/core/Popover\";\nimport Radio from \"@material-ui/core/Radio\";\nimport RadioGroup from \"@material-ui/core/RadioGroup\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport FormLabel from \"@material-ui/core/FormLabel\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    padding: theme.spacing(1),\n  },\n}));\n\nexport default ({ valueSources, valueSrc, title, setValueSrc, readonly}) => {\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const classes = useStyles();\n\n\n  const handleOpen = (event) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  const toggleOpenClose = (event) => {\n    anchorEl ? handleClose() : handleOpen(event);\n  };\n\n  const handleChange = e => {\n    if (e.target.value === undefined)\n      return;\n    setValueSrc(e.target.value);\n    handleClose();\n  };\n\n  const renderOptions = (valueSources) => (\n    valueSources.map(([srcKey, info]) => (\n      <FormControlLabel \n        key={srcKey} \n        value={srcKey} \n        checked={valueSrc == srcKey || !valueSrc && srcKey == \"value\"} \n        control={<Radio />} \n        label={info.label}\n      />\n    ))\n  );\n\n  const open = Boolean(anchorEl);\n\n  return (\n    <div>\n      <IconButton size=\"small\" onClick={toggleOpenClose}>\n        <ExpandMoreSharpIcon />\n      </IconButton>\n    \n      <Popover    \n        open={open}\n        anchorEl={anchorEl}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"left\",\n        }}\n        onClose={handleClose}\n        classes={{\n          paper: classes.paper,\n        }}\n        disablePortal\n      >\n        <FormControl component=\"fieldset\">\n          <FormLabel component=\"legend\">{title}</FormLabel>\n          <RadioGroup value={valueSrc || \"value\"} onChange={handleChange}>\n            {renderOptions(valueSources)}\n          </RadioGroup>\n        </FormControl>\n      </Popover>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { ThemeProvider, createTheme } from \"@material-ui/core/styles\";\nimport { ConfirmProvider, useConfirm } from \"material-ui-confirm\";\nimport { MuiPickersUtilsProvider } from \"@material-ui/pickers\";\nimport MomentUtils from \"@date-io/moment\";\n\n\n// value widgets\nimport MaterialTextWidget from \"./value/MaterialText\";\nimport MaterialTextAreaWidget from \"./value/MaterialTextArea\";\nimport MaterialDateWidget from \"./value/MaterialDate\";\nimport MaterialDateTimeWidget from \"./value/MaterialDateTime\";\nimport MaterialTimeWidget from \"./value/MaterialTime\";\nimport MaterialSelectWidget from \"./value/MaterialSelect\";\nimport MaterialNumberWidget from \"./value/MaterialNumber\";\nimport MaterialSliderWidget from \"./value/MaterialSlider\";\nimport MaterialRangeWidget from \"./value/MaterialRange\";\nimport MaterialBooleanWidget from \"./value/MaterialBoolean\";\nimport MaterialMultiSelectWidget from \"./value/MaterialMultiSelect\";\nimport MaterialAutocompleteWidget from \"./value/MaterialAutocomplete\";\n\n// field select widgets\nimport MaterialFieldSelect from \"./core/MaterialFieldSelect\";\nimport MaterialFieldAutocomplete from \"./core/MaterialFieldAutocomplete\";\n\n// core components\nimport MaterialButton from \"./core/MaterialButton\";\nimport MaterialButtonGroup from \"./core/MaterialButtonGroup\";\nimport MaterialConjs from \"./core/MaterialConjs\";\nimport MaterialSwitch from \"./core/MaterialSwitch\";\nimport MaterialValueSources from \"./core/MaterialValueSources\";\nimport MaterialConfirm from \"./core/MaterialConfirm\";\n\n// provider\nconst MaterialProvider = ({config, children}) => {\n  const settingsTheme = config.settings.theme || {};\n  const settingsLocale = config.settings.locale || {};\n  const themeConfig = settingsTheme.material;\n  const locale = settingsLocale.material;\n  const useTheme = themeConfig || locale;\n  const theme = useTheme ? createTheme(themeConfig, locale) : null;\n\n  const base = (<div className=\"mui\">{children}</div>);\n  const withProviders = (\n    <MuiPickersUtilsProvider utils={MomentUtils}>\n      <ConfirmProvider>\n        {base}\n      </ConfirmProvider>\n    </MuiPickersUtilsProvider>\n  );\n  const withTheme = theme ? (\n    <ThemeProvider theme={theme}>\n      {withProviders}\n    </ThemeProvider>\n  ) : withProviders;\n\n  return withTheme;\n};\n\n\nexport default {\n  MaterialTextWidget,\n  MaterialTextAreaWidget,\n  MaterialDateWidget,\n  MaterialDateTimeWidget,\n  MaterialTimeWidget,\n  MaterialSelectWidget,\n  MaterialNumberWidget,\n  MaterialSliderWidget,\n  MaterialRangeWidget,\n  MaterialBooleanWidget,\n  MaterialMultiSelectWidget,\n  MaterialAutocompleteWidget,\n\n  MaterialFieldSelect,\n  MaterialFieldAutocomplete,\n\n  MaterialButton,\n  MaterialButtonGroup,\n  MaterialConjs,\n  MaterialSwitch,\n  MaterialValueSources,\n  MaterialConfirm,\n  MaterialUseConfirm: useConfirm,\n\n  MaterialProvider,\n};\n","import React from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {value, setValue, config, readonly, placeholder, customProps, maxLength} = props;\n\n  const onChange = e => {\n    let val = e.target.value;\n    if (val === \"\")\n      val = undefined; // don't allow empty value\n    setValue(val);\n  };\n\n  const textValue = value || \"\";\n\n  return (\n    <FormControl>\n      <TextField \n        value={textValue}\n        placeholder={!readonly ? placeholder : \"\"}\n        InputProps={{\n          readOnly: readonly,\n        }}\n        inputProps={{\n          maxLength: maxLength,\n        }}\n        disabled={readonly}\n        onChange={onChange}\n        {...customProps}\n      />\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {value, setValue, config, readonly, placeholder, customProps, maxLength, maxRows, fullWidth} = props;\n  const {defaultMaxRows} = config.settings;\n\n  const onChange = e => {\n    let val = e.target.value;\n    if (val === \"\")\n      val = undefined; // don't allow empty value\n    setValue(val);\n  };\n  \n  const textValue = value || \"\";\n\n  return (\n    <FormControl fullWidth={fullWidth}>\n      <TextField \n        fullWidth={fullWidth}\n        maxRows={maxRows || defaultMaxRows}\n        multiline={true}\n        value={textValue}\n        placeholder={!readonly ? placeholder : \"\"}\n        InputProps={{\n          readOnly: readonly,\n        }}\n        inputProps={{\n          maxLength: maxLength,\n        }}\n        disabled={readonly}\n        onChange={onChange}\n        {...customProps}\n      />\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport { KeyboardDatePicker, DatePicker } from \"@material-ui/pickers\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {value, setValue, readonly, customProps, dateFormat, valueFormat, placeholder, useKeyboard} = props;\n\n  const formatSingleValue = (value) => {\n    return value && value.isValid() ? value.format(valueFormat) : undefined;\n  };\n\n  const handleChange = (value) => {\n    setValue(formatSingleValue(value));\n  };\n\n  const Picker = useKeyboard ? KeyboardDatePicker : DatePicker;\n\n  return (\n    <FormControl>\n      <Picker\n        readOnly={readonly}\n        disabled={readonly}\n        placeholder={!readonly ? placeholder : \"\"}\n        format={dateFormat}\n        value={value || null}\n        onChange={handleChange}\n        {...customProps}\n      />\n    </FormControl>\n  );\n};","import React from \"react\";\nimport { DateTimePicker, KeyboardDateTimePicker } from \"@material-ui/pickers\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {value, setValue, use12Hours, readonly, placeholder, dateFormat, timeFormat, valueFormat, customProps, useKeyboard} = props;\n\n  const formatSingleValue = (value) => {\n    return value && value.isValid() ? value.format(valueFormat) : undefined;\n  };\n\n  const handleChange = (value) => {\n    setValue(formatSingleValue(value));\n  };\n\n  const Picker = useKeyboard ? KeyboardDateTimePicker : DateTimePicker;\n  const dateTimeFormat = dateFormat + \" \" + timeFormat;\n  \n  return (\n    <FormControl>\n      <Picker\n        readOnly={readonly}\n        disabled={readonly}\n        ampm={!!use12Hours}\n        placeholder={!readonly ? placeholder : \"\"}\n        format={dateTimeFormat}\n        value={value || null}\n        onChange={handleChange}\n        {...customProps}\n      />\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport { TimePicker, KeyboardTimePicker } from \"@material-ui/pickers\";\nimport moment from \"moment\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {value, setValue, use12Hours, readonly, placeholder, timeFormat, valueFormat, customProps, useKeyboard} = props;\n\n  const formatSingleValue = (value) => {\n    return value && value.isValid() ? value.format(valueFormat) : undefined;\n  };\n\n  const handleChange = (value) => {\n    setValue(formatSingleValue(value));\n  };\n\n  const Picker = useKeyboard ? KeyboardTimePicker : TimePicker;\n  const hasSeconds = timeFormat.indexOf(\":ss\") != -1;\n  const timeValue = value ? moment(value, timeFormat) : null;\n\n  return (\n    <FormControl>\n      <Picker\n        readOnly={readonly}\n        disabled={readonly}\n        ampm={!!use12Hours}\n        placeholder={!readonly ? placeholder : \"\"}\n        format={timeFormat}\n        value={timeValue || null}\n        onChange={handleChange}\n        views={hasSeconds ? [\"hours\", \"minutes\", \"seconds\"] : [\"hours\", \"minutes\"]}\n        {...customProps}\n      />\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport Select from \"@material-ui/core/Select\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport {mapListValues} from \"../../../../utils/stuff\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport omit from \"lodash/omit\";\n\nexport default ({listValues, value, setValue, allowCustomValues, readonly, placeholder, customProps}) => {\n  const renderOptions = () =>\n    mapListValues(listValues, ({title, value}) => {\n      return <MenuItem key={value} value={value}>{title}</MenuItem>;\n    });\n\n  const onChange = e => {\n    if (e.target.value === undefined)\n      return;\n    setValue(e.target.value);\n  };\n\n  const renderValue = (selectedValue) => {\n    if (!readonly && selectedValue == null)\n      return placeholder;\n    return getListValueTitle(selectedValue);\n  };\n\n  const getListValueTitle = (selectedValue) => \n    mapListValues(listValues, ({title, value}) => \n      (value === selectedValue ? title : null)\n    )\n      .filter(v => v !== null)\n      .shift();\n  \n  const hasValue = value != null;\n\n  return (\n    <FormControl>\n      <Select\n        autoWidth\n        displayEmpty\n        label={!readonly ? placeholder : \"\"}\n        onChange={onChange}\n        value={hasValue ? value : \"\"}\n        disabled={readonly}\n        readOnly={readonly}\n        renderValue={renderValue}\n        {...omit(customProps, [\"showSearch\", \"input\"])}\n      >\n        {renderOptions()}\n      </Select>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {value, setValue, config, readonly, min, max, step, placeholder, customProps} = props;\n  \n  const onChange = e => {\n    let val = e.target.value;\n    if (val === \"\" || val === null)\n      val = undefined;\n    else\n      val = Number(val);\n    setValue(val);\n  };\n\n  const numberValue = value == undefined ? \"\" : value;\n  \n  return (\n    <FormControl>\n      <TextField \n        type=\"number\"\n        value={numberValue}\n        placeholder={!readonly ? placeholder : \"\"}\n        InputProps={{\n          readOnly: readonly,\n        }}\n        inputProps={{\n          min: min,\n          max: max,\n          step: step,\n        }}\n        disabled={readonly}\n        onChange={onChange}\n        {...customProps}\n      />\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport Slider from \"@material-ui/core/Slider\";\nimport TextField from \"@material-ui/core/TextField\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {config, placeholder, customProps, value, setValue, min, max, step, marks, readonly} = props;\n  const {defaultSliderWidth} = config.settings;\n\n  const handleSliderChange = (_e, newValue) => {\n    setValue(newValue);\n  };\n\n  const handleInputChange = (e) => {\n    let val = e.target.value;\n    if (val === \"\" || val === null)\n      val = undefined;\n    else\n      val = Number(val);\n    setValue(val);\n  };\n\n  const handleInputBlur = () => {\n    // TIP: Fix if typed value out of range in input\n    if (value < min) {\n      setValue(min);\n    } else if (value > max) {\n      setValue(max);\n    }\n  };\n\n\n  const {width, ...rest} =  customProps || {};\n  const customInputProps = rest.input || {};\n  const customSliderProps = rest.slider || rest;\n  \n  // TIP: Can't pass undefined to MUI, cause it means uncontrolled component use.\n  //      For empty value input needs \"\", slider needs null or 0\n  const inputValue = typeof value === \"number\" ? value : \"\";\n  const sliderValue = typeof value === \"number\" ? value : null;\n\n  // marks example: { 0: \"0%\", 100: React.createElement('strong', null, \"100%\") }\n  const muiMarks = marks ? Object.keys(marks).map(v => ({value: v, label: marks[v]})) : false;\n\n\n  const InputCmp = (\n    <TextField \n      type=\"number\"\n      value={inputValue}\n      placeholder={placeholder}\n      InputProps={{\n        readOnly: readonly,\n      }}\n      inputProps={{\n        min: min,\n        max: max,\n        step: step,\n      }}\n      disabled={readonly}\n      onChange={handleInputChange}\n      onBlur={handleInputBlur}\n      {...customInputProps}\n    />\n  );\n\n  const SliderCmp = (\n    <Slider \n      value={sliderValue}\n      onChange={handleSliderChange}\n      disabled={readonly}\n      min={min}\n      max={max}\n      step={step}\n      marks={muiMarks}\n      valueLabelDisplay=\"auto\"\n      {...customSliderProps}\n    />\n  );\n\n  const stylesWrapper = {\n    display: \"inline-flex\", \n    alignItems: \"center\"\n  };\n\n  const stylesInputWrapper = {\n    marginLeft: \"5px\",\n  };\n\n  const stylesSliderWrapper = {\n    marginLeft: \"5px\", \n    paddingLeft: \"12px\", \n    marginBottom: muiMarks && \"-16px\", \n    width: width || defaultSliderWidth,\n  };\n\n  return (\n    <FormControl>\n      <div style={stylesWrapper}>\n        <div style={stylesInputWrapper}>\n          {InputCmp}\n        </div>\n        <div style={stylesSliderWrapper}>\n          {SliderCmp}\n        </div>\n      </div>\n    </FormControl>\n  );\n};\n","import React, { useEffect } from \"react\";\nimport Slider from \"@material-ui/core/Slider\";\nimport TextField from \"@material-ui/core/TextField\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default (props) => {\n  const {config, placeholders, customProps, value, setValue, min, max, step, marks, readonly, textSeparators} = props;\n  const {defaultSliderWidth} = config.settings;\n\n  useEffect(() => {\n    const [valueFrom, valueTo] = props.value || [undefined, undefined];\n    if (props.value && (valueFrom == undefined || valueTo == undefined)) {\n      // happens if we changed op from '==' to 'between'\n      // (I know, timeout is dirty hack..)\n      setTimeout(() => {\n        const oneValue = valueFrom || valueTo;\n        const value = [oneValue, oneValue];\n        setValue(value);\n      }, 1);\n    }\n  }, []);\n\n  const handleSliderChange = (_e, newValues) => {\n    setValue(newValues);\n  };\n\n  const handleInputChangeFrom = (e) => {\n    // TIP: need to use props.value instead of value\n    let valueFrom = e.target.value;\n    if (valueFrom === \"\" || valueFrom == null)\n      valueFrom = undefined;\n    else\n      valueFrom = Number(valueFrom);\n    let value = props.value ? [...props.value] : [undefined, undefined];\n    value[0] = valueFrom;\n    setValue(value);\n  };\n\n  const handleInputChangeTo = (e) => {\n    let valueTo = e.target.value;\n    if (valueTo === \"\" || valueTo == null)\n      valueTo = undefined;\n    else\n      valueTo = Number(valueTo);\n    let value = props.value ? [...props.value] : [undefined, undefined];\n    value[1] = valueTo;\n    setValue(value);\n  };\n\n  const handleInputBlur = () => {\n    // TIP: Fix if typed value out of range in inputs\n    if (!value) return;\n    if (value[0] < min) {\n      setValue([min, value[1]]);\n    } else if (value[1] > max) {\n      setValue([value[0], max]);\n    }\n  };\n\n  const {width, ...rest} =  customProps || {};\n  const customInputProps = rest.input || {};\n  const customSliderProps = rest.slider || rest;\n\n  // marks example: { 0: \"0%\", 100: React.createElement('strong', null, \"100%\") }\n  const muiMarks = marks ? Object.keys(marks).map(v => ({value: v, label: marks[v]})) : false;\n\n  // TIP: Can't pass undefined to MUI, cause it means uncontrolled component use.\n  //      For empty value input needs \"\", slider needs null or 0, but null will cause problems with range mode\n  let sliderValue = value ? [...value] : [undefined, undefined];\n  let [valueFrom, valueTo] = sliderValue;\n  if (valueFrom == undefined) {\n    valueFrom = \"\";\n    sliderValue[0] = 0;\n  }\n  if (valueTo == undefined) {\n    valueTo = \"\";\n    sliderValue[1] = 0;\n  }\n  \n\n  const FromInputCmp = (\n    <TextField \n      type=\"number\"\n      value={valueFrom}\n      placeholder={placeholders[0]}\n      InputProps={{\n        readOnly: readonly,\n      }}\n      inputProps={{\n        min: min,\n        max: max,\n        step: step,\n      }}\n      disabled={readonly}\n      onChange={handleInputChangeFrom}\n      onBlur={handleInputBlur}\n      {...customInputProps}\n    />\n  );\n\n  const ToInputCmp = (\n    <TextField \n      type=\"number\"\n      value={valueTo}\n      placeholder={placeholders[1]}\n      InputProps={{\n        readOnly: readonly,\n      }}\n      inputProps={{\n        min: min,\n        max: max,\n        step: step,\n      }}\n      disabled={readonly}\n      onChange={handleInputChangeTo}\n      onBlur={handleInputBlur}\n      {...customInputProps}\n    />\n  );\n\n  const SliderCmp = (\n    <Slider \n      value={sliderValue}\n      onChange={handleSliderChange}\n      disabled={readonly}\n      min={min}\n      max={max}\n      step={step}\n      marks={muiMarks}\n      valueLabelDisplay=\"auto\"\n      {...customSliderProps}\n    />\n  );\n\n  const stylesWrapper = {\n    display: \"inline-flex\", \n  };\n\n  const stylesInputWrapper = {\n    marginLeft: \"5px\",\n  };\n\n  const stylesSliderWrapper = {\n    marginLeft: \"5px\", \n    paddingLeft: \"12px\", \n    marginBottom: muiMarks && \"-16px\", \n    width: width || defaultSliderWidth,\n  };\n\n  return (\n    <FormControl>\n      <div style={stylesWrapper}>\n        <div style={stylesInputWrapper}>\n          {FromInputCmp}\n        </div>\n        <div className={\"widget--sep\"}>\n          <span>{ textSeparators[1] }</span>\n        </div>\n        <div style={stylesInputWrapper}>\n          {ToInputCmp}\n        </div>\n        <div style={stylesSliderWrapper}>\n          {SliderCmp}\n        </div>\n      </div>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport Switch from \"@material-ui/core/Switch\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Typography from \"@material-ui/core/Typography\";\n\nexport default (props) => {\n  const { customProps, value, setValue, labelYes, labelNo, readonly } = props;\n\n  const onChange = () => {\n    setValue(!value);\n  };\n  \n  return (\n    <FormControl>\n      <Typography component=\"div\">\n        <Grid component=\"label\" container alignItems=\"center\" spacing={0}>\n          <Grid item component=\"span\">{labelNo}</Grid>\n          <Grid item component=\"span\">\n            <Switch\n              checked={!!value}\n              onChange={onChange}\n              disabled={readonly}\n              {...customProps}\n            />\n          </Grid>\n          <Grid item component=\"span\">{labelYes}</Grid>\n        </Grid>\n      </Typography>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport {mapListValues} from \"../../../../utils/stuff\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport Select from \"@material-ui/core/Select\";\nimport Checkbox from \"@material-ui/core/Checkbox\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport omit from \"lodash/omit\";\n\nexport default ({listValues, value, setValue, allowCustomValues, readonly, placeholder, customProps}) => {\n  const renderOptions = (selectedValues) => \n    mapListValues(listValues, ({title, value}) => {\n      return (\n        <MenuItem key={value} value={value}>\n          <Checkbox checked={selectedValues.indexOf(value) > -1} />\n          <ListItemText primary={title} />\n        </MenuItem>\n      );\n    });\n\n  const renderValue = (selectedValues) => {\n    if (!readonly && !selectedValues.length)\n      return placeholder;\n    const selectedTitles = mapListValues(listValues, ({title, value}) => (\n      selectedValues.indexOf(value) > -1 ? title : null\n    )).filter(v => v !== null);\n    return selectedTitles.join(\", \");\n  };\n\n  const hasValue = value != null && value.length > 0;\n\n  const onChange = e => {\n    if (e.target.value === undefined)\n      return;\n    setValue(e.target.value);\n  };\n\n  return (\n    <FormControl>\n      <Select multiple\n        autoWidth\n        displayEmpty\n        label={!readonly ? placeholder : \"\"}\n        onChange={onChange}\n        value={hasValue ? value : []}\n        disabled={readonly}\n        readOnly={readonly}\n        renderValue={renderValue}\n        {...omit(customProps, [\"showSearch\", \"input\", \"showCheckboxes\"])}\n      >\n        {renderOptions(hasValue ? value : [])}\n      </Select>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport Select from \"@material-ui/core/Select\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport FormControl from \"@material-ui/core/FormControl\";\n\nexport default ({items, setField, selectedKey, readonly, placeholder}) => {\n  const renderOptions = (fields, level = 0) => (\n    fields.map(field => {\n      const {items, path, label, disabled} = field;\n      const prefix = \"\\u00A0\\u00A0\".repeat(level);\n      if (items) {\n        return [\n          <ListSubheader disabled={disabled} key={path} disableSticky={true}>\n            {prefix && <span>{prefix}</span>}\n            {label}\n          </ListSubheader>,\n          renderOptions(items, level+1),\n        ];\n      } else {\n        return <MenuItem disabled={disabled} key={path} value={path}>\n          {prefix && <span>{prefix}</span>}\n          {label}\n        </MenuItem>;\n      }\n    })\n  );\n\n  const onChange = e => {\n    if (e.target.value === undefined)\n      return;\n    setField(e.target.value);\n  };\n\n  const renderValue = (selectedValue) => {\n    if (!readonly && !selectedValue)\n      return placeholder;\n    const findLabel = (fields) => {\n      return fields.map(field => {\n        if(!field.items) return field.path === selectedValue ? field.label : null;\n        return findLabel(field.items);\n      });\n    };\n    return findLabel(items).filter((v) => {\n      if (Array.isArray(v)) {\n        return v.some((value) => value !== null);\n      } else {\n        return v !== null;\n      }\n    }).pop();\n  };\n  \n  const hasValue = selectedKey != null;\n  return (\n    <FormControl>\n      <Select\n        autoWidth\n        displayEmpty\n        label={placeholder}\n        onChange={onChange}\n        value={hasValue ? selectedKey : \"\"}\n        disabled={readonly}\n        renderValue={renderValue}\n      >\n        {renderOptions(items)}\n      </Select>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport Button from \"@material-ui/core/Button\";\nimport IconButton from \"@material-ui/core/IconButton\";\n\nexport default ({type, label, onClick, readonly, config}) => {\n  const typeToOnlyIcon = {\n    \"delGroup\": <DeleteIcon />,\n    \"delRuleGroup\": <DeleteIcon />,\n    \"delRule\": <DeleteIcon />,\n    \"addRuleGroup\": <AddIcon />,\n  };\n  const typeToIcon = {\n    \"addRule\": <AddIcon />,\n    \"addGroup\": <AddIcon />,\n    \"addRuleGroupExt\": <AddIcon />,\n  };\n  const typeToColor = {\n    \"addRule\": \"default\",\n    \"addGroup\": \"primary\",\n    \"delGroup\": \"secondary\",\n    \"delRuleGroup\": \"secondary\",\n    \"delRule\": \"secondary\",\n  };\n  if (typeToOnlyIcon[type])\n    return <IconButton size=\"small\" disabled={readonly} onClick={onClick} color={typeToColor[type]}>{typeToOnlyIcon[type]}</IconButton>;\n  else\n    return <Button size=\"small\" disabled={readonly} onClick={onClick} color={typeToColor[type]} startIcon={typeToIcon[type]}>{label}</Button>;\n};\n","import React from \"react\";\n\nexport default ({children, config}) => {\n  return <>{children}</>;\n};\n","import React from \"react\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport Checkbox from \"@material-ui/core/Checkbox\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\nimport Button from \"@material-ui/core/Button\";\n\nexport default ({id, not, setNot, conjunctionOptions, setConjunction, disabled, readonly, config, showNot, notLabel}) => {\n  //TIP: disabled=true if only 1 rule; readonly=true if immutable mode\n  const conjsCount = Object.keys(conjunctionOptions).length;\n  const lessThenTwo = disabled;\n  const {forceShowConj} = config.settings;\n  const showConj = forceShowConj || conjsCount > 1 && !lessThenTwo;\n\n  const renderOptions = () => \n    Object.keys(conjunctionOptions).map(key => {\n      const {id, name, label, checked} = conjunctionOptions[key];\n      const postfix = setConjunction.isDummyFn ? \"__dummy\" : \"\";\n      if ((readonly || disabled) && !checked)\n        return null;\n      return (\n        <Button \n          key={id+postfix} \n          id={id+postfix} \n          color={checked ? \"primary\" : \"default\"} \n          value={key} \n          onClick={onClick.bind(null, key)} \n          disabled={readonly || disabled}\n        >\n          {label}\n        </Button>\n      );\n    });\n  \n  const renderNot = () => {\n    if (readonly && !not)\n      return null;\n    return (\n      <Button \n        key={id}\n        id={id + \"__not\"}\n        color={not ? \"secondary\" : \"default\"} \n        onClick={onNotClick.bind(null, !not)} \n        disabled={readonly}\n      >\n        {notLabel || \"NOT\"}\n      </Button>\n    );\n  };\n\n  const onClick = value => setConjunction(value);\n  const onNotClick = checked => setNot(checked);\n\n  return (\n    <FormControl>\n      <ButtonGroup \n        disableElevation \n        variant=\"contained\" \n        size=\"small\" \n        disabled={readonly}\n      >\n        {showNot && renderNot()}\n        {showConj && renderOptions()}\n      </ButtonGroup>\n    </FormControl>\n  );\n  \n};\n","import React from \"react\";\nimport Switch from \"@material-ui/core/Switch\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Button from \"@material-ui/core/Button\";\nimport LockOpenIcon from \"@material-ui/icons/LockOpen\";\nimport LockIcon from \"@material-ui/icons/Lock\";\n\nexport default ({value, setValue, label, checkedLabel, hideLabel, id, config, type}) => {\n  const {renderSize} = config.settings;\n  const onChange = e => setValue(e.target.checked);\n  const onClick = () => setValue(!value);\n  const postfix = type;\n  const showLabel = value ? (checkedLabel || label) : label;\n  const icon = value ? <LockIcon /> : <LockOpenIcon />;\n\n  if (type == \"lock\") {\n    if (hideLabel) {\n      return <IconButton\n        key={id+postfix}\n        onClick={onClick}\n        size={\"small\"}\n      >{icon}</IconButton>;\n    } else {\n      return <Button\n        key={id+postfix}\n        onClick={onClick}\n        size={\"small\"}\n        startIcon={icon}\n      >{showLabel}</Button>;\n    }\n  }\n\n  return <FormControlLabel \n    control={<Switch\n      checked={!!value}\n      size={\"small\"}\n      onChange={onChange}\n    />} \n    label={showLabel} \n  />;\n};\n","export default ({onOk, okText, cancelText, title, confirmFn}) => {\n  confirmFn({ \n    description: title || \"Are you sure?\",\n    title: null,\n    confirmationText: okText || \"Ok\",\n    cancellationText: cancelText || \"Cancel\",\n  })\n    .then(onOk)\n    .catch(() => {});\n};\n","import MaterialWidgets from \"../../components/widgets/material\";\nimport BasicConfig, {stringifyForDisplay} from \"../basic\";\nimport React from \"react\";\nimport {SqlString, spelEscape} from \"../../utils/export\";\n\n\nconst {\n  MaterialBooleanWidget,\n  MaterialTextWidget,\n  MaterialTextAreaWidget,\n  MaterialDateWidget,\n  MaterialTimeWidget,\n  MaterialDateTimeWidget,\n  MaterialMultiSelectWidget,\n  MaterialSelectWidget,\n  MaterialNumberWidget,\n  MaterialSliderWidget,\n  MaterialRangeWidget,\n  MaterialAutocompleteWidget,\n\n  MaterialFieldSelect,\n  MaterialFieldAutocomplete,\n  MaterialConjs,\n  MaterialSwitch,\n  MaterialButton,\n  MaterialButtonGroup,\n  MaterialValueSources,\n\n  MaterialProvider,\n  MaterialConfirm,\n  MaterialUseConfirm,\n} = MaterialWidgets;\n\n\nconst settings = {\n  ...BasicConfig.settings,\n\n  renderField: (props) => props?.customProps?.showSearch \n    ? <MaterialFieldAutocomplete {...props} /> \n    : <MaterialFieldSelect {...props} />,\n  renderOperator: (props) => <MaterialFieldSelect {...props} />,\n  renderFunc: (props) => <MaterialFieldSelect {...props} />,\n  renderConjs: (props) => <MaterialConjs {...props} />,\n  renderSwitch: (props) => <MaterialSwitch {...props} />,\n  renderButton: (props) => <MaterialButton {...props} />,\n  renderButtonGroup: (props) => <MaterialButtonGroup {...props} />,\n  renderValueSources: (props) => <MaterialValueSources {...props} />,\n  renderProvider: (props) => <MaterialProvider {...props} />,\n  renderConfirm: MaterialConfirm,\n  useConfirm: MaterialUseConfirm,\n};\n\n\nconst widgets = {\n  ...BasicConfig.widgets,\n  text: {\n    ...BasicConfig.widgets.text,\n    factory: (props) => <MaterialTextWidget {...props} />,\n  },\n  textarea: {\n    ...BasicConfig.widgets.textarea,\n    factory: (props) => <MaterialTextAreaWidget {...props} />,\n  },\n  number: {\n    ...BasicConfig.widgets.number,\n    factory: (props) => <MaterialNumberWidget {...props} />,\n  },\n  multiselect: {\n    ...BasicConfig.widgets.multiselect,\n    factory: (props) => {\n      return (props.asyncFetch || props.showSearch) \n        ? <MaterialAutocompleteWidget multiple {...props} /> \n        : <MaterialMultiSelectWidget {...props} />;\n    },\n  },\n  select: {\n    ...BasicConfig.widgets.select,\n    factory: (props) => {\n      return (props.asyncFetch || props.showSearch) \n        ? <MaterialAutocompleteWidget {...props} /> \n        : <MaterialSelectWidget {...props} />;\n    },\n  },\n  slider: {\n    ...BasicConfig.widgets.slider,\n    factory: (props) => <MaterialSliderWidget {...props} />,\n  },\n  boolean: {\n    ...BasicConfig.widgets.boolean,\n    factory: (props) => <MaterialBooleanWidget {...props} />,\n  },\n  date: {\n    ...BasicConfig.widgets.date,\n    factory: (props) => <MaterialDateWidget {...props} />,\n  },\n  time: {\n    ...BasicConfig.widgets.time,\n    factory: (props) => <MaterialTimeWidget {...props} />,\n  },\n  datetime: {\n    ...BasicConfig.widgets.datetime,\n    factory: (props) => <MaterialDateTimeWidget {...props} />,\n  },\n\n  rangeslider: {\n    type: \"number\",\n    jsType: \"number\",\n    valueSrc: \"value\",\n    factory: (props) => <MaterialRangeWidget {...props} />,\n    valueLabel: \"Range\",\n    valuePlaceholder: \"Select range\",\n    valueLabels: [\n      { label: \"Number from\", placeholder: \"Enter number from\" },\n      { label: \"Number to\", placeholder: \"Enter number to\" },\n    ],\n    formatValue: (val, fieldDef, wgtDef, isForDisplay) => {\n      return isForDisplay ? stringifyForDisplay(val) : JSON.stringify(val);\n    },\n    sqlFormatValue: (val, fieldDef, wgtDef, op, opDef) => {\n      return SqlString.escape(val);\n    },\n    spelFormatValue: (val) => spelEscape(val),\n    singleWidget: \"slider\",\n    toJS: (val, fieldSettings) => (val),\n  },\n};\n\n\nconst types = {\n  ...BasicConfig.types,\n  number: {\n    ...BasicConfig.types.number,\n    widgets: {\n      ...BasicConfig.types.number.widgets,\n      rangeslider: {\n        opProps: {\n          between: {\n            isSpecialRange: true,\n          },\n          not_between: {\n            isSpecialRange: true,\n          }\n        },\n        operators: [\n          \"between\",\n          \"not_between\",\n          \"is_null\",\n          \"is_not_null\",\n        ],\n      }\n    },\n  },\n};\n\nexport default {\n  ...BasicConfig,\n  types,\n  widgets,\n  settings,\n};","import React from \"react\";\nimport debounce from \"lodash/debounce\";\nimport { mapListValues, listValuesToArray } from \"../utils/stuff\";\nimport { mergeListValues, listValueToOption, getListValue } from \"../utils/autocomplete\";\n\n\nconst useListValuesAutocomplete = ({\n  asyncFetch, useLoadMore, useAsyncSearch, forceAsyncSearch,\n  asyncListValues: selectedAsyncListValues,\n  listValues: staticListValues, allowCustomValues,\n  value: selectedValue, setValue, placeholder\n}, {\n  debounceTimeout,\n  multiple\n}) => {\n  const knownSpecialValues = [\"LOAD_MORE\", \"LOADING_MORE\"];\n  const loadMoreTitle = \"Load more...\";\n  const loadingMoreTitle = \"Loading more...\";\n  const aPlaceholder = forceAsyncSearch ? \"Type to search\" : placeholder;\n\n  // state\n  const [open, setOpen] = React.useState(false);\n  const [asyncFetchMeta, setAsyncFetchMeta] = React.useState(undefined);\n  const [loadingCnt, setLoadingCnt] = React.useState(0);\n  const [isLoadingMore, setIsLoadingMore] = React.useState(false);\n  const [inputValue, setInputValue] = React.useState(\"\");\n  const [asyncListValues, setAsyncListValues] = React.useState(undefined);\n\n  // ref\n  const asyncFectchCnt = React.useRef(0);\n  const componentIsMounted = React.useRef(true);\n  const isSelectedLoadMore = React.useRef(false);\n\n  // compute\n  const nSelectedAsyncListValues = listValuesToArray(selectedAsyncListValues);\n  const listValues = asyncFetch\n    ? (!allowCustomValues ? mergeListValues(asyncListValues, nSelectedAsyncListValues, true) : asyncListValues)\n    : staticListValues;\n  //const isDirtyInitialListValues = asyncListValues == undefined && selectedAsyncListValues && selectedAsyncListValues.length && typeof selectedAsyncListValues[0] != \"object\";\n  const isLoading = loadingCnt > 0;\n  const canInitialLoad = open && asyncFetch\n    && asyncListValues === undefined\n    && (forceAsyncSearch ? inputValue : true);\n  const isInitialLoading = canInitialLoad && isLoading;\n  const canLoadMore = !isInitialLoading && listValues && listValues.length > 0\n    && asyncFetchMeta && asyncFetchMeta.hasMore && (asyncFetchMeta.filter || \"\") === inputValue;\n  const canShowLoadMore = !isLoading && canLoadMore;\n  const options = mapListValues(listValues, listValueToOption);\n  const hasValue = selectedValue != null;\n  // const selectedListValue = hasValue ? getListValue(selectedValue, listValues) : null;\n  // const selectedOption = listValueToOption(selectedListValue);\n\n  // fetch\n  const fetchListValues = async (filter = null, isLoadMore = false) => {\n    // clear obsolete meta\n    if (!isLoadMore && asyncFetchMeta) {\n      setAsyncFetchMeta(undefined);\n    }\n\n    const offset = isLoadMore && asyncListValues ? asyncListValues.length : 0;\n    const meta = isLoadMore && asyncFetchMeta || !useLoadMore && { pageSize: 0 };\n\n    const newAsyncFetchCnt = ++asyncFectchCnt.current;\n    const res = await asyncFetch(filter, offset, meta);\n    const isFetchCancelled = asyncFectchCnt.current != newAsyncFetchCnt;\n    if (isFetchCancelled || !componentIsMounted.current) {\n      return null;\n    }\n\n    const { values, hasMore, meta: newMeta } = res && res.values ? res : { values: res };\n    const nValues = listValuesToArray(values);\n    let assumeHasMore;\n    let newValues;\n    if (isLoadMore) {\n      newValues = mergeListValues(asyncListValues, nValues, false);\n      assumeHasMore = newValues.length > asyncListValues.length;\n    } else {\n      newValues = nValues;\n      if (useLoadMore) {\n        assumeHasMore = newValues.length > 0;\n      }\n    }\n\n    // save new meta\n    const realNewMeta = hasMore != null || newMeta != null || assumeHasMore != null ? {\n      ...(assumeHasMore != null ? { hasMore: assumeHasMore } : {}),\n      ...(hasMore != null ? { hasMore } : {}),\n      ...(newMeta != null ? newMeta : {}),\n      filter\n    } : undefined;\n    if (realNewMeta) {\n      setAsyncFetchMeta(realNewMeta);\n    }\n\n    return newValues;\n  };\n\n  const loadListValues = async (filter = null, isLoadMore = false) => {\n    setLoadingCnt(x => (x + 1));\n    setIsLoadingMore(isLoadMore);\n    const list = await fetchListValues(filter, isLoadMore);\n    if (!componentIsMounted.current) {\n      return;\n    }\n    if (list != null) {\n      // tip: null can be used for reject (eg, if user don't want to filter by input)\n      setAsyncListValues(list);\n    }\n    setLoadingCnt(x => (x - 1));\n    setIsLoadingMore(false);\n  };\n  const loadListValuesDebounced = React.useCallback(debounce(loadListValues, debounceTimeout), []);\n\n  // Unmount\n  React.useEffect(() => {\n    return () => {\n      componentIsMounted.current = false;\n    };\n  }, []);\n\n  // Initial loading\n  React.useEffect(() => {\n    if (canInitialLoad && loadingCnt == 0 && asyncFectchCnt.current == 0) {\n      (async () => {\n        await loadListValues();\n      })();\n    }\n  }, [canInitialLoad]);\n\n  // Event handlers\n  const onOpen = () => {\n    setOpen(true);\n  };\n\n  const onClose = (_e) => {\n    if (isSelectedLoadMore.current) {\n      isSelectedLoadMore.current = false;\n      if (multiple) {\n        setOpen(false);\n      }\n    } else {\n      setOpen(false);\n    }\n  };\n\n  const onDropdownVisibleChange = (open) => {\n    if (open) {\n      onOpen();\n    } else {\n      onClose();\n    }\n  };\n\n  const isSpecialValue = (option) => {\n    const specialValue = option?.specialValue || option?.value;\n    return knownSpecialValues.includes(specialValue);\n  };\n\n  const onChange = async (_e, option) => {\n    let specialValue = option?.specialValue || option?.value \n      || multiple && option.map(opt => opt?.specialValue || opt?.value).find(v => !!v);\n    if (specialValue == \"LOAD_MORE\") {\n      isSelectedLoadMore.current = true;\n      await loadListValues(inputValue, true);\n    } else if (specialValue == \"LOADING_MORE\") {\n      isSelectedLoadMore.current = true;\n    } else {\n      if (multiple) {\n        const options = option;\n        let newSelectedListValues = options.map((o, i) => {\n          const item = o.value != null ? o : getListValue(o, listValues);\n          // AntDesign puts array of labels in `_e` (`option` is array of objects, but custom option is always `{}`)\n          // MUI puts array of labels in `option`\n          const customItem = allowCustomValues && !item ? (Array.isArray(_e) ? _e[i] : o) : null;\n          return item || customItem;\n        });\n        let newSelectedValues = newSelectedListValues\n          .filter(o => o !== undefined)\n          .map(o => (o.value !== undefined ? o.value : o));\n        if (!newSelectedValues.length)\n          newSelectedValues = undefined; //not allow []\n        setValue(newSelectedValues, newSelectedListValues);\n      } else {\n        const v = option == null ? undefined : option.value;\n        setValue(v, [option]);\n      }\n    }\n  };\n\n  const onInputChange = async (_e, newInputValue) => {\n    const val = newInputValue;\n    //const isTypeToSearch = e.type == 'change';\n\n    if (val === loadMoreTitle || val === loadingMoreTitle) {\n      return;\n    }\n\n    setInputValue(val);\n\n    if (allowCustomValues) {\n      if (multiple) {\n        //todo\n      } else {\n        setValue(val, [val]);\n      }\n    }\n\n    const canSearchAsync = useAsyncSearch && (forceAsyncSearch ? !!val : true);\n    if (canSearchAsync) {\n      await loadListValuesDebounced(val);\n    } else if (useAsyncSearch && forceAsyncSearch) {\n      setAsyncListValues([]);\n    }\n  };\n\n  // to keep compatibility with antD\n  const onSearch = async (newInputValue) => {\n    if (newInputValue === \"\" && !open) {\n      return;\n    }\n\n    await onInputChange(null, newInputValue);\n  };\n\n  // Options\n  const extendOptions = (options) => {\n    const filtered = [...options];\n    if (useLoadMore) {\n      if (canShowLoadMore) {\n        filtered.push({\n          specialValue: \"LOAD_MORE\",\n          title: loadMoreTitle,\n        });\n      } else if (isLoadingMore) {\n        filtered.push({\n          specialValue: \"LOADING_MORE\",\n          title: loadingMoreTitle,\n          disabled: true\n        });\n      }\n    }\n    return filtered;\n  };\n\n  const getOptionSelected = (option, valueOrOption) => {\n    if (valueOrOption == null)\n      return null;\n    const selectedValue = valueOrOption.value != undefined ? valueOrOption.value : valueOrOption;\n    return option.value === selectedValue;\n  };\n\n  const getOptionDisabled = (valueOrOption) => {\n    return valueOrOption && valueOrOption.disabled;\n  };\n\n  const getOptionLabel = (valueOrOption) => {\n    if (valueOrOption == null)\n      return null;\n    const option = valueOrOption.value != undefined ? valueOrOption\n      : listValueToOption(getListValue(valueOrOption, listValues));\n    if (!option && valueOrOption.specialValue) {\n      // special last 'Load more...' item\n      return valueOrOption.title;\n    }\n    if (!option && allowCustomValues) {\n      // there is just string value, it's not item from list\n      return valueOrOption;\n    }\n    if (!option) {\n      // weird\n      return valueOrOption;\n    }\n    return option.title;\n  };\n\n  return {\n    options,\n    listValues,\n    hasValue,\n\n    open,\n    onOpen,\n    onClose,\n    onDropdownVisibleChange,\n    onChange,\n    \n    inputValue,\n    onInputChange,\n    onSearch,\n    canShowLoadMore,\n    isInitialLoading,\n    isLoading,\n    isLoadingMore,\n    isSpecialValue,\n\n    extendOptions,\n    getOptionSelected,\n    getOptionDisabled,\n    getOptionLabel,\n\n    // unused\n    //selectedListValue,\n    //selectedOption,\n    aPlaceholder,\n  };\n};\n\nexport default useListValuesAutocomplete;\n","export const ADD_GROUP = \"ADD_GROUP\";\nexport const ADD_CASE_GROUP = \"ADD_CASE_GROUP\";\nexport const REMOVE_GROUP = \"REMOVE_GROUP\";\nexport const SET_CONJUNCTION = \"SET_CONJUNCTION\";\nexport const SET_NOT = \"SET_NOT\";\nexport const ADD_RULE = \"ADD_RULE\";\nexport const REMOVE_RULE = \"REMOVE_RULE\";\nexport const SET_FIELD = \"SET_FIELD\";\nexport const SET_OPERATOR = \"SET_OPERATOR\";\nexport const SET_VALUE = \"SET_VALUE\";\nexport const SET_VALUE_SRC = \"SET_VALUE_SRC\";\nexport const SET_OPERATOR_OPTION = \"SET_OPERATOR_OPTION\";\nexport const SET_LOCK = \"SET_LOCK\";\n\nexport const SET_TREE = \"SET_TREE\";\n\nexport const MOVE_ITEM = \"MOVE_ITEM\";\n\nexport const PLACEMENT_AFTER = \"after\";\nexport const PLACEMENT_BEFORE = \"before\";\nexport const PLACEMENT_APPEND = \"append\";\nexport const PLACEMENT_PREPEND = \"prepend\";\n\nexport const SET_DRAG_PROGRESS = \"SET_DRAG_PROGRESS\";\nexport const SET_DRAG_START = \"SET_DRAG_START\";\nexport const SET_DRAG_END = \"SET_DRAG_END\";\n","\nimport Immutable from \"immutable\";\nimport {\n  expandTreePath, expandTreeSubpath, getItemByPath, fixPathsInTree, \n  getTotalRulesCountInTree, fixEmptyGroupsInTree, isEmptyTree, hasChildren, removeIsLockedInTree\n} from \"../utils/treeUtils\";\nimport {\n  defaultRuleProperties, defaultGroupProperties, defaultOperator, \n  defaultOperatorOptions, defaultRoot, defaultItemProperties\n} from \"../utils/defaultUtils\";\nimport * as constants from \"../constants\";\nimport uuid from \"../utils/uuid\";\nimport {\n  getFuncConfig, getFieldConfig, getFieldWidgetConfig, getOperatorConfig\n} from \"../utils/configUtils\";\nimport {\n  getOperatorsForField, getFirstOperator, getWidgetForFieldOp,\n  getNewValueForFieldOp\n} from \"../utils/ruleUtils\";\nimport {deepEqual, defaultValue, applyToJS} from \"../utils/stuff\";\nimport {validateValue} from \"../utils/validation\";\nimport omit from \"lodash/omit\";\nimport mapValues from \"lodash/mapValues\";\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {Immutable.Map} properties\n */\nconst addNewGroup = (state, path, type, groupUuid, properties, config, children = null, meta = {}) => {\n  const {shouldCreateEmptyGroup} = config.settings;\n  const groupPath = path.push(groupUuid);\n  const canAddNewRule = !shouldCreateEmptyGroup;\n  const isDefaultCase = !!meta?.isDefaultCase;\n\n  const origState = state;\n  state = addItem(state, path, type, groupUuid, defaultGroupProperties(config).merge(properties || {}), config, children);\n  if (state !== origState) {\n    if (!children && !isDefaultCase) {\n      state = state.setIn(expandTreePath(groupPath, \"children1\"), new Immutable.OrderedMap());\n\n      // Add one empty rule into new group\n      if (canAddNewRule) {\n        state = addItem(state, groupPath, \"rule\", uuid(), defaultRuleProperties(config), config);\n      }\n    }\n\n    state = fixPathsInTree(state);\n  }\n  \n  return state;\n};\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {Immutable.Map} properties\n */\nconst removeGroup = (state, path, config) => {\n  state = removeItem(state, path);\n\n  const {canLeaveEmptyGroup} = config.settings;\n  const parentPath = path.slice(0, -1);\n  const isEmptyParentGroup = !hasChildren(state, parentPath);\n  if (isEmptyParentGroup && !canLeaveEmptyGroup) {\n    // check ancestors for emptiness (and delete 'em if empty)\n    state = fixEmptyGroupsInTree(state);\n    \n    if (isEmptyTree(state) && !canLeaveEmptyGroup) {\n      // if whole query is empty, add one empty rule to root\n      state = addItem(state, new Immutable.List(), \"rule\", uuid(), defaultRuleProperties(config), config);\n    }\n  }\n  state = fixPathsInTree(state);\n  return state;\n};\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n */\nconst removeRule = (state, path, config) => {\n  state = removeItem(state, path);\n\n  const {canLeaveEmptyGroup} = config.settings;\n  const parentPath = path.pop();\n  const parent = state.getIn(expandTreePath(parentPath));\n\n  const parentField = parent.getIn([\"properties\", \"field\"]);\n  const parentOperator = parent.getIn([\"properties\", \"operator\"]);\n  const parentValue = parent.getIn([\"properties\", \"value\", 0]);\n  const parentFieldConfig = parentField ? getFieldConfig(config, parentField) : null;\n  const parentOperatorConfig = parentOperator ? getOperatorConfig(config, parentOperator, parentField) : null;\n  const hasGroupCountRule = parentField && parentOperator && parentOperatorConfig.cardinality != 0; // && parentValue != undefined;\n  \n  const isParentRuleGroup = parent.get(\"type\") == \"rule_group\";\n  const isEmptyParentGroup = !hasChildren(state, parentPath);\n  const canLeaveEmpty = isParentRuleGroup \n    ? hasGroupCountRule && parentFieldConfig.initialEmptyWhere\n    : canLeaveEmptyGroup;\n  \n  if (isEmptyParentGroup && !canLeaveEmpty) {\n    if (isParentRuleGroup) {\n      // deleted last rule from rule_group, so delete whole rule_group\n      state = state.deleteIn(expandTreePath(parentPath));\n    }\n\n    // check ancestors for emptiness (and delete 'em if empty)\n    state = fixEmptyGroupsInTree(state);\n\n    if (isEmptyTree(state) && !canLeaveEmptyGroup) {\n      // if whole query is empty, add one empty rule to root\n      state = addItem(state, new Immutable.List(), \"rule\", uuid(), defaultRuleProperties(config), config);\n    }\n  }\n  state = fixPathsInTree(state);\n  return state;\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {bool} not\n */\nconst setNot = (state, path, not) =>\n  state.setIn(expandTreePath(path, \"properties\", \"not\"), not);\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {bool} lock\n */\nconst setLock = (state, path, lock) =>\n  removeIsLockedInTree(state.setIn(expandTreePath(path, \"properties\", \"isLocked\"), lock));\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {string} conjunction\n */\nconst setConjunction = (state, path, conjunction) =>\n  state.setIn(expandTreePath(path, \"properties\", \"conjunction\"), conjunction);\n\n// convert children deeply from JS to Immutable\nconst _addChildren1 = (config, item, children) => {\n  if (children && Array.isArray(children)) {\n    item.children1 = new Immutable.OrderedMap(\n      children.reduce((map, it) => {\n        const id1 = uuid();\n        const it1 = {\n          ...it,\n          properties: defaultItemProperties(config, it).merge(it.properties || {}),\n          id: id1\n        };\n        _addChildren1(config, it1, it1.children1);\n        //todo: guarantee order\n        return {\n          ...map,\n          [id1]: new Immutable.Map(it1)\n        };\n      }, {})\n    );\n  }\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {string} type\n * @param {string} id\n * @param {Immutable.OrderedMap} properties\n * @param {object} config\n */\nconst addItem = (state, path, type, id, properties, config, children = null) => {\n  if (type == \"switch_group\")\n    throw new Error(\"Can't add switch_group programmatically\");\n  const { maxNumberOfCases, maxNumberOfRules, maxNesting } = config.settings;\n  const rootType = state.get(\"type\");\n  const isTernary = rootType == \"switch_group\";\n  const targetItem = state.getIn(expandTreePath(path));\n  const caseGroup = isTernary ? state.getIn(expandTreePath(path.take(2))) : null;\n  const childrenPath = expandTreePath(path, \"children1\");\n  const targetChildren = state.getIn(childrenPath);\n  const hasChildren = !!targetChildren && targetChildren.size;\n  const targetChildrenSize = hasChildren ? targetChildren.size : null;\n  let currentNumber, maxNumber;\n  if (type == \"case_group\") {\n    currentNumber = targetChildrenSize;\n    maxNumber = maxNumberOfCases;\n  } else if (type == \"group\") {\n    currentNumber = path.size;\n    maxNumber = maxNesting;\n  } else if (targetItem?.get(\"type\") == \"rule_group\") {\n    // don't restrict\n  } else {\n    currentNumber = isTernary ? getTotalRulesCountInTree(caseGroup) : getTotalRulesCountInTree(state);\n    maxNumber = maxNumberOfRules;\n  }\n  const canAdd = maxNumber && currentNumber ? (currentNumber < maxNumber) : true;\n  \n  const item = {type, id, properties};\n  _addChildren1(config, item, children);\n\n  const isLastDefaultCase = type == \"case_group\" && hasChildren && targetChildren.last().get(\"children1\") == null;\n\n  if (canAdd) {\n    const newChildren = new Immutable.OrderedMap({\n      [id]: new Immutable.Map(item)\n    });\n    if (!hasChildren) {\n      state = state.setIn(childrenPath, newChildren);\n    } else if (isLastDefaultCase) {\n      const last = targetChildren.last();\n      const newChildrenWithLast = new Immutable.OrderedMap({\n        [id]: new Immutable.Map(item),\n        [last.get(\"id\")]: last\n      });\n      state = state.deleteIn(expandTreePath(childrenPath, \"children1\", last.get(\"id\")));\n      state = state.mergeIn(childrenPath, newChildrenWithLast);\n    } else {\n      state = state.mergeIn(childrenPath, newChildren);\n    }\n    state = fixPathsInTree(state);\n  }\n  return state;\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n */\nconst removeItem = (state, path) => {\n  state = state.deleteIn(expandTreePath(path));\n  state = fixPathsInTree(state);\n  return state;\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} fromPath\n * @param {Immutable.List} toPath\n * @param {string} placement, see constants PLACEMENT_*: PLACEMENT_AFTER, PLACEMENT_BEFORE, PLACEMENT_APPEND, PLACEMENT_PREPEND\n * @param {object} config\n */\nconst moveItem = (state, fromPath, toPath, placement, config) => {\n  const from = getItemByPath(state, fromPath);\n  const sourcePath = fromPath.pop();\n  const source = fromPath.size > 1 ? getItemByPath(state, sourcePath) : null;\n  const sourceChildren = source ? source.get(\"children1\") : null;\n\n  const to = getItemByPath(state, toPath);\n  const targetPath = (placement == constants.PLACEMENT_APPEND || placement == constants.PLACEMENT_PREPEND) ? toPath : toPath.pop();\n  const target = (placement == constants.PLACEMENT_APPEND || placement == constants.PLACEMENT_PREPEND) \n    ? to\n    : toPath.size > 1 ? getItemByPath(state, targetPath) : null;\n  const targetChildren = target ? target.get(\"children1\") : null;\n\n  if (!source || !target)\n    return state;\n\n  const isSameParent = (source.get(\"id\") == target.get(\"id\"));\n  const isSourceInsideTarget = targetPath.size < sourcePath.size \n        && deepEqual(targetPath.toArray(), sourcePath.toArray().slice(0, targetPath.size));\n  const isTargetInsideSource = targetPath.size > sourcePath.size \n        && deepEqual(sourcePath.toArray(), targetPath.toArray().slice(0, sourcePath.size));\n  let sourceSubpathFromTarget = null;\n  let targetSubpathFromSource = null;\n  if (isSourceInsideTarget) {\n    sourceSubpathFromTarget = Immutable.List(sourcePath.toArray().slice(targetPath.size));\n  } else if (isTargetInsideSource) {\n    targetSubpathFromSource = Immutable.List(targetPath.toArray().slice(sourcePath.size));\n  }\n\n  let newTargetChildren = targetChildren, newSourceChildren = sourceChildren;\n  if (!isTargetInsideSource)\n    newSourceChildren = newSourceChildren.delete(from.get(\"id\"));\n  if (isSameParent) {\n    newTargetChildren = newSourceChildren;\n  } else if (isSourceInsideTarget) {\n    newTargetChildren = newTargetChildren.updateIn(expandTreeSubpath(sourceSubpathFromTarget, \"children1\"), (_oldChildren) => newSourceChildren);\n  }\n\n  if (placement == constants.PLACEMENT_BEFORE || placement == constants.PLACEMENT_AFTER) {\n    newTargetChildren = Immutable.OrderedMap().withMutations(r => {\n      for (let [itemId, item] of newTargetChildren.entries()) {\n        if (itemId == to.get(\"id\") && placement == constants.PLACEMENT_BEFORE) {\n          r.set(from.get(\"id\"), from);\n        }\n                \n        r.set(itemId, item);\n\n        if (itemId == to.get(\"id\") && placement == constants.PLACEMENT_AFTER) {\n          r.set(from.get(\"id\"), from);\n        }\n      }\n    });\n  } else if (placement == constants.PLACEMENT_APPEND) {\n    newTargetChildren = newTargetChildren.merge({[from.get(\"id\")]: from});\n  } else if (placement == constants.PLACEMENT_PREPEND) {\n    newTargetChildren = Immutable.OrderedMap({[from.get(\"id\")]: from}).merge(newTargetChildren);\n  }\n\n  if (isTargetInsideSource) {\n    newSourceChildren = newSourceChildren.updateIn(expandTreeSubpath(targetSubpathFromSource, \"children1\"), (_oldChildren) => newTargetChildren);\n    newSourceChildren = newSourceChildren.delete(from.get(\"id\"));\n  }\n\n  if (!isSameParent && !isSourceInsideTarget)\n    state = state.updateIn(expandTreePath(sourcePath, \"children1\"), (_oldChildren) => newSourceChildren);\n  if (!isTargetInsideSource)\n    state = state.updateIn(expandTreePath(targetPath, \"children1\"), (_oldChildren) => newTargetChildren);\n\n  state = fixPathsInTree(state);\n  return state;\n};\n\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {string} field\n */\nconst setField = (state, path, newField, config) => {\n  if (!newField)\n    return removeItem(state, path);\n\n  const {fieldSeparator, setOpOnChangeField, showErrorMessage} = config.settings;\n  if (Array.isArray(newField))\n    newField = newField.join(fieldSeparator);\n\n  const currentType = state.getIn(expandTreePath(path, \"type\"));\n  const currentProperties = state.getIn(expandTreePath(path, \"properties\"));\n  const wasRuleGroup = currentType == \"rule_group\";\n  const newFieldConfig = getFieldConfig(config, newField);\n  const isRuleGroup = newFieldConfig.type == \"!group\";\n  const isRuleGroupExt = isRuleGroup && newFieldConfig.mode == \"array\";\n  const isChangeToAnotherType = wasRuleGroup != isRuleGroup;\n  \n  const currentOperator = currentProperties.get(\"operator\");\n  const currentOperatorOptions = currentProperties.get(\"operatorOptions\");\n  const _currentField = currentProperties.get(\"field\");\n  const _currentValue = currentProperties.get(\"value\");\n  const _currentValueSrc = currentProperties.get(\"valueSrc\", new Immutable.List());\n  const _currentValueType = currentProperties.get(\"valueType\", new Immutable.List());\n\n  // If the newly selected field supports the same operator the rule currently\n  // uses, keep it selected.\n  const lastOp = newFieldConfig && newFieldConfig.operators.indexOf(currentOperator) !== -1 ? currentOperator : null;\n  let newOperator = null;\n  const availOps = getOperatorsForField(config, newField);\n  if (availOps && availOps.length == 1)\n    newOperator = availOps[0];\n  else if (availOps && availOps.length > 1) {\n    for (let strategy of setOpOnChangeField || []) {\n      if (strategy == \"keep\" && !isChangeToAnotherType)\n        newOperator = lastOp;\n      else if (strategy == \"default\")\n        newOperator = defaultOperator(config, newField, false);\n      else if (strategy == \"first\")\n        newOperator = getFirstOperator(config, newField);\n      if (newOperator) //found op for strategy\n        break;\n    }\n  }\n\n  if (!isRuleGroup && !newFieldConfig.operators) {\n    console.warn(`Type ${newFieldConfig.type} is not supported`);\n    return state;\n  }\n\n  if (wasRuleGroup && !isRuleGroup) {\n    state = state.setIn(expandTreePath(path, \"type\"), \"rule\");\n    state = state.deleteIn(expandTreePath(path, \"children1\"));\n    state = state.setIn(expandTreePath(path, \"properties\"), new Immutable.OrderedMap());\n  }\n\n  if (isRuleGroup) {\n    state = state.setIn(expandTreePath(path, \"type\"), \"rule_group\");\n    const {canReuseValue, newValue, newValueSrc, newValueType, operatorCardinality} = getNewValueForFieldOp(\n      config, config, currentProperties, newField, newOperator, \"field\", true\n    );\n    let groupProperties = defaultGroupProperties(config, newFieldConfig).merge({\n      field: newField,\n      mode: newFieldConfig.mode,\n    });\n    if (isRuleGroupExt) {\n      groupProperties = groupProperties.merge({\n        operator: newOperator,\n        value: newValue,\n        valueSrc: newValueSrc,\n        valueType: newValueType,\n      });\n    }\n    state = state.setIn(expandTreePath(path, \"children1\"), new Immutable.OrderedMap());\n    state = state.setIn(expandTreePath(path, \"properties\"), groupProperties);\n    if (newFieldConfig.initialEmptyWhere && operatorCardinality == 1) { // just `COUNT(grp) > 1` without `HAVING ..`\n      // no childeren\n    } else {\n      state = addItem(state, path, \"rule\", uuid(), defaultRuleProperties(config, newField), config);\n    }\n    state = fixPathsInTree(state);\n\n    return state;\n  }\n\n  return state.updateIn(expandTreePath(path, \"properties\"), (map) => map.withMutations((current) => {\n    const {canReuseValue, newValue, newValueSrc, newValueType, newValueError} = getNewValueForFieldOp(\n      config, config, current, newField, newOperator, \"field\", true\n    );\n    if (showErrorMessage) {\n      current = current\n        .set(\"valueError\", newValueError);\n    }\n    const newOperatorOptions = canReuseValue ? currentOperatorOptions : defaultOperatorOptions(config, newOperator, newField);\n\n    return current\n      .set(\"field\", newField)\n      .set(\"operator\", newOperator)\n      .set(\"operatorOptions\", newOperatorOptions)\n      .set(\"value\", newValue)\n      .set(\"valueSrc\", newValueSrc)\n      .set(\"valueType\", newValueType)\n      .delete(\"asyncListValues\");\n  }));\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {string} operator\n */\nconst setOperator = (state, path, newOperator, config) => {\n  const {showErrorMessage} = config.settings;\n\n  const properties = state.getIn(expandTreePath(path, \"properties\"));\n  const children = state.getIn(expandTreePath(path, \"children1\"));\n  const currentField = properties.get(\"field\");\n  const fieldConfig = getFieldConfig(config, currentField);\n  const isRuleGroup = fieldConfig.type == \"!group\";\n  const operatorConfig = getOperatorConfig(config, newOperator, currentField);\n  const operatorCardinality = operatorConfig ? defaultValue(operatorConfig.cardinality, 1) : null;\n\n  state = state.updateIn(expandTreePath(path, \"properties\"), (map) => map.withMutations((current) => {\n    const currentField = current.get(\"field\");\n    const currentOperatorOptions = current.get(\"operatorOptions\");\n    const _currentValue = current.get(\"value\", new Immutable.List());\n    const _currentValueSrc = current.get(\"valueSrc\", new Immutable.List());\n    const _currentOperator = current.get(\"operator\");\n\n    const {canReuseValue, newValue, newValueSrc, newValueType, newValueError} = getNewValueForFieldOp(\n      config, config, current, currentField, newOperator, \"operator\", true\n    );\n    if (showErrorMessage) {\n      current = current\n        .set(\"valueError\", newValueError);\n    }\n    const newOperatorOptions = canReuseValue ? currentOperatorOptions : defaultOperatorOptions(config, newOperator, currentField);\n\n    if (!canReuseValue) {\n      current = current\n        .delete(\"asyncListValues\");\n    }\n\n    return current\n      .set(\"operator\", newOperator)\n      .set(\"operatorOptions\", newOperatorOptions)\n      .set(\"value\", newValue)\n      .set(\"valueSrc\", newValueSrc)\n      .set(\"valueType\", newValueType);\n  }));\n\n  if (isRuleGroup) {\n    if (operatorCardinality == 0 && children.size == 0) {\n      state = addItem(state, path, \"rule\", uuid(), defaultRuleProperties(config, currentField), config);\n    }\n  }\n\n  return state;\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {integer} delta\n * @param {*} value\n * @param {string} valueType\n * @param {*} asyncListValues\n * @param {boolean} __isInternal\n */\nconst setValue = (state, path, delta, value, valueType, config, asyncListValues, __isInternal) => {\n  const {fieldSeparator, showErrorMessage} = config.settings;\n  let isInternalValueChange;\n  const valueSrc = state.getIn(expandTreePath(path, \"properties\", \"valueSrc\", delta + \"\")) || null;\n  if (valueSrc === \"field\" && Array.isArray(value))\n    value = value.join(fieldSeparator);\n\n  const field = state.getIn(expandTreePath(path, \"properties\", \"field\")) || null;\n  const operator = state.getIn(expandTreePath(path, \"properties\", \"operator\")) || null;\n  const operatorConfig = getOperatorConfig(config, operator, field);\n  const operatorCardinality = operator ? defaultValue(operatorConfig.cardinality, 1) : null;\n\n  const isEndValue = false;\n  const calculatedValueType = valueType || calculateValueType(value, valueSrc, config);\n  const canFix = false;\n  const [validateError, fixedValue] = validateValue(\n    config, field, field, operator, value, calculatedValueType, valueSrc, asyncListValues, canFix, isEndValue\n  );\n  const isValid = !validateError;\n  if (fixedValue !== value) {\n    // eg, get exact value from listValues (not string)\n    value = fixedValue;\n  }\n\n  // Additional validation for range values\n  if (showErrorMessage) {\n    const w = getWidgetForFieldOp(config, field, operator, valueSrc);\n    const fieldWidgetDefinition = getFieldWidgetConfig(config, field, operator, w, valueSrc);\n    const valueSrcs = Array.from({length: operatorCardinality}, (_, i) => (state.getIn(expandTreePath(path, \"properties\", \"valueSrc\", i + \"\")) || null));\n        \n    if (operatorConfig && operatorConfig.validateValues && valueSrcs.filter(vs => vs == \"value\" || vs == null).length == operatorCardinality) {\n      const values = Array.from({length: operatorCardinality}, (_, i) => (i == delta ? value : state.getIn(expandTreePath(path, \"properties\", \"value\", i + \"\")) || null));\n      const jsValues = fieldWidgetDefinition && fieldWidgetDefinition.toJS ? values.map(v => fieldWidgetDefinition.toJS(v, fieldWidgetDefinition)) : values;\n      const rangeValidateError = operatorConfig.validateValues(jsValues);\n\n      state = state.setIn(expandTreePath(path, \"properties\", \"valueError\", operatorCardinality), rangeValidateError);\n    }\n  }\n  \n  const lastValueArr = state.getIn(expandTreePath(path, \"properties\", \"value\"));\n  if (!lastValueArr) {\n    state = state\n      .setIn(expandTreePath(path, \"properties\", \"value\"), new Immutable.List(new Array(operatorCardinality)))\n      .setIn(expandTreePath(path, \"properties\", \"valueType\"), new Immutable.List(new Array(operatorCardinality)))\n      .setIn(expandTreePath(path, \"properties\", \"valueError\"), new Immutable.List(new Array(operatorCardinality)));\n  }\n\n  const lastValue = state.getIn(expandTreePath(path, \"properties\", \"value\", delta + \"\"));\n  const lastError = state.getIn(expandTreePath(path, \"properties\", \"valueError\", delta));\n  const isLastEmpty = lastValue == undefined;\n  const isLastError = !!lastError;\n  if (isValid || showErrorMessage) {\n    state = state.deleteIn(expandTreePath(path, \"properties\", \"asyncListValues\"));\n    // set only good value\n    if (typeof value === \"undefined\") {\n      state = state.setIn(expandTreePath(path, \"properties\", \"value\", delta + \"\"), undefined);\n      state = state.setIn(expandTreePath(path, \"properties\", \"valueType\", delta + \"\"), null);\n    } else {\n      if (asyncListValues) {\n        state = state.setIn(expandTreePath(path, \"properties\", \"asyncListValues\"), asyncListValues);\n      }\n      state = state.setIn(expandTreePath(path, \"properties\", \"value\", delta + \"\"), value);\n      state = state.setIn(expandTreePath(path, \"properties\", \"valueType\", delta + \"\"), calculatedValueType);\n      isInternalValueChange = __isInternal && !isLastEmpty && !isLastError;\n    }\n  }\n  if (showErrorMessage) {\n    state = state.setIn(expandTreePath(path, \"properties\", \"valueError\", delta), validateError);\n  }\n  if (__isInternal && (isValid && isLastError || !isValid && !isLastError)) {\n    state = state.setIn(expandTreePath(path, \"properties\", \"valueError\", delta), validateError);\n    isInternalValueChange = false;\n  }\n  \n  return {tree: state, isInternalValueChange};\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {integer} delta\n * @param {*} srcKey\n */\nconst setValueSrc = (state, path, delta, srcKey, config) => {\n  const {showErrorMessage} = config.settings;\n\n  const field = state.getIn(expandTreePath(path, \"properties\", \"field\")) || null;\n  const operator = state.getIn(expandTreePath(path, \"properties\", \"operator\")) || null;\n\n  state = state.setIn(expandTreePath(path, \"properties\", \"value\", delta + \"\"), undefined);\n  state = state.setIn(expandTreePath(path, \"properties\", \"valueType\", delta + \"\"), null);\n  state = state.deleteIn(expandTreePath(path, \"properties\", \"asyncListValues\"));\n\n  if (showErrorMessage) {\n    // clear value error\n    state = state.setIn(expandTreePath(path, \"properties\", \"valueError\", delta), null);\n\n    // if current operator is range, clear possible range error\n    const operatorConfig = getOperatorConfig(config, operator, field);\n    const operatorCardinality = operator ? defaultValue(operatorConfig.cardinality, 1) : null;\n    if (operatorConfig.validateValues) {\n      state = state.setIn(expandTreePath(path, \"properties\", \"valueError\", operatorCardinality), null);\n    }\n  }\n  \n  // set valueSrc\n  if (typeof srcKey === \"undefined\") {\n    state = state.setIn(expandTreePath(path, \"properties\", \"valueSrc\", delta + \"\"), null);\n  } else {\n    state = state.setIn(expandTreePath(path, \"properties\", \"valueSrc\", delta + \"\"), srcKey);\n  }\n\n  // maybe set default value\n  if (srcKey) {\n    const properties = state.getIn(expandTreePath(path, \"properties\"));\n    // this call should return canReuseValue = false and provide default value\n    const {canReuseValue, newValue, newValueSrc, newValueType, newValueError} = getNewValueForFieldOp(\n      config, config, properties, field, operator, \"valueSrc\", true\n    );\n    if (!canReuseValue && newValueSrc.get(delta) == srcKey) {\n      state = state.setIn(expandTreePath(path, \"properties\", \"value\", delta + \"\"), newValue.get(delta));\n      state = state.setIn(expandTreePath(path, \"properties\", \"valueType\", delta + \"\"), newValueType.get(delta));\n    }\n  }\n\n  return state;\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {Immutable.List} path\n * @param {string} name\n * @param {*} value\n */\nconst setOperatorOption = (state, path, name, value) => {\n  return state.setIn(expandTreePath(path, \"properties\", \"operatorOptions\", name), value);\n};\n\n/**\n * @param {Immutable.Map} state\n */\nconst checkEmptyGroups = (state, config) => {\n  const {canLeaveEmptyGroup} = config.settings;\n  if (!canLeaveEmptyGroup) {\n    state = fixEmptyGroupsInTree(state);\n  }\n  return state;\n};\n\n\n/**\n * \n */\nconst calculateValueType = (value, valueSrc, config) => {\n  let calculatedValueType = null;\n  if (value) {\n    if (valueSrc === \"field\") {\n      const fieldConfig = getFieldConfig(config, value);\n      if (fieldConfig) {\n        calculatedValueType = fieldConfig.type;\n      }\n    } else if (valueSrc === \"func\") {\n      const funcKey = value.get(\"func\");\n      if (funcKey) {\n        const funcConfig = getFuncConfig(config, funcKey);\n        if (funcConfig) {\n          calculatedValueType = funcConfig.returnType;\n        }\n      }\n    }\n  }\n  return calculatedValueType;\n};\n\nconst getField = (state, path) => {\n  const field = state.getIn(expandTreePath(path, \"properties\", \"field\")) || null;\n  return field;\n};\n\nconst emptyDrag = {\n  dragging: {\n    id: null,\n    x: null,\n    y: null,\n    w: null,\n    h: null\n  },\n  mousePos: {},\n  dragStart: {\n    id: null,\n  },\n};\n\nconst getActionMeta = (action, state) => {\n  const actionKeysToOmit = [\n    \"config\", \"asyncListValues\", \"__isInternal\"\n  ];\n  const actionTypesToIgnore = [\n    constants.SET_TREE,\n    constants.SET_DRAG_START,\n    constants.SET_DRAG_PROGRESS,\n    constants.SET_DRAG_END,\n  ];\n  let meta = mapValues(omit(action, actionKeysToOmit), applyToJS);\n  let affectedField = action.path && getField(state.tree, action.path) || action.field;\n  if (affectedField)\n    meta.affectedField = affectedField;\n  if (actionTypesToIgnore.includes(action.type) || action.type.indexOf(\"@@redux\") == 0)\n    meta = null;\n  return meta;\n};\n\n/**\n * @param {Immutable.Map} state\n * @param {object} action\n */\nexport default (config, tree, getMemoizedTree) => {\n  const emptyTree = defaultRoot(config);\n  const initTree = tree || emptyTree;\n  const emptyState = {\n    tree: initTree, \n    ...emptyDrag\n  };\n    \n  return (state = emptyState, action) => {\n    const unset = {__isInternalValueChange: undefined, __lastAction: undefined};\n    let set = {};\n    let actionMeta = getActionMeta(action, state);\n\n    switch (action.type) {\n    case constants.SET_TREE: {\n      const validatedTree = getMemoizedTree(action.config, action.tree);\n      set.tree = validatedTree;\n      break;\n    }\n\n    case constants.ADD_CASE_GROUP: {\n      set.tree = addNewGroup(state.tree, action.path, \"case_group\", action.id, action.properties, action.config,  action.children, action.meta);\n      break;\n    }\n\n    case constants.ADD_GROUP: {\n      set.tree = addNewGroup(state.tree, action.path, \"group\", action.id, action.properties, action.config,  action.children, action.meta);\n      break;\n    }\n\n    case constants.REMOVE_GROUP: {\n      set.tree = removeGroup(state.tree, action.path, action.config);\n      break;\n    }\n\n    case constants.ADD_RULE: {\n      set.tree = addItem(state.tree, action.path, action.ruleType, action.id, action.properties, action.config, action.children);\n      break;\n    }\n\n    case constants.REMOVE_RULE: {\n      set.tree = removeRule(state.tree, action.path, action.config);\n      break;\n    }\n\n    case constants.SET_CONJUNCTION: {\n      set.tree = setConjunction(state.tree, action.path, action.conjunction);\n      break;\n    }\n\n    case constants.SET_NOT: {\n      set.tree = setNot(state.tree, action.path, action.not);\n      break;\n    }\n\n    case constants.SET_FIELD: {\n      set.tree = setField(state.tree, action.path, action.field, action.config);\n      break;\n    }\n\n    case constants.SET_LOCK: {\n      set.tree = setLock(state.tree, action.path, action.lock);\n      break;\n    }\n\n    case constants.SET_OPERATOR: {\n      set.tree = setOperator(state.tree, action.path, action.operator, action.config);\n      break;\n    }\n\n    case constants.SET_VALUE: {\n      const {tree, isInternalValueChange} = setValue(\n        state.tree, action.path, action.delta, action.value, action.valueType, action.config, action.asyncListValues, action.__isInternal\n      );\n      set.__isInternalValueChange = isInternalValueChange;\n      set.tree = tree;\n      break;\n    }\n\n    case constants.SET_VALUE_SRC: {\n      set.tree = setValueSrc(state.tree, action.path, action.delta, action.srcKey, action.config);\n      break;\n    }\n\n    case constants.SET_OPERATOR_OPTION: {\n      set.tree = setOperatorOption(state.tree, action.path, action.name, action.value);\n      break;\n    }\n\n    case constants.MOVE_ITEM: {\n      set.tree = moveItem(state.tree, action.fromPath, action.toPath, action.placement, action.config);\n      break;\n    }\n\n    case constants.SET_DRAG_START: {\n      set.dragStart = action.dragStart;\n      set.dragging = action.dragging;\n      set.mousePos = action.mousePos;\n      break;\n    }\n\n    case constants.SET_DRAG_PROGRESS: {\n      set.mousePos = action.mousePos;\n      set.dragging = action.dragging;\n      break;\n    }\n\n    case constants.SET_DRAG_END: {\n      set.tree = checkEmptyGroups(state.tree, config);\n      set = { ...set, ...emptyDrag };\n      break;\n    }\n\n    default: {\n      break;\n    }\n    }\n\n    if (actionMeta) {\n      set.__lastAction = actionMeta;\n    }\n    \n    return {...state, ...unset, ...set};\n  };\n\n};\n","import React from \"react\";\n\nexport default React.createContext(); ","import uuid from \"../utils/uuid\";\nimport {toImmutableList} from \"../utils/stuff\";\nimport {defaultRuleProperties, defaultGroupProperties} from \"../utils/defaultUtils\";\nimport * as constants from \"../constants\";\nimport Immutable from \"immutable\";\n\n\n\n/**\n * @param {object} config\n * @param {Immutable.Map} tree\n */\nexport const setTree = (config, tree) => ({\n  type: constants.SET_TREE,\n  tree: tree,\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {Immutable.Map} properties\n */\nexport const addRule = (config, path, properties, ruleType = \"rule\", children = null) => ({\n  type: constants.ADD_RULE,\n  ruleType: ruleType,\n  children: children,\n  path: toImmutableList(path),\n  id: uuid(),\n  properties: defaultRuleProperties(config).merge(properties || {}),\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n */\nexport const removeRule = (config, path) => ({\n  type: constants.REMOVE_RULE,\n  path: toImmutableList(path),\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {Immutable.Map} properties\n */\nexport const addDefaultCaseGroup = (config, path, properties, children = null) => ({\n  type: constants.ADD_CASE_GROUP,\n  path: toImmutableList(path),\n  children: children,\n  id: uuid(),\n  properties: defaultGroupProperties(config).merge(properties || {}),\n  config: config,\n  meta: {\n    isDefaultCase: true\n  }\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {Immutable.Map} properties\n */\nexport const addCaseGroup = (config, path, properties, children = null) => ({\n  type: constants.ADD_CASE_GROUP,\n  path: toImmutableList(path),\n  children: children,\n  id: uuid(),\n  properties: defaultGroupProperties(config).merge(properties || {}),\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {Immutable.Map} properties\n */\nexport const addGroup = (config, path, properties, children = null) => ({\n  type: constants.ADD_GROUP,\n  path: toImmutableList(path),\n  children: children,\n  id: uuid(),\n  properties: defaultGroupProperties(config).merge(properties || {}),\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n */\nexport const removeGroup = (config, path) => ({\n  type: constants.REMOVE_GROUP,\n  path: toImmutableList(path),\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Array} fromPath\n * @param {Array} toPath\n * @param {String} placement, see constants PLACEMENT_*\n */\nexport const moveItem = (config, fromPath, toPath, placement) => ({\n  type: constants.MOVE_ITEM,\n  fromPath: toImmutableList(fromPath),\n  toPath: toImmutableList(toPath),\n  placement: placement,\n  config: config,\n});\n","import * as constants from \"../constants\";\nimport {toImmutableList} from \"../utils/stuff\";\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {string} conjunction\n */\nexport const setConjunction = (config, path, conjunction) => ({\n  type: constants.SET_CONJUNCTION,\n  path: toImmutableList(path),\n  conjunction: conjunction\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {bool} not\n */\nexport const setNot = (config, path, not) => ({\n  type: constants.SET_NOT,\n  path: toImmutableList(path),\n  not: not\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {bool} lock\n */\nexport const setLock = (config, path, lock) => ({\n  type: constants.SET_LOCK,\n  path: toImmutableList(path),\n  lock: lock\n});","import * as constants from \"../constants\";\nimport {toImmutableList} from \"../utils/stuff\";\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {string} field\n */\nexport const setField = (config, path, field) => ({\n  type: constants.SET_FIELD,\n  path: toImmutableList(path),\n  field: field,\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {string} operator\n */\nexport const setOperator = (config, path, operator) => ({\n  type: constants.SET_OPERATOR,\n  path: toImmutableList(path),\n  operator: operator,\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {integer} delta\n * @param {*} value\n * @param {string} valueType\n * @param {*} asyncListValues\n * @param {boolean} __isInternal\n */\nexport const setValue = (config, path, delta, value, valueType, asyncListValues, __isInternal) => ({\n  type: constants.SET_VALUE,\n  path: toImmutableList(path),\n  delta: delta,\n  value: value,\n  valueType: valueType,\n  asyncListValues: asyncListValues,\n  config: config,\n  __isInternal: __isInternal\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {integer} delta\n * @param {*} srcKey\n */\nexport const setValueSrc = (config, path, delta, srcKey) => ({\n  type: constants.SET_VALUE_SRC,\n  path: toImmutableList(path),\n  delta: delta,\n  srcKey: srcKey,\n  config: config\n});\n\n/**\n * @param {object} config\n * @param {Immutable.List} path\n * @param {string} name\n * @param {*} value\n */\nexport const setOperatorOption = (config, path, name, value) => ({\n  type: constants.SET_OPERATOR_OPTION,\n  path: toImmutableList(path),\n  name: name,\n  value: value,\n  config: config\n});\n","import * as constants from \"../constants\";\n\n\n/**\n * @param {Object} mousePos\n * @param {Object} dragging\n */\nexport const setDragProgress = (mousePos, dragging) => ({\n  type: constants.SET_DRAG_PROGRESS,\n  mousePos: mousePos,\n  dragging: dragging,\n});\n\n/**\n * @param {Object} dragStart\n * @param {Object} dragging\n * @param {Object} mousePos\n */\nexport const setDragStart = (dragStart, dragging, mousePos) => ({\n  type: constants.SET_DRAG_START,\n  dragStart: dragStart,\n  dragging: dragging,\n  mousePos: mousePos,\n});\n\n/**\n *\n */\nexport const setDragEnd = () => ({\n  type: constants.SET_DRAG_END,\n});\n","import React, { Component } from \"react\";\nimport {connect} from \"react-redux\";\nimport context from \"../stores/context\";\nimport PropTypes from \"prop-types\";\nimport * as actions from \"../actions\";\nimport {immutableEqual} from \"../utils/stuff\";\nimport {useOnPropsChanged, liteShouldComponentUpdate, bindActionCreators} from \"../utils/reactUtils\";\n\n\nclass Query extends Component {\n  static propTypes = {\n    config: PropTypes.object.isRequired,\n    onChange: PropTypes.func,\n    renderBuilder: PropTypes.func,\n    tree: PropTypes.any, //instanceOf(Immutable.Map)\n    //dispatch: PropTypes.func.isRequired,\n    //__isInternalValueChange\n    //__lastAction\n    //getMemoizedTree: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n\n    this._updateActions(props);\n\n    // For preventive validation (tree and config consistency)\n    // When config has chnaged from QueryContainer, \n    //  but new dispatched validated tree value is not in redux store yet (tree prop is old)\n    this.validatedTree = props.getMemoizedTree(props.config, props.tree);\n    this.oldValidatedTree = this.validatedTree;\n\n    //props.onChange && props.onChange(this.validatedTree, props.config);\n  }\n\n  _updateActions (props) {\n    const {config, dispatch} = props;\n    this.actions = bindActionCreators({...actions.tree, ...actions.group, ...actions.rule}, config, dispatch);\n  }\n\n  shouldComponentUpdate = liteShouldComponentUpdate(this, {\n    tree: (nextValue) => {\n      if (nextValue === this.oldValidatedTree && this.oldValidatedTree === this.validatedTree) {\n        // Got value dispatched from QueryContainer\n        // Ignore, because we've just rendered it\n        return false;\n      }\n      return true;\n    }\n  });\n\n  onPropsChanged(nextProps) {\n    const {onChange} = nextProps;\n    const oldConfig = this.props.config;\n    const newTree = nextProps.tree;\n    const oldTree = this.props.tree;\n    const newConfig = nextProps.config;\n\n    this.oldValidatedTree = this.validatedTree;\n    this.validatedTree = newTree;\n    if (oldConfig !== newConfig) {\n      this._updateActions(nextProps);\n      this.validatedTree = nextProps.getMemoizedTree(newConfig, newTree, oldConfig);\n    }\n\n    const validatedTreeChanged = !immutableEqual(this.validatedTree, this.oldValidatedTree);\n    if (validatedTreeChanged) {\n      onChange && onChange(this.validatedTree, newConfig, nextProps.__lastAction);\n    }\n  }\n\n  render() {\n    const {config, renderBuilder, dispatch, __isInternalValueChange} = this.props;\n    const builderProps = {\n      tree: this.validatedTree,\n      actions: this.actions,\n      config: config,\n      dispatch: dispatch,\n      __isInternalValueChange\n    };\n\n    return renderBuilder(builderProps);\n  }\n}\n\n\nconst ConnectedQuery = connect(\n  (state) => {\n    return {\n      tree: state.tree,\n      __isInternalValueChange: state.__isInternalValueChange,\n      __lastAction: state.__lastAction,\n    };\n  },\n  null,\n  null,\n  {\n    context\n  }\n)(Query);\nConnectedQuery.displayName = \"ConnectedQuery\";\n\n\nexport default ConnectedQuery;\n","import React, { Component, PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport treeStoreReducer from \"../stores/tree\";\nimport context from \"../stores/context\";\nimport {createStore} from \"redux\";\nimport {Provider} from \"react-redux\";\nimport * as actions from \"../actions\";\nimport {createConfigMemo} from \"../utils/configUtils\";\nimport {immutableEqual} from \"../utils/stuff\";\nimport {defaultRoot} from \"../utils/defaultUtils\";\nimport {createValidationMemo} from \"../utils/validation\";\nimport {liteShouldComponentUpdate, useOnPropsChanged} from \"../utils/reactUtils\";\nimport ConnectedQuery from \"./Query\";\n\n\nexport default class QueryContainer extends Component {\n  static propTypes = {\n    //config\n    conjunctions: PropTypes.object.isRequired,\n    fields: PropTypes.object.isRequired,\n    types: PropTypes.object.isRequired,\n    operators: PropTypes.object.isRequired,\n    widgets: PropTypes.object.isRequired,\n    settings: PropTypes.object.isRequired,\n\n    onChange: PropTypes.func,\n    renderBuilder: PropTypes.func,\n    value: PropTypes.any, //instanceOf(Immutable.Map)\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    useOnPropsChanged(this);\n\n    this.getMemoizedConfig = createConfigMemo();\n    this.getMemoizedTree = createValidationMemo();\n    \n    const config = this.getMemoizedConfig(props);\n    const tree = props.value;\n    const validatedTree = this.getMemoizedTree(config, tree);\n\n    const reducer = treeStoreReducer(config, validatedTree, this.getMemoizedTree);\n    const store = createStore(reducer);\n\n    this.state = {\n      store,\n      config\n    };\n  }\n\n  shouldComponentUpdate = liteShouldComponentUpdate(this, {\n    value: (nextValue, prevValue, state) => { return false; }\n  });\n\n  onPropsChanged(nextProps) {\n    // compare configs\n    const oldConfig = this.state.config;\n    const nextConfig = this.getMemoizedConfig(nextProps);\n    const isConfigChanged = oldConfig !== nextConfig;\n\n    // compare trees\n    const storeValue = this.state.store.getState().tree;\n    const isTreeChanged = !immutableEqual(nextProps.value, this.props.value) && !immutableEqual(nextProps.value, storeValue);\n    const currentTree = isTreeChanged ? nextProps.value || defaultRoot(nextProps) : storeValue;\n\n    if (isConfigChanged) {\n      this.setState({config: nextConfig});\n    }\n    \n    if (isTreeChanged || isConfigChanged) {\n      const validatedTree = this.getMemoizedTree(nextConfig, currentTree, oldConfig);\n      return Promise.resolve().then(() => {\n        this.state.store.dispatch(\n          actions.tree.setTree(nextConfig, validatedTree)\n        );\n      });\n    }\n  }\n\n  render() {\n    // `get_children` is deprecated!\n    const {renderBuilder, get_children, onChange, settings} = this.props;\n    const {config, store} = this.state;\n    const {renderProvider: QueryWrapper} = settings;\n\n    return (\n      <QueryWrapper config={config}>\n        <Provider store={store} context={context}>\n          <ConnectedQuery\n            config={config}\n            getMemoizedTree={this.getMemoizedTree}\n            onChange={onChange}\n            renderBuilder={renderBuilder || get_children}\n          />\n        </Provider>\n      </QueryWrapper>\n    );\n  }\n}\n","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport context from \"../../stores/context\";\nimport {getFieldConfig} from \"../../utils/configUtils\";\nimport {pureShouldComponentUpdate} from \"../../utils/reactUtils\";\nimport {connect} from \"react-redux\";\nconst classNames = require(\"classnames\");\n\n\nconst createRuleContainer = (Rule) => \n  class RuleContainer extends Component {\n    static propTypes = {\n      id: PropTypes.string.isRequired,\n      groupId: PropTypes.string,\n      config: PropTypes.object.isRequired,\n      path: PropTypes.any.isRequired, //instanceOf(Immutable.List)\n      operator: PropTypes.string,\n      field: PropTypes.string,\n      actions: PropTypes.object.isRequired, //{removeRule: Funciton, setField, setOperator, setOperatorOption, setValue, setValueSrc, ...}\n      onDragStart: PropTypes.func,\n      value: PropTypes.any, //depends on widget\n      valueSrc: PropTypes.any,\n      asyncListValues: PropTypes.array,\n      valueError: PropTypes.any,\n      operatorOptions: PropTypes.object,\n      reordableNodesCnt: PropTypes.number,\n      parentField: PropTypes.string, //from RuleGroup\n      isLocked: PropTypes.bool,\n      isTrueLocked: PropTypes.bool,\n      //connected:\n      dragging: PropTypes.object, //{id, x, y, w, h}\n      isDraggingTempo: PropTypes.bool,\n    };\n\n    constructor(props) {\n      super(props);\n      \n      this.dummyFn.isDummyFn = true;\n    }\n\n    dummyFn = () => {};\n\n    removeSelf = () => {\n      this.props.actions.removeRule(this.props.path);\n    };\n\n    setLock = (lock = null) => {\n      this.props.actions.setLock(this.props.path, lock);\n    };\n\n    setField = (field) => {\n      this.props.actions.setField(this.props.path, field);\n    };\n\n    setOperator = (operator) => {\n      this.props.actions.setOperator(this.props.path, operator);\n    };\n\n    setOperatorOption = (name, value) => {\n      this.props.actions.setOperatorOption(this.props.path, name, value);\n    };\n\n    setValue = (delta, value, type, asyncListValues, __isInternal) => {\n      this.props.actions.setValue(this.props.path, delta, value, type, asyncListValues, __isInternal);\n    };\n\n    setValueSrc = (delta, srcKey) => {\n      this.props.actions.setValueSrc(this.props.path, delta, srcKey);\n    };\n\n    shouldComponentUpdate(nextProps, nextState) {\n      let prevProps = this.props;\n      let prevState = this.state;\n\n      let should = pureShouldComponentUpdate(this)(nextProps, nextState);\n      if (should) {\n        if (prevState == nextState && prevProps != nextProps) {\n          const draggingId = (nextProps.dragging.id || prevProps.dragging.id);\n          const isDraggingMe = draggingId == nextProps.id;\n          let chs = [];\n          for (let k in nextProps) {\n            let changed = (nextProps[k] != prevProps[k]);\n            if (k == \"dragging\" && !isDraggingMe) {\n              changed = false; //dragging another item -> ignore\n            }\n            if (changed) {\n              chs.push(k);\n            }\n          }\n          if (!chs.length)\n            should = false;\n        }\n      }\n      return should;\n    }\n\n    render() {\n      const isDraggingMe = this.props.dragging.id == this.props.id;\n      const fieldConfig = getFieldConfig(this.props.config, this.props.field);\n      const {showErrorMessage} = this.props.config.settings;\n      const _isGroup = fieldConfig && fieldConfig.type == \"!struct\";\n      const isInDraggingTempo = !isDraggingMe && this.props.isDraggingTempo;\n\n      const valueError = this.props.valueError;\n      const oneValueError = valueError && valueError.toArray().filter(e => !!e).shift() || null;\n      const hasError = oneValueError != null && showErrorMessage;\n\n      return (\n        <div\n          className={classNames(\"group-or-rule-container\", \"rule-container\", hasError ? \"rule-with-error\" : null)}\n          data-id={this.props.id}\n        >\n          {[\n            isDraggingMe ? <Rule\n              key={\"dragging\"}\n              id={this.props.id}\n              groupId={this.props.groupId}\n              isDraggingMe={true}\n              isDraggingTempo={true}\n              dragging={this.props.dragging}\n              setField={this.dummyFn}\n              setOperator={this.dummyFn}\n              setOperatorOption={this.dummyFn}\n              setLock={this.dummyFn}\n              removeSelf={this.dummyFn}\n              setValue={this.dummyFn}\n              setValueSrc={this.dummyFn}\n              selectedField={this.props.field || null}\n              parentField={this.props.parentField || null}\n              selectedOperator={this.props.operator || null}\n              value={this.props.value || null}\n              valueSrc={this.props.valueSrc || null}\n              valueError={this.props.valueError || null}\n              operatorOptions={this.props.operatorOptions}\n              config={this.props.config}\n              reordableNodesCnt={this.props.reordableNodesCnt}\n              totalRulesCnt={this.props.totalRulesCnt}\n              asyncListValues={this.props.asyncListValues}\n              isLocked={this.props.isLocked}\n              isTrueLocked={this.props.isTrueLocked}\n              parentReordableNodesCnt={this.props.parentReordableNodesCnt}\n            /> : null\n            ,\n            <Rule\n              key={this.props.id}\n              id={this.props.id}\n              groupId={this.props.groupId}\n              isDraggingMe={isDraggingMe}\n              isDraggingTempo={isInDraggingTempo}\n              onDragStart={this.props.onDragStart}\n              setLock={isInDraggingTempo ? this.dummyFn : this.setLock}\n              removeSelf={isInDraggingTempo ? this.dummyFn : this.removeSelf}\n              setField={isInDraggingTempo ? this.dummyFn : this.setField}\n              setOperator={isInDraggingTempo ? this.dummyFn : this.setOperator}\n              setOperatorOption={isInDraggingTempo ? this.dummyFn : this.setOperatorOption}\n              setValue={isInDraggingTempo ? this.dummyFn : this.setValue}\n              setValueSrc={isInDraggingTempo ? this.dummyFn : this.setValueSrc}\n              selectedField={this.props.field || null}\n              parentField={this.props.parentField || null}\n              selectedOperator={this.props.operator || null}\n              value={this.props.value || null}\n              valueSrc={this.props.valueSrc || null}\n              valueError={this.props.valueError || null}\n              operatorOptions={this.props.operatorOptions}\n              config={this.props.config}\n              reordableNodesCnt={this.props.reordableNodesCnt}\n              totalRulesCnt={this.props.totalRulesCnt}\n              asyncListValues={this.props.asyncListValues}\n              isLocked={this.props.isLocked}\n              isTrueLocked={this.props.isTrueLocked}\n              parentReordableNodesCnt={this.props.parentReordableNodesCnt}\n            />\n          ]}\n        </div>\n      );\n    }\n\n  };\n\n\nexport default (Rule) => {\n  const ConnectedRuleContainer = connect(\n    (state) => {\n      return {\n        dragging: state.dragging,\n      };\n    },\n    null,\n    null,\n    {\n      context\n    }\n  )(createRuleContainer(Rule));\n  ConnectedRuleContainer.displayName = \"ConnectedRuleContainer\";\n\n  return ConnectedRuleContainer;\n};\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nconst classNames = require(\"classnames\");\n\n\nexport default (className) => (GroupOrRule) =>\n  class Draggable extends PureComponent {\n    static propTypes = {\n      isDraggingTempo: PropTypes.bool,\n      isDraggingMe: PropTypes.bool,\n      onDragStart: PropTypes.func,\n      dragging: PropTypes.object, //{id, x, y, w, h}\n      isLocked: PropTypes.bool,\n      isTrueLocked: PropTypes.bool,\n    };\n\n    constructor(props) {\n      super(props);\n      this.wrapper = React.createRef();\n    }\n\n    handleDraggerMouseDown = (e) => {\n      var nodeId = this.props.id;\n      var dom = this.wrapper.current;\n        \n      if (this.props.onDragStart) {\n        this.props.onDragStart(nodeId, dom, e);\n      }\n    };\n\n    render () {\n      const {\n        isDraggingTempo,\n        isDraggingMe,\n        dragging,\n        ...otherProps\n      } = this.props;\n      const {\n        isTrueLocked,\n      } = otherProps;\n\n      let styles = {};\n      if (isDraggingMe && isDraggingTempo) {\n        styles = {\n          top: dragging.y,\n          left: dragging.x,\n          width: dragging.w\n        };\n      }\n\n      const cn = classNames(className, \"group-or-rule\",\n        isDraggingMe && isDraggingTempo ? \"qb-draggable\" : null,\n        isDraggingMe && !isDraggingTempo ? \"qb-placeholder\" : null,\n        isTrueLocked ? \"locked\" : null\n      );\n\n      return (\n        <div\n          className={cn}\n          style={styles}\n          ref={this.wrapper}\n          data-id={this.props.id}\n        >\n          <GroupOrRule\n            handleDraggerMouseDown={this.handleDraggerMouseDown}\n            isDraggingMe={isDraggingMe}\n            isDraggingTempo={isDraggingTempo}\n            {...otherProps}\n          />\n        </div>\n      );\n    }\n\n  };\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport {getFieldConfig, getOperatorConfig} from \"../../utils/configUtils\";\nimport keys from \"lodash/keys\";\nimport pickBy from \"lodash/pickBy\";\nimport mapValues from \"lodash/mapValues\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\n\n\nexport default class Operator extends PureComponent {\n  static propTypes = {\n    id: PropTypes.string,\n    groupId: PropTypes.string,\n    config: PropTypes.object.isRequired,\n    selectedField: PropTypes.string,\n    selectedOperator: PropTypes.string,\n    readonly: PropTypes.bool,\n    //actions\n    setOperator: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n    const prevProps = this.props;\n    const keysForMeta = [\"config\", \"selectedField\", \"selectedOperator\"];\n    const needUpdateMeta = !this.meta || keysForMeta.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n\n    if (needUpdateMeta) {\n      this.meta = this.getMeta(nextProps);\n    }\n  }\n\n  getMeta({config, selectedField, selectedOperator}) {\n    const fieldConfig = getFieldConfig(config, selectedField);\n    const operators = fieldConfig?.operators;\n    const operatorOptions \n      = mapValues(\n        pickBy(\n          config.operators, \n          (item, key) => operators?.indexOf(key) !== -1\n        ), \n        (_opts, op) => getOperatorConfig(config, op, selectedField)\n      );\n      \n    const items = this.buildOptions(config, operatorOptions, operators);\n\n    const isOpSelected = !!selectedOperator;\n    const currOp = isOpSelected ? operatorOptions[selectedOperator] : null;\n    const selectedOpts = currOp || {};\n    const placeholder = this.props.config.settings.operatorPlaceholder;\n    const selectedKey = selectedOperator;\n    const selectedKeys = isOpSelected ? [selectedKey] : null;\n    const selectedPath = selectedKeys;\n    const selectedLabel = selectedOpts.label;\n    \n    return {\n      placeholder, items,\n      selectedKey, selectedKeys, selectedPath, selectedLabel, selectedOpts, fieldConfig\n    };\n  }\n\n  buildOptions(config, fields, ops) {\n    if (!fields || !ops)\n      return null;\n\n    return keys(fields).sort((a, b) => (ops.indexOf(a) - ops.indexOf(b))).map(fieldKey => {\n      const field = fields[fieldKey];\n      const label = field.label;\n      return {\n        key: fieldKey,\n        path: fieldKey,\n        label,\n      };\n    });\n  }\n\n  render() {\n    const {config, customProps, setOperator, readonly, id, groupId} = this.props;\n    const {renderOperator} = config.settings;\n    const renderProps = {\n      id,\n      groupId,\n      config, \n      customProps, \n      readonly,\n      setField: setOperator,\n      ...this.meta\n    };\n    if (!renderProps.items)\n      return null;\n    return renderOperator(renderProps);\n  }\n\n\n}\n","import React, { PureComponent } from \"react\";\nimport Operator from \"./Operator\";\nimport {Col} from \"../utils\";\n\n\nexport default class OperatorWrapper extends PureComponent {\n  render() {\n    const {\n      config, selectedField, selectedOperator, setOperator, \n      selectedFieldPartsLabels, showOperator, showOperatorLabel, selectedFieldWidgetConfig, readonly, id, groupId\n    } = this.props;\n    const operator = showOperator\n            && <Col key={\"operators-for-\"+(selectedFieldPartsLabels || []).join(\"_\")} className=\"rule--operator\">\n              { config.settings.showLabels\n                    && <label className=\"rule--label\">{config.settings.operatorLabel}</label>\n              }\n              <Operator\n                key=\"operator\"\n                config={config}\n                selectedField={selectedField}\n                selectedOperator={selectedOperator}\n                setOperator={setOperator}\n                readonly={readonly}\n                id={id}\n                groupId={groupId}\n              />\n            </Col>;\n    const hiddenOperator = showOperatorLabel\n            && <Col key={\"operators-for-\"+(selectedFieldPartsLabels || []).join(\"_\")} className=\"rule--operator\">\n              <div className=\"rule--operator\">\n                {config.settings.showLabels\n                  ? <label className=\"rule--label\">&nbsp;</label>\n                  : null}\n                <span>{selectedFieldWidgetConfig.operatorInlineLabel}</span>\n              </div>\n            </Col>;\n    return [\n      operator,\n      hiddenOperator\n    ];\n  }\n}\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport {getFieldConfig} from \"../../utils/configUtils\";\nimport {getFieldPath, getFieldPathLabels} from \"../../utils/ruleUtils\";\nimport {truncateString} from \"../../utils/stuff\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport last from \"lodash/last\";\nimport keys from \"lodash/keys\";\n\n\nexport default class Field extends PureComponent {\n  static propTypes = {\n    id: PropTypes.string,\n    groupId: PropTypes.string,\n    config: PropTypes.object.isRequired,\n    selectedField: PropTypes.string,\n    parentField: PropTypes.string,\n    customProps: PropTypes.object,\n    readonly: PropTypes.bool,\n    //actions\n    setField: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n    const prevProps = this.props;\n    const keysForMeta = [\"selectedField\", \"config\", \"parentField\"];\n    const needUpdateMeta = !this.meta || keysForMeta.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n\n    if (needUpdateMeta) {\n      this.meta = this.getMeta(nextProps);\n    }\n  }\n\n  getMeta({selectedField, config, parentField}) {\n    const selectedKey = selectedField;\n    const {maxLabelsLength, fieldSeparatorDisplay, fieldPlaceholder, fieldSeparator} = config.settings;\n    const isFieldSelected = !!selectedField;\n    const placeholder = !isFieldSelected ? truncateString(fieldPlaceholder, maxLabelsLength) : null;\n    const currField = isFieldSelected ? getFieldConfig(config, selectedKey) : null;\n    const selectedOpts = currField || {};\n\n    const selectedKeys = getFieldPath(selectedKey, config);\n    const selectedPath = getFieldPath(selectedKey, config, true);\n    const selectedLabel = this.getFieldLabel(currField, selectedKey, config);\n    const partsLabels = getFieldPathLabels(selectedKey, config);\n    let selectedFullLabel = partsLabels ? partsLabels.join(fieldSeparatorDisplay) : null;\n    if (selectedFullLabel == selectedLabel || parentField)\n      selectedFullLabel = null;\n    const selectedAltLabel = selectedOpts.label2;\n\n    const parentFieldPath = typeof parentField == \"string\" ? parentField.split(fieldSeparator) : parentField;\n    const parentFieldConfig = parentField ? getFieldConfig(config, parentField) : null;\n    const sourceFields = parentField ? parentFieldConfig && parentFieldConfig.subfields : config.fields;\n    const items = this.buildOptions(parentFieldPath, config, sourceFields, parentFieldPath);\n\n    return {\n      placeholder, items, parentField,\n      selectedKey, selectedKeys, selectedPath, selectedLabel, selectedOpts, selectedAltLabel, selectedFullLabel,\n    };\n  }\n\n  getFieldLabel(fieldOpts, fieldKey, config) {\n    if (!fieldKey) return null;\n    let fieldSeparator = config.settings.fieldSeparator;\n    let maxLabelsLength = config.settings.maxLabelsLength;\n    let fieldParts = Array.isArray(fieldKey) ? fieldKey : fieldKey.split(fieldSeparator);\n    let label = fieldOpts && fieldOpts.label || last(fieldParts);\n    label = truncateString(label, maxLabelsLength);\n    return label;\n  }\n\n  buildOptions(parentFieldPath, config, fields, path = null, optGroupLabel = null) {\n    if (!fields)\n      return null;\n    const {fieldSeparator, fieldSeparatorDisplay} = config.settings;\n    const prefix = path ? path.join(fieldSeparator) + fieldSeparator : \"\";\n\n    return keys(fields).map(fieldKey => {\n      const field = fields[fieldKey];\n      const label = this.getFieldLabel(field, fieldKey, config);\n      const partsLabels = getFieldPathLabels(prefix+fieldKey, config);\n      let fullLabel = partsLabels.join(fieldSeparatorDisplay);\n      if (fullLabel == label || parentFieldPath)\n        fullLabel = null;\n      const altLabel = field.label2;\n      const tooltip = field.tooltip;\n      const subpath = (path ? path : []).concat(fieldKey);\n      const disabled = field.disabled;\n            \n      if (field.hideForSelect)\n        return undefined;\n\n      if (field.type == \"!struct\") {\n        return {\n          disabled,\n          key: fieldKey,\n          path: prefix+fieldKey,\n          label,\n          fullLabel,\n          altLabel,\n          tooltip,\n          items: this.buildOptions(parentFieldPath, config, field.subfields, subpath, label)\n        };\n      } else {\n        return {\n          disabled,\n          key: fieldKey,\n          path: prefix+fieldKey,\n          label,\n          fullLabel,\n          altLabel,\n          tooltip,\n          grouplabel: optGroupLabel\n        };\n      }\n    }).filter(o => !!o);\n  }\n\n  render() {\n    const {config, customProps, setField, readonly, id, groupId} = this.props;\n    const {renderField} = config.settings;\n    const renderProps = {\n      id,\n      groupId,\n      config, \n      customProps, \n      readonly,\n      setField,\n      ...this.meta\n    };\n    return renderField(renderProps);\n  }\n\n}\n","import React, { PureComponent } from \"react\";\nimport Field from \"./Field\";\nimport {Col} from \"../utils\";\n\n\nexport default class FieldWrapper extends PureComponent {\n  render() {\n    const {config, selectedField, setField, parentField, classname, readonly, id, groupId} = this.props;\n    return (\n      <Col className={classname}>\n        { config.settings.showLabels\n                    && <label className=\"rule--label\">{config.settings.fieldLabel}</label>\n        }\n        <Field\n          config={config}\n          selectedField={selectedField}\n          parentField={parentField}\n          setField={setField}\n          customProps={config.settings.customFieldSelectProps}\n          readonly={readonly}\n          id={id}\n          groupId={groupId}\n        />\n      </Col>\n    );\n  }\n}\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport {getOperatorConfig} from \"../../utils/configUtils\";\n\nexport default class OperatorOptions extends PureComponent {\n  static propTypes = {\n    config: PropTypes.object.isRequired,\n    operatorOptions: PropTypes.any.isRequired, //instanceOf(Immutable.Map)\n    selectedField: PropTypes.string.isRequired,\n    selectedOperator: PropTypes.string.isRequired,\n    readonly: PropTypes.bool,\n    //actions\n    setOperatorOption: PropTypes.func.isRequired,\n  };\n\n  render() {\n    if (!this.props.selectedOperator)\n      return null;\n    const operatorDefinitions = getOperatorConfig(this.props.config, this.props.selectedOperator, this.props.selectedField);\n    if (typeof operatorDefinitions.options === \"undefined\") {\n      return null;\n    }\n\n    const { factory: optionsFactory, ...basicOptionsProps } = operatorDefinitions.options;\n    const optionsProps = Object.assign({}, basicOptionsProps, {\n      config: this.props.config,\n      field: this.props.selectedField,\n      operator: this.props.selectedOperator,\n      options: this.props.operatorOptions,\n      setOption: this.props.setOperatorOption,\n      readonly: this.props.readonly,\n    });\n    const optionsCmp = optionsFactory(optionsProps);\n    const name = this.props.selectedOperator;\n\n    return (\n      <div className={`rule--operator rule--operator--${name.toUpperCase()}`}>\n        {optionsCmp}\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport RuleContainer from \"../containers/RuleContainer\";\nimport Draggable from \"../containers/Draggable\";\nimport OperatorWrapper from \"../rule/OperatorWrapper\";\nimport FieldWrapper from \"../rule/FieldWrapper\";\nimport Widget from \"../rule/Widget\";\nimport OperatorOptions from \"../rule/OperatorOptions\";\nimport {getFieldConfig, getOperatorConfig, getFieldWidgetConfig} from \"../../utils/configUtils\";\nimport {getFieldPathLabels, getValueSourcesForFieldOp} from \"../../utils/ruleUtils\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport {Col, DragIcon, dummyFn, ConfirmFn} from \"../utils\";\nconst classNames = require(\"classnames\");\n\n\n@RuleContainer\n@Draggable(\"rule\")\n@ConfirmFn\nclass Rule extends PureComponent {\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    groupId: PropTypes.string,\n    selectedField: PropTypes.string,\n    selectedOperator: PropTypes.string,\n    operatorOptions: PropTypes.object,\n    config: PropTypes.object.isRequired,\n    value: PropTypes.any, //depends on widget\n    valueSrc: PropTypes.any,\n    asyncListValues: PropTypes.array,\n    isDraggingMe: PropTypes.bool,\n    isDraggingTempo: PropTypes.bool,\n    parentField: PropTypes.string, //from RuleGroup\n    valueError: PropTypes.any,\n    isLocked: PropTypes.bool,\n    isTrueLocked: PropTypes.bool,\n    //path: PropTypes.instanceOf(Immutable.List),\n    //actions\n    handleDraggerMouseDown: PropTypes.func,\n    setField: PropTypes.func,\n    setOperator: PropTypes.func,\n    setOperatorOption: PropTypes.func,\n    setLock: PropTypes.func,\n    removeSelf: PropTypes.func,\n    setValue: PropTypes.func,\n    setValueSrc: PropTypes.func,\n    reordableNodesCnt: PropTypes.number,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n    this.removeSelf = this.removeSelf.bind(this);\n    this.setLock = this.setLock.bind(this);\n\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n    const prevProps = this.props;\n    const keysForMeta = [\"selectedField\", \"selectedOperator\", \"config\", \"reordableNodesCnt\", \"isLocked\"];\n    const needUpdateMeta = !this.meta || keysForMeta.map(k => (nextProps[k] !== prevProps[k])).filter(ch => ch).length > 0;\n\n    if (needUpdateMeta) {\n      this.meta = this.getMeta(nextProps);\n    }\n  }\n\n  getMeta({selectedField, selectedOperator, config, reordableNodesCnt, isLocked}) {\n    const selectedFieldPartsLabels = getFieldPathLabels(selectedField, config);\n    const selectedFieldConfig = getFieldConfig(config, selectedField);\n    const isSelectedGroup = selectedFieldConfig && selectedFieldConfig.type == \"!struct\";\n    const isFieldAndOpSelected = selectedField && selectedOperator && !isSelectedGroup;\n    const selectedOperatorConfig = getOperatorConfig(config, selectedOperator, selectedField);\n    const selectedOperatorHasOptions = selectedOperatorConfig && selectedOperatorConfig.options != null;\n    const selectedFieldWidgetConfig = getFieldWidgetConfig(config, selectedField, selectedOperator) || {};\n    const hideOperator = selectedFieldWidgetConfig.hideOperator;\n\n    const showDragIcon = config.settings.canReorder && reordableNodesCnt > 1 && !isLocked;\n    const showOperator = selectedField && !hideOperator;\n    const showOperatorLabel = selectedField && hideOperator && selectedFieldWidgetConfig.operatorInlineLabel;\n    const showWidget = isFieldAndOpSelected;\n    const showOperatorOptions = isFieldAndOpSelected && selectedOperatorHasOptions;\n\n    return {\n      selectedFieldPartsLabels, selectedFieldWidgetConfig,\n      showDragIcon, showOperator, showOperatorLabel, showWidget, showOperatorOptions\n    };\n  }\n\n  setLock(lock) {\n    this.props.setLock(lock);\n  }\n\n  removeSelf() {\n    const {confirmFn} = this.props;\n    const {renderConfirm, removeRuleConfirmOptions: confirmOptions} = this.props.config.settings;\n    const doRemove = () => {\n      this.props.removeSelf();\n    };\n    if (confirmOptions && !this.isEmptyCurrentRule()) {\n      renderConfirm({...confirmOptions,\n        onOk: doRemove,\n        onCancel: null,\n        confirmFn: confirmFn\n      });\n    } else {\n      doRemove();\n    }\n  }\n\n  isEmptyCurrentRule() {\n    return !(\n      this.props.selectedField !== null\n            && this.props.selectedOperator !== null\n            && this.props.value.filter((val) => val !== undefined).size > 0\n    );\n  }\n\n  renderField() {\n    const {config, isLocked} = this.props;\n    const { immutableFieldsMode } = config.settings;\n\n    return <FieldWrapper\n      key=\"field\"\n      classname={\"rule--field\"}\n      config={config}\n      selectedField={this.props.selectedField}\n      setField={!immutableFieldsMode ? this.props.setField : dummyFn}\n      parentField={this.props.parentField}\n      readonly={immutableFieldsMode || isLocked}\n      id={this.props.id}\n      groupId={this.props.groupId}\n    />;\n  }\n\n  renderOperator () {\n    const {config, isLocked} = this.props;\n    const {\n      selectedFieldPartsLabels, selectedFieldWidgetConfig, showOperator, showOperatorLabel\n    } = this.meta;\n    const { immutableOpsMode } = config.settings;\n\n    return <OperatorWrapper\n      key=\"operator\"\n      config={config}\n      selectedField={this.props.selectedField}\n      selectedOperator={this.props.selectedOperator}\n      setOperator={!immutableOpsMode ? this.props.setOperator : dummyFn}\n      selectedFieldPartsLabels={selectedFieldPartsLabels}\n      showOperator={showOperator}\n      showOperatorLabel={showOperatorLabel}\n      selectedFieldWidgetConfig={selectedFieldWidgetConfig}\n      readonly={immutableOpsMode || isLocked}\n      id={this.props.id}\n      groupId={this.props.groupId}\n    />;\n  }\n\n  renderWidget() {\n    const {config, valueError, isLocked} = this.props;\n    const { showWidget } = this.meta;\n    const { immutableValuesMode } = config.settings;\n    if (!showWidget) return null;\n\n    const widget = <Widget\n      key=\"values\"\n      field={this.props.selectedField}\n      parentField={this.props.parentField}\n      operator={this.props.selectedOperator}\n      value={this.props.value}\n      valueSrc={this.props.valueSrc}\n      asyncListValues={this.props.asyncListValues}\n      valueError={valueError}\n      config={config}\n      setValue={!immutableValuesMode ? this.props.setValue : dummyFn}\n      setValueSrc={!immutableValuesMode ? this.props.setValueSrc : dummyFn}\n      readonly={immutableValuesMode || isLocked}\n      id={this.props.id}\n      groupId={this.props.groupId}\n    />;\n\n    return (\n      <Col key={\"widget-for-\"+this.props.selectedOperator} className=\"rule--value\">\n        {widget}\n      </Col>\n    );\n  }\n\n  renderOperatorOptions() {\n    const {config} = this.props;\n    const { showOperatorOptions } = this.meta;\n    const { immutableOpsMode, immutableValuesMode } = config.settings;\n    if (!showOperatorOptions) return null;\n\n    const opOpts = <OperatorOptions\n      key=\"operatorOptions\"\n      selectedField={this.props.selectedField}\n      selectedOperator={this.props.selectedOperator}\n      operatorOptions={this.props.operatorOptions}\n      setOperatorOption={!immutableOpsMode ? this.props.setOperatorOption : dummyFn}\n      config={config}\n      readonly={immutableValuesMode}\n    />;\n\n    return (\n      <Col key={\"op-options-for-\"+this.props.selectedOperator} className=\"rule--operator-options\">\n        {opOpts}\n      </Col>\n    );\n  }\n\n  renderBeforeWidget() {\n    const {config} = this.props;\n    const { renderBeforeWidget } = config.settings;\n    return renderBeforeWidget \n        && <Col key={\"before-widget-for-\" +this.props.selectedOperator} className=\"rule--before-widget\">\n          {typeof renderBeforeWidget === \"function\" ? renderBeforeWidget(this.props) : renderBeforeWidget}\n        </Col>;\n  }\n\n  renderAfterWidget() {\n    const {config} = this.props;\n    const { renderAfterWidget } = config.settings;\n    return renderAfterWidget \n        && <Col key={\"after-widget-for-\" +this.props.selectedOperator} className=\"rule--after-widget\">\n          {typeof renderAfterWidget === \"function\" ? renderAfterWidget(this.props) : renderAfterWidget}\n        </Col>;\n  }\n\n  renderError() {\n    const {config, valueError} = this.props;\n    const { renderRuleError, showErrorMessage } = config.settings;\n    const oneValueError = valueError && valueError.toArray().filter(e => !!e).shift() || null;\n    return showErrorMessage && oneValueError \n        && <div className=\"rule--error\">\n          {renderRuleError ? renderRuleError({error: oneValueError}) : oneValueError}\n        </div>;\n  }\n\n  renderDrag() {\n    const { showDragIcon } = this.meta;\n\n    return showDragIcon\n        && <span\n          key=\"rule-drag-icon\"\n          className={\"qb-drag-handler rule--drag-handler\"}\n          onMouseDown={this.props.handleDraggerMouseDown}\n        ><DragIcon /> </span>;\n  }\n\n  renderDel() {\n    const {config, isLocked} = this.props;\n    const {\n      deleteLabel, \n      immutableGroupsMode, \n      renderButton: Btn,\n      canDeleteLocked\n    } = config.settings;\n\n    return !immutableGroupsMode && (!isLocked || isLocked && canDeleteLocked) && (\n      <Btn \n        type=\"delRule\" onClick={this.removeSelf} label={deleteLabel} config={config}\n      />\n    );\n  }\n\n  renderLock() {\n    const {config, isLocked, isTrueLocked, id} = this.props;\n    const {\n      lockLabel, lockedLabel, showLock,\n      renderSwitch: Switch\n    } = config.settings;\n      \n    return showLock && !(isLocked && !isTrueLocked) && (\n      <Switch \n        type=\"lock\" id={id} value={isLocked} setValue={this.setLock} label={lockLabel} checkedLabel={lockedLabel} hideLabel={true} config={config}\n      />\n    );\n  }\n\n  render () {\n    const { showOperatorOptions, selectedFieldWidgetConfig } = this.meta;\n    const { valueSrc, value, config } = this.props;\n    const canShrinkValue = valueSrc.first() == \"value\" && !showOperatorOptions && value.size == 1 && selectedFieldWidgetConfig.fullWidth;\n    const { renderButtonGroup: BtnGrp } = config.settings;\n\n    const parts = [\n      this.renderField(),\n      this.renderOperator(),\n      this.renderBeforeWidget(),\n      this.renderWidget(),\n      this.renderAfterWidget(),\n      this.renderOperatorOptions(),\n    ];\n    const body = <div key=\"rule-body\" className={classNames(\"rule--body\", canShrinkValue && \"can--shrink--value\")}>{parts}</div>;\n\n    const error = this.renderError();\n    const drag = this.renderDrag();\n    const lock = this.renderLock();\n    const del = this.renderDel();\n      \n    return (\n      <>\n        {drag}\n        <div className=\"rule--body--wrapper\">\n          {body}{error}\n        </div>\n        <div className=\"rule--header\">\n          <BtnGrp config={config}>\n            {lock}\n            {del}\n          </BtnGrp>\n        </div>\n      </>\n    );\n  }\n\n}\n\n\nexport default Rule;\n","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport mapValues from \"lodash/mapValues\";\nimport context from \"../../stores/context\";\nimport {pureShouldComponentUpdate, useOnPropsChanged} from \"../../utils/reactUtils\";\nimport {connect} from \"react-redux\";\nimport {defaultGroupConjunction} from \"../../utils/defaultUtils\";\n\n\nconst createGroupContainer = (Group) => \n  class GroupContainer extends Component {\n    static propTypes = {\n      //tree: PropTypes.instanceOf(Immutable.Map).isRequired,\n      config: PropTypes.object.isRequired,\n      actions: PropTypes.object.isRequired, //{setConjunction: Funciton, removeGroup, addGroup, addRule, ...}\n      path: PropTypes.any.isRequired, //instanceOf(Immutable.List)\n      id: PropTypes.string.isRequired,\n      groupId: PropTypes.string,\n      not: PropTypes.bool,\n      conjunction: PropTypes.string,\n      children1: PropTypes.any, //instanceOf(Immutable.OrderedMap)\n      onDragStart: PropTypes.func,\n      reordableNodesCnt: PropTypes.number,\n      field: PropTypes.string, // for RuleGroup\n      parentField: PropTypes.string, //from RuleGroup\n      isLocked: PropTypes.bool,\n      isTrueLocked: PropTypes.bool,\n      //connected:\n      dragging: PropTypes.object, //{id, x, y, w, h}\n      isDraggingTempo: PropTypes.bool,\n    };\n\n    constructor(props) {\n      super(props);\n      useOnPropsChanged(this);\n\n      this.selectedConjunction = this._selectedConjunction(props);\n      this.conjunctionOptions = this._getConjunctionOptions(props);\n      this.dummyFn.isDummyFn = true;\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n      let prevProps = this.props;\n      let prevState = this.state;\n\n      let should = pureShouldComponentUpdate(this)(nextProps, nextState);\n      if (should) {\n        if (prevState == nextState && prevProps != nextProps) {\n          const draggingId = (nextProps.dragging.id || prevProps.dragging.id);\n          const isDraggingMe = draggingId == nextProps.id;\n          let chs = [];\n          for (let k in nextProps) {\n            let changed = (nextProps[k] != prevProps[k]);\n            if (k == \"dragging\" && !isDraggingMe) {\n              changed = false; //dragging another item -> ignore\n            }\n            if (changed) {\n              chs.push(k);\n            }\n          }\n          if (!chs.length)\n            should = false;\n        }\n      }\n      return should;\n    }\n\n    onPropsChanged(nextProps) {\n      const {config, id, conjunction} = nextProps;\n      const oldConfig = this.props.config;\n      const oldConjunction = this.props.conjunction;\n      if (oldConfig != config || oldConjunction != conjunction) {\n        this.selectedConjunction = this._selectedConjunction(nextProps);\n        this.conjunctionOptions = this._getConjunctionOptions(nextProps);\n      }\n    }\n\n    _getConjunctionOptions (props) {\n      return mapValues(props.config.conjunctions, (item, index) => ({\n        id: `conjunction-${props.id}-${index}`,\n        name: `conjunction[${props.id}]`,\n        key: index,\n        label: item.label,\n        checked: index === this._selectedConjunction(props),\n      }));\n    }\n\n    _selectedConjunction = (props) => {\n      props = props || this.props;\n      return props.conjunction || defaultGroupConjunction(props.config, props.field);\n    };\n\n    setConjunction = (conj = null) => {\n      this.props.actions.setConjunction(this.props.path, conj);\n    };\n\n    setNot = (not = null) => {\n      this.props.actions.setNot(this.props.path, not);\n    };\n\n    setLock = (lock = null) => {\n      this.props.actions.setLock(this.props.path, lock);\n    };\n\n    dummyFn = () => {};\n\n    removeSelf = () => {\n      this.props.actions.removeGroup(this.props.path);\n    };\n\n    addGroup = () => {\n      this.props.actions.addGroup(this.props.path);\n    };\n\n    addCaseGroup = () => {\n      this.props.actions.addCaseGroup(this.props.path);\n    };\n\n    addDefaultCaseGroup = () => {\n      this.props.actions.addDefaultCaseGroup(this.props.path);\n    };\n\n    addRule = () => {\n      this.props.actions.addRule(this.props.path);\n    };\n\n    // for RuleGroup\n    setField = (field) => {\n      this.props.actions.setField(this.props.path, field);\n    };\n\n    // for RuleGroupExt\n    setOperator = (operator) => {\n      this.props.actions.setOperator(this.props.path, operator);\n    };\n\n    setValue = (delta, value, type) => {\n      this.props.actions.setValue(this.props.path, delta, value, type);\n    };\n\n    render() {\n      const isDraggingMe = this.props.dragging.id == this.props.id;\n      const currentNesting = this.props.path.size;\n      const maxNesting = this.props.config.settings.maxNesting;\n      const isInDraggingTempo = !isDraggingMe && this.props.isDraggingTempo;\n\n      // Don't allow nesting further than the maximum configured depth and don't\n      // allow removal of the root group.\n      const allowFurtherNesting = typeof maxNesting === \"undefined\" || currentNesting < maxNesting;\n      const isRoot = currentNesting == 1;\n      return (\n        <div\n          className={\"group-or-rule-container group-container\"}\n          data-id={this.props.id}\n        >\n          {[\n            isDraggingMe ? <Group\n              key={\"dragging\"}\n              id={this.props.id}\n              groupId={this.props.groupId}\n              isDraggingMe={true}\n              isDraggingTempo={true}\n              dragging={this.props.dragging}\n              isRoot={isRoot}\n              allowFurtherNesting={allowFurtherNesting}\n              conjunctionOptions={this.conjunctionOptions}\n              not={this.props.not}\n              selectedConjunction={this.selectedConjunction}\n              setConjunction={this.dummyFn}\n              setNot={this.dummyFn}\n              setLock={this.dummyFn}\n              removeSelf={this.dummyFn}\n              addGroup={this.dummyFn}\n              addCaseGroup={this.dummyFn}\n              addDefaultCaseGroup={this.dummyFn}\n              addRule={this.dummyFn}\n              setField={this.dummyFn}\n              setOperator={this.dummyFn}\n              setValue={this.dummyFn}\n              value={this.props.value || null}\n              config={this.props.config}\n              children1={this.props.children1}\n              actions={this.props.actions}\n              //tree={this.props.tree}\n              reordableNodesCnt={this.props.reordableNodesCnt}\n              totalRulesCnt={this.props.totalRulesCnt}\n              selectedField={this.props.field || null}\n              parentField={this.props.parentField || null}\n              selectedOperator={this.props.operator || null}\n              isLocked={this.props.isLocked}\n              isTrueLocked={this.props.isTrueLocked}\n              parentReordableNodesCnt={this.props.parentReordableNodesCnt}\n            /> : null\n            ,\n            <Group\n              key={this.props.id}\n              id={this.props.id}\n              groupId={this.props.groupId}\n              isDraggingMe={isDraggingMe}\n              isDraggingTempo={isInDraggingTempo}\n              onDragStart={this.props.onDragStart}\n              isRoot={isRoot}\n              allowFurtherNesting={allowFurtherNesting}\n              conjunctionOptions={this.conjunctionOptions}\n              not={this.props.not}\n              selectedConjunction={this.selectedConjunction}\n              setConjunction={isInDraggingTempo ? this.dummyFn : this.setConjunction}\n              setNot={isInDraggingTempo ? this.dummyFn : this.setNot}\n              setLock={isInDraggingTempo ? this.dummyFn : this.setLock}\n              removeSelf={isInDraggingTempo ? this.dummyFn : this.removeSelf}\n              addGroup={isInDraggingTempo ? this.dummyFn : this.addGroup}\n              addCaseGroup={isInDraggingTempo ? this.dummyFn : this.addCaseGroup}\n              addDefaultCaseGroup={isInDraggingTempo ? this.dummyFn : this.addDefaultCaseGroup}\n              addRule={isInDraggingTempo ? this.dummyFn : this.addRule}\n              setField={isInDraggingTempo ? this.dummyFn : this.setField}\n              setOperator={isInDraggingTempo ? this.dummyFn : this.setOperator}\n              setValue={isInDraggingTempo ? this.dummyFn : this.setValue}\n              value={this.props.value || null}\n              config={this.props.config}\n              children1={this.props.children1}\n              actions={this.props.actions}\n              //tree={this.props.tree}\n              reordableNodesCnt={this.props.reordableNodesCnt}\n              totalRulesCnt={this.props.totalRulesCnt}\n              selectedField={this.props.field || null}\n              parentField={this.props.parentField || null}\n              selectedOperator={this.props.operator || null}\n              isLocked={this.props.isLocked}\n              isTrueLocked={this.props.isTrueLocked}\n              parentReordableNodesCnt={this.props.parentReordableNodesCnt}\n            />\n          ]}\n        </div>\n      );\n    }\n\n  };\n\n\nexport default (Group) => {\n  const ConnectedGroupContainer = connect(\n    (state) => {\n      return {\n        dragging: state.dragging,\n      };\n    },\n    null,\n    null,\n    {\n      context\n    }\n  )(createGroupContainer(Group));\n  ConnectedGroupContainer.displayName = \"ConnectedGroupContainer\";\n\n  return ConnectedGroupContainer;\n};\n","import React, { PureComponent } from \"react\";\n\nconst groupActionsPositionList = {\n  topLeft: \"group--actions--tl\",\n  topCenter: \"group--actions--tc\",\n  topRight: \"group--actions--tr\",\n  bottomLeft: \"group--actions--bl\",\n  bottomCenter: \"group--actions--bc\",\n  bottomRight: \"group--actions--br\"\n};\nconst defaultPosition = \"topRight\";\n\n\nexport class GroupActions extends PureComponent {\n  render() {\n    const {\n      config, \n      addRule, addGroup, removeSelf, setLock, isLocked, isTrueLocked, id,\n      canAddGroup, canAddRule, canDeleteGroup\n    } = this.props;\n    const {\n      immutableGroupsMode, addRuleLabel, addGroupLabel, delGroupLabel, groupActionsPosition, \n      renderButton: Btn, renderSwitch: Switch, renderButtonGroup: BtnGrp,\n      lockLabel, lockedLabel, showLock, canDeleteLocked,\n    } = config.settings;\n    const position = groupActionsPositionList[groupActionsPosition || defaultPosition];\n\n    const setLockSwitch = showLock && !(isLocked && !isTrueLocked) && <Switch \n      type=\"lock\" id={id} value={isLocked} setValue={setLock} label={lockLabel} checkedLabel={lockedLabel} config={config}\n    />;\n\n    const addRuleBtn = !immutableGroupsMode && canAddRule && !isLocked && <Btn\n      type=\"addRule\" onClick={addRule} label={addRuleLabel} readonly={isLocked} config={config}\n    />;\n    const addGroupBtn = !immutableGroupsMode && canAddGroup && !isLocked && <Btn\n      type=\"addGroup\" onClick={addGroup} label={addGroupLabel} readonly={isLocked} config={config}\n    />;\n    const delGroupBtn = !immutableGroupsMode && canDeleteGroup && (!isLocked || isLocked && canDeleteLocked) && <Btn\n      type=\"delGroup\" onClick={removeSelf} label={delGroupLabel} config={config}\n    />;\n\n    return (\n      <div className={`group--actions ${position}`}>\n        <BtnGrp config={config}>\n          {setLockSwitch}\n          {addRuleBtn}\n          {addGroupBtn}\n          {delGroupBtn}\n        </BtnGrp>\n      </div>\n    );\n  }\n}\n","import React, { Component, PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport startsWith from \"lodash/startsWith\";\nimport GroupContainer from \"../containers/GroupContainer\";\nimport Draggable from \"../containers/Draggable\";\nconst classNames = require(\"classnames\");\nimport { Item } from \"./Item\";\nimport {GroupActions} from \"./GroupActions\";\nimport {ConfirmFn, DragIcon, dummyFn} from \"../utils\";\n\nconst defaultPosition = \"topRight\";\n\n\nexport class BasicGroup extends PureComponent {\n  static propTypes = {\n    //tree: PropTypes.instanceOf(Immutable.Map).isRequired,\n    reordableNodesCnt: PropTypes.number,\n    conjunctionOptions: PropTypes.object.isRequired,\n    allowFurtherNesting: PropTypes.bool.isRequired,\n    isRoot: PropTypes.bool.isRequired,\n    not: PropTypes.bool,\n    selectedConjunction: PropTypes.string,\n    config: PropTypes.object.isRequired,\n    id: PropTypes.string.isRequired,\n    groupId: PropTypes.string,\n    path: PropTypes.any, //instanceOf(Immutable.List)\n    children1: PropTypes.any, //instanceOf(Immutable.OrderedMap)\n    isDraggingMe: PropTypes.bool,\n    isDraggingTempo: PropTypes.bool,\n    isLocked: PropTypes.bool,\n    isTrueLocked: PropTypes.bool,\n    //actions\n    handleDraggerMouseDown: PropTypes.func,\n    onDragStart: PropTypes.func,\n    addRule: PropTypes.func.isRequired,\n    addGroup: PropTypes.func.isRequired,\n    removeSelf: PropTypes.func.isRequired,\n    setConjunction: PropTypes.func.isRequired,\n    setNot: PropTypes.func.isRequired,\n    setLock: PropTypes.func.isRequired,\n    actions: PropTypes.object.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.removeSelf = this.removeSelf.bind(this);\n    this.setLock = this.setLock.bind(this);\n    this.renderItem = this.renderItem.bind(this);\n  }\n\n  isGroupTopPosition() {\n    return startsWith(this.props.config.settings.groupActionsPosition || defaultPosition, \"top\");\n  }\n\n  setLock(lock) {\n    this.props.setLock(lock);\n  }\n\n  removeSelf() {\n    const {confirmFn} = this.props;\n    const {renderConfirm, removeGroupConfirmOptions: confirmOptions} = this.props.config.settings;\n    const doRemove = () => {\n      this.props.removeSelf();\n    };\n    if (confirmOptions && !this.isEmptyCurrentGroup()) {\n      renderConfirm({...confirmOptions,\n        onOk: doRemove,\n        onCancel: null,\n        confirmFn: confirmFn\n      });\n    } else {\n      doRemove();\n    }\n  }\n\n  isEmptyCurrentGroup() {\n    const children = this.props.children1;\n    return !children || children.size == 0\n      || children.size == 1 && this.isEmpty(children.first());\n  }\n\n  isEmpty(item) {\n    const isGroup = (item.get(\"type\") == \"group\" || item.get(\"type\") == \"rule_group\");\n    return isGroup ? this.isEmptyGroup(item) : this.isEmptyRule(item);\n  }\n\n  isEmptyGroup(group) {\n    const children = group.get(\"children1\");\n    return !children || children.size == 0\n      || children.size == 1 && this.isEmpty(children.first());\n  }\n\n  isEmptyRule(rule) {\n    const properties = rule.get(\"properties\");\n    return !(\n      properties.get(\"field\") !== null\n          && properties.get(\"operator\") !== null\n          && properties.get(\"value\").filter((val) => val !== undefined).size > 0\n    );\n  }\n\n  render() {\n    return <>\n      {this.renderHeaderWrapper()}\n      {this.renderChildrenWrapper()}\n      {this.renderFooterWrapper()}\n    </>;\n  }\n\n  showNot() {\n    const {config} = this.props;\n    return config.settings.showNot;\n  }\n\n  // show conjs for 2+ children?\n  showConjs() {\n    const {conjunctionOptions, children1, config} = this.props;\n    const conjunctionCount = Object.keys(conjunctionOptions).length;\n    return conjunctionCount > 1 || this.showNot();\n  }\n\n  isOneChild() {\n    const {children1} = this.props;\n    return children1 ? children1.size < 2 : true;\n  }\n\n  renderChildrenWrapper() {\n    const {children1} = this.props;\n\n    return children1 && (\n      <div key=\"group-children\" className={classNames(\n        \"group--children\",\n        !this.showConjs() ? \"hide--conjs\" : \"\",\n        this.isOneChild() ? \"hide--line\" : \"\",\n        this.isOneChild() ? \"one--child\" : \"\",\n        this.childrenClassName()\n      )}>{this.renderChildren()}</div>\n    );\n  }\n\n  childrenClassName = () => \"\";\n\n  renderHeaderWrapper() {\n    const isGroupTopPosition = this.isGroupTopPosition();\n    return (\n      <div key=\"group-header\" className={classNames(\n        \"group--header\",\n        this.isOneChild() ? \"one--child\" : \"\",\n      )}>\n        {this.renderHeader()}\n        {isGroupTopPosition && this.renderBeforeActions()}\n        {isGroupTopPosition && this.renderActions()}\n        {isGroupTopPosition && this.renderAfterActions()}\n      </div>\n    );\n  }\n\n  renderFooterWrapper() {\n    const isGroupTopPosition = this.isGroupTopPosition();\n    return !isGroupTopPosition && (\n      <div key=\"group-footer\" className='group--footer'>\n        {this.renderBeforeActions()}\n        {this.renderActions()}\n        {this.renderAfterActions()}\n      </div>\n    );\n  }\n\n  renderBeforeActions = () => {\n    const BeforeActions = this.props.config.settings.renderBeforeActions;\n    if (BeforeActions == undefined)\n      return null;\n\n    return typeof BeforeActions === \"function\" ? <BeforeActions {...this.props}/> : BeforeActions;\n  };\n\n  renderAfterActions = () => {\n    const AfterActions = this.props.config.settings.renderAfterActions;\n    if (AfterActions == undefined)\n      return null;\n\n    return typeof AfterActions === \"function\" ? <AfterActions {...this.props}/> : AfterActions;\n  };\n\n  renderActions() {\n    const {config, addRule, addGroup, isLocked, isTrueLocked, id} = this.props;\n\n    return <GroupActions\n      config={config}\n      addRule={addRule}\n      addGroup={addGroup}\n      canAddGroup={this.canAddGroup()}\n      canAddRule={this.canAddRule()}\n      canDeleteGroup={this.canDeleteGroup()}\n      removeSelf={this.removeSelf}\n      setLock={this.setLock}\n      isLocked={isLocked}\n      isTrueLocked={isTrueLocked}\n      id={id}\n    />;\n  }\n\n  canAddGroup() {\n    return this.props.allowFurtherNesting;\n  }\n  canAddRule() {\n    const maxNumberOfRules = this.props.config.settings.maxNumberOfRules;\n    const totalRulesCnt = this.props.totalRulesCnt;\n    if (maxNumberOfRules) {\n      return totalRulesCnt < maxNumberOfRules;\n    }\n    return true;\n  }\n  canDeleteGroup() {\n    return !this.props.isRoot;\n  }\n\n  renderChildren() {\n    const {children1} = this.props;\n    return children1 ? children1.map(this.renderItem).toList() : null;\n  }\n\n  renderItem(item) {\n    const props = this.props;\n    const {config, actions, onDragStart, isLocked} = props;\n    const isRuleGroup = item.get(\"type\") == \"group\" && item.getIn([\"properties\", \"field\"]) != null;\n    const type = isRuleGroup ? \"rule_group\" : item.get(\"type\");\n    \n    return (\n      <Item\n        {...this.extraPropsForItem(item)}\n        key={item.get(\"id\")}\n        id={item.get(\"id\")}\n        groupId={props.id}\n        //path={props.path.push(item.get('id'))}\n        path={item.get(\"path\")}\n        type={type}\n        properties={item.get(\"properties\")}\n        config={config}\n        actions={actions}\n        children1={item.get(\"children1\")}\n        //tree={props.tree}\n        reordableNodesCnt={this.reordableNodesCntForItem(item)}\n        totalRulesCnt={this.totalRulesCntForItem(item)}\n        parentReordableNodesCnt={this.reordableNodesCnt()}\n        onDragStart={onDragStart}\n        isDraggingTempo={this.props.isDraggingTempo}\n        isParentLocked={isLocked}\n      />\n    );\n  }\n\n  extraPropsForItem(_item) {\n    return {};\n  }\n\n  reordableNodesCnt() {\n    if (this.props.isLocked)\n      return 0;\n    return this.props.reordableNodesCnt;\n  }\n\n  totalRulesCntForItem(_item) {\n    return this.props.totalRulesCnt;\n  }\n\n  reordableNodesCntForItem(_item) {\n    if (this.props.isLocked)\n      return 0;\n    return this.reordableNodesCnt();\n  }\n\n  showDragIcon() {\n    const { config, isRoot, isLocked } = this.props;\n    const reordableNodesCnt = this.reordableNodesCnt();\n    return config.settings.canReorder && !isRoot && reordableNodesCnt > 1 && !isLocked;\n  }\n\n  renderDrag() {\n    const { handleDraggerMouseDown } = this.props;\n    const drag = this.showDragIcon()\n      && <span\n        key=\"group-drag-icon\"\n        className={\"qb-drag-handler group--drag-handler\"}\n        onMouseDown={handleDraggerMouseDown}\n      ><DragIcon /> </span>;\n    return drag;\n  }\n\n  conjunctionOptions() {\n    const { conjunctionOptions } = this.props;\n    return conjunctionOptions;\n  }\n\n  renderConjs() {\n    const {\n      config, children1, id,\n      selectedConjunction, setConjunction, not, setNot, isLocked\n    } = this.props;\n\n    const {immutableGroupsMode, renderConjs: Conjs, showNot: _showNot, notLabel} = config.settings;\n    const conjunctionOptions = this.conjunctionOptions();\n    if (!this.showConjs())\n      return null;\n    if (!children1 || !children1.size)\n      return null;\n\n    const renderProps = {\n      disabled: this.isOneChild(),\n      readonly: immutableGroupsMode || isLocked,\n      selectedConjunction: selectedConjunction,\n      setConjunction: immutableGroupsMode ? dummyFn : setConjunction,\n      conjunctionOptions: conjunctionOptions,\n      config: config,\n      not: not || false,\n      id: id,\n      setNot: immutableGroupsMode ? dummyFn : setNot,\n      notLabel: notLabel,\n      showNot: this.showNot(),\n      isLocked: isLocked\n    };\n    return <Conjs {...renderProps} />;\n  }\n\n  renderHeader() {\n    return (\n      <div className={\"group--conjunctions\"}>\n        {this.renderConjs()}\n        {this.renderDrag()}\n      </div>\n    );\n  }\n}\n\nexport default GroupContainer(Draggable(\"group\")(ConfirmFn(BasicGroup)));\n","import React, { PureComponent } from \"react\";\n\nexport class RuleGroupActions extends PureComponent {\n  render() {\n    const {\n      config, \n      addRule, canAddRule, canDeleteGroup, removeSelf, \n      setLock, isLocked, isTrueLocked, id,\n    } = this.props;\n    const {\n      immutableGroupsMode, addRuleLabel, delGroupLabel,\n      renderButton: Btn, renderSwitch: Switch, renderButtonGroup: BtnGrp,\n      lockLabel, lockedLabel, showLock, canDeleteLocked,\n    } = config.settings;\n\n    const setLockSwitch = showLock && !(isLocked && !isTrueLocked) && <Switch \n      type=\"lock\" id={id} value={isLocked} setValue={setLock} label={lockLabel} checkedLabel={lockedLabel} hideLabel={true} config={config}\n    />;\n\n    const addRuleBtn = !immutableGroupsMode && canAddRule && !isLocked && <Btn \n      type=\"addRuleGroup\" onClick={addRule} label={addRuleLabel} readonly={isLocked} config={config}\n    />;\n\n    const delGroupBtn = !immutableGroupsMode && canDeleteGroup && (!isLocked || isLocked && canDeleteLocked) && <Btn \n      type=\"delRuleGroup\" onClick={removeSelf} label={delGroupLabel} config={config}\n    />;\n\n    return (\n      <div className={\"group--actions\"}>\n        <BtnGrp config={config}>\n          {setLockSwitch}\n          {addRuleBtn}\n          {delGroupBtn}\n        </BtnGrp>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport GroupContainer from \"../containers/GroupContainer\";\nimport Draggable from \"../containers/Draggable\";\nimport {BasicGroup} from \"./Group\";\nimport {RuleGroupActions} from \"./RuleGroupActions\";\nimport FieldWrapper from \"../rule/FieldWrapper\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport {ConfirmFn} from \"../utils\";\n\n\n@GroupContainer\n@Draggable(\"group rule_group\")\n@ConfirmFn\nclass RuleGroup extends BasicGroup {\n  static propTypes = {\n    ...BasicGroup.propTypes,\n    selectedField: PropTypes.string,\n    parentField: PropTypes.string,\n    setField: PropTypes.func,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n  }\n\n  childrenClassName = () => \"rule_group--children\";\n  \n  renderHeaderWrapper = () => null;\n  renderFooterWrapper = () => null;\n  renderConjs = () => null;\n  canAddGroup = () => false;\n  canAddRule = () => true;\n  canDeleteGroup = () => false;\n\n  reordableNodesCntForItem(_item) {\n    if (this.props.isLocked)\n      return 0;\n    const {children1} = this.props;\n    return children1.size;\n  }\n\n  renderChildrenWrapper() {\n    return (\n      <>\n        {this.renderDrag()}\n        {this.renderField()}\n        {this.renderActions()}\n        {super.renderChildrenWrapper()}\n      </>\n    );\n  }\n\n  renderField() {\n    const { config, selectedField, setField, parentField, id, groupId, isLocked } = this.props;\n    const { immutableFieldsMode } = config.settings;\n    return <FieldWrapper\n      key=\"field\"\n      classname={\"group--field\"}\n      config={config}\n      selectedField={selectedField}\n      setField={setField}\n      parentField={parentField}\n      readonly={immutableFieldsMode || isLocked}\n      id={id}\n      groupId={groupId}\n    />;\n  }\n\n  renderActions() {\n    const {config, addRule, isLocked, isTrueLocked, id} = this.props;\n\n    return <RuleGroupActions\n      config={config}\n      addRule={addRule}\n      canAddRule={this.canAddRule()}\n      canDeleteGroup={this.canDeleteGroup()}\n      removeSelf={this.removeSelf}\n      setLock={this.setLock}\n      isLocked={isLocked}\n      isTrueLocked={isTrueLocked}\n      id={id}\n    />;\n  }\n\n  extraPropsForItem(_item) {\n    return {\n      parentField: this.props.selectedField\n    };\n  }\n}\n\n\nexport default RuleGroup;\n","import React, { PureComponent } from \"react\";\n\nexport class RuleGroupExtActions extends PureComponent {\n  render() {\n    const {\n      config, \n      addRule, canAddRule, canDeleteGroup, removeSelf, \n      setLock, isLocked, isTrueLocked, id,\n    } = this.props;\n    const {\n      immutableGroupsMode, addSubRuleLabel, delGroupLabel,\n      renderButton: Btn, renderSwitch: Switch, renderButtonGroup: BtnGrp,\n      lockLabel, lockedLabel, showLock, canDeleteLocked,\n    } = config.settings;\n\n    const setLockSwitch = showLock && !(isLocked && !isTrueLocked) && <Switch \n      type=\"lock\" id={id} value={isLocked} setValue={setLock} label={lockLabel} checkedLabel={lockedLabel} config={config}\n    />;\n\n    const addRuleBtn = !immutableGroupsMode && canAddRule && !isLocked && <Btn \n      type=\"addRuleGroupExt\" onClick={addRule} label={addSubRuleLabel} readonly={isLocked} config={config}\n    />;\n\n    const delGroupBtn = !immutableGroupsMode && canDeleteGroup && (!isLocked || isLocked && canDeleteLocked) && <Btn \n      type=\"delRuleGroup\" onClick={removeSelf} label={delGroupLabel} config={config}\n    />;\n\n    return (\n      <div className={\"group--actions group--actions--tr\"}>\n        <BtnGrp config={config}>\n          {setLockSwitch}\n          {addRuleBtn}\n          {delGroupBtn}\n        </BtnGrp>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport GroupContainer from \"../containers/GroupContainer\";\nimport Draggable from \"../containers/Draggable\";\nimport {BasicGroup} from \"./Group\";\nimport {RuleGroupExtActions} from \"./RuleGroupExtActions\";\nimport FieldWrapper from \"../rule/FieldWrapper\";\nimport OperatorWrapper from \"../rule/OperatorWrapper\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport {Col, dummyFn, ConfirmFn} from \"../utils\";\nimport {getFieldWidgetConfig, getFieldConfig} from \"../../utils/configUtils\";\nimport Widget from \"../rule/Widget\";\nconst classNames = require(\"classnames\");\n\n\n@GroupContainer\n@Draggable(\"group rule_group_ext\")\n@ConfirmFn\nclass RuleGroupExt extends BasicGroup {\n  static propTypes = {\n    ...BasicGroup.propTypes,\n    selectedField: PropTypes.string,\n    selectedOperator: PropTypes.string,\n    value: PropTypes.any,\n    parentField: PropTypes.string,\n    setField: PropTypes.func,\n    setOperator: PropTypes.func,\n    setValue: PropTypes.func,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n  }\n\n  childrenClassName = () => \"rule_group_ext--children\";\n  \n  renderFooterWrapper = () => null;\n  canAddGroup = () => false;\n  canAddRule = () => true;\n  canDeleteGroup = () => true;\n\n  renderHeaderWrapper() {\n    return (\n      <div key=\"group-header\" className={classNames(\n        \"group--header\", \n        this.isOneChild() ? \"one--child\" : \"\",\n        this.showDragIcon() ? \"with--drag\" : \"hide--drag\",\n        this.showConjs() && (!this.isOneChild() || this.showNot()) ? \"with--conjs\" : \"hide--conjs\"\n      )}>\n        {this.renderHeader()}\n        {this.renderGroupField()}\n        {this.renderActions()}\n      </div>\n    );\n  }\n\n  renderHeader() {\n    return (\n      <div className={\"group--conjunctions\"}>\n        {this.renderConjs()}\n        {this.renderDrag()}\n      </div>\n    );\n  }\n\n  renderGroupField() {\n    return (\n      <div className={\"group--field--count--rule\"}>\n        {this.renderField()}\n        {this.renderOperator()}\n        {this.renderWidget()}\n      </div>\n    );\n  }\n\n  showNot() {\n    const {config, selectedField, selectedOperator} = this.props;\n    const selectedFieldConfig = getFieldConfig(config, selectedField) || {};\n    return selectedFieldConfig.showNot != undefined ? selectedFieldConfig.showNot : config.settings.showNot;\n  }\n\n  conjunctionOptions() {\n    const {config, selectedField, selectedOperator} = this.props;\n    const selectedFieldConfig = getFieldConfig(config, selectedField) || {};\n    let conjunctionOptions = super.conjunctionOptions();\n    if (selectedFieldConfig.conjunctions) {\n      let filtered = {};\n      for (let k of selectedFieldConfig.conjunctions) {\n        filtered[k] = conjunctionOptions[k];\n      }\n      conjunctionOptions = filtered;\n    }\n    return conjunctionOptions;\n  }\n\n  renderField() {\n    const { config, selectedField, setField, parentField, id, groupId, isLocked } = this.props;\n    const { immutableFieldsMode } = config.settings;\n    return <FieldWrapper\n      key=\"field\"\n      classname={\"rule--field\"}\n      config={config}\n      selectedField={selectedField}\n      setField={setField}\n      parentField={parentField}\n      readonly={immutableFieldsMode || isLocked}\n      id={id}\n      groupId={groupId}\n    />;\n  }\n\n  renderOperator() {\n    const {config, selectedField, selectedOperator, setField, setOperator, isLocked} = this.props;\n    const { immutableFieldsMode } = config.settings;\n    const selectedFieldWidgetConfig = getFieldWidgetConfig(config, selectedField, selectedOperator) || {};\n    const hideOperator = selectedFieldWidgetConfig.hideOperator;\n    const showOperatorLabel = selectedField && hideOperator && selectedFieldWidgetConfig.operatorInlineLabel;\n    const showOperator = selectedField && !hideOperator;\n\n    return <OperatorWrapper\n      key=\"operator\"\n      classname={\"group--operator\"}\n      config={config}\n      selectedField={selectedField}\n      selectedOperator={selectedOperator}\n      setField={setField}\n      setOperator={setOperator}\n      selectedFieldPartsLabels={[\"group\"]}\n      showOperator={showOperator}\n      showOperatorLabel={showOperatorLabel}\n      selectedFieldWidgetConfig={selectedFieldWidgetConfig}\n      readonly={immutableFieldsMode || isLocked}\n      id={this.props.id}\n      groupId={this.props.groupId}\n    />;\n  }\n\n  renderWidget() {\n    const {config, selectedField, selectedOperator, isLocked} = this.props;\n    const { immutableValuesMode } = config.settings;\n    const isFieldAndOpSelected = selectedField && selectedOperator;\n    const showWidget = isFieldAndOpSelected;\n    if (!showWidget) return null;\n\n    const widget = <Widget\n      key=\"values\"\n      isForRuleGruop={true}\n      field={this.props.selectedField}\n      operator={this.props.selectedOperator}\n      value={this.props.value}\n      valueSrc={\"value\"}\n      valueError={null}\n      config={config}\n      setValue={!immutableValuesMode ? this.props.setValue : dummyFn}\n      setValueSrc={dummyFn}\n      readonly={immutableValuesMode || isLocked}\n      id={this.props.id}\n      groupId={this.props.groupId}\n    />;\n\n    return (\n      <Col key={\"widget-for-\"+this.props.selectedOperator} className=\"rule--value\">\n        {widget}\n      </Col>\n    );\n  }\n\n  renderActions() {\n    const {config, addRule, isLocked, isTrueLocked, id} = this.props;\n\n    return <RuleGroupExtActions\n      config={config}\n      addRule={addRule}\n      canAddRule={this.canAddRule()}\n      canDeleteGroup={this.canDeleteGroup()}\n      removeSelf={this.removeSelf}\n      setLock={this.setLock}\n      isLocked={isLocked}\n      isTrueLocked={isTrueLocked}\n      id={id}\n    />;\n  }\n\n  reordableNodesCntForItem(_item) {\n    if (this.props.isLocked)\n      return 0;\n    const {children1} = this.props;\n    return children1.size;\n  }\n\n  extraPropsForItem(_item) {\n    return {\n      parentField: this.props.selectedField\n    };\n  }\n}\n\n\nexport default RuleGroupExt;\n","import React, { PureComponent } from \"react\";\n\nconst groupActionsPositionList = {\n  topLeft: \"group--actions--tl\",\n  topCenter: \"group--actions--tc\",\n  topRight: \"group--actions--tr\",\n  bottomLeft: \"group--actions--bl\",\n  bottomCenter: \"group--actions--bc\",\n  bottomRight: \"group--actions--br\"\n};\nconst defaultPosition = \"topRight\";\n\n\nexport class SwitchGroupActions extends PureComponent {\n  render() {\n    const {\n      config, \n      addCaseGroup, addDefaultCaseGroup, setLock, isLocked, isTrueLocked, id, canAddGroup, canAddDefault\n    } = this.props;\n    const {\n      immutableGroupsMode, addCaseLabel, addDefaultCaseLabel, groupActionsPosition, \n      renderButton: Btn, renderSwitch: Switch, renderButtonGroup: BtnGrp,\n      lockLabel, lockedLabel, showLock,\n    } = config.settings;\n    const position = groupActionsPositionList[groupActionsPosition || defaultPosition];\n\n    const setLockSwitch = showLock && !(isLocked && !isTrueLocked) && <Switch \n      type=\"lock\" id={id} value={isLocked} setValue={setLock} label={lockLabel} checkedLabel={lockedLabel} config={config}\n    />;\n\n    const addCaseGroupBtn = !immutableGroupsMode && canAddGroup && !isLocked && <Btn\n      type=\"addCaseGroup\" onClick={addCaseGroup} label={addCaseLabel} readonly={isLocked} config={config}\n    />;\n\n    const addDefaultCaseGroupBtn = !immutableGroupsMode && canAddDefault && !isLocked && <Btn\n      type=\"addDefaultCaseGroup\" onClick={addDefaultCaseGroup} label={addDefaultCaseLabel} readonly={isLocked} config={config}\n    />;\n\n    return (\n      <div className={`group--actions ${position}`}>\n        <BtnGrp config={config}>\n          {setLockSwitch}\n          {addCaseGroupBtn}\n          {addDefaultCaseGroupBtn}\n        </BtnGrp>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport GroupContainer from \"../containers/GroupContainer\";\nimport Draggable from \"../containers/Draggable\";\nimport {BasicGroup} from \"./Group\";\nimport {SwitchGroupActions} from \"./SwitchGroupActions\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport {Col, dummyFn, ConfirmFn} from \"../utils\";\nimport {getTotalReordableNodesCountInTree, getTotalRulesCountInTree} from \"../../utils/treeUtils\";\nconst classNames = require(\"classnames\");\n\n\n@GroupContainer\n@Draggable(\"group switch_group\")\n@ConfirmFn\nclass SwitchGroup extends BasicGroup {\n  static propTypes = {\n    ...BasicGroup.propTypes,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n  }\n\n  childrenClassName = () => \"switch_group--children\";\n  \n  renderFooterWrapper = () => null;\n  hasDefaultCase = () => {\n    return this.props.children1.size && this.props.children1.filter(c => c.get(\"children1\") == null).size > 0;\n  };\n  canAddGroup() {\n    const { maxNumberOfCases } = this.props.config.settings;\n    const totalCasesCnt = this.props.children1.size;\n    if (maxNumberOfCases) {\n      return totalCasesCnt < maxNumberOfCases;\n    }\n    return true;\n  }\n  canAddRule() {\n    return false;\n  }\n\n  reordableNodesCnt() {\n    // result will be passed to each case's `parentReordableNodesCnt` prop\n    const totalCasesCnt = this.props.children1.size;\n    let casesToReorder = totalCasesCnt;\n    if (this.hasDefaultCase()) {\n      casesToReorder--;\n    }\n    return casesToReorder;\n  }\n\n  totalRulesCntForItem(item) {\n    return getTotalRulesCountInTree(item);\n  }\n\n  reordableNodesCntForItem(item) {\n    if (this.props.isLocked)\n      return 0;\n    const { canLeaveEmptyCase, canRegroupCases } = this.props.config.settings;\n\n    const totalCasesCnt = this.props.children1.size;\n    let casesToReorder = totalCasesCnt;\n    if (this.hasDefaultCase()) {\n      casesToReorder--;\n    }\n\n    const nodesInCase = getTotalReordableNodesCountInTree(item);\n    let cnt = nodesInCase;\n    if (cnt == 1 && canRegroupCases && canLeaveEmptyCase && casesToReorder > 1)\n      cnt = 111;\n    return cnt;\n  }\n\n  renderHeaderWrapper() {\n    return (\n      <div key=\"group-header\" className={classNames(\n        \"group--header\", \n        this.isOneChild() ? \"one--child\" : \"\",\n        this.showDragIcon() ? \"with--drag\" : \"hide--drag\",\n        this.showConjs() && (!this.isOneChild() || this.showNot()) ? \"with--conjs\" : \"hide--conjs\"\n      )}>\n        {this.renderHeader()}\n        {this.renderActions()}\n      </div>\n    );\n  }\n\n  renderHeader() {\n    return (\n      <div className={\"group--conjunctions\"}>\n        {this.renderConjs()}\n        {this.renderDrag()}\n      </div>\n    );\n  }\n\n  renderConjs() {\n    const { renderSwitchPrefix } = this.props.config.settings;\n    return renderSwitchPrefix ? renderSwitchPrefix() : null;\n  }\n\n  showNot() {\n    return false;\n  }\n\n\n  renderActions() {\n    const {config, addCaseGroup, addDefaultCaseGroup, isLocked, isTrueLocked, id} = this.props;\n\n    return <SwitchGroupActions\n      config={config}\n      addCaseGroup={addCaseGroup}\n      addDefaultCaseGroup={addDefaultCaseGroup}\n      canAddDefault={!this.hasDefaultCase()}\n      canAddGroup={this.canAddGroup()}\n      setLock={this.setLock}\n      isLocked={isLocked}\n      isTrueLocked={isTrueLocked}\n      id={id}\n    />;\n  }\n\n}\n\n\nexport default SwitchGroup;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport GroupContainer from \"../containers/GroupContainer\";\nimport Draggable from \"../containers/Draggable\";\nimport {BasicGroup} from \"./Group\";\nimport {GroupActions} from \"./GroupActions\";\nimport {useOnPropsChanged} from \"../../utils/reactUtils\";\nimport {Col, dummyFn, ConfirmFn} from \"../utils\";\nimport Widget from \"../rule/Widget\";\nconst classNames = require(\"classnames\");\n\n\n@GroupContainer\n@Draggable(\"group case_group\")\n@ConfirmFn\nclass CaseGroup extends BasicGroup {\n  static propTypes = {\n    ...BasicGroup.propTypes,\n    parentReordableNodesCnt: PropTypes.number,\n    value: PropTypes.any,\n    setValue: PropTypes.func,\n  };\n\n  constructor(props) {\n    super(props);\n    useOnPropsChanged(this);\n    this.onPropsChanged(props);\n  }\n\n  onPropsChanged(nextProps) {\n  }\n\n  isDefaultCase() {\n    return this.props.children1 == undefined;\n  }\n\n  reordableNodesCnt() {\n    // `parentReordableNodesCnt` is number of cases to reorder\n    return this.props.parentReordableNodesCnt;\n  }\n\n  reordableNodesCntForItem(_item) {\n    // `reordableNodesCnt` is number of nodes is current case\n    if (this.props.isLocked)\n      return 0;\n    return this.props.reordableNodesCnt;\n  }\n\n  totalRulesCntForItem(_item) {\n    // `totalRulesCnt` is number of nodes is current case\n    return this.props.totalRulesCnt;\n  }\n\n  showDragIcon() {\n    // default impl of `showDragIcon()` uses `this.reordableNodesCnt()`\n    if (this.isDefaultCase())\n      return false;\n    return super.showDragIcon();\n  }\n\n  childrenClassName = () => \"case_group--children\";\n  \n  renderFooterWrapper = () => null;\n\n  renderHeaderWrapper() {\n    return (\n      <div key=\"group-header\" className={classNames(\n        \"group--header\", \n        this.isOneChild() ? \"one--child\" : \"\",\n        this.showDragIcon() ? \"with--drag\" : \"hide--drag\",\n        this.showConjs() && (!this.isOneChild() || this.showNot()) ? \"with--conjs\" : \"hide--conjs\"\n      )}>\n        {this.renderHeaderLeft()}\n        {this.renderHeaderCenter()}\n        {this.renderActions()}\n      </div>\n    );\n  }\n\n  renderChildrenWrapper() {\n    if (this.isDefaultCase())\n      return null;\n    // body has 2 columns: condition & value\n    return (\n      <div className={\"case_group--body\"}>\n        {this.renderCondition()}\n        {this.renderValue()}\n      </div>\n    );\n  }\n\n  renderHeaderLeft() {\n    if (this.isDefaultCase()) {\n      const { defaultCaseLabel } = this.props.config.settings;\n      return defaultCaseLabel || \"\";\n    }\n    // default impl:\n    return (\n      <div className={\"group--conjunctions\"}>\n        {this.renderConjs()}\n        {this.renderDrag()}\n      </div>\n    );\n  }\n\n  renderCondition() {\n    if (this.isDefaultCase())\n      return null;\n    return super.renderChildrenWrapper();\n  }\n\n  renderHeaderCenter() {\n    if (this.isDefaultCase())\n      return this.renderValue();\n    else\n      return null;\n  }\n\n  canAddGroup() {\n    if (this.isDefaultCase())\n      return false;\n    return super.canAddGroup();\n  }\n\n  canAddRule() {\n    if (this.isDefaultCase())\n      return false;\n    return super.canAddRule();\n  }\n\n  renderValue() {\n    const { config, isLocked, value, setValue, id } = this.props;\n    const { immutableValuesMode } = config.settings;\n\n    const widget = <Widget\n      key=\"values\"\n      isCaseValue={true}\n      field={\"!case_value\"}\n      operator={null}\n      value={value}\n      valueSrc={\"value\"}\n      valueError={null}\n      config={config}\n      setValue={!immutableValuesMode ? setValue : dummyFn}\n      setValueSrc={dummyFn}\n      readonly={immutableValuesMode || isLocked}\n      id={id}\n      groupId={null}\n    />;\n\n    return (\n      <Col className=\"case_group--value\">\n        {widget}\n      </Col>\n    );\n  }\n\n  renderActions() {\n    const {config, addGroup, addRule, isLocked, isTrueLocked, id} = this.props;\n    return <GroupActions\n      config={config}\n      addGroup={addGroup}\n      addRule={addRule}\n      canAddRule={this.canAddRule()}\n      canAddGroup={this.canAddGroup()}\n      canDeleteGroup={this.canDeleteGroup()}\n      removeSelf={this.removeSelf}\n      setLock={this.setLock}\n      isLocked={isLocked}\n      isTrueLocked={isTrueLocked}\n      id={id}\n    />;\n  }\n\n  isEmptyCurrentGroup() {\n    // used to confirm self-deletion\n    const { value } = this.props;\n    const oneValue = value && value.size ? value.get(0) : null;\n    const hasValue = oneValue != null && (Array.isArray(oneValue) ? oneValue.length > 0 : true);\n    return super.isEmptyCurrentGroup() && !hasValue;\n  }\n\n}\n\n\nexport default CaseGroup;\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Rule from \"./Rule\";\nimport Group from \"./Group\";\nimport RuleGroup from \"./RuleGroup\";\nimport RuleGroupExt from \"./RuleGroupExt\";\nimport SwitchGroup from \"./SwitchGroup\";\nimport CaseGroup from \"./CaseGroup\";\n\nconst types = [\n  \"rule\",\n  \"group\",\n  \"rule_group\",\n  \"switch_group\",\n  \"case_group\"\n];\n\nconst getProperties = (props) => {\n  const properties = props.properties.toObject();\n  const result = {...properties};\n  if (props.isParentLocked) {\n    result.isLocked = true;\n  }\n  if (properties.isLocked) {\n    result.isTrueLocked = true;\n  }\n  return result;\n};\n\nconst typeMap = {\n  rule: (props) => (\n    <Rule\n      {...getProperties(props)}\n      id={props.id}\n      groupId={props.groupId}\n      path={props.path}\n      actions={props.actions}\n      reordableNodesCnt={props.reordableNodesCnt}\n      totalRulesCnt={props.totalRulesCnt}\n      config={props.config}\n      onDragStart={props.onDragStart}\n      isDraggingTempo={props.isDraggingTempo}\n      parentField={props.parentField}\n      parentReordableNodesCnt={props.parentReordableNodesCnt}\n    />\n  ),\n  group: (props) => (\n    <Group \n      {...getProperties(props)}\n      id={props.id}\n      groupId={props.groupId}\n      path={props.path}\n      actions={props.actions}\n      config={props.config}\n      //tree={props.tree}\n      reordableNodesCnt={props.reordableNodesCnt}\n      totalRulesCnt={props.totalRulesCnt}\n      onDragStart={props.onDragStart}\n      isDraggingTempo={props.isDraggingTempo}\n      children1={props.children1}\n      parentField={null}\n      parentReordableNodesCnt={props.parentReordableNodesCnt}\n    />\n  ),\n  rule_group: (props) => (\n    <RuleGroup \n      {...getProperties(props)}\n      id={props.id}\n      groupId={props.groupId}\n      path={props.path}\n      actions={props.actions}\n      config={props.config}\n      //tree={props.tree}\n      reordableNodesCnt={props.reordableNodesCnt}\n      totalRulesCnt={props.totalRulesCnt}\n      onDragStart={props.onDragStart}\n      isDraggingTempo={props.isDraggingTempo}\n      children1={props.children1}\n      parentField={props.parentField}\n      parentReordableNodesCnt={props.parentReordableNodesCnt}\n    />\n  ),\n  rule_group_ext: (props) => (\n    <RuleGroupExt \n      {...getProperties(props)}\n      id={props.id}\n      groupId={props.groupId}\n      path={props.path}\n      actions={props.actions}\n      config={props.config}\n      //tree={props.tree}\n      reordableNodesCnt={props.reordableNodesCnt}\n      totalRulesCnt={props.totalRulesCnt}\n      onDragStart={props.onDragStart}\n      isDraggingTempo={props.isDraggingTempo}\n      children1={props.children1}\n      parentField={props.parentField}\n      parentReordableNodesCnt={props.parentReordableNodesCnt}\n    />\n  ),\n  switch_group: (props) => (\n    <SwitchGroup \n      {...getProperties(props)}\n      id={props.id}\n      groupId={props.groupId}\n      path={props.path}\n      actions={props.actions}\n      config={props.config}\n      //tree={props.tree}\n      reordableNodesCnt={props.reordableNodesCnt}\n      totalRulesCnt={props.totalRulesCnt}\n      onDragStart={props.onDragStart}\n      isDraggingTempo={props.isDraggingTempo}\n      children1={props.children1}\n      parentField={null}\n      parentReordableNodesCnt={props.parentReordableNodesCnt}\n    />\n  ),\n  case_group: (props) => (\n    <CaseGroup \n      {...getProperties(props)}\n      id={props.id}\n      groupId={props.groupId}\n      path={props.path}\n      actions={props.actions}\n      config={props.config}\n      //tree={props.tree}\n      reordableNodesCnt={props.reordableNodesCnt}\n      totalRulesCnt={props.totalRulesCnt}\n      onDragStart={props.onDragStart}\n      isDraggingTempo={props.isDraggingTempo}\n      children1={props.children1}\n      parentField={null}\n      parentReordableNodesCnt={props.parentReordableNodesCnt}\n    />\n  ),\n};\n\n\nclass Item extends PureComponent {\n  static propTypes = {\n    //tree: PropTypes.instanceOf(Immutable.Map).isRequired,\n    config: PropTypes.object.isRequired,\n    id: PropTypes.string.isRequired,\n    groupId: PropTypes.string,\n    type: PropTypes.oneOf(types).isRequired,\n    path: PropTypes.any.isRequired, //instanceOf(Immutable.List)\n    properties: PropTypes.any.isRequired, //instanceOf(Immutable.Map)\n    children1: PropTypes.any, //instanceOf(Immutable.OrderedMap)\n    actions: PropTypes.object.isRequired,\n    reordableNodesCnt: PropTypes.number,\n    onDragStart: PropTypes.func,\n    parentField: PropTypes.string, //from RuleGroup\n    isDraggingTempo: PropTypes.bool,\n    isParentLocked: PropTypes.bool,\n  };\n\n  render() {\n    const { type, ...props } = this.props;\n    const mode = props.properties.get(\"mode\");\n    const postfix = mode == \"array\" ? \"_ext\" : \"\";\n    const Cmp = typeMap[type + postfix];\n    if (!Cmp) return null;\n    return Cmp(props);\n  }\n}\n\nexport { Item };\n","import React, { Component } from \"react\";\nimport {connect} from \"react-redux\";\nimport {getFlatTree} from \"../../utils/treeUtils\";\nimport {logger} from \"../../utils/stuff\";\nimport context from \"../../stores/context\";\nimport * as constants from \"../../constants\";\nimport clone from \"clone\";\nimport PropTypes from \"prop-types\";\nimport * as actions from \"../../actions\";\nimport {pureShouldComponentUpdate, useOnPropsChanged} from \"../../utils/reactUtils\";\n\n\nconst createSortableContainer = (Builder, CanMoveFn = null) => \n  class SortableContainer extends Component {\n    static propTypes = {\n      tree: PropTypes.any.isRequired, //instanceOf(Immutable.Map)\n      actions: PropTypes.object.isRequired, // {moveItem: Function, ..}\n      //... see Builder\n    };\n\n    constructor(props) {\n      super(props);\n      useOnPropsChanged(this);\n\n      this.onPropsChanged(props);\n    }\n\n    onPropsChanged(nextProps) {\n      this.tree = getFlatTree(nextProps.tree);\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n      let prevProps = this.props;\n      let prevState = this.state;\n\n      let should = pureShouldComponentUpdate(this)(nextProps, nextState);\n      if (should) {\n        if (prevState == nextState && prevProps != nextProps) {\n          let chs = [];\n          for (let k in nextProps) {\n            let changed = (nextProps[k] != prevProps[k]);\n            if (changed) {\n              //don't render <Builder> on dragging - appropriate redux-connected components will do it\n              if(k != \"dragging\" && k != \"mousePos\")\n                chs.push(k);\n            }\n          }\n          if (!chs.length)\n            should = false;\n        }\n      }\n      return should;\n    }\n\n    componentDidUpdate(_prevProps, _prevState) {\n      let dragging = this.props.dragging;\n      let startDragging = this.props.dragStart;\n      if (startDragging && startDragging.id) {\n        dragging.itemInfo = this.tree.items[dragging.id];\n        if (dragging.itemInfo) {\n          if (dragging.itemInfo.index != startDragging.itemInfo.index || dragging.itemInfo.parent != startDragging.itemInfo.parent) {\n            const treeEl = startDragging.treeEl;\n            const treeElContainer = startDragging.treeElContainer;\n            const plhEl = this._getPlaceholderNodeEl(treeEl, true);\n            if (plhEl) {\n              const plX = plhEl.getBoundingClientRect().left + window.scrollX;\n              const plY = plhEl.getBoundingClientRect().top + window.scrollY;\n              const oldPlX = startDragging.plX;\n              const oldPlY = startDragging.plY;\n              const scrollTop = treeElContainer.scrollTop;\n              startDragging.plX = plX;\n              startDragging.plY = plY;\n              startDragging.itemInfo = clone(dragging.itemInfo);\n              startDragging.y = plhEl.offsetTop;\n              startDragging.x = plhEl.offsetLeft;\n              startDragging.clientY += (plY - oldPlY);\n              startDragging.clientX += (plX - oldPlX);\n              if (treeElContainer != document.body)\n                startDragging.scrollTop = scrollTop;\n\n              this.onDrag(this.props.mousePos, false);\n            }\n          }\n        }\n      }\n    }\n\n    _getNodeElById (treeEl, indexId, ignoreCache = false) {\n      if (indexId == null)\n        return null;\n      if (!this._cacheEls)\n        this._cacheEls = {};\n      let el = this._cacheEls[indexId];\n      if (el && document.contains(el) && !ignoreCache)\n        return el;\n      el = treeEl.querySelector('.group-or-rule-container[data-id=\"'+indexId+'\"]');\n      this._cacheEls[indexId] = el;\n      return el;\n    }\n\n    _getDraggableNodeEl (treeEl, ignoreCache = false) {\n      if (!this._cacheEls)\n        this._cacheEls = {};\n      let el = this._cacheEls[\"draggable\"];\n      if (el && document.contains(el) && !ignoreCache)\n        return el;\n      const els = treeEl.getElementsByClassName(\"qb-draggable\");\n      el = els.length ? els[0] : null;\n      this._cacheEls[\"draggable\"] = el;\n      return el;\n    }\n\n    _getPlaceholderNodeEl (treeEl, ignoreCache = false) {\n      if (!this._cacheEls)\n        this._cacheEls = {};\n      let el = this._cacheEls[\"placeholder\"];\n      if (el && document.contains(el) && !ignoreCache)\n        return el;\n      const els = treeEl.getElementsByClassName(\"qb-placeholder\");\n      el = els.length ? els[0] : null;\n      this._cacheEls[\"placeholder\"] = el;\n      return el;\n    }\n\n    _isScrollable(node) {\n      const overflowY = window.getComputedStyle(node)[\"overflow-y\"];\n      return (overflowY === \"scroll\" || overflowY === \"auto\") && (node.scrollHeight > node.offsetHeight);\n    }\n\n    _getScrollParent(node) {\n      if (node == null)\n        return null;\n    \n      if (node === document.body || this._isScrollable(node)) {\n        return node;\n      } else {\n        return this._getScrollParent(node.parentNode);\n      }\n    }\n\n    _getEventTarget = (e, dragStart) => {\n      return e && e.__mocked_window || document.body || window;\n    };\n\n    onDragStart = (id, dom, e) => {\n      let treeEl = dom.closest(\".query-builder\");\n      document.body.classList.add(\"qb-dragging\");\n      treeEl.classList.add(\"qb-dragging\");\n      let treeElContainer = treeEl.closest(\".query-builder-container\") || treeEl;\n      treeElContainer = this._getScrollParent(treeElContainer) || document.body;\n      const scrollTop = treeElContainer.scrollTop;\n      \n      const _dragEl = this._getDraggableNodeEl(treeEl);\n      const _plhEl = this._getPlaceholderNodeEl(treeEl);\n\n      const tmpAllGroups = treeEl.querySelectorAll(\".group--children\");\n      const anyGroup = tmpAllGroups.length ? tmpAllGroups[0] : null;\n      let groupPadding;\n      if (anyGroup) {\n        groupPadding = window.getComputedStyle(anyGroup, null).getPropertyValue(\"padding-left\");\n        groupPadding = parseInt(groupPadding);\n      }\n\n      const dragging = {\n        id: id,\n        x: dom.offsetLeft,\n        y: dom.offsetTop,\n        w: dom.offsetWidth,\n        h: dom.offsetHeight,\n        itemInfo: this.tree.items[id],\n        paddingLeft: groupPadding,\n      };\n      const dragStart = {\n        id: id,\n        x: dom.offsetLeft,\n        y: dom.offsetTop,\n        scrollTop: scrollTop,\n        clientX: e.clientX,\n        clientY: e.clientY,\n        itemInfo: clone(this.tree.items[id]),\n        treeEl: treeEl,\n        treeElContainer: treeElContainer,\n      };\n      const mousePos = {\n        clientX: e.clientX,\n        clientY: e.clientY,\n      };\n\n      const target = this._getEventTarget(e, dragStart);\n      this.eventTarget = target;\n      target.addEventListener(\"mousemove\", this.onDrag);\n      target.addEventListener(\"mouseup\", this.onDragEnd);\n\n      this.props.setDragStart(dragStart, dragging, mousePos);\n    };\n\n\n    onDrag = (e, doHandleDrag = true) => {\n      let dragging = Object.assign({}, this.props.dragging);\n      let startDragging = this.props.dragStart;\n      const paddingLeft = dragging.paddingLeft; //this.props.paddingLeft;\n      const treeElContainer = startDragging.treeElContainer;\n      const scrollTop = treeElContainer.scrollTop;\n      dragging.itemInfo = this.tree.items[dragging.id];\n      if (!dragging.itemInfo) {\n        return;\n      }\n\n      let mousePos = {\n        clientX: e.clientX,\n        clientY: e.clientY,\n      };\n      const startMousePos = {\n        clientX: startDragging.clientX,\n        clientY: startDragging.clientY,\n      };\n\n      if (e.__mock_dom) {\n        const treeEl = startDragging.treeEl;\n        const dragEl = this._getDraggableNodeEl(treeEl);\n        const plhEl = this._getPlaceholderNodeEl(treeEl);\n        e.__mock_dom({treeEl, dragEl, plhEl});\n      }\n\n      //first init plX/plY\n      if (!startDragging.plX) {\n        const treeEl = startDragging.treeEl;\n        const plhEl = this._getPlaceholderNodeEl(treeEl);\n        if (plhEl) {\n          startDragging.plX = plhEl.getBoundingClientRect().left + window.scrollX;\n          startDragging.plY = plhEl.getBoundingClientRect().top + window.scrollY;\n        }\n      }\n\n      const startX = startDragging.x;\n      const startY = startDragging.y;\n      const startClientX = startDragging.clientX;\n      const startClientY = startDragging.clientY;\n      const startScrollTop = startDragging.scrollTop;\n      const pos = {\n        x: startX + (e.clientX - startClientX),\n        y: startY + (e.clientY - startClientY) + (scrollTop - startScrollTop)\n      };\n      dragging.x = pos.x;\n      dragging.y = pos.y;\n      dragging.paddingLeft = paddingLeft;\n      dragging.mousePos = mousePos;\n      dragging.startMousePos = startMousePos;\n\n\n      this.props.setDragProgress(mousePos, dragging);\n\n      const moved = doHandleDrag ? this.handleDrag(dragging, e, CanMoveFn) : false;\n\n      if (!moved) {\n        if (e.preventDefault)\n          e.preventDefault();\n      }\n    };\n\n    onDragEnd = () => {\n      let treeEl = this.props.dragStart.treeEl;\n\n      this.props.setDragEnd();\n\n      treeEl.classList.remove(\"qb-dragging\");\n      document.body.classList.remove(\"qb-dragging\");\n      this._cacheEls = {};\n\n      const target = this.eventTarget || this._getEventTarget();\n      target.removeEventListener(\"mousemove\", this.onDrag);\n      target.removeEventListener(\"mouseup\", this.onDragEnd);\n    };\n    \n\n    handleDrag (dragInfo, e, canMoveFn) {\n      const canMoveBeforeAfterGroup = true;\n      const itemInfo = dragInfo.itemInfo;\n      const paddingLeft = dragInfo.paddingLeft;\n\n      let moveInfo = null;\n      const treeEl = this.props.dragStart.treeEl;\n      const dragId = dragInfo.id;\n      const dragEl = this._getDraggableNodeEl(treeEl);\n      const plhEl = this._getPlaceholderNodeEl(treeEl);\n      let dragRect, plhRect, hovRect, treeRect;\n      if (dragEl && plhEl) {\n        dragRect = dragEl.getBoundingClientRect();\n        plhRect = plhEl.getBoundingClientRect();\n        if (!plhRect.width) {\n          return;\n        }\n        let dragDirs = {hrz: 0, vrt: 0};\n        if (dragRect.top < plhRect.top)\n          dragDirs.vrt = -1; //up\n        else if (dragRect.bottom > plhRect.bottom)\n          dragDirs.vrt = +1; //down\n        if (dragRect.left > plhRect.left)\n          dragDirs.hrz = +1; //right\n        else if (dragRect.left < plhRect.left)\n          dragDirs.hrz = -1; //left\n\n        treeRect = treeEl.getBoundingClientRect();\n        const trgCoord = {\n          x: treeRect.left + (treeRect.right - treeRect.left) / 2,\n          y: dragDirs.vrt >= 0 ? dragRect.bottom : dragRect.top,\n        };\n        let hovCNodeEl;\n        if (e.__mocked_hov_container) {\n          hovCNodeEl = e.__mocked_hov_container;\n        } else {\n          const hovNodeEl = document.elementFromPoint(trgCoord.x, trgCoord.y-1);\n          hovCNodeEl = hovNodeEl ? hovNodeEl.closest(\".group-or-rule-container\") : null;\n          if (!hovCNodeEl && hovNodeEl && hovNodeEl.classList.contains(\"query-builder-container\")) {\n            // fix 2022-01-24 - get root .group-or-rule-container\n            const rootGroupContainer = hovNodeEl?.firstChild?.firstChild;\n            if (rootGroupContainer && rootGroupContainer.classList.contains(\"group-or-rule-container\")) {\n              hovCNodeEl = rootGroupContainer;\n            }\n          }\n        }\n        if (!hovCNodeEl) {\n          logger.log(\"out of tree bounds!\");\n        } else {\n          const isGroup = hovCNodeEl.classList.contains(\"group-container\");\n          const hovNodeId = hovCNodeEl.getAttribute(\"data-id\");\n          const hovEl = hovCNodeEl;\n          let doAppend = false;\n          let doPrepend = false;\n          if (hovEl) {\n            hovRect = hovEl.getBoundingClientRect();\n            const hovHeight = hovRect.bottom - hovRect.top;\n            const hovII = this.tree.items[hovNodeId];\n            let trgRect = null,\n              trgEl = null,\n              trgII = null,\n              altII = null; //for canMoveBeforeAfterGroup\n\n            if (dragDirs.vrt == 0) {\n              trgII = itemInfo;\n              trgEl = plhEl;\n              if (trgEl)\n                trgRect = trgEl.getBoundingClientRect();\n            } else {\n              if (isGroup) {\n                if (dragDirs.vrt > 0) { //down\n                  //take group header (for prepend only)\n                  const hovInnerEl = hovCNodeEl.getElementsByClassName(\"group--header\");\n                  const hovEl2 = hovInnerEl.length ? hovInnerEl[0] : null;\n                  if (hovEl2) {\n                    const hovRect2 = hovEl2.getBoundingClientRect();\n                    const hovHeight2 = hovRect2.bottom - hovRect2.top;\n                    const isOverHover = ((dragRect.bottom - hovRect2.top) > hovHeight2*3/4);\n                    if (isOverHover && hovII.top > dragInfo.itemInfo.top) {\n                      trgII = hovII;\n                      trgRect = hovRect2;\n                      trgEl = hovEl2;\n                      doPrepend = true;\n                    }\n                  }\n                } else if (dragDirs.vrt < 0) { //up\n                  if (hovII.lev >= itemInfo.lev) {\n                    //take whole group\n                    const isClimbToHover = ((hovRect.bottom - dragRect.top) >= 2);\n                    if (isClimbToHover && hovII.top < dragInfo.itemInfo.top) {\n                      trgII = hovII;\n                      trgRect = hovRect;\n                      trgEl = hovEl;\n                      doAppend = true;\n                    }\n                  }\n                }\n                if (!doPrepend && !doAppend || canMoveBeforeAfterGroup) {\n                  //take whole group and check if we can move before/after group\n                  const isOverHover = (dragDirs.vrt < 0 //up\n                    ? ((hovRect.bottom - dragRect.top) > (hovHeight-5))\n                    : ((dragRect.bottom - hovRect.top) > (hovHeight-5)));\n                  if (isOverHover) {\n                    if (!doPrepend && !doAppend) {\n                      trgII = hovII;\n                      trgRect = hovRect;\n                      trgEl = hovEl;\n                    }\n                    if (canMoveBeforeAfterGroup) {\n                      altII = hovII;\n                    }\n                  }\n                }\n              } else {\n                //check if we can move before/after group\n                const isOverHover = (dragDirs.vrt < 0 //up\n                  ? ((hovRect.bottom - dragRect.top) > hovHeight/2)\n                  : ((dragRect.bottom - hovRect.top) > hovHeight/2));\n                if (isOverHover) {\n                  trgII = hovII;\n                  trgRect = hovRect;\n                  trgEl = hovEl;\n                }\n              }\n            }\n\n            const isSamePos = (trgII && trgII.id == dragId);\n            if (trgRect) {\n              const dragLeftOffset = dragRect.left - treeRect.left;\n              const trgLeftOffset = trgRect.left - treeRect.left;\n              const _trgLev = trgLeftOffset / paddingLeft;\n              const dragLev = Math.max(0, Math.round(dragLeftOffset / paddingLeft));\n\n              //find all possible moves\n              let availMoves = [];\n              let altMoves = []; //alternatively can move after/before group, if can't move into it\n              if (isSamePos) {\n                //do nothing\n              } else {\n                if (isGroup) {\n                  if (doAppend) {\n                    availMoves.push([constants.PLACEMENT_APPEND, trgII, trgII.lev+1]);\n                  } else if (doPrepend) {\n                    availMoves.push([constants.PLACEMENT_PREPEND, trgII, trgII.lev+1]);\n                  }\n                  //alt\n                  if (canMoveBeforeAfterGroup && altII) {\n                    // fix 2022-01-24: do prepend/append instead of before/after for root\n                    const isToRoot = altII.lev == 0;\n                    // fix 2022-01-25: fix prepend/append instead of before/after for case_group\n                    const isToCase = altII.type == \"case_group\" && itemInfo.type != \"case_group\";\n                    let prevCaseId = altII.prev && this.tree.items[altII.prev].caseId;\n                    let nextCaseId = altII.next && this.tree.items[altII.next].caseId;\n                    if (itemInfo.caseId == prevCaseId)\n                      prevCaseId = null;\n                    if (itemInfo.caseId == nextCaseId)\n                      nextCaseId = null;\n                    const prevCase = prevCaseId && this.tree.items[prevCaseId];\n                    const nextCase = nextCaseId && this.tree.items[nextCaseId];\n\n                    if (dragDirs.vrt > 0) { //down\n                      if (isToRoot) {\n                        altMoves.push([constants.PLACEMENT_APPEND, altII, altII.lev+1]);\n                      } else if (isToCase && nextCase) {\n                        altMoves.push([constants.PLACEMENT_PREPEND, nextCase, nextCase.lev+1]);\n                      } else {\n                        altMoves.push([constants.PLACEMENT_AFTER, altII, altII.lev]);\n                      }\n                    } else if (dragDirs.vrt < 0) { //up\n                      if (isToRoot) {\n                        altMoves.push([constants.PLACEMENT_PREPEND, altII, altII.lev+1]);\n                      } else if (isToCase && prevCase) {\n                        altMoves.push([constants.PLACEMENT_APPEND, prevCase, prevCase.lev+1]);\n                      } else {\n                        altMoves.push([constants.PLACEMENT_BEFORE, altII, altII.lev]);\n                      }\n                    }\n                  }\n                }\n                if (!doAppend && !doPrepend) {\n                  if (dragDirs.vrt < 0) { //up\n                    availMoves.push([constants.PLACEMENT_BEFORE, trgII, trgII.lev]);\n                  } else if (dragDirs.vrt > 0) { //down\n                    availMoves.push([constants.PLACEMENT_AFTER, trgII, trgII.lev]);\n                  }\n                }\n              }\n              \n              //add case\n              const addCaseII = am => {\n                const toII = am[1];\n                const fromCaseII = itemInfo.caseId ? this.tree.items[itemInfo.caseId] : null;\n                const toCaseII = toII.caseId ? this.tree.items[toII.caseId] : null;\n                return [...am, fromCaseII, toCaseII];\n              };\n              availMoves = availMoves.map(addCaseII);\n              altMoves = altMoves.map(addCaseII);\n\n              //sanitize\n              availMoves = availMoves.filter(am => {\n                const placement = am[0];\n                const trg = am[1];\n                if ((placement == constants.PLACEMENT_BEFORE || placement == constants.PLACEMENT_AFTER) && trg.parent == null)\n                  return false;\n                if (trg.collapsed && (placement == constants.PLACEMENT_APPEND || placement == constants.PLACEMENT_PREPEND))\n                  return false;\n\n                let isInside = (trg.id == itemInfo.id);\n                if (!isInside) {\n                  let tmp = trg;\n                  while (tmp.parent) {\n                    tmp = this.tree.items[tmp.parent];\n                    if (tmp.id == itemInfo.id) {\n                      isInside = true;\n                      break;\n                    }\n                  }\n                }\n                return !isInside;\n              }).map(am => {\n                const placement = am[0],\n                  toII = am[1],\n                  _lev = am[2],\n                  _fromCaseII = am[3],\n                  _toCaseII = am[4];\n                let toParentII = null;\n                if (placement == constants.PLACEMENT_APPEND || placement == constants.PLACEMENT_PREPEND)\n                  toParentII = toII;\n                else\n                  toParentII = this.tree.items[toII.parent];\n                if (toParentII && toParentII.parent == null)\n                  toParentII = null;\n                am[5] = toParentII;\n                return am;\n              });\n\n              let bestMode = null;\n              let filteredMoves = availMoves.filter(am => this.canMove(itemInfo, am[1], am[0], am[3], am[4], am[5], canMoveFn));\n              if (canMoveBeforeAfterGroup && filteredMoves.length == 0 && altMoves.length > 0) {\n                filteredMoves = altMoves.filter(am => this.canMove(itemInfo, am[1], am[0], am[3], am[4], am[5], canMoveFn));\n              }\n              const levs = filteredMoves.map(am => am[2]);\n              const curLev = itemInfo.lev;\n              const allLevs = levs.concat(curLev);\n              let closestDragLev = null;\n              if (allLevs.indexOf(dragLev) != -1)\n                closestDragLev = dragLev;\n              else if (dragLev > Math.max(...allLevs))\n                closestDragLev = Math.max(...allLevs);\n              else if (dragLev < Math.min(...allLevs))\n                closestDragLev = Math.min(...allLevs);\n              bestMode = filteredMoves.find(am => am[2] == closestDragLev);\n              if (!isSamePos && !bestMode && filteredMoves.length)\n                bestMode = filteredMoves[0];\n              moveInfo = bestMode;\n            }\n          }\n        }\n      }\n\n      if (moveInfo) {\n        this.move(itemInfo, moveInfo[1], moveInfo[0], moveInfo[3]);\n\n        // logger.log(\"DRAG-N-DROP\", JSON.stringify({\n        //   dragRect,\n        //   plhRect,\n        //   treeRect,\n        //   hovRect,\n        //   startMousePos: dragInfo.startMousePos,\n        //   mousePos: dragInfo.mousePos,\n        // }));\n        return true;\n      }\n\n      return false;\n    }\n\n    canMove (fromII, toII, placement, fromCaseII, toCaseII, toParentII, canMoveFn) {\n      if (!fromII || !toII)\n        return false;\n      if (fromII.id === toII.id)\n        return false;\n\n      const { canRegroup, canRegroupCases, maxNesting, maxNumberOfRules, canLeaveEmptyCase } = this.props.config.settings;\n      const newLev = toParentII ? toParentII.lev + 1 : toII.lev;\n      const isBeforeAfter = placement == constants.PLACEMENT_BEFORE || placement == constants.PLACEMENT_AFTER;\n      const isPend = placement == constants.PLACEMENT_PREPEND || placement == constants.PLACEMENT_APPEND;\n      const isLev1 = isBeforeAfter && toII.lev == 1 || isPend && toII.lev == 0;\n      const isParentChange = fromII.parent != toII.parent;\n      const isStructChange = isPend || isParentChange;\n      // can't move `case_group` anywhere but before/after anoter `case_group`\n      const isForbiddenStructChange = fromII.type == \"case_group\" && !isLev1\n        // can't restruct `rule_group`\n        || fromII.parentType == \"rule_group\" || toII.type == \"rule_group\" || toII.parentType == \"rule_group\" \n        // only `case_group` can be placed under `switch_group`\n        || fromII.type != \"case_group\" && toII.type == \"case_group\" && isBeforeAfter\n        || fromII.type != \"case_group\" && toII.type == \"switch_group\"\n        // can't move rule/group to another case\n        || !canRegroupCases && fromII.caseId != toII.caseId;\n      const isLockedChange = toII.isLocked || fromII.isLocked || toParentII && toParentII.isLocked;\n\n      if (maxNesting && newLev > maxNesting)\n        return false;\n      \n      if (isStructChange && (!canRegroup || isForbiddenStructChange || isLockedChange))\n        return false;\n      \n      if (fromII.type != \"case_group\" && fromII.caseId != toII.caseId) {\n        const isLastFromCase = fromCaseII ? fromCaseII._height == 2 : false;\n        const newRulesInTargetCase = toCaseII ? toCaseII.leafsCount + 1 : 0;\n        if (maxNumberOfRules && newRulesInTargetCase > maxNumberOfRules)\n          return false;\n        if (isLastFromCase && !canLeaveEmptyCase)\n          return false;\n      }\n\n      if (fromII.type == \"case_group\" && (\n        fromII.isDefaultCase || toII.isDefaultCase\n        || toII.type == \"switch_group\" && placement == constants.PLACEMENT_APPEND\n      )) {\n        // leave default case alone\n        return false;\n      }\n\n      let res = true;\n      if (canMoveFn) {\n        res = canMoveFn(fromII.node.toJS(), toII.node.toJS(), placement, toParentII ? toParentII.node.toJS() : null);\n      }\n      return res;\n    }\n\n    move (fromII, toII, placement, toParentII) {\n      //logger.log(\"move\", fromII, toII, placement, toParentII);\n      this.props.actions.moveItem(fromII.path, toII.path, placement);\n    }\n\n    render() {\n      return <Builder\n        {...this.props}\n        onDragStart={this.onDragStart}\n      />;\n    }\n  };\n\n\nexport default (Builder, CanMoveFn = null) => {\n  const ConnectedSortableContainer = connect(\n    (state) => {\n      return {\n        dragging: state.dragging,\n        dragStart: state.dragStart,\n        mousePos: state.mousePos,\n      };\n    }, {\n      setDragStart: actions.drag.setDragStart,\n      setDragProgress: actions.drag.setDragProgress,\n      setDragEnd: actions.drag.setDragEnd,\n    },\n    null,\n    {\n      context\n    }\n  )(createSortableContainer(Builder, CanMoveFn));\n  ConnectedSortableContainer.displayName = \"ConnectedSortableContainer\";\n\n  return ConnectedSortableContainer;\n};\n\n","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Immutable, {Map} from \"immutable\";\nimport { Item } from \"./item/Item\";\nimport SortableContainer from \"./containers/SortableContainer\";\nimport {getTotalReordableNodesCountInTree, getTotalRulesCountInTree} from \"../utils/treeUtils\";\nimport uuid from \"../utils/uuid\";\nimport {pureShouldComponentUpdate} from \"../utils/reactUtils\";\n\n\n@SortableContainer\nexport default class Builder extends Component {\n  static propTypes = {\n    tree: PropTypes.any.isRequired, //instanceOf(Immutable.Map)\n    config: PropTypes.object.isRequired,\n    actions: PropTypes.object.isRequired,\n    onDragStart: PropTypes.func,\n  };\n\n  shouldComponentUpdate(nextProps, nextState) {\n    const prevProps = this.props;\n    let should = pureShouldComponentUpdate(this)(nextProps, nextState);\n    if (should) {\n      let chs = [];\n      for (let k in nextProps) {\n        let changed = (nextProps[k] !== prevProps[k]);\n        if (changed && k != \"__isInternalValueChange\") {\n          chs.push(k);\n        }\n      }\n      if (!chs.length)\n        should = false;\n      //optimize render\n      if (chs.length == 1 && chs[0] == \"tree\" && nextProps.__isInternalValueChange)\n        should = false;\n    }\n    return should;\n  }\n\n  constructor(props) {\n    super(props);\n\n    this._updPath(props);\n  }\n\n  _updPath (props) {\n    const id = props.tree.get(\"id\");\n    this.path = Immutable.List.of(id);\n  }\n\n  render() {\n    const tree = this.props.tree;\n    const rootType = tree.get(\"type\");\n    const isTernary = rootType == \"switch_group\";\n    const reordableNodesCnt = isTernary ? null : getTotalReordableNodesCountInTree(tree);\n    const totalRulesCnt = isTernary ? null : getTotalRulesCountInTree(tree);\n    const id = tree.get(\"id\");\n    return (\n      <Item \n        key={id}\n        id={id}\n        path={this.path}\n        type={rootType}\n        properties={tree.get(\"properties\") || new Map()}\n        config={this.props.config}\n        actions={this.props.actions}\n        children1={tree.get(\"children1\") || new Map()}\n        //tree={tree}\n        reordableNodesCnt={reordableNodesCnt}\n        totalRulesCnt={totalRulesCnt}\n        parentReordableNodesCnt={0}\n        onDragStart={this.props.onDragStart}\n      />\n    );\n  }\n}\n","import {defaultValue} from \"../utils/stuff\";\nimport {getFieldConfig, getOperatorConfig} from \"../utils/configUtils\";\nimport {defaultConjunction} from \"../utils/defaultUtils\";\nimport {formatFieldName} from \"../utils/ruleUtils\";\nimport {completeValue} from \"../utils/funcUtils\";\nimport {Map} from \"immutable\";\n\n/*\n Build tree to http://querybuilder.js.org/ like format\n\n Example:\n {\n    \"condition\": \"AND\",\n    \"rules\": [\n        {\n            \"id\": \"price\",\n            \"field\": \"price\",\n            \"type\": \"double\",\n            \"input\": \"text\",\n            \"operator\": \"less\",\n            \"value\": \"10.25\"\n        },\n        {\n            \"condition\": \"OR\",\n            \"rules\": [\n                {\n                    \"id\": \"category\",\n                    \"field\": \"category\",\n                    \"type\": \"integer\",\n                    \"input\": \"select\",\n                    \"operator\": \"equal\",\n                    \"value\": \"2\"\n                },\n                {\n                    \"id\": \"category\",\n                    \"field\": \"category\",\n                    \"type\": \"integer\",\n                    \"input\": \"select\",\n                    \"operator\": \"equal\",\n                    \"value\": \"1\"\n                }\n            ]\n        }\n    ]\n }\n */\n\n\nexport const queryBuilderFormat = (item, config) => {\n  //meta is mutable\n  let meta = {\n    usedFields: []\n  };\n  const res = formatItem(item, config, meta);\n  if (!res)\n    return undefined;\n  return {\n    ...res, \n    ...meta\n  };\n};\n\n\nconst formatItem = (item, config, meta) => {\n  if (!item) return undefined;\n\n  const type = item.get(\"type\");\n  const children = item.get(\"children1\");\n\n  if ((type === \"group\" || type === \"rule_group\") && children && children.size) {\n    return formatGroup(item, config, meta);\n  } else if (type === \"rule\") {\n    return formatRule(item, config, meta);\n  }\n  return undefined;\n};\n\n\nconst formatGroup = (item, config, meta) => {\n  const properties = item.get(\"properties\") || new Map();\n  const children = item.get(\"children1\");\n  const id = item.get(\"id\");\n\n  const list = children\n    .map((currentChild) => formatItem(currentChild, config, meta))\n    .filter((currentChild) => typeof currentChild !== \"undefined\");\n  if (!list.size)\n    return undefined;\n\n  let conjunction = properties.get(\"conjunction\");\n  if (!conjunction)\n    conjunction = defaultConjunction(config);\n  const not = properties.get(\"not\");\n\n  const resultQuery = {\n    id,\n    rules: list.toList(),\n    condition: conjunction.toUpperCase(),\n    not,\n  };\n  return resultQuery;\n};\n\n\nconst formatRule = (item, config, meta) => {\n  const properties = item.get(\"properties\") || new Map();\n  const id = item.get(\"id\");\n\n  const operator = properties.get(\"operator\");\n  const options = properties.get(\"operatorOptions\");\n  let field = properties.get(\"field\");\n  let value = properties.get(\"value\");\n  let valueSrc = properties.get(\"valueSrc\");\n  let valueType = properties.get(\"valueType\");\n  const hasUndefinedValues = value.filter(v => v === undefined).size > 0;\n\n  if (field == null || operator == null || hasUndefinedValues)\n    return undefined;\n\n  const fieldDefinition = getFieldConfig(config, field) || {};\n  const operatorDefinition = getOperatorConfig(config, operator, field) || {};\n  const fieldType = fieldDefinition.type || \"undefined\";\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n  const typeConfig = config.types[fieldDefinition.type] || {};\n  const fieldName = formatFieldName(field, config, meta);\n\n  if (value.size < cardinality)\n    return undefined;\n\n  if (meta.usedFields.indexOf(field) == -1)\n    meta.usedFields.push(field);\n  value = value.toArray();\n  valueSrc = valueSrc.toArray();\n  valueType = valueType.toArray();\n  let values = [];\n  for (let i = 0 ; i < value.length ; i++) {\n    const val = {\n      type: valueType[i],\n      value: value[i],\n    };\n    values.push(val);\n    if (valueSrc[i] == \"field\") {\n      const secondField = value[i];\n      if (meta.usedFields.indexOf(secondField) == -1)\n        meta.usedFields.push(secondField);\n    }\n  }\n  let operatorOptions = options ? options.toJS() : null;\n  if (operatorOptions && !Object.keys(operatorOptions).length)\n    operatorOptions = null;\n      \n  let ruleQuery = {\n    id,\n    fieldName,\n    type: fieldType,\n    input: typeConfig.mainWidget,\n    operator,\n  };\n  if (operatorOptions)\n    ruleQuery.operatorOptions = operatorOptions;\n  ruleQuery.values = values;\n  return ruleQuery;\n};\n","import {defaultValue} from \"../utils/stuff\";\nimport {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig, getFuncConfig\n} from \"../utils/configUtils\";\nimport {getWidgetForFieldOp} from \"../utils/ruleUtils\";\nimport {defaultConjunction} from \"../utils/defaultUtils\";\nimport {completeValue} from \"../utils/funcUtils\";\nimport {Map} from \"immutable\";\nimport omit from \"lodash/omit\";\nimport pick from \"lodash/pick\";\n\n// http://jsonlogic.com/\n\n\nexport const jsonLogicFormat = (item, config) => {\n  //meta is mutable\n  let meta = {\n    usedFields: [],\n    errors: []\n  };\n  \n  const logic = formatItem(item, config, meta, true);\n  \n  // build empty data\n  const {errors, usedFields} = meta;\n  const {fieldSeparator} = config.settings;\n  let data = {};\n  for (let ff of usedFields) {\n    const def = getFieldConfig(config, ff) || {};\n    const parts = ff.split(fieldSeparator);\n    let tmp = data;\n    for (let i = 0 ; i < parts.length ; i++) {\n      const p = parts[i];\n      const pdef = getFieldConfig(config, parts.slice(0, i+1)) || {};\n      if (i != parts.length - 1) {\n        if (pdef.type == \"!group\" && pdef.mode != \"struct\") {\n          if (!tmp[p])\n            tmp[p] = [{}];\n          tmp = tmp[p][0];\n        } else {\n          if (!tmp[p])\n            tmp[p] = {};\n          tmp = tmp[p];\n        }\n      } else {\n        if (!tmp[p])\n          tmp[p] = null; // can use def.type for sample values\n      }\n    }\n  }\n    \n  return {\n    errors,\n    logic,\n    data,\n  };\n};\n\n\nconst formatItem = (item, config, meta, isRoot, parentField = null) => {\n  if (!item) return undefined;\n  const type = item.get(\"type\");\n  const properties = item.get(\"properties\") || new Map();\n  const isLocked = properties.get(\"isLocked\");\n  const {lockedOp} = config.settings.jsonLogic;\n  let ret;\n  if (type === \"group\" || type === \"rule_group\") {\n    ret = formatGroup(item, config, meta, isRoot, parentField);\n  } else if (type === \"rule\") {\n    ret = formatRule(item, config, meta, parentField);\n  }\n  if (isLocked && ret && lockedOp) {\n    ret = { [lockedOp] : ret };\n  }\n  return ret;\n};\n\n\nconst formatGroup = (item, config, meta, isRoot, parentField = null) => {\n  const type = item.get(\"type\");\n  const properties = item.get(\"properties\") || new Map();\n  const mode = properties.get(\"mode\");\n  const children = item.get(\"children1\");\n  const field = properties.get(\"field\");\n  if (!children) return undefined;\n  \n  let conjunction = properties.get(\"conjunction\");\n  if (!conjunction)\n    conjunction = defaultConjunction(config);\n  const conjunctionDefinition = config.conjunctions[conjunction];\n  const conj = conjunctionDefinition.jsonLogicConj || conjunction.toLowerCase();\n  const not = properties.get(\"not\");\n  if (conj != \"and\" && conj != \"or\") {\n    meta.errors.push(`Conjunction ${conj} is not supported`);\n    return undefined;\n  }\n\n  const isRuleGroup = (type === \"rule_group\" && !isRoot);\n  const groupField = isRuleGroup && mode != \"struct\" ? field : parentField;\n  const groupOperator = properties.get(\"operator\");\n  const groupOperatorDefinition = groupOperator && getOperatorConfig(config, groupOperator, field) || null;\n  const formattedValue = formatItemValue(config, properties, meta, groupOperator, parentField);\n  const isGroup0 = isRuleGroup && (!groupOperator || groupOperatorDefinition.cardinality == 0);\n\n  const list = children\n    .map((currentChild) => formatItem(currentChild, config, meta, false, groupField))\n    .filter((currentChild) => typeof currentChild !== \"undefined\");\n  \n  if (isRuleGroup && mode != \"struct\" && !isGroup0) {\n    // \"count\" rule can have no \"having\" children, but should have number value\n    if (formattedValue == undefined)\n      return undefined;\n  } else {\n    if (!list.size)\n      return undefined;\n  }\n\n  let resultQuery = {};\n  if (list.size == 1 && !isRoot)\n    resultQuery = list.first();\n  else\n    resultQuery[conj] = list.toList().toJS();\n  \n  // revert\n  if (not) {\n    resultQuery = { \"!\": resultQuery };\n  }\n\n  // rule_group (issue #246)\n  if (isRuleGroup && mode != \"struct\") {\n    const formattedField = formatField(meta, config, field, parentField);\n    if (isGroup0) {\n      // config.settings.groupOperators\n      const op = groupOperator || \"some\";\n      resultQuery = {\n        [op]: [\n          formattedField,\n          resultQuery\n        ]\n      };\n    } else {\n      // there is rule for count\n      const filter = !list.size \n        ? formattedField\n        : {\n          \"filter\": [\n            formattedField,\n            resultQuery\n          ]\n        };\n      const count = {\n        \"reduce\": [\n          filter,\n          { \"+\": [1, { var: \"accumulator\" }] },\n          0\n        ]\n      };\n      resultQuery = formatLogic(config, properties, count, formattedValue, groupOperator);\n    }\n  }\n  \n  return resultQuery;\n};\n\n\nconst formatRule = (item, config, meta, parentField = null) => {\n  const properties = item.get(\"properties\") || new Map();\n  const field = properties.get(\"field\");\n\n  let operator = properties.get(\"operator\");\n  let operatorOptions = properties.get(\"operatorOptions\");\n  operatorOptions = operatorOptions ? operatorOptions.toJS() : null;\n  if (operatorOptions && !Object.keys(operatorOptions).length)\n    operatorOptions = null;\n\n  if (field == null || operator == null)\n    return undefined;\n\n  const fieldDefinition = getFieldConfig(config, field) || {};\n  let operatorDefinition = getOperatorConfig(config, operator, field) || {};\n  let reversedOp = operatorDefinition.reversedOp;\n  let revOperatorDefinition = getOperatorConfig(config, reversedOp, field) || {};\n\n  // check op\n  let isRev = false;\n  if (!operatorDefinition.jsonLogic && !revOperatorDefinition.jsonLogic) {\n    meta.errors.push(`Operator ${operator} is not supported`);\n    return undefined;\n  }\n  if (!operatorDefinition.jsonLogic && revOperatorDefinition.jsonLogic) {\n    isRev = true;\n    [operator, reversedOp] = [reversedOp, operator];\n    [operatorDefinition, revOperatorDefinition] = [revOperatorDefinition, operatorDefinition];\n  }\n\n  const formattedValue = formatItemValue(config, properties, meta, operator, parentField);\n  if (formattedValue === undefined)\n    return undefined;\n\n  const formattedField = formatField(meta, config, field, parentField);\n\n  return formatLogic(config, properties, formattedField, formattedValue, operator, operatorOptions, fieldDefinition, isRev);\n};\n\n\nconst formatItemValue = (config, properties, meta, operator, parentField) => {\n  const field = properties.get(\"field\");\n  const iValueSrc = properties.get(\"valueSrc\");\n  const iValueType = properties.get(\"valueType\");\n  const fieldDefinition = getFieldConfig(config, field) || {};\n  const operatorDefinition = getOperatorConfig(config, operator, field) || {};\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n  const iValue = properties.get(\"value\");\n  const asyncListValues = properties.get(\"asyncListValues\");\n  if (iValue == undefined)\n    return undefined;\n  \n  let valueSrcs = [];\n  let valueTypes = [];\n  let oldUsedFields = meta.usedFields;\n  const fvalue = iValue.map((currentValue, ind) => {\n    const valueSrc = iValueSrc ? iValueSrc.get(ind) : null;\n    const valueType = iValueType ? iValueType.get(ind) : null;\n    const cValue = completeValue(currentValue, valueSrc, config);\n    const widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n    const fieldWidgetDef = omit(getFieldWidgetConfig(config, field, operator, widget, valueSrc), [\"factory\"]);\n    const fv = formatValue(\n      meta, config, cValue, valueSrc, valueType, fieldWidgetDef, fieldDefinition, operator, operatorDefinition, parentField, asyncListValues\n    );\n    if (fv !== undefined) {\n      valueSrcs.push(valueSrc);\n      valueTypes.push(valueType);\n    }\n    return fv;\n  });\n  const hasUndefinedValues = fvalue.filter(v => v === undefined).size > 0;\n  if (fvalue.size < cardinality || hasUndefinedValues) {\n    meta.usedFields = oldUsedFields; // restore\n    return undefined;\n  }\n  return cardinality > 1 ? fvalue.toArray() : (cardinality == 1 ? fvalue.first() : null);\n};\n\n\nconst formatValue = (meta, config, currentValue, valueSrc, valueType, fieldWidgetDef, fieldDef, operator, operatorDef, parentField = null, asyncListValues) => {\n  if (currentValue === undefined)\n    return undefined;\n  let ret;\n  if (valueSrc == \"field\") {\n    ret = formatField(meta, config, currentValue, parentField);\n  } else if (valueSrc == \"func\") {\n    ret = formatFunc(meta, config, currentValue, parentField);\n  } else if (typeof fieldWidgetDef.jsonLogic === \"function\") {\n    const fn = fieldWidgetDef.jsonLogic;\n    const args = [\n      currentValue,\n      {\n        ...pick(fieldDef, [\"fieldSettings\", \"listValues\"]),\n        asyncListValues\n      },\n      //useful options: valueFormat for date/time\n      omit(fieldWidgetDef, [\"formatValue\", \"mongoFormatValue\", \"sqlFormatValue\", \"jsonLogic\", \"elasticSearchFormatValue\", \"spelFormatValue\"]),\n    ];\n    if (operator) {\n      args.push(operator);\n      args.push(operatorDef);\n    }\n    ret = fn(...args);\n  } else {\n    ret = currentValue;\n  }\n  return ret;\n};\n\n\nconst formatFunc = (meta, config, currentValue, parentField = null) => {\n  const funcKey = currentValue.get(\"func\");\n  const args = currentValue.get(\"args\");\n  const funcConfig = getFuncConfig(config, funcKey);\n  if (!funcConfig.jsonLogic) {\n    meta.errors.push(`Func ${funcKey} is not supported`);\n    return undefined;\n  }\n\n  let formattedArgs = {};\n  for (const argKey in funcConfig.args) {\n    const argConfig = funcConfig.args[argKey];\n    const fieldDef = getFieldConfig(config, argConfig);\n    const argVal = args ? args.get(argKey) : undefined;\n    const argValue = argVal ? argVal.get(\"value\") : undefined;\n    const argValueSrc = argVal ? argVal.get(\"valueSrc\") : undefined;\n    const formattedArgVal = formatValue(\n      meta, config, argValue, argValueSrc, argConfig.type, fieldDef, argConfig, null, null, parentField\n    );\n    if (argValue != undefined && formattedArgVal === undefined) {\n      meta.errors.push(`Can't format value of arg ${argKey} for func ${funcKey}`);\n      return undefined;\n    }\n    if (formattedArgVal !== undefined) { // skip optional in the end\n      formattedArgs[argKey] = formattedArgVal;\n    }\n  }\n  const formattedArgsArr = Object.values(formattedArgs);\n\n  let ret;\n  if (typeof funcConfig.jsonLogic === \"function\") {\n    const fn = funcConfig.jsonLogic;\n    const args = [\n      formattedArgs,\n    ];\n    ret = fn(...args);\n  } else {\n    const funcName = funcConfig.jsonLogic || funcKey;\n    const isMethod = !!funcConfig.jsonLogicIsMethod;\n    if (isMethod) {\n      const [obj, ...params] = formattedArgsArr;\n      if (params.length) {\n        ret = { \"method\": [ obj, funcName, params ] };\n      } else {\n        ret = { \"method\": [ obj, funcName ] };\n      }\n    } else {\n      ret = { [funcName]: formattedArgsArr };\n    }\n  }\n  return ret;\n};\n\n\nconst formatField = (meta, config, field, parentField = null) => {\n  const {fieldSeparator, jsonLogic} = config.settings;\n\n  let ret;\n  if (field) {\n    if (Array.isArray(field))\n      field = field.join(fieldSeparator);\n    const fieldDef = getFieldConfig(config, field) || {};\n    let fieldName = field;\n    if (fieldDef.fieldName) {\n      fieldName = fieldDef.fieldName;\n    }\n    if (parentField) {\n      const parentFieldDef = getFieldConfig(config, parentField) || {};\n      let parentFieldName = parentField;\n      if (parentFieldDef.fieldName) {\n        parentFieldName = parentFieldDef.fieldName;\n      }\n      if (fieldName.indexOf(parentFieldName + fieldSeparator) == 0) {\n        fieldName = fieldName.slice((parentFieldName + fieldSeparator).length);\n      } else {\n        meta.errors.push(`Can't cut group ${parentFieldName} from field ${fieldName}`);\n      }\n    }\n    let varName = fieldDef.jsonLogicVar || (fieldDef.type == \"!group\" ? jsonLogic.groupVarKey : \"var\");\n    ret = { [varName] : fieldName };\n    if (meta.usedFields.indexOf(field) == -1)\n      meta.usedFields.push(field);\n  }\n  return ret;\n};\n\nconst buildFnToFormatOp = (operator, operatorDefinition, formattedField, formattedValue) => {\n  let formatteOp = operator;\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n  const isReverseArgs = defaultValue(operatorDefinition._jsonLogicIsRevArgs, false);\n  if (typeof operatorDefinition.jsonLogic == \"string\")\n    formatteOp = operatorDefinition.jsonLogic;\n  const rangeOps = [\"<\", \"<=\", \">\", \">=\"];\n  const eqOps = [\"==\", \"!=\"];\n  const fn = (field, op, val, opDef, opOpts) => {\n    if (cardinality == 0 && eqOps.includes(formatteOp))\n      return { [formatteOp]: [formattedField, null] };\n    else if (cardinality == 0)\n      return { [formatteOp]: formattedField };\n    else if (cardinality == 1 && isReverseArgs)\n      return { [formatteOp]: [formattedValue, formattedField] };\n    else if (cardinality == 1)\n      return { [formatteOp]: [formattedField, formattedValue] };\n    else if (cardinality == 2 && rangeOps.includes(formatteOp))\n      return { [formatteOp]: [formattedValue[0], formattedField, formattedValue[1]] };\n    else\n      return { [formatteOp]: [formattedField, ...formattedValue] };\n  };\n  return fn;\n};\n\nconst formatLogic = (config, properties, formattedField, formattedValue, operator, operatorOptions = null, fieldDefinition = null, isRev = false) => {\n  const field = properties.get(\"field\");\n  const operatorDefinition = getOperatorConfig(config, operator, field) || {};\n  let fn = typeof operatorDefinition.jsonLogic == \"function\" \n    ? operatorDefinition.jsonLogic \n    : buildFnToFormatOp(operator, operatorDefinition, formattedField, formattedValue);\n  const args = [\n    formattedField,\n    operator,\n    formattedValue,\n    omit(operatorDefinition, [\"formatOp\", \"mongoFormatOp\", \"sqlFormatOp\", \"jsonLogic\", \"spelFormatOp\"]),\n    operatorOptions,\n    fieldDefinition,\n  ];\n  let ruleQuery = fn(...args);\n\n  if (isRev) {\n    ruleQuery = { \"!\": ruleQuery };\n  }\n\n  return ruleQuery;\n};\n","import {defaultValue} from \"../utils/stuff\";\nimport {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig, getFuncConfig\n} from \"../utils/configUtils\";\nimport {getFieldPath, getFieldPathLabels, getWidgetForFieldOp} from \"../utils/ruleUtils\";\nimport {defaultConjunction} from \"../utils/defaultUtils\";\nimport {completeValue} from \"../utils/funcUtils\";\nimport omit from \"lodash/omit\";\nimport pick from \"lodash/pick\";\nimport {Map} from \"immutable\";\nimport {settings as defaultSettings} from \"../config/default\";\n\n\n// helpers\nconst isObject = (v) => (typeof v == \"object\" && v !== null && !Array.isArray(v));\n\nexport const mongodbFormat = (tree, config) => {\n  return _mongodbFormat(tree, config, false);\n};\n\nexport const _mongodbFormat = (tree, config, returnErrors = true) => {\n  //meta is mutable\n  let meta = {\n    errors: []\n  };\n\n  const res = formatItem([], tree, config, meta);\n\n  if (returnErrors) {\n    return [res, meta.errors];\n  } else {\n    if (meta.errors.length)\n      console.warn(\"Errors while exporting to MongoDb:\", meta.errors);\n    return res;\n  }\n};\n\n\nconst formatItem = (parents, item, config, meta, _not = false, _canWrapExpr = true, _fieldName = undefined, _value = undefined) => {\n  if (!item) return undefined;\n\n  const type = item.get(\"type\");\n\n  if ((type === \"group\" || type === \"rule_group\")) {\n    return formatGroup(parents, item, config, meta, _not, _canWrapExpr, _fieldName, _value);\n  } else if (type === \"rule\") {\n    return formatRule(parents, item, config, meta, _not, _canWrapExpr, _fieldName, _value);\n  }\n  return undefined;\n};\n\n\nconst formatGroup = (parents, item, config, meta, _not = false, _canWrapExpr = true, _fieldName = undefined, _value = undefined) => {\n  const type = item.get(\"type\");\n  const properties = item.get(\"properties\") || new Map();\n  const children = item.get(\"children1\");\n  const {canShortMongoQuery} = config.settings;\n  if (!children) return undefined;\n\n  const hasParentRuleGroup = parents.filter(it => it.get(\"type\") == \"rule_group\").length > 0;\n  const parentPath = parents\n    .filter(it => it.get(\"type\") == \"rule_group\")\n    .map(it => it.get(\"properties\").get(\"field\"))\n    .slice(-1).pop();\n  const realParentPath = hasParentRuleGroup && parentPath;\n\n  const groupField = type === \"rule_group\" ? properties.get(\"field\") : null;\n  const groupFieldName = formatFieldName(groupField, config, meta, realParentPath);\n  const groupFieldDef = getFieldConfig(config, groupField) || {};\n  const mode = groupFieldDef.mode; //properties.get(\"mode\");\n  const canHaveEmptyChildren = groupField && mode == \"array\";\n\n  const not = _not ? !(properties.get(\"not\")) : (properties.get(\"not\"));\n  const list = children\n    .map((currentChild) => formatItem(\n      [...parents, item], currentChild, config, meta, not, true, mode == \"array\" ? (f => `$$el.${f}`) : undefined)\n    )\n    .filter((currentChild) => typeof currentChild !== \"undefined\");\n  if (!canHaveEmptyChildren && !list.size)\n    return undefined;\n\n  let conjunction = properties.get(\"conjunction\");\n  if (!conjunction)\n    conjunction = defaultConjunction(config);\n  let conjunctionDefinition = config.conjunctions[conjunction];\n  const reversedConj = conjunctionDefinition.reversedConj;\n  if (not && reversedConj) {\n    conjunction = reversedConj;\n    conjunctionDefinition = config.conjunctions[conjunction];\n  }\n  const mongoConj = conjunctionDefinition.mongoConj;\n\n  let resultQuery;\n  if (list.size == 1) {\n    resultQuery = list.first();\n  } else if (list.size > 1) {\n    const rules = list.toList().toJS();\n    const canShort = canShortMongoQuery && (mongoConj == \"$and\");\n    if (canShort) {\n      resultQuery = rules.reduce((acc, rule) => {\n        if (!acc) return undefined;\n        for (let k in rule) {\n          if (k[0] == \"$\") {\n            acc = undefined;\n            break;\n          }\n          if (acc[k] == undefined) {\n            acc[k] = rule[k];\n          } else {\n            // https://github.com/ukrbublik/react-awesome-query-builder/issues/182\n            let prev = acc[k], next = rule[k];\n            if (!isObject(prev)) {\n              prev = {\"$eq\": prev};\n            }\n            if (!isObject(next)) {\n              next = {\"$eq\": next};\n            }\n            const prevOp = Object.keys(prev)[0], nextOp = Object.keys(next)[0];\n            if (prevOp == nextOp) {\n              acc = undefined;\n              break;\n            }\n            acc[k] = Object.assign({}, prev, next);\n          }\n        }\n        return acc;\n      }, {});\n    }\n    if (!resultQuery) // can't be shorten\n      resultQuery = { [mongoConj] : rules };\n  }\n\n  if (groupField) {\n    if (mode == \"array\") {\n      const totalQuery = {\n        \"$size\": groupFieldName\n      };\n      const filterQuery = resultQuery ? {\n        \"$size\": {\n          \"$filter\": {\n            input: \"$\" + groupFieldName,\n            as: \"el\",\n            cond: resultQuery\n          }\n        }\n      } : totalQuery;\n      resultQuery = formatItem(\n        parents, item.set(\"type\", \"rule\"), config, meta, false, false, (_f => filterQuery), totalQuery\n      );\n      resultQuery = { \"$expr\": resultQuery };\n    } else {\n      resultQuery = { [groupFieldName]: {\"$elemMatch\": resultQuery} };\n    }\n  }\n  return resultQuery;\n};\n\n\nconst formatRule = (parents, item, config, meta, _not = false, _canWrapExpr = true, _fieldName = undefined, _value = undefined) => {\n  const properties = item.get(\"properties\") || new Map();\n\n  const hasParentRuleGroup = parents.filter(it => it.get(\"type\") == \"rule_group\").length > 0;\n  const parentPath = parents\n    .filter(it => it.get(\"type\") == \"rule_group\")\n    .map(it => it.get(\"properties\").get(\"field\"))\n    .slice(-1).pop();\n  const realParentPath = hasParentRuleGroup && parentPath;\n\n  let operator = properties.get(\"operator\");\n  const operatorOptions = properties.get(\"operatorOptions\");\n  const field = properties.get(\"field\");\n  const iValue = properties.get(\"value\");\n  const iValueSrc = properties.get(\"valueSrc\");\n  const iValueType = properties.get(\"valueType\");\n  const asyncListValues = properties.get(\"asyncListValues\");\n\n  if (field == null || operator == null || iValue === undefined)\n    return undefined;\n\n  const fieldDef = getFieldConfig(config, field) || {};\n  let operatorDefinition = getOperatorConfig(config, operator, field) || {};\n  let reversedOp = operatorDefinition.reversedOp;\n  let revOperatorDefinition = getOperatorConfig(config, reversedOp, field) || {};\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n\n  let not = _not;\n  if (not && reversedOp) {\n    [operator, reversedOp] = [reversedOp, operator];\n    [operatorDefinition, revOperatorDefinition] = [revOperatorDefinition, operatorDefinition];\n    not = false;\n  }\n\n  const fieldName = formatFieldName(field, config, meta, realParentPath);\n\n  //format value\n  let valueSrcs = [];\n  let valueTypes = [];\n  let useExpr = false;\n  const fvalue = iValue.map((currentValue, ind) => {\n    const valueSrc = iValueSrc ? iValueSrc.get(ind) : null;\n    const valueType = iValueType ? iValueType.get(ind) : null;\n    const cValue = completeValue(currentValue, valueSrc, config);\n    const widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n    const fieldWidgetDef = omit(getFieldWidgetConfig(config, field, operator, widget, valueSrc), [\"factory\"]);\n    const [fv, fvUseExpr] = formatValue(\n      meta, config, cValue, valueSrc, valueType, fieldWidgetDef, fieldDef, realParentPath,  operator, operatorDefinition, asyncListValues\n    );\n    if (fv !== undefined) {\n      useExpr = useExpr || fvUseExpr;\n      valueSrcs.push(valueSrc);\n      valueTypes.push(valueType);\n    }\n    return fv;\n  });\n  if (_fieldName)\n    useExpr = true;\n  const wrapExpr = useExpr && _canWrapExpr;\n  const hasUndefinedValues = fvalue.filter(v => v === undefined).size > 0;\n  if (fvalue.size < cardinality || hasUndefinedValues)\n    return undefined;\n  const formattedValue = cardinality > 1 ? fvalue.toArray() : (cardinality == 1 ? fvalue.first() : null);\n  \n  //build rule\n  const fn = operatorDefinition.mongoFormatOp;\n  if (!fn) {\n    meta.errors.push(`Operator ${operator} is not supported`);\n    return undefined;\n  }\n  const args = [\n    _fieldName ? _fieldName(fieldName) : fieldName,\n    operator,\n    _value !== undefined && formattedValue == null ? _value : formattedValue,\n    useExpr,\n    (valueSrcs.length > 1 ? valueSrcs : valueSrcs[0]),\n    (valueTypes.length > 1 ? valueTypes : valueTypes[0]),\n    omit(operatorDefinition, [\"formatOp\", \"mongoFormatOp\", \"sqlFormatOp\", \"jsonLogic\", \"spelFormatOp\"]),\n    operatorOptions,\n    fieldDef,\n  ];\n  let ruleQuery = fn(...args);\n  if (wrapExpr) {\n    ruleQuery = { \"$expr\": ruleQuery };\n  }\n  if (not) {\n    ruleQuery = { \"$not\": ruleQuery };\n  }\n  return ruleQuery;\n};\n\n\nconst formatValue = (meta, config, currentValue, valueSrc, valueType, fieldWidgetDef, fieldDef, parentPath, operator, operatorDef, asyncListValues) => {\n  if (currentValue === undefined)\n    return [undefined, false];\n  \n  let ret;\n  let useExpr = false;\n\n  if (valueSrc == \"field\") {\n    [ret, useExpr] = formatRightField(meta, config, currentValue, parentPath);\n  } else if (valueSrc == \"func\") {\n    [ret, useExpr] = formatFunc(meta, config, currentValue, parentPath);\n  } else {\n    if (typeof fieldWidgetDef.mongoFormatValue === \"function\") {\n      const fn = fieldWidgetDef.mongoFormatValue;\n      const args = [\n        currentValue,\n        {\n          ...pick(fieldDef, [\"fieldSettings\", \"listValues\"]),\n          asyncListValues\n        },\n        //useful options: valueFormat for date/time\n        omit(fieldWidgetDef, [\"formatValue\", \"mongoFormatValue\", \"sqlFormatValue\", \"jsonLogic\", \"elasticSearchFormatValue\", \"spelFormatValue\"]),\n      ];\n      if (operator) {\n        args.push(operator);\n        args.push(operatorDef);\n      }\n      ret = fn(...args);\n    } else {\n      ret = currentValue;\n    }\n  }\n\n  return [ret, useExpr];\n};\n\n\n\nconst formatFieldName = (field, config, meta, parentPath) => {\n  if (!field) return;\n  const fieldDef = getFieldConfig(config, field) || {};\n  const {fieldSeparator} = config.settings;\n  const fieldParts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  let fieldName = Array.isArray(field) ? field.join(fieldSeparator) : field;\n  // if (fieldDef.tableName) { // legacy\n  //     const fieldPartsCopy = [...fieldParts];\n  //     fieldPartsCopy[0] = fieldDef.tableName;\n  //     fieldName = fieldPartsCopy.join(fieldSeparator);\n  // }\n  if (fieldDef.fieldName) {\n    fieldName = fieldDef.fieldName;\n  }\n\n  if (parentPath) {\n    const parentFieldDef = getFieldConfig(config, parentPath) || {};\n    let parentFieldName = parentPath;\n    if (parentFieldDef.fieldName) {\n      parentFieldName = parentFieldDef.fieldName;\n    }\n    if (fieldName.indexOf(parentFieldName+\".\") == 0) {\n      fieldName = fieldName.slice((parentFieldName+\".\").length);\n    } else {\n      meta.errors.push(`Can't cut group ${parentFieldName} from field ${fieldName}`);\n    }\n  }\n  return fieldName;\n};\n\nconst formatRightField = (meta, config, rightField, parentPath) => {\n  const {fieldSeparator} = config.settings;\n  let ret;\n  const useExpr = true;\n\n  if (rightField) {\n    const rightFieldDefinition = getFieldConfig(config, rightField) || {};\n    const fieldParts = Array.isArray(rightField) ? rightField : rightField.split(fieldSeparator);\n    const _fieldKeys = getFieldPath(rightField, config);\n    const fieldPartsLabels = getFieldPathLabels(rightField, config);\n    const fieldFullLabel = fieldPartsLabels ? fieldPartsLabels.join(fieldSeparator) : null;\n    const formatFieldFn = config.settings.formatField || defaultSettings.formatField;\n    const rightFieldName = formatFieldName(rightField, config, meta, parentPath);\n    const formattedField = formatFieldFn(rightFieldName, fieldParts, fieldFullLabel, rightFieldDefinition, config, false);\n    ret = \"$\" + formattedField;\n  }\n\n  return [ret, useExpr];\n};\n\n\nconst formatFunc = (meta, config, currentValue, parentPath) => {\n  const useExpr = true;\n  let ret;\n\n  const funcKey = currentValue.get(\"func\");\n  const args = currentValue.get(\"args\");\n  const funcConfig = getFuncConfig(config, funcKey);\n  const funcName = funcConfig.mongoFunc || funcKey;\n  const mongoArgsAsObject = funcConfig.mongoArgsAsObject;\n\n  let formattedArgs = {};\n  let argsCnt = 0;\n  let lastArg = undefined;\n  for (const argKey in funcConfig.args) {\n    const argConfig = funcConfig.args[argKey];\n    const fieldDef = getFieldConfig(config, argConfig);\n    const argVal = args ? args.get(argKey) : undefined;\n    const argValue = argVal ? argVal.get(\"value\") : undefined;\n    const argValueSrc = argVal ? argVal.get(\"valueSrc\") : undefined;\n    const argAsyncListValues = argVal ? argVal.get(\"asyncListValues\") : undefined;\n    const widget = getWidgetForFieldOp(config, fieldDef, null, argValueSrc);\n    const fieldWidgetDef = omit(getFieldWidgetConfig(config, fieldDef, null, widget, argValueSrc), [\"factory\"]);\n    const [formattedArgVal, _argUseExpr] = formatValue(\n      meta, config, argValue, argValueSrc, argConfig.type, fieldWidgetDef, fieldDef, parentPath, null, null, argAsyncListValues\n    );\n    if (argValue != undefined && formattedArgVal === undefined) {\n      meta.errors.push(`Can't format value of arg ${argKey} for func ${funcKey}`);\n      return [undefined, false];\n    }\n    argsCnt++;\n    if (formattedArgVal !== undefined) { // skip optional in the end\n      formattedArgs[argKey] = formattedArgVal;\n      lastArg = formattedArgVal;\n    }\n  }\n\n  if (typeof funcConfig.mongoFormatFunc === \"function\") {\n    const fn = funcConfig.mongoFormatFunc;\n    const args = [\n      formattedArgs,\n    ];\n    ret = fn(...args);\n  } else if (funcConfig.mongoFormatFunc === null) {\n    meta.errors.push(`Functon ${funcName} is not supported`);\n    return [undefined, false];\n  } else {\n    if (mongoArgsAsObject)\n      ret = { [funcName]: formattedArgs };\n    else if (argsCnt == 1 && lastArg !== undefined)\n      ret = { [funcName]: lastArg };\n    else\n      ret = { [funcName]: Object.values(formattedArgs) };\n  }\n\n  return [ret, useExpr];\n};\n\n\n","import {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig, getFuncConfig\n} from \"../utils/configUtils\";\nimport {\n  getFieldPath, getFieldPathLabels, getWidgetForFieldOp, formatFieldName\n} from \"../utils/ruleUtils\";\nimport omit from \"lodash/omit\";\nimport pick from \"lodash/pick\";\nimport {defaultValue} from \"../utils/stuff\";\nimport {defaultConjunction} from \"../utils/defaultUtils\";\nimport {settings as defaultSettings} from \"../config/default\";\nimport {completeValue} from \"../utils/funcUtils\";\nimport {Map} from \"immutable\";\nimport {SqlString} from \"../utils/export\";\n\nexport const sqlFormat = (tree, config) => {\n  return _sqlFormat(tree, config, false);\n};\n\nexport const _sqlFormat = (tree, config, returnErrors = true) => {\n  //meta is mutable\n  let meta = {\n    errors: []\n  };\n\n  const res = formatItem(tree, config, meta);\n\n  if (returnErrors) {\n    return [res, meta.errors];\n  } else {\n    if (meta.errors.length)\n      console.warn(\"Errors while exporting to SQL:\", meta.errors);\n    return res;\n  }\n};\n\n\nconst formatItem = (item, config, meta) => {\n  if (!item) return undefined;\n  const type = item.get(\"type\");\n  const children = item.get(\"children1\");\n\n  if ((type === \"group\" || type === \"rule_group\") && children && children.size) {\n    return formatGroup(item, config, meta);\n  } else if (type === \"rule\") {\n    return formatRule(item, config, meta);\n  }\n\n  return undefined;\n};\n\n\nconst formatGroup = (item, config, meta) => {\n  const type = item.get(\"type\");\n  const properties = item.get(\"properties\") || new Map();\n  const children = item.get(\"children1\");\n\n  const groupField = type === \"rule_group\" ? properties.get(\"field\") : null;\n  const groupFieldDef = getFieldConfig(config, groupField) || {};\n  if (groupFieldDef.mode == \"array\") {\n    meta.errors.push(`Aggregation is not supported for ${groupField}`);\n  }\n\n  const not = properties.get(\"not\");\n  const list = children\n    .map((currentChild) => formatItem(currentChild, config, meta))\n    .filter((currentChild) => typeof currentChild !== \"undefined\");\n  if (!list.size)\n    return undefined;\n\n  let conjunction = properties.get(\"conjunction\");\n  if (!conjunction)\n    conjunction = defaultConjunction(config);\n  const conjunctionDefinition = config.conjunctions[conjunction];\n\n  return conjunctionDefinition.sqlFormatConj(list, conjunction, not);\n};\n\nconst buildFnToFormatOp = (operator, operatorDefinition) => {\n  const sqlOp = operatorDefinition.sqlOp || operator;\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n  let fn;\n  if (cardinality == 0) {\n    fn = (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      return `${field} ${sqlOp}`;\n    };\n  } else if (cardinality == 1) {\n    fn = (field, op, value, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      return `${field} ${sqlOp} ${value}`;\n    };\n  } else if (cardinality == 2) {\n    // between\n    fn = (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      const valFrom = values.first();\n      const valTo = values.get(1);\n      return `${field} ${sqlOp} ${valFrom} AND ${valTo}`;\n    };\n  }\n  return fn;\n};\n\nconst formatRule = (item, config, meta) => {\n  const properties = item.get(\"properties\") || new Map();\n  const field = properties.get(\"field\");\n  let operator = properties.get(\"operator\");\n  const operatorOptions = properties.get(\"operatorOptions\");\n  const iValueSrc = properties.get(\"valueSrc\");\n  const iValueType = properties.get(\"valueType\");\n  const iValue = properties.get(\"value\");\n  const asyncListValues = properties.get(\"asyncListValues\");\n  if (field == null || operator == null)\n    return undefined;\n\n  const fieldDefinition = getFieldConfig(config, field) || {};\n  let opDef = getOperatorConfig(config, operator, field) || {};\n  let reversedOp = opDef.reversedOp;\n  let revOpDef = getOperatorConfig(config, reversedOp, field) || {};\n  const cardinality = defaultValue(opDef.cardinality, 1);\n\n  // check op\n  let isRev = false;\n  const canFormatOp = opDef.sqlOp || opDef.sqlFormatOp;\n  const canFormatRevOp = revOpDef.sqlOp || revOpDef.sqlFormatOp;\n  if (!canFormatOp && !canFormatRevOp) {\n    meta.errors.push(`Operator ${operator} is not supported`);\n    return undefined;\n  }\n  if (!canFormatRevOp && canFormatRevOp) {\n    isRev = true;\n    [operator, reversedOp] = [reversedOp, operator];\n    [opDef, revOpDef] = [revOpDef, opDef];\n  }\n\n  //format value\n  let valueSrcs = [];\n  let valueTypes = [];\n  const fvalue = iValue.map((currentValue, ind) => {\n    const valueSrc = iValueSrc ? iValueSrc.get(ind) : null;\n    const valueType = iValueType ? iValueType.get(ind) : null;\n    const cValue = completeValue(currentValue, valueSrc, config);\n    const widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n    const fieldWidgetDefinition = omit(getFieldWidgetConfig(config, field, operator, widget, valueSrc), [\"factory\"]);\n    let fv = formatValue(\n      meta, config, cValue, valueSrc, valueType, fieldWidgetDefinition, fieldDefinition, operator, opDef, asyncListValues\n    );\n    if (fv !== undefined) {\n      valueSrcs.push(valueSrc);\n      valueTypes.push(valueType);\n    }\n    return fv;\n  });\n  const hasUndefinedValues = fvalue.filter(v => v === undefined).size > 0;\n  if (hasUndefinedValues || fvalue.size < cardinality)\n    return undefined;\n  const formattedValue = (cardinality == 1 ? fvalue.first() : fvalue);\n\n  //find fn to format expr\n  const fn = opDef.sqlFormatOp || buildFnToFormatOp(operator, opDef);\n  if (!fn) {\n    meta.errors.push(`Operator ${operator} is not supported`);\n    return undefined;\n  }\n      \n  //format field\n  const formattedField = formatField(meta, config, field);\n      \n  //format expr\n  const args = [\n    formattedField,\n    operator,\n    formattedValue,\n    (valueSrcs.length > 1 ? valueSrcs : valueSrcs[0]),\n    (valueTypes.length > 1 ? valueTypes : valueTypes[0]),\n    omit(opDef, [\"formatOp\", \"mongoFormatOp\", \"sqlFormatOp\", \"jsonLogic\", \"spelFormatOp\"]),\n    operatorOptions,\n    fieldDefinition,\n  ];\n\n  let ret;\n  ret = fn(...args);\n  if (isRev) {\n    ret = config.settings.sqlFormatReverse(ret);\n  }\n  if (ret === undefined) {\n    meta.errors.push(`Operator ${operator} is not supported for value source ${valueSrcs.join(\", \")}`);\n    return undefined;\n  }\n  return ret;\n};\n\n\nconst formatValue = (meta, config, currentValue, valueSrc, valueType, fieldWidgetDef, fieldDef, operator, operatorDef, asyncListValues) => {\n  if (currentValue === undefined)\n    return undefined;\n  let ret;\n  if (valueSrc == \"field\") {\n    ret = formatField(meta, config, currentValue);\n  } else if (valueSrc == \"func\") {\n    ret = formatFunc(meta, config, currentValue);\n  } else {\n    if (typeof fieldWidgetDef.sqlFormatValue === \"function\") {\n      const fn = fieldWidgetDef.sqlFormatValue;\n      const args = [\n        currentValue,\n        {\n          ...pick(fieldDef, [\"fieldSettings\", \"listValues\"]),\n          asyncListValues\n        },\n        //useful options: valueFormat for date/time\n        omit(fieldWidgetDef, [\"formatValue\", \"mongoFormatValue\", \"sqlFormatValue\", \"jsonLogic\", \"elasticSearchFormatValue\", \"spelFormatValue\"]),\n      ];\n      if (operator) {\n        args.push(operator);\n        args.push(operatorDef);\n      }\n      if (valueSrc == \"field\") {\n        const valFieldDefinition = getFieldConfig(config, currentValue) || {}; \n        args.push(valFieldDefinition);\n      }\n      ret = fn(...args);\n    } else {\n      if (Array.isArray(currentValue)) {\n        ret = currentValue.map(v => SqlString.escape(v));\n      } else {\n        ret = SqlString.escape(currentValue);\n      }\n    }\n  }\n  return ret;\n};\n\nconst formatField = (meta, config, field) => {\n  if (!field) return;\n  const {fieldSeparator} = config.settings;\n  const fieldDefinition = getFieldConfig(config, field) || {};\n  const fieldParts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  const _fieldKeys = getFieldPath(field, config);\n  const fieldPartsLabels = getFieldPathLabels(field, config);\n  const fieldFullLabel = fieldPartsLabels ? fieldPartsLabels.join(fieldSeparator) : null;\n  const formatFieldFn = config.settings.formatField || defaultSettings.formatField;\n  const fieldName = formatFieldName(field, config, meta);\n  const formattedField = formatFieldFn(fieldName, fieldParts, fieldFullLabel, fieldDefinition, config);\n  return formattedField;\n};\n\n\nconst formatFunc = (meta, config, currentValue) => {\n  const funcKey = currentValue.get(\"func\");\n  const args = currentValue.get(\"args\");\n  const funcConfig = getFuncConfig(config, funcKey);\n  const funcName = funcConfig.sqlFunc || funcKey;\n\n  let formattedArgs = {};\n  for (const argKey in funcConfig.args) {\n    const argConfig = funcConfig.args[argKey];\n    const fieldDef = getFieldConfig(config, argConfig);\n    const argVal = args ? args.get(argKey) : undefined;\n    const argValue = argVal ? argVal.get(\"value\") : undefined;\n    const argValueSrc = argVal ? argVal.get(\"valueSrc\") : undefined;\n    const argAsyncListValues = argVal ? argVal.get(\"asyncListValues\") : undefined;\n    const formattedArgVal = formatValue(\n      meta, config, argValue, argValueSrc, argConfig.type, fieldDef, argConfig, null, null, argAsyncListValues\n    );\n    if (argValue != undefined && formattedArgVal === undefined) {\n      meta.errors.push(`Can't format value of arg ${argKey} for func ${funcKey}`);\n      return undefined;\n    }\n    if (formattedArgVal !== undefined) { // skip optional in the end\n      formattedArgs[argKey] = formattedArgVal;\n    }\n  }\n\n  let ret;\n  if (typeof funcConfig.sqlFormatFunc === \"function\") {\n    const fn = funcConfig.sqlFormatFunc;\n    const args = [\n      formattedArgs\n    ];\n    ret = fn(...args);\n  } else {\n    const argsStr = Object.entries(formattedArgs)\n      .map(([k, v]) => v)\n      .join(\", \");\n    ret = `${funcName}(${argsStr})`;\n  }\n  return ret;\n};\n","import {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig, getFuncConfig\n} from \"../utils/configUtils\";\nimport {\n  getFieldPath, getWidgetForFieldOp, formatFieldName, getFieldPartsConfigs\n} from \"../utils/ruleUtils\";\nimport omit from \"lodash/omit\";\nimport pick from \"lodash/pick\";\nimport {defaultValue, logger} from \"../utils/stuff\";\nimport {defaultConjunction} from \"../utils/defaultUtils\";\nimport {settings as defaultSettings} from \"../config/default\";\nimport {completeValue} from \"../utils/funcUtils\";\nimport {Map} from \"immutable\";\nimport {spelEscape} from \"../utils/export\";\n\nexport const spelFormat = (tree, config) => {\n  return _spelFormat(tree, config, false);\n};\n\nexport const _spelFormat = (tree, config, returnErrors = true) => {\n  //meta is mutable\n  let meta = {\n    errors: []\n  };\n\n  const res = formatItem(tree, config, meta, null);\n\n  if (returnErrors) {\n    return [res, meta.errors];\n  } else {\n    if (meta.errors.length)\n      console.warn(\"Errors while exporting to SpEL:\", meta.errors);\n    return res;\n  }\n};\n\n\nconst formatItem = (item, config, meta, parentField = null) => {\n  if (!item) return undefined;\n  const type = item.get(\"type\");\n\n  if ((type === \"group\" || type === \"rule_group\")) {\n    return formatGroup(item, config, meta, parentField);\n  } else if (type === \"rule\") {\n    return formatRule(item, config, meta, parentField);\n  } else if (type == \"switch_group\") {\n    return formatSwitch(item, config, meta, parentField);\n  } else if (type == \"case_group\") {\n    return formatCase(item, config, meta, parentField);\n  }\n\n  return undefined;\n};\n\nconst formatCase = (item, config, meta, parentField = null) => {\n  const type = item.get(\"type\");\n  if (type != \"case_group\") {\n    meta.errors.push(`Unexpected child of type ${type} inside switch`);\n    return undefined;\n  }\n  const properties = item.get(\"properties\") || new Map();\n  \n  const [formattedValue, valueSrc, valueType] = formatItemValue(\n    config, properties, meta, null, parentField, \"!case_value\"\n  );\n\n  const cond = formatGroup(item, config, meta, parentField);\n  return [cond, formattedValue];\n};\n\nconst formatSwitch = (item, config, meta, parentField = null) => {\n  const properties = item.get(\"properties\") || new Map();\n  const children = item.get(\"children1\");\n  if (!children) return undefined;\n  const cases = children\n    .map((currentChild) => formatCase(currentChild, config, meta, null))\n    .filter((currentChild) => typeof currentChild !== \"undefined\")\n    .toArray();\n  \n  if (!cases.length) return undefined;\n\n  if (cases.length == 1 && !cases[0][0]) {\n    // only 1 case without condition\n    return cases[0][1];\n  }\n\n  let filteredCases = [];\n  for (let i = 0 ; i < cases.length ; i++) {\n    if (i != (cases.length - 1) && !cases[i][0]) {\n      meta.errors.push(`No condition for case ${i}`);\n    } else {\n      filteredCases.push(cases[i]);\n      if (i == (cases.length - 1) && cases[i][0]) {\n        // no default - add null as default\n        filteredCases.push([undefined, null]);\n      }\n    }\n  }\n\n  let left = \"\", right = \"\";\n  for (let i = 0 ; i < filteredCases.length ; i++) {\n    let [cond, value] = filteredCases[i];\n    if (value == undefined)\n      value = \"null\";\n    if (cond == undefined)\n      cond = \"true\";\n    if (i != (filteredCases.length - 1)) {\n      left += `(${cond} ? ${value} : `;\n      right += \")\";\n    } else {\n      left += `${value}`;\n    }\n  }\n  return left + right;\n};\n\nconst formatGroup = (item, config, meta, parentField = null) => {\n  const type = item.get(\"type\");\n  const properties = item.get(\"properties\") || new Map();\n  const mode = properties.get(\"mode\");\n  const children = item.get(\"children1\");\n  const field = properties.get(\"field\");\n  if (!children) return undefined;\n\n  let conjunction = properties.get(\"conjunction\");\n  if (!conjunction)\n    conjunction = defaultConjunction(config);\n  const conjunctionDefinition = config.conjunctions[conjunction];\n  const not = properties.get(\"not\");\n\n  const isRuleGroup = type === \"rule_group\";\n  const isRuleGroupArray = isRuleGroup && mode != \"struct\";\n  const groupField = isRuleGroupArray ? field : parentField;\n  const groupFieldDef = getFieldConfig(config, groupField) || {};\n  const isSpelArray = groupFieldDef.isSpelArray;\n  \n  // check op for reverse\n  let groupOperator = properties.get(\"operator\");\n  if (!groupOperator && (!mode || mode == \"some\")) {\n    groupOperator = \"some\";\n  }\n  const realGroupOperator = checkOp(config, groupOperator, field);\n  const isGroupOpRev = realGroupOperator != groupOperator;\n  const realGroupOperatorDefinition = groupOperator && getOperatorConfig(config, realGroupOperator, field) || null;\n  const isGroup0 = isRuleGroup && (!realGroupOperator || realGroupOperatorDefinition.cardinality == 0);\n  \n  // build value for aggregation op\n  const [formattedValue, valueSrc, valueType] = formatItemValue(\n    config, properties, meta, realGroupOperator, parentField, null\n  );\n  \n  // build filter in aggregation\n  const list = children\n    .map((currentChild) => formatItem(currentChild, config, meta, groupField))\n    .filter((currentChild) => typeof currentChild !== \"undefined\");\n\n  if (isRuleGroupArray && !isGroup0) {\n    // \"count\" rule can have no \"having\" children, but should have number value\n    if (formattedValue == undefined)\n      return undefined;\n  } else {\n    if (!list.size)\n      return undefined;\n  }\n\n  const omitBrackets = isRuleGroup;\n  const filter = list.size ? conjunctionDefinition.spelFormatConj(list, conjunction, not, omitBrackets) : null;\n\n  // build result\n  let ret;\n  if (isRuleGroupArray) {\n    const formattedField = formatField(meta, config, field, parentField);\n    const getSize = isSpelArray ? \".length\" : \".size()\";\n    const fullSize = `${formattedField}${getSize}`;\n    // https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/expressions.html#expressions-collection-selection\n    const filteredSize = filter ? `${formattedField}.?[${filter}]${getSize}` : fullSize;\n    const groupValue = isGroup0 ? fullSize : formattedValue;\n    // format expression\n    ret = formatExpression(\n      meta, config, properties, filteredSize, groupValue, realGroupOperator, valueSrc, valueType, isGroupOpRev\n    );\n  } else {\n    ret = filter;\n  }\n  \n  return ret;\n};\n\nconst buildFnToFormatOp = (operator, operatorDefinition) => {\n  const spelOp = operatorDefinition.spelOp;\n  if (!spelOp) return undefined;\n  const objectIsFirstArg = spelOp[0] == \"$\";\n  const isMethod = spelOp[0] == \".\" || objectIsFirstArg;\n  const sop = isMethod ? spelOp.slice(1) : spelOp;\n  let fn;\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n  if (cardinality == 0) {\n    fn = (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      if (isMethod)\n        return `${field}.${sop}()`;\n      else\n        return `${field} ${sop}`;\n    };\n  } else if (cardinality == 1) {\n    fn = (field, op, values, valueSrc, valueType, opDef, operatorOptions, fieldDef) => {\n      if (objectIsFirstArg)\n        return `${values}.${sop}(${field})`;\n      else if (isMethod)\n        return `${field}.${sop}(${values})`;\n      else\n        return `${field} ${sop} ${values}`;\n    };\n  }\n  return fn;\n};\n\nconst formatExpression = (meta, config, properties, formattedField, formattedValue, operator, valueSrc, valueType, isRev = false) => {\n  const field = properties.get(\"field\");\n  const opDef = getOperatorConfig(config, operator, field) || {};\n  const fieldDef = getFieldConfig(config, field) || {};\n  const operatorOptions = properties.get(\"operatorOptions\");\n\n  //find fn to format expr\n  const fn = opDef.spelFormatOp || buildFnToFormatOp(operator, opDef);\n  if (!fn) {\n    meta.errors.push(`Operator ${operator} is not supported`);\n    return undefined;\n  }\n\n  //format expr\n  const args = [\n    formattedField,\n    operator,\n    formattedValue,\n    valueSrc,\n    valueType,\n    omit(opDef, [\"formatOp\", \"mongoFormatOp\", \"sqlFormatOp\", \"jsonLogic\", \"spelFormatOp\"]),\n    operatorOptions,\n    fieldDef,\n  ];\n  let ret;\n  ret = fn(...args);\n\n  //rev\n  if (isRev) {\n    ret = config.settings.spelFormatReverse(ret);\n  }\n\n  if (ret === undefined) {\n    meta.errors.push(`Operator ${operator} is not supported for value source ${valueSrc}`);\n  }\n\n  return ret;\n};\n\nconst checkOp = (config, operator, field) => {\n  if (!operator) return undefined;\n  let opDef = getOperatorConfig(config, operator, field) || {};\n  let reversedOp = opDef.reversedOp;\n  let revOpDef = getOperatorConfig(config, reversedOp, field) || {};\n\n  let isRev = false;\n  const canFormatOp = opDef.spelOp || opDef.spelFormatOp;\n  const canFormatRevOp = revOpDef.spelOp || revOpDef.spelFormatOp;\n  if (!canFormatOp && !canFormatRevOp) {\n    return undefined;\n  }\n  if (!canFormatOp && canFormatRevOp) {\n    isRev = true;\n    [operator, reversedOp] = [reversedOp, operator];\n    [opDef, revOpDef] = [revOpDef, opDef];\n  }\n  return operator;\n};\n\nconst formatRule = (item, config, meta, parentField = null) => {\n  const properties = item.get(\"properties\") || new Map();\n  const field = properties.get(\"field\");\n  let operator = properties.get(\"operator\");\n  if (field == null || operator == null)\n    return undefined;\n\n  // check op for reverse\n  const realOp = checkOp(config, operator, field);\n  if (!realOp) {\n    meta.errors.push(`Operator ${operator} is not supported`);\n    return undefined;\n  }\n  const isRev = realOp != operator;\n\n  //format value\n  const [formattedValue, valueSrc, valueType] = formatItemValue(\n    config, properties, meta, realOp, parentField, null\n  );\n  if (formattedValue === undefined)\n    return undefined;\n      \n  //format field\n  const formattedField = formatField(meta, config, field, parentField);\n  \n  // format expression\n  let res = formatExpression(\n    meta, config, properties, formattedField, formattedValue, realOp, valueSrc, valueType, isRev\n  );\n  return res;\n};\n\nconst formatItemValue = (config, properties, meta, operator, parentField, expectedValueType = null) => {\n  let field = properties.get(\"field\");\n  const iValueSrc = properties.get(\"valueSrc\");\n  const iValueType = properties.get(\"valueType\");\n  if (expectedValueType == \"!case_value\" || iValueType && iValueType.get(0) == \"case_value\") {\n    field = \"!case_value\";\n  }\n  const fieldDef = getFieldConfig(config, field) || {};\n  const operatorDefinition = getOperatorConfig(config, operator, field) || {};\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n  const iValue = properties.get(\"value\");\n  const asyncListValues = properties.get(\"asyncListValues\");\n  \n  let valueSrcs = [];\n  let valueTypes = [];\n  let formattedValue;\n  \n  if (iValue != undefined) {\n    const fvalue = iValue.map((currentValue, ind) => {\n      const valueSrc = iValueSrc ? iValueSrc.get(ind) : null;\n      const valueType = iValueType ? iValueType.get(ind) : null;\n      const cValue = completeValue(currentValue, valueSrc, config);\n      const widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n      const fieldWidgetDef = omit(getFieldWidgetConfig(config, field, operator, widget, valueSrc), [\"factory\"]);\n      const fv = formatValue(\n        meta, config, cValue, valueSrc, valueType, fieldWidgetDef, fieldDef, operator, operatorDefinition, parentField, asyncListValues\n      );\n      if (fv !== undefined) {\n        valueSrcs.push(valueSrc);\n        valueTypes.push(valueType);\n      }\n      return fv;\n    });\n    const hasUndefinedValues = fvalue.filter(v => v === undefined).size > 0;\n    if (!( fvalue.size < cardinality || hasUndefinedValues )) {\n      formattedValue = cardinality > 1 ? fvalue.toArray() : (cardinality == 1 ? fvalue.first() : null);\n    }\n  }\n  \n  return [\n    formattedValue, \n    (valueSrcs.length > 1 ? valueSrcs : valueSrcs[0]),\n    (valueTypes.length > 1 ? valueTypes : valueTypes[0]),\n  ];\n};\n\nconst formatValue = (meta, config, currentValue, valueSrc, valueType, fieldWidgetDef, fieldDef, operator, operatorDef, parentField = null, asyncListValues) => {\n  if (currentValue === undefined)\n    return undefined;\n  let ret;\n  if (valueSrc == \"field\") {\n    ret = formatField(meta, config, currentValue, parentField);\n  } else if (valueSrc == \"func\") {\n    ret = formatFunc(meta, config, currentValue, parentField);\n  } else {\n    if (typeof fieldWidgetDef.spelFormatValue === \"function\") {\n      const fn = fieldWidgetDef.spelFormatValue;\n      const args = [\n        currentValue,\n        {\n          ...pick(fieldDef, [\"fieldSettings\", \"listValues\"]),\n          asyncListValues\n        },\n        //useful options: valueFormat for date/time\n        omit(fieldWidgetDef, [\"formatValue\", \"mongoFormatValue\", \"sqlFormatValue\", \"jsonLogic\", \"elasticSearchFormatValue\", \"spelFormatValue\"]),\n      ];\n      if (operator) {\n        args.push(operator);\n        args.push(operatorDef);\n      }\n      if (valueSrc == \"field\") {\n        const valFieldDefinition = getFieldConfig(config, currentValue) || {}; \n        args.push(valFieldDefinition);\n      }\n      ret = fn(...args);\n    } else {\n      ret = spelEscape(currentValue);\n    }\n  }\n  return ret;\n};\n\nconst formatField = (meta, config, field, parentField = null) => {\n  if (!field) return;\n  const {fieldSeparator} = config.settings;\n  const fieldDefinition = getFieldConfig(config, field) || {};\n  const fieldParts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  const _fieldKeys = getFieldPath(field, config, parentField);\n  const fieldPartsConfigs = getFieldPartsConfigs(field, config, parentField);\n  const formatFieldFn = config.settings.formatSpelField;\n  let fieldName = formatFieldName(field, config, meta);\n  if (parentField) {\n    const parentFieldDef = getFieldConfig(config, parentField) || {};\n    let parentFieldName = parentField;\n    if (parentFieldDef.fieldName) {\n      parentFieldName = parentFieldDef.fieldName;\n    }\n    if (fieldName.indexOf(parentFieldName + fieldSeparator) == 0) {\n      fieldName = fieldName.slice((parentFieldName + fieldSeparator).length);\n      // fieldName = \"#this.\" + fieldName;\n    } else {\n      meta.errors.push(`Can't cut group ${parentFieldName} from field ${fieldName}`);\n    }\n  }\n  const fieldPartsMeta = fieldPartsConfigs.map(([key, cnf, parentCnf]) => {\n    let parent;\n    if (parentCnf) {\n      if (parentCnf.type == \"!struct\" || parentCnf.type == \"!group\" && parentCnf.mode == \"struct\")\n        parent = cnf.isSpelMap ? \"map\" : \"class\";\n      else if (parentCnf.type == \"!group\")\n        parent = cnf.isSpelItemMap ? \"[map]\" : \"[class]\";\n      else\n        parent = \"class\";\n    }\n    const isSpelVariable = cnf?.isSpelVariable;\n    return {\n      key,\n      parent,\n      isSpelVariable\n    };\n  });\n  const formattedField = formatFieldFn(fieldName, parentField, fieldParts, fieldPartsMeta, fieldDefinition, config);\n  return formattedField;\n};\n\n\nconst formatFunc = (meta, config, currentValue, parentField = null) => {\n  const funcKey = currentValue.get(\"func\");\n  const args = currentValue.get(\"args\");\n  const funcConfig = getFuncConfig(config, funcKey);\n  const funcName = funcConfig.spelFunc || funcKey;\n\n  let formattedArgs = {};\n  for (const argKey in funcConfig.args) {\n    const argConfig = funcConfig.args[argKey];\n    const fieldDef = getFieldConfig(config, argConfig);\n    const argVal = args ? args.get(argKey) : undefined;\n    const argValue = argVal ? argVal.get(\"value\") : undefined;\n    const argValueSrc = argVal ? argVal.get(\"valueSrc\") : undefined;\n    const argAsyncListValues = argVal ? argVal.get(\"asyncListValues\") : undefined;\n    const formattedArgVal = formatValue(\n      meta, config, argValue, argValueSrc, argConfig.type, fieldDef, argConfig, null, null, parentField, argAsyncListValues\n    );\n    if (argValue != undefined && formattedArgVal === undefined) {\n      meta.errors.push(`Can't format value of arg ${argKey} for func ${funcKey}`);\n      return undefined;\n    }\n    if (formattedArgVal !== undefined) { // skip optional in the end\n      formattedArgs[argKey] = formattedArgVal;\n    }\n  }\n\n  let ret;\n  if (typeof funcConfig.spelFormatFunc === \"function\") {\n    const fn = funcConfig.spelFormatFunc;\n    const args = [\n      formattedArgs\n    ];\n    ret = fn(...args);\n  } else {\n    const args = Object.entries(formattedArgs).map(([k, v]) => v);\n    if (funcName[0] == \".\" && args.length) {\n      const [obj, ...params] = args;\n      ret = `${obj}${funcName}(${params.join(\", \")})`;\n    } else {\n      ret = `${funcName}(${args.join(\", \")})`;\n    }\n  }\n  return ret;\n};\n","import {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig, getFuncConfig\n} from \"../utils/configUtils\";\nimport {\n  getFieldPath, getFieldPathLabels, getWidgetForFieldOp, formatFieldName\n} from \"../utils/ruleUtils\";\nimport omit from \"lodash/omit\";\nimport pick from \"lodash/pick\";\nimport {defaultValue} from \"../utils/stuff\";\nimport {defaultConjunction} from \"../utils/defaultUtils\";\nimport {settings as defaultSettings} from \"../config/default\";\nimport {completeValue} from \"../utils/funcUtils\";\nimport {Map} from \"immutable\";\n\n\nexport const queryString = (item, config, isForDisplay = false) => {\n  //meta is mutable\n  let meta = {\n    errors: []\n  };\n\n  const res = formatItem(item, config, meta, isForDisplay, null);\n\n  if (meta.errors.length)\n    console.warn(\"Errors while exporting to string:\", meta.errors);\n  return res;\n};\n\n\nconst formatItem = (item, config, meta, isForDisplay = false, parentField = null) => {\n  if (!item) return undefined;\n  const type = item.get(\"type\");\n  const children = item.get(\"children1\");\n\n  if ((type === \"group\" || type === \"rule_group\") ) {\n    return formatGroup(item, config, meta, isForDisplay, parentField);\n  } else if (type === \"rule\") {\n    return formatRule(item, config, meta, isForDisplay, parentField);\n  }\n\n  return undefined;\n};\n\n\nconst formatGroup = (item, config, meta, isForDisplay = false, parentField = null) => {\n  const type = item.get(\"type\");\n  const properties = item.get(\"properties\") || new Map();\n  const mode = properties.get(\"mode\");\n  const children = item.get(\"children1\");\n  if (!children) return undefined;\n\n  const isRuleGroup = (type === \"rule_group\");\n  // TIP: don't cut group for mode == 'struct' and don't do aggr format (maybe later)\n  const groupField = isRuleGroup && mode == \"array\" ? properties.get(\"field\") : null;\n  const canHaveEmptyChildren = isRuleGroup && mode == \"array\";\n  const not = properties.get(\"not\");\n  const list = children\n    .map((currentChild) => formatItem(currentChild, config, meta, isForDisplay, groupField))\n    .filter((currentChild) => typeof currentChild !== \"undefined\");\n  if (!canHaveEmptyChildren && !list.size)\n    return undefined;\n\n  let conjunction = properties.get(\"conjunction\");\n  if (!conjunction)\n    conjunction = defaultConjunction(config);\n  const conjunctionDefinition = config.conjunctions[conjunction];\n\n  const conjStr = list.size ? conjunctionDefinition.formatConj(list, conjunction, not, isForDisplay) : null;\n  \n  let ret;\n  if (groupField) {\n    const aggrArgs = formatRule(item, config, meta, isForDisplay, parentField, true);\n    if (aggrArgs) {\n      const isRev = aggrArgs.pop();\n      const args = [\n        conjStr,\n        ...aggrArgs\n      ];\n      ret = config.settings.formatAggr(...args);\n      if (isRev) {\n        ret = config.settings.formatReverse(ret, null, null, null, null, isForDisplay);\n      }\n    }\n  } else {\n    ret = conjStr;\n  }\n\n  return ret;\n};\n\n\nconst formatItemValue = (config, properties, meta, _operator, isForDisplay, parentField) => {\n  const field = properties.get(\"field\");\n  const iValueSrc = properties.get(\"valueSrc\");\n  const iValueType = properties.get(\"valueType\");\n  const fieldDef = getFieldConfig(config, field) || {};\n  const operator = _operator || properties.get(\"operator\");\n  const operatorDef = getOperatorConfig(config, operator, field) || {};\n  const cardinality = defaultValue(operatorDef.cardinality, 1);\n  const iValue = properties.get(\"value\");\n  const asyncListValues = properties.get(\"asyncListValues\");\n\n  let valueSrcs = [];\n  let valueTypes = [];\n  let formattedValue;\n\n  if (iValue != undefined) {\n    const fvalue = iValue.map((currentValue, ind) => {\n      const valueSrc = iValueSrc ? iValueSrc.get(ind) : null;\n      const valueType = iValueType ? iValueType.get(ind) : null;\n      const cValue = completeValue(currentValue, valueSrc, config);\n      const widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n      const fieldWidgetDef = omit(getFieldWidgetConfig(config, field, operator, widget, valueSrc), [\"factory\"]);\n      let fv = formatValue(\n        config, meta, cValue, valueSrc, valueType, fieldWidgetDef, fieldDef, operator, operatorDef, isForDisplay, parentField, asyncListValues\n      );\n      if (fv !== undefined) {\n        valueSrcs.push(valueSrc);\n        valueTypes.push(valueType);\n      }\n      return fv;\n    });\n    const hasUndefinedValues = fvalue.filter(v => v === undefined).size > 0;\n    if (!( hasUndefinedValues || fvalue.size < cardinality )) {\n      formattedValue = (cardinality == 1 ? fvalue.first() : fvalue);\n    }\n  }\n\n  return [\n    formattedValue, \n    (valueSrcs.length > 1 ? valueSrcs : valueSrcs[0]),\n    (valueTypes.length > 1 ? valueTypes : valueTypes[0]),\n  ];\n};\n\nconst buildFnToFormatOp = (operator, operatorDefinition) => {\n  const fop = operatorDefinition.labelForFormat || operator;\n  const cardinality = defaultValue(operatorDefinition.cardinality, 1);\n  let fn;\n  if (cardinality == 0) {\n    fn = (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      return `${field} ${fop}`;\n    };\n  } else if (cardinality == 1) {\n    fn = (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      return `${field} ${fop} ${values}`;\n    };\n  } else if (cardinality == 2) {\n    // between\n    fn = (field, op, values, valueSrc, valueType, opDef, operatorOptions, isForDisplay) => {\n      const valFrom = values.first();\n      const valTo = values.get(1);\n      return `${field} ${fop} ${valFrom} AND ${valTo}`;\n    };\n  }\n  return fn;\n};\n\nconst formatRule = (item, config, meta, isForDisplay = false, parentField = null, returnArgs = false) => {\n  const properties = item.get(\"properties\") || new Map();\n  const field = properties.get(\"field\");\n  let operator = properties.get(\"operator\");\n  let operatorOptions = properties.get(\"operatorOptions\");\n  if (field == null || operator == null)\n    return undefined;\n  \n  const fieldDef = getFieldConfig(config, field) || {};\n  let operatorDef = getOperatorConfig(config, operator, field) || {};\n  let reversedOp = operatorDef.reversedOp;\n  let revOperatorDef = getOperatorConfig(config, reversedOp, field) || {};\n  \n  //check op\n  let isRev = false;\n  let fn = operatorDef.formatOp;\n  if (!fn && reversedOp) {\n    fn = revOperatorDef.formatOp;\n    if (fn) {\n      isRev = true;\n      [operator, reversedOp] = [reversedOp, operator];\n      [operatorDef, revOperatorDef] = [revOperatorDef, operatorDef];\n    }\n  }\n\n  //find fn to format expr\n  if (!fn)\n    fn = buildFnToFormatOp(operator, operatorDef);\n  if (!fn)\n    return undefined;\n\n  //format field\n  const formattedField = formatField(config, meta, field, isForDisplay, parentField);\n\n  //format value\n  const [formattedValue, valueSrc, valueType] = formatItemValue(\n    config, properties, meta, operator, isForDisplay, parentField\n  );\n  if (formattedValue === undefined)\n    return undefined;\n\n  const args = [\n    formattedField,\n    operator,\n    formattedValue,\n    valueSrc,\n    valueType,\n    omit(operatorDef, [\"formatOp\", \"mongoFormatOp\", \"sqlFormatOp\", \"jsonLogic\", \"spelFormatOp\"]),\n    operatorOptions,\n    isForDisplay,\n    fieldDef,\n    isRev,\n  ];\n\n  if (returnArgs) {\n    return args;\n  } else {\n    //format expr\n    let ret = fn(...args);\n\n    //rev\n    if (isRev) {\n      ret = config.settings.formatReverse(ret, operator, reversedOp, operatorDef, revOperatorDef, isForDisplay);\n    }\n\n    return ret;\n  }\n};\n\n\nconst formatValue = (config, meta, value, valueSrc, valueType, fieldWidgetDef, fieldDef, operator, opDef, isForDisplay, parentField = null, asyncListValues) => {\n  if (value === undefined)\n    return undefined;\n  let ret;\n  if (valueSrc == \"field\") {\n    ret = formatField(config, meta, value, isForDisplay, parentField);\n  } else if (valueSrc == \"func\") {\n    ret = formatFunc(config, meta, value, isForDisplay, parentField);\n  } else {\n    if (typeof fieldWidgetDef.formatValue === \"function\") {\n      const fn = fieldWidgetDef.formatValue;\n      const args = [\n        value,\n        {\n          ...pick(fieldDef, [\"fieldSettings\", \"listValues\"]),\n          asyncListValues\n        },\n        //useful options: valueFormat for date/time\n        omit(fieldWidgetDef, [\"formatValue\", \"mongoFormatValue\", \"sqlFormatValue\", \"jsonLogic\", \"elasticSearchFormatValue\", \"spelFormatValue\"]),\n        isForDisplay\n      ];\n      if (operator) {\n        args.push(operator);\n        args.push(opDef);\n      }\n      if (valueSrc == \"field\") {\n        const valFieldDefinition = getFieldConfig(config, value) || {}; \n        args.push(valFieldDefinition);\n      }\n      ret = fn(...args);\n    } else {\n      ret = value;\n    }\n  }\n  return ret;\n};\n\n\nconst formatField = (config, meta, field, isForDisplay, parentField = null, cutParentField = true) => {\n  const {fieldSeparator, fieldSeparatorDisplay} = config.settings;\n  let ret = null;\n  if (field) {\n    const fieldDefinition = getFieldConfig(config, field) || {};\n    const fieldParts = Array.isArray(field) ? field : field.split(fieldSeparator);\n    const _fieldKeys = getFieldPath(field, config);\n    const fieldPartsLabels = getFieldPathLabels(field, config, cutParentField ? parentField : null);\n    const fieldFullLabel = fieldPartsLabels ? fieldPartsLabels.join(fieldSeparatorDisplay) : null;\n    const fieldLabel2 = fieldDefinition.label2 || fieldFullLabel;\n    const formatFieldFn = config.settings.formatField || defaultSettings.formatField;\n    const fieldName = formatFieldName(field, config, meta, cutParentField ? parentField : null);\n    ret = formatFieldFn(fieldName, fieldParts, fieldLabel2, fieldDefinition, config, isForDisplay);\n  }\n  return ret;\n};\n\n\nconst formatFunc = (config, meta, funcValue, isForDisplay, parentField = null) => {\n  const funcKey = funcValue.get(\"func\");\n  const args = funcValue.get(\"args\");\n  const funcConfig = getFuncConfig(config, funcKey);\n  const funcName = isForDisplay && funcConfig.label || funcKey;\n\n  let formattedArgs = {};\n  let formattedArgsWithNames = {};\n  for (const argKey in funcConfig.args) {\n    const argConfig = funcConfig.args[argKey];\n    const fieldDef = getFieldConfig(config, argConfig);\n    const argVal = args ? args.get(argKey) : undefined;\n    const argValue = argVal ? argVal.get(\"value\") : undefined;\n    const argValueSrc = argVal ? argVal.get(\"valueSrc\") : undefined;\n    const argAsyncListValues = argVal ? argVal.get(\"asyncListValues\") : undefined;\n    const formattedArgVal = formatValue(\n      config, meta, argValue, argValueSrc, argConfig.type, fieldDef, argConfig, null, null, isForDisplay, parentField, argAsyncListValues\n    );\n    const argName = isForDisplay && argConfig.label || argKey;\n    if (formattedArgVal !== undefined) { // skip optional in the end\n      formattedArgs[argKey] = formattedArgVal;\n      formattedArgsWithNames[argName] = formattedArgVal;\n    }\n  }\n\n  let ret = null;\n  if (typeof funcConfig.formatFunc === \"function\") {\n    const fn = funcConfig.formatFunc;\n    const args = [\n      formattedArgs,\n      isForDisplay\n    ];\n    ret = fn(...args);\n  } else {\n    const argsStr = Object.entries(formattedArgsWithNames)\n      .map(([k, v]) => (isForDisplay ? `${k}: ${v}` : `${v}`))\n      .join(\", \");\n    ret = `${funcName}(${argsStr})`;\n  }\n  return ret;\n};\n","import {getWidgetForFieldOp} from \"../utils/ruleUtils\";\nimport {defaultConjunction} from \"../utils/defaultUtils\";\n\n\n/**\n * Converts a string representation of top_left and bottom_right cords to\n * a ES geo_point required for query\n *\n * @param {string} geoPointString - comma separated string of lat/lon coods\n * @returns {{top_left: {lon: number, lat: number}, bottom_right: {lon: number, lat: number}}} - ES geoPoint formatted object\n * @private\n */\nfunction buildEsGeoPoint(geoPointString) {\n  if (geoPointString == null) {\n    return null;\n  }\n\n  const coordsNumberArray = geoPointString.split(\",\").map(Number);\n  return {\n    top_left: {\n      lat: coordsNumberArray[0],\n      lon: coordsNumberArray[1]\n    },\n    bottom_right: {\n      lat: coordsNumberArray[2],\n      lon: coordsNumberArray[3]\n    }\n  };\n}\n\n/**\n * Converts a dateTime string from the query builder to a ES range formatted object\n *\n * @param {string} dateTime - dateTime formatted string\n * @param {string} operator - query builder operator type, see constants.js and query builder docs\n * @returns {{lt: string}|{lte: string}|{gte: string}|{gte: string, lte: string}|undefined} - ES range query parameter\n *\n * @private\n */\nfunction buildEsRangeParameters(value, operator) {\n  // -- if value is greater than 1 then we assume this is a between operator : BUG this is wrong, a selectable list can have multiple values\n  if (value.length > 1) {\n    return {\n      gte: \"\".concat(value[0]),\n      lte: \"\".concat(value[1])\n    };\n  } // -- if value is only one we assume this is a date time query for a specific day\n\n  const dateTime = value[0]; //TODO: Rethink about this part, what if someone adds a new type of opperator\n\n  //todo: move this logic into config\n  switch (operator) {\n  case \"on_date\": //todo: not used\n  case \"not_on_date\":\n  case \"equal\":\n  case \"select_equals\":\n  case \"not_equal\":\n    return {\n      gte: \"\".concat(dateTime, \"||/d\"),\n      lte: \"\".concat(dateTime, \"||+1d\")\n    };\n\n  case \"less_or_equal\":\n    return {\n      lte: \"\".concat(dateTime)\n    };\n\n  case \"greater_or_equal\":\n    return {\n      gte: \"\".concat(dateTime)\n    };\n\n  case \"less\":\n    return {\n      lt: \"\".concat(dateTime)\n    };\n\n  case \"greater\":\n    return {\n      gt: \"\".concat(dateTime)\n    };\n\n  default:\n    return undefined;\n  }\n}\n\n/**\n * Builds the DSL parameters for a Wildcard query\n *\n * @param {string} value - The match value\n * @returns {{value: string}} - The value = value parameter surrounded with * on each end\n * @private\n */\nfunction buildEsWildcardParameters(value) {\n  return {\n    value: \"*\" + value + \"*\"\n  };\n}\n\n/**\n * Takes the match type string from awesome query builder like 'greater_or_equal' and\n * returns the ES occurrence required for bool queries\n *\n * @param {string} combinator - query group type or rule condition\n * @param {bool} not\n * @returns {string} - ES occurrence type. See constants.js\n * @private\n */\nfunction determineOccurrence(combinator, not) {\n  //todo: move into config, like mongoConj\n  switch (combinator) {\n  case \"AND\":\n    return not ? \"must_not\" : \"must\";\n    // -- AND\n\n  case \"OR\":\n    return not ? \"should_not\" : \"should\";\n    // -- OR\n\n  case \"NOT\":\n    return not ? \"must\" : \"must_not\";\n    // -- NOT AND\n\n  default:\n    return undefined;\n  }\n}\n\n/**\n * Determines what field to query off of given the operator type\n *\n * @param {string} fieldDataType - The type of data\n * @param {string} fullFieldName - A '.' separated string containing the property lineage (including self)\n * @param {string} queryType - The query type\n * @returns {string|*} - will be either the fullFieldName or fullFieldName.keyword\n * @private\n */\n//todo: not used\nfunction determineQueryField(fieldDataType, fullFieldName, queryType) {\n  if (fieldDataType === \"boolean\") {\n    return fullFieldName;\n  }\n\n  switch (queryType) {\n  case \"term\":\n  case \"wildcard\":\n    return \"\".concat(fullFieldName, \".keyword\");\n\n  case \"geo_bounding_box\":\n  case \"range\":\n  case \"match\":\n    return fullFieldName;\n\n  default:\n    console.error(\"Can't determine query field for query type \".concat(queryType));\n    return null;\n  }\n}\n\nfunction buildRegexpParameters(value) {\n  return {\n    value: value\n  };\n}\n\nfunction determineField(fieldName, config) {\n  //todo: ElasticSearchTextField - not used\n  //return config.fields[fieldName].ElasticSearchTextField || fieldName;\n  return fieldName;\n}\n\nfunction buildParameters(queryType, value, operator, fieldName, config) {\n  const textField = determineField(fieldName, config);\n  switch (queryType) {\n  case \"filter\":\n    //todo: elasticSearchScript - not used\n    return {\n      script: config.operators[operator].elasticSearchScript(fieldName, value)\n    };\n\n  case \"exists\":\n    return { field: fieldName };\n\n  case \"match\":\n    return { [textField]: value[0] };\n\n  case \"term\":\n    return { [fieldName]: value[0] };\n\n  //todo: not used\n  // need to add geo type into RAQB or remove this code\n  case \"geo_bounding_box\":\n    return { [fieldName]: buildEsGeoPoint(value[0]) };\n\n  case \"range\":\n    return { [fieldName]: buildEsRangeParameters(value, operator) };\n\n  case \"wildcard\":\n    return { [fieldName]: buildEsWildcardParameters(value[0]) };\n\n  case \"regexp\":\n    return { [fieldName]: buildRegexpParameters(value[0]) };\n\n  default:\n    return undefined;\n  }\n}\n/**\n * Handles the building of the group portion of the DSL\n *\n * @param {string} fieldName - The name of the field you are building a rule for\n * @param {string} fieldDataType - The type of data this field holds\n * @param {string} value - The value of this rule\n * @param {string} operator - The condition on how the value is matched\n * @returns {object} - The ES rule\n * @private\n */\nfunction buildEsRule(fieldName, value, operator, config, valueSrc) {\n  if (!fieldName || !operator || value == undefined)\n    return undefined; // rule is not fully entered\n  let op = operator;\n  let opConfig = config.operators[op];\n  if (!opConfig)\n    return undefined; // unknown operator\n  let { elasticSearchQueryType } = opConfig;\n\n  // not\n  let not = false;\n  if (!elasticSearchQueryType && opConfig.reversedOp) {\n    not = true;\n    op = opConfig.reversedOp;\n    opConfig = config.operators[op];\n    ({ elasticSearchQueryType } = opConfig);\n  }\n  \n  // handle if value 0 has multiple values like a select in a array\n  const widget = getWidgetForFieldOp(config, fieldName, op, valueSrc);\n  const widgetConfig = config.widgets[widget];\n  if (!widgetConfig)\n    return undefined; // unknown widget\n  const { elasticSearchFormatValue } = widgetConfig;\n\n  /** In most cases the queryType will be static however in some casese (like between) the query type will change\n   * based on the data type. i.e. a between time will be different than between number, date, letters etc... */\n  let queryType;\n  if (typeof elasticSearchQueryType === \"function\") {\n    queryType = elasticSearchQueryType(widget);\n  } else {\n    queryType = elasticSearchQueryType;\n  }\n\n  if (!queryType) {\n    // Not supported\n    return undefined;\n  }\n\n  /** If a widget has a rule on how to format that data then use that otherwise use default way of determineing search parameters\n   * */\n  let parameters;\n  if (typeof elasticSearchFormatValue === \"function\") {\n    parameters = elasticSearchFormatValue(queryType, value, op, fieldName, config);\n  } else {\n    parameters = buildParameters(queryType, value, op, fieldName, config);\n  }\n\n  if (not) {\n    return {\n      bool: {\n        must_not: {\n          [queryType]: {...parameters}\n        }\n      }\n    };\n  } else {\n    return {\n      [queryType]: {...parameters}\n    };\n  }\n}\n\n/**\n * Handles the building of the group portion of the DSL\n *\n * @param {object} children - The contents of the group\n * @param {string} conjunction - The way the contents of the group are joined together i.e. AND OR\n * @param {bool} not\n * @param {Function} recursiveFxn - The recursive fxn to build the contents of the groups children\n * @private\n * @returns {object} - The ES group\n */\nfunction buildEsGroup(children, conjunction, not, recursiveFxn, config) {\n  if (!children || !children.size)\n    return undefined;\n  const childrenArray = children.valueSeq().toArray();\n  const occurrence = determineOccurrence(conjunction, not);\n  const result = childrenArray.map((c) => recursiveFxn(c, config)).filter(v => v !== undefined);\n  if (!result.length)\n    return undefined;\n  const resultFlat = result.flat(Infinity);\n  return {\n    bool: {\n      [occurrence]: resultFlat\n    }\n  };\n}\n\nexport function elasticSearchFormat(tree, config) {\n  // -- format the es dsl here\n  if (!tree) return undefined;\n  const type = tree.get(\"type\");\n  const properties = tree.get(\"properties\") || new Map();\n\n  if (type === \"rule\" && properties.get(\"field\")) {\n    // -- field is null when a new blank rule is added\n    const operator = properties.get(\"operator\");\n    const field = properties.get(\"field\");\n    const value = properties.get(\"value\").toJS();\n    const _valueType = properties.get(\"valueType\")?.get(0);\n    const valueSrc = properties.get(\"valueSrc\")?.get(0);\n\n    if (valueSrc === \"func\") {\n      // -- elastic search doesn't support functions (that is post processing)\n      return;\n    }\n\n    if (value && Array.isArray(value[0])) {\n      //TODO : Handle case where the value has multiple values such as in the case of a list\n      return value[0].map((val) => \n        buildEsRule(field, [val], operator, config, valueSrc)\n      );\n    } else {\n      return buildEsRule(field, value, operator, config, valueSrc);\n    }\n  }\n\n  if (type === \"group\" || type === \"rule_group\") {\n    const not = properties.get(\"not\");\n    let conjunction = properties.get(\"conjunction\");\n    if (!conjunction)\n      conjunction = defaultConjunction(config);\n    const children = tree.get(\"children1\");\n    return buildEsGroup(children, conjunction, not, elasticSearchFormat, config);\n  }\n}\n","import Immutable, { fromJS, Map } from \"immutable\";\nimport {validateTree} from \"../utils/validation\";\nimport {extendConfig} from \"../utils/configUtils\";\nimport {getTreeBadFields, getLightTree} from \"../utils/treeUtils\";\nimport {isJsonLogic} from \"../utils/stuff\";\n\nexport const getTree = (immutableTree, light = true, children1AsArray = true) => {\n  if (!immutableTree) return undefined;\n  let tree = immutableTree;\n  tree = tree.toJS();\n  if (light)\n    tree = getLightTree(tree, children1AsArray);\n  return tree;\n};\n\nexport const loadTree = (serTree) => {\n  if (isImmutableTree(serTree)) {\n    return serTree;\n  } else if (isTree(serTree)) {\n    return jsTreeToImmutable(serTree);\n  } else if (typeof serTree == \"string\" && serTree.startsWith('[\"~#iM\"')) {\n    //tip: old versions of RAQB were saving tree with `transit.toJSON()`\n    // https://github.com/ukrbublik/react-awesome-query-builder/issues/69\n    throw \"You are trying to load query in obsolete serialization format (Immutable string) which is not supported in versions starting from 2.1.17\";\n  } else if (typeof serTree == \"string\") {\n    return jsTreeToImmutable(JSON.parse(serTree));\n  } else throw \"Can't load tree!\";\n};\n\nexport const checkTree = (tree, config) => {\n  if (!tree) return undefined;\n  const extendedConfig = extendConfig(config);\n  return validateTree(tree, null, extendedConfig, extendedConfig);\n};\n\nexport const isValidTree = (tree) => {\n  return getTreeBadFields(tree).length == 0;\n};\n\nexport const isImmutableTree = (tree) => {\n  return Map.isMap(tree);\n};\n\nexport const isTree = (tree) => {\n  return typeof tree == \"object\" && (tree.type == \"group\" || tree.type == \"switch_group\");\n};\n\nexport {isJsonLogic};\n\nfunction jsTreeToImmutable(tree) {\n  return fromJS(tree, function (key, value) {\n    let outValue;\n    if (key == \"properties\") {\n      outValue = value.toOrderedMap();\n\n      // `value` should be undefined instead of null\n      // JSON doesn't support undefined and replaces undefined -> null\n      // So fix: null -> undefined\n      for (let i = 0 ; i < 2 ; i++) {\n        if (outValue.get(\"value\")?.get(i) === null) {\n          outValue = outValue.setIn([\"value\", i], undefined);\n        }\n      }\n    } else if (key == \"value\" && value.get(0) && value.get(0).toJS !== undefined) {\n      const valueJs = value.get(0).toJS();\n      if (valueJs.func) {\n        outValue = value.toOrderedMap();\n      } else {\n        // only for raw values keep JS representation\n        outValue = Immutable.List.of(valueJs);\n      }\n    } else if (key == \"asyncListValues\") {\n      // keep in JS format\n      outValue = value.toJS();\n    } else if (key == \"children1\" && Immutable.Iterable.isIndexed(value)) {\n      outValue = new Immutable.OrderedMap(value.map(child => [child.get(\"id\"), child]));\n    } else {\n      outValue = Immutable.Iterable.isIndexed(value) ? value.toList() : value.toOrderedMap();\n    }\n    return outValue;\n  });\n}\n\n","import uuid from \"../utils/uuid\";\nimport {defaultValue, isJsonLogic, shallowEqual, logger} from \"../utils/stuff\";\nimport {getFieldConfig, extendConfig, normalizeField} from \"../utils/configUtils\";\nimport {getWidgetForFieldOp} from \"../utils/ruleUtils\";\nimport {loadTree} from \"./tree\";\nimport {defaultConjunction, defaultGroupConjunction} from \"../utils/defaultUtils\";\n\nimport moment from \"moment\";\n\n// http://jsonlogic.com/\n\n// helpers\nconst arrayUniq = (arr) => Array.from(new Set(arr));\nconst arrayToObject = (arr) => arr.reduce((acc, [f, fc]) => ({ ...acc, [f]: fc }), {});\n\nexport const loadFromJsonLogic = (logicTree, config) => {\n  return _loadFromJsonLogic(logicTree, config, false);\n};\n\nexport const _loadFromJsonLogic = (logicTree, config, returnErrors = true) => {\n  //meta is mutable\n  let meta = {\n    errors: []\n  };\n  const extendedConfig = extendConfig(config);\n  const conv = buildConv(extendedConfig);\n  let jsTree = logicTree ? convertFromLogic(logicTree, conv, extendedConfig, \"rule\", meta) : undefined;\n  if (jsTree && jsTree.type != \"group\") {\n    jsTree = wrapInDefaultConj(jsTree, extendedConfig);\n  }\n  const immTree = jsTree ? loadTree(jsTree) : undefined;\n\n  if (returnErrors) {\n    return [immTree, meta.errors];\n  } else {\n    if (meta.errors.length)\n      console.warn(\"Errors while importing from JsonLogic:\", meta.errors);\n    return immTree;\n  }\n};\n\n\nconst buildConv = (config) => {\n  let operators = {};\n  for (let opKey in config.operators) {\n    const opConfig = config.operators[opKey];\n    if (typeof opConfig.jsonLogic == \"string\") {\n      // example: \"</2\", \"#in/1\"\n      const opk = (opConfig._jsonLogicIsRevArgs ? \"#\" : \"\") + opConfig.jsonLogic + \"/\" + defaultValue(opConfig.cardinality, 1);\n      if (!operators[opk])\n        operators[opk] = [];\n      operators[opk].push(opKey);\n    } else if(typeof opConfig.jsonLogic2 == \"string\") {\n      // example: all-in/1\"\n      const opk = opConfig.jsonLogic2 + \"/\" + defaultValue(opConfig.cardinality, 1);\n      if (!operators[opk])\n        operators[opk] = [];\n      operators[opk].push(opKey);\n    }\n  }\n\n  let conjunctions = {};\n  for (let conjKey in config.conjunctions) {\n    const conjunctionDefinition = config.conjunctions[conjKey];\n    const ck = conjunctionDefinition.jsonLogicConj || conjKey.toLowerCase();\n    conjunctions[ck] = conjKey;\n  }\n\n  let funcs = {};\n  for (let funcKey in config.funcs) {\n    const funcConfig = config.funcs[funcKey];\n    let fk;\n    if (funcConfig.jsonLogicIsMethod) {\n      fk = \"#\" + funcConfig.jsonLogic;\n    } else if (typeof funcConfig.jsonLogic == \"string\") {\n      fk = funcConfig.jsonLogic;\n    }\n    if (fk) {\n      if (!funcs[fk])\n        funcs[fk] = [];\n      funcs[fk].push(funcKey);\n    }\n  }\n\n  const {groupVarKey, altVarKey} = config.settings.jsonLogic;\n\n  return {\n    operators,\n    conjunctions,\n    funcs,\n    varKeys: [\"var\", groupVarKey, altVarKey],\n  };\n};\n\n\nconst convertFromLogic = (logic, conv, config, expectedType, meta, not = false, fieldConfig, widget, parentField = null, _isLockedLogic = false) => {\n  let op, vals;\n  if (isJsonLogic(logic)) {\n    op = Object.keys(logic)[0];\n    vals = logic[op];\n    if (!Array.isArray(vals))\n      vals = [ vals ];\n  }\n  \n  let ret;\n  let beforeErrorsCnt = meta.errors.length;\n\n  const {lockedOp} = config.settings.jsonLogic;\n  const isEmptyOp = op == \"!\" && (vals.length == 1 && vals[0] && isJsonLogic(vals[0]) && conv.varKeys.includes(Object.keys(vals[0])[0]));\n  const isRev = op == \"!\" && !isEmptyOp;\n  const isLocked = lockedOp && op == lockedOp;\n  if (isLocked) {\n    ret = convertFromLogic(vals[0], conv, config, expectedType, meta, not, fieldConfig, widget, parentField, true);\n  } else if (isRev) {\n    // reverse with not\n    ret = convertFromLogic(vals[0], conv, config, expectedType, meta, !not, fieldConfig, widget, parentField);\n  } else if(expectedType == \"val\") {\n    // not is not used here\n    ret = convertField(op, vals, conv, config, not, meta, parentField) \n      || convertFunc(op, vals, conv, config, not, fieldConfig, meta, parentField) \n      || convertVal(logic, fieldConfig, widget, config, meta);\n  } else if(expectedType == \"rule\") {\n    ret = convertConj(op, vals, conv, config, not, meta, parentField, false) \n    || convertOp(op, vals, conv, config, not, meta, parentField);\n  }\n\n  let afterErrorsCnt = meta.errors.length;\n  if (op != \"!\" && ret === undefined && afterErrorsCnt == beforeErrorsCnt) {\n    meta.errors.push(`Can't parse logic ${JSON.stringify(logic)}`);\n  }\n\n  if (isLocked) {\n    ret.properties.isLocked = true;\n  }\n\n  return ret;\n};\n\n\nconst convertVal = (val, fieldConfig, widget, config, meta) => {\n  if (val === undefined) return undefined;\n  const widgetConfig = config.widgets[widget || fieldConfig.mainWidget];\n\n  if (!widgetConfig) {\n    meta.errors.push(`No widget for type ${fieldConfig.type}`);\n    return undefined;\n  }\n\n  if (isJsonLogic(val)) {\n    meta.errors.push(`Unexpected logic in value: ${JSON.stringify(val)}`);\n    return undefined;\n  }\n\n  // number of seconds -> time string\n  if (fieldConfig && fieldConfig.type == \"time\" && typeof val == \"number\") {\n    const [h, m, s] = [Math.floor(val / 60 / 60) % 24, Math.floor(val / 60) % 60, val % 60];\n    const valueFormat = widgetConfig.valueFormat;\n    if (valueFormat) {\n      const dateVal = new Date(val);\n      dateVal.setMilliseconds(0);\n      dateVal.setHours(h);\n      dateVal.setMinutes(m);\n      dateVal.setSeconds(s);\n      val = moment(dateVal).format(valueFormat);\n    } else {\n      val = `${h}:${m}:${s}`;\n    }\n  }\n\n  // \"2020-01-08T22:00:00.000Z\" -> Date object\n  if (fieldConfig && [\"date\", \"datetime\"].includes(fieldConfig.type) && val && !(val instanceof Date)) {\n    try {\n      const dateVal = new Date(val);\n      if (dateVal instanceof Date && dateVal.toISOString() === val) {\n        val = dateVal;\n      }\n    } catch(e) {\n      meta.errors.push(`Can't convert value ${val} as Date`);\n      val = undefined;\n    }\n  }\n\n  // Date object -> formatted string\n  if (val instanceof Date && fieldConfig) {\n    const valueFormat = widgetConfig.valueFormat;\n    if (valueFormat) {\n      val = moment(val).format(valueFormat);\n    }\n  }\n\n  let asyncListValues;\n  if (val && fieldConfig.fieldSettings && fieldConfig.fieldSettings.asyncFetch) {\n    const vals = Array.isArray(val) ? val : [val];\n    asyncListValues = vals;\n  }\n\n  return {\n    valueSrc: \"value\",\n    value: val,\n    valueType: widgetConfig.type,\n    asyncListValues\n  };\n};\n\n\nconst convertField = (op, vals, conv, config, not, meta, parentField = null) => {\n  const {fieldSeparator} = config.settings;\n  if (conv.varKeys.includes(op) && typeof vals[0] == \"string\") {\n    let field = vals[0];\n    if (parentField)\n      field = [parentField, field].join(fieldSeparator);\n    field = normalizeField(config, field);\n    const fieldConfig = getFieldConfig(config, field);\n    if (!fieldConfig) {\n      meta.errors.push(`No config for field ${field}`);\n      return undefined;\n    }\n\n    return {\n      valueSrc: \"field\",\n      value: field,\n      valueType: fieldConfig.type,\n    };\n  }\n\n  return undefined;\n};\n\n\nconst convertFunc = (op, vals, conv, config, not, fieldConfig, meta, parentField = null) => {\n  if (!op) return undefined;\n  let func, argsArr, funcKey;\n  const jsonLogicIsMethod = (op == \"method\");\n  if (jsonLogicIsMethod) {\n    let obj, opts;\n    [obj, func, ...opts] = vals;\n    argsArr = [obj, ...opts];\n  } else {\n    func = op;\n    argsArr = vals;\n  }\n\n  const fk = (jsonLogicIsMethod ? \"#\" : \"\") + func;\n  const funcKeys = (conv.funcs[fk] || []).filter(k => \n    (fieldConfig ? config.funcs[k].returnType == fieldConfig.type : true)\n  );\n  if (funcKeys.length) {\n    funcKey = funcKeys[0];\n  } else {\n    const v = {[op]: vals};\n    for (const [f, fc] of Object.entries(config.funcs || {})) {\n      if (fc.jsonLogicImport && fc.returnType == fieldConfig.type) {\n        let parsed;\n        try {\n          parsed = fc.jsonLogicImport(v);\n        } catch(_e) {\n          // given expression `v` can't be parsed into function\n        }\n        if (parsed) {\n          funcKey = f;\n          argsArr = parsed;\n        }\n      }\n    }\n  }\n  if (!funcKey)\n    return undefined;\n\n  if (funcKey) {\n    const funcConfig = config.funcs[funcKey];\n    const argKeys = Object.keys(funcConfig.args || {});\n    let args = argsArr.reduce((acc, val, ind) => {\n      const argKey = argKeys[ind];\n      const argConfig = funcConfig.args[argKey];\n      let argVal = convertFromLogic(val, conv, config, \"val\", meta, false, argConfig, null, parentField);\n      if (argVal === undefined) {\n        argVal = argConfig.defaultValue;\n        if (argVal === undefined) {\n          meta.errors.push(`No value for arg ${argKey} of func ${funcKey}`);\n          return undefined;\n        }\n      }\n      return {...acc, [argKey]: argVal};\n    }, {});\n\n    return {\n      valueSrc: \"func\",\n      value: {\n        func: funcKey,\n        args: args\n      },\n      valueType: funcConfig.returnType,\n    };\n  }\n\n  return undefined;\n};\n\n\nconst convertConj = (op, vals, conv, config, not, meta, parentField = null, isRuleGroup = false) => {\n  const conjKey = conv.conjunctions[op];\n  const {fieldSeparator} = config.settings;\n  const parentFieldConfig = parentField ? getFieldConfig(config, parentField) : null;\n  const isParentGroup = parentFieldConfig?.type == \"!group\";\n  if (conjKey) {\n    let type = \"group\";\n    const children = vals\n      .map(v => convertFromLogic(v, conv, config, \"rule\", meta, false, null, null, parentField))\n      .filter(r => r !== undefined)\n      .reduce((acc, r) => ({...acc, [r.id] : r}), {});\n    const complexFields = Object.values(children)\n      .map(v => v?.properties?.field)\n      .filter(f => f && f.includes(fieldSeparator));\n    const complexFieldsGroupAncestors = Object.fromEntries(\n      arrayUniq(complexFields).map(f => {\n        const parts = f.split(fieldSeparator);\n        const ancs = Object.fromEntries(\n          parts.slice(0, -1)\n            .map((f, i, parts) => [...parts.slice(0, i), f])\n            .map(fp => [fp.join(fieldSeparator), getFieldConfig(config, fp)])\n            .filter(([_f, fc]) => fc.type == \"!group\")\n        );\n        return [f, Object.keys(ancs)];\n      })\n    );\n    const childrenInRuleGroup = Object.values(children)\n      .map(v => v?.properties?.field)\n      .map(f => complexFieldsGroupAncestors[f])\n      .filter(ancs => ancs && ancs.length);\n    const usedRuleGroups = arrayUniq(Object.values(complexFieldsGroupAncestors).flat());\n    const usedTopRuleGroups = topLevelFieldsFilter(usedRuleGroups);\n    \n    let properties = {\n      conjunction: conjKey,\n      not: not\n    };\n    const id = uuid();\n\n    let children1 = {};\n    let groupToId = {};\n    Object.entries(children).map(([k, v]) => {\n      if (v.type == \"group\" || v.type == \"rule_group\") {\n        // put as-is\n        children1[k] = v;\n      } else {\n        const field = v?.properties?.field;\n        const groupAncestors = complexFieldsGroupAncestors[field];\n        const groupField = groupAncestors?.at(-1);\n        if (!groupField) {\n          // not in rule_group (can be simple field or in struct) - put as-is\n          children1[k] = v;\n        } else {\n          // wrap field in rule_group (with creating hierarchy if need)\n          let ch = children1;\n          let parentFieldParts = parentField ? parentField.split(fieldSeparator) : [];\n          const isInParent = shallowEqual(parentFieldParts, groupField.split(fieldSeparator).slice(0, parentFieldParts.length));\n          if (!isInParent)\n            parentFieldParts = []; // should not be\n          const traverseGroupFields = groupField\n            .split(fieldSeparator)\n            .slice(parentFieldParts.length)\n            .map((f, i, parts) => [...parentFieldParts, ...parts.slice(0, i), f].join(fieldSeparator))\n            .map(f => normalizeField(config, f))\n            .map((f) => ({f, fc: getFieldConfig(config, f) || {}}))\n            .filter(({fc}) => (fc.type != \"!struct\"));\n          traverseGroupFields.map(({f: gf, fc: gfc}, i) => {\n            let groupId = groupToId[gf];\n            if (!groupId) {\n              groupId = uuid();\n              groupToId[gf] = groupId;\n              ch[groupId] = {\n                type: \"rule_group\",\n                id: groupId,\n                children1: {},\n                properties: {\n                  conjunction: conjKey,\n                  not: false,\n                  field: gf,\n                  mode: gfc.mode,\n                }\n              };\n            }\n            ch = ch[groupId].children1;\n          });\n          ch[k] = v;\n        }\n      }\n    });\n\n    // tip: for isRuleGroup=true correct type and properties will be set out of this func\n\n    return {\n      type: type,\n      id: id,\n      children1: children1,\n      properties: properties\n    };\n  }\n\n  return undefined;\n};\n\n\nconst topLevelFieldsFilter = (fields) => {\n  let arr = [...fields].sort((a, b) => (a.length - b.length));\n  for (let i = 0 ; i < arr.length ; i++) {\n    for (let j = i + 1 ; j < arr.length ; j++) {\n      if (arr[j].indexOf(arr[i]) == 0) {\n        // arr[j] is inside arr[i] (eg. \"a.b\" inside \"a\")\n        arr.splice(j, 1);\n        j--;\n      }\n    }\n  }\n  return arr;\n};\n\nconst wrapInDefaultConjRuleGroup = (rule, parentField, parentFieldConfig, config, conj) => {\n  if (!rule) return undefined;\n  return {\n    type: \"rule_group\",\n    id: uuid(),\n    children1: { [rule.id]: rule },\n    properties: {\n      conjunction: conj || defaultGroupConjunction(config, parentFieldConfig),\n      not: false,\n      field: parentField,\n    }\n  };\n};\n\nconst wrapInDefaultConj = (rule, config, not = false) => {\n  return {\n    type: \"group\",\n    id: uuid(),\n    children1: { [rule.id]: rule },\n    properties: {\n      conjunction: defaultConjunction(config),\n      not: not\n    }\n  };\n};\n\nconst parseRule = (op, arity, vals, parentField, conv, config, meta) => {\n  let errors = [];\n  let res = _parseRule(op, arity, vals, parentField, conv, config, errors, false) \n         || _parseRule(op, arity, vals, parentField, conv, config, errors, true) ;\n\n  if (!res) {\n    meta.errors.push(errors.join(\"; \") || `Unknown op ${op}/${arity}`);\n    return undefined;\n  }\n  \n  return res;\n};\n\nconst _parseRule = (op, arity, vals, parentField, conv, config, errors, isRevArgs) => {\n  // config.settings.groupOperators are used for group count (cardinality = 0 is exception)\n  // but don't confuse with \"all-in\" for multiselect\n  const isAllInForMultiselect = op == \"all\" && isJsonLogic(vals[1]) && Object.keys(vals[1])[0] == \"in\";\n  const isGroup0 = !isAllInForMultiselect && config.settings.groupOperators.includes(op);\n  const eqOps = [\"==\", \"!=\"];\n  let cardinality = isGroup0 ? 0 : arity - 1;\n  if (isGroup0)\n    cardinality = 0;\n  else if (eqOps.includes(op) && cardinality == 1 && vals[1] === null)\n    cardinality = 0;\n\n  const opk = op + \"/\" + cardinality;\n  const {fieldSeparator} = config.settings;\n  let opKeys = conv.operators[(isRevArgs ? \"#\" : \"\") + opk];\n  if (!opKeys)\n    return;\n  \n  let jlField, args = [];\n  const rangeOps = [\"<\", \"<=\", \">\", \">=\"];\n  if (rangeOps.includes(op) && arity == 3) {\n    jlField = vals[1];\n    args = [ vals[0], vals[2] ];\n  } else if (isRevArgs) {\n    jlField = vals[1];\n    args = [ vals[0] ];\n  } else {\n    [jlField, ...args] = vals;\n  }\n\n  if (!isJsonLogic(jlField)) {\n    errors.push(`Incorrect operands for ${op}: ${JSON.stringify(vals)}`);\n    return;\n  }\n  let k = Object.keys(jlField)[0];\n  let v = Object.values(jlField)[0];\n  \n  let field, having, isGroup;\n  if (conv.varKeys.includes(k) && typeof v == \"string\") {\n    field = v;\n  }\n  if (isGroup0) {\n    isGroup = true;\n    having = args[0];\n    args = [];\n  }\n  // reduce/filter for group ext\n  if (k == \"reduce\" && Array.isArray(v) && v.length == 3) {\n    let [filter, acc, init] = v;\n    if (isJsonLogic(filter) && init == 0 && isJsonLogic(acc) && Array.isArray(acc[\"+\"]) && acc[\"+\"][0] == 1 && isJsonLogic(acc[\"+\"][1]) && acc[\"+\"][1][\"var\"] == \"accumulator\") {\n      k = Object.keys(filter)[0];\n      v = Object.values(filter)[0];\n      if (k == \"filter\") {\n        let [group, filter] = v;\n        if (isJsonLogic(group)) {\n          k = Object.keys(group)[0];\n          v = Object.values(group)[0];\n          if (conv.varKeys.includes(k) && typeof v == \"string\") {\n            field = v;\n            having = filter;\n            isGroup = true;\n          }\n        }\n      } else if (conv.varKeys.includes(k) && typeof v == \"string\") {\n        field = v;\n        isGroup = true;\n      }\n    }\n  }\n  \n  if (!field) {\n    errors.push(`Unknown field ${JSON.stringify(jlField)}`);\n    return;\n  }\n  if (parentField)\n    field = [parentField, field].join(fieldSeparator);\n  field = normalizeField(config, field);\n\n  const fieldConfig = getFieldConfig(config, field);\n  if (!fieldConfig) {\n    errors.push(`No config for field ${field}`);\n    return;\n  }\n\n  let opKey = opKeys[0];\n  if (opKeys.length > 1 && fieldConfig && fieldConfig.operators) {\n    // eg. for \"equal\" and \"select_equals\"\n    opKeys = opKeys\n      .filter(k => fieldConfig.operators.includes(k));\n    if (opKeys.length == 0) {\n      errors.push(`No corresponding ops for field ${field}`);\n      return;\n    }\n    opKey = opKeys[0];\n  }\n  \n  return {\n    field, fieldConfig, opKey, args, having\n  };\n};\n\nconst convertOp = (op, vals, conv, config, not, meta, parentField = null) => {\n  if (!op) return undefined;\n\n  const arity = vals.length;\n  if (op == \"all\" && isJsonLogic(vals[1])) {\n    // special case for \"all-in\"\n    const op2 = Object.keys(vals[1])[0];\n    if (op2 == \"in\") {\n      vals = [\n        vals[0],\n        vals[1][op2][1]\n      ];\n      op = op + \"-\" + op2; // \"all-in\"\n    }\n  }\n\n  const parseRes = parseRule(op, arity, vals, parentField, conv, config, meta);\n  if (!parseRes) return undefined;\n  let {field, fieldConfig, opKey, args, having} = parseRes;\n  let opConfig = config.operators[opKey];\n\n  // Group component in array mode can show NOT checkbox, so do nothing in this case\n  // Otherwise try to revert\n  const showNot = fieldConfig.showNot !== undefined ? fieldConfig.showNot : config.settings.showNot; \n  let canRev = true;\n  // if (fieldConfig.type == \"!group\" && fieldConfig.mode == \"array\" && showNot)\n  //   canRev = false;\n\n  let conj;\n  let havingVals;\n  if (fieldConfig.type == \"!group\" && having) {\n    conj = Object.keys(having)[0];\n    havingVals = having[conj];\n    if (!Array.isArray(havingVals))\n      havingVals = [ havingVals ];\n\n    // Preprocess \"!\": Try to reverse op in single rule in having\n    // Eg. use `not_equal` instead of `not` `equal`\n    const isEmptyOp = conj == \"!\" && (havingVals.length == 1 && havingVals[0] && isJsonLogic(havingVals[0]) && conv.varKeys.includes(Object.keys(havingVals[0])[0]));\n    if (conj == \"!\" && !isEmptyOp) {\n      not = !not;\n      having = having[\"!\"];\n      conj = Object.keys(having)[0];\n      havingVals = having[conj];\n      if (!Array.isArray(havingVals))\n        havingVals = [ havingVals ];\n    }\n  }\n\n  // Use reversed op\n  if (not && canRev && opConfig.reversedOp) {\n    not = false;\n    opKey = opConfig.reversedOp;\n    opConfig = config.operators[opKey];\n  }\n\n  const widget = getWidgetForFieldOp(config, field, opKey);\n\n  const convertedArgs = args\n    .map(v => convertFromLogic(v, conv, config, \"val\", meta, false, fieldConfig, widget, parentField));\n  if (convertedArgs.filter(v => v === undefined).length) {\n    //meta.errors.push(`Undefined arg for field ${field} and op ${opKey}`);\n    return undefined;\n  }\n\n  let res;\n\n  if (fieldConfig.type == \"!group\" && having) {\n    if (conv.conjunctions[conj] !== undefined) {\n      res = convertConj(conj, havingVals, conv, config, not, meta, field, true);\n      not = false; // not was applied to group\n    } else {\n      // need to be wrapped in `rule_group`\n      const rule = convertOp(conj, havingVals, conv, config, not && canRev, meta, field);\n      if (not && canRev && !rule?.properties?.not) {\n        not = false; // op was reversed in rule\n      }\n      res = wrapInDefaultConjRuleGroup(rule, field, fieldConfig, config, conv.conjunctions[\"and\"]);\n    }\n    if (!res)\n      return undefined;\n    \n    res.type = \"rule_group\";\n    if (not) {\n      Object.assign(res.properties, {\n        not: not,\n      });\n    }\n    Object.assign(res.properties, {\n      field: field,\n      mode: fieldConfig.mode,\n      operator: opKey,\n    });\n    if (fieldConfig.mode == \"array\") {\n      Object.assign(res.properties, {\n        value: convertedArgs.map(v => v.value),\n        valueSrc: convertedArgs.map(v => v.valueSrc),\n        valueType: convertedArgs.map(v => v.valueType),\n      });\n    }\n  } else if (fieldConfig.type == \"!group\" && !having) {\n    res = {\n      type: \"rule_group\",\n      id: uuid(),\n      children1: {},\n      properties: {\n        conjunction: defaultGroupConjunction(config, fieldConfig),\n        not: not,\n        mode: fieldConfig.mode,\n        field: field,\n        operator: opKey,\n      }\n    };\n    if (fieldConfig.mode == \"array\") {\n      Object.assign(res.properties, {\n        value: convertedArgs.map(v => v.value),\n        valueSrc: convertedArgs.map(v => v.valueSrc),\n        valueType: convertedArgs.map(v => v.valueType),\n      });\n    }\n  } else {\n    const asyncListValuesArr = convertedArgs.map(v => v.asyncListValues).filter(v => v != undefined);\n    const asyncListValues = asyncListValuesArr.length ? asyncListValuesArr[0] : undefined;\n    res = {\n      type: \"rule\",\n      id: uuid(),\n      properties: {\n        field: field,\n        operator: opKey,\n        value: convertedArgs.map(v => v.value),\n        valueSrc: convertedArgs.map(v => v.valueSrc),\n        valueType: convertedArgs.map(v => v.valueType),\n        asyncListValues,\n      }\n    };\n    if (not) {\n      //meta.errors.push(`No rev op for ${opKey}`);\n      res = wrapInDefaultConj(res, config, not);\n    }\n  }\n\n  return res;\n};\n\n","import { SpelExpressionEvaluator } from \"spel2js\";\nimport uuid from \"../utils/uuid\";\nimport {getFieldConfig, extendConfig, normalizeField} from \"../utils/configUtils\";\nimport {getWidgetForFieldOp} from \"../utils/ruleUtils\";\nimport {loadTree} from \"./tree\";\nimport {defaultConjunction, defaultGroupConjunction} from \"../utils/defaultUtils\";\nimport {logger} from \"../utils/stuff\";\nimport moment from \"moment\";\n\nexport const loadFromSpel = (logicTree, config) => {\n  return _loadFromSpel(logicTree, config, true);\n};\n\nexport const _loadFromSpel = (spelStr, config, returnErrors = true) => {\n  //meta is mutable\n  let meta = {\n    errors: []\n  };\n  const extendedConfig = extendConfig(config);\n  const conv = buildConv(extendedConfig);\n  \n  let compiledExpression;\n  let convertedObj;\n  let jsTree = undefined;\n  try {\n    const compileRes = SpelExpressionEvaluator.compile(spelStr);\n    compiledExpression = compileRes._compiledExpression;\n  } catch (e) {\n    meta.errors.push(e);\n  }\n  \n  if (compiledExpression) {\n    logger.debug(\"compiledExpression:\", compiledExpression);\n    convertedObj = convertCompiled(compiledExpression, meta);\n    logger.debug(\"convertedObj:\", convertedObj, meta);\n\n    jsTree = convertToTree(convertedObj, conv, extendedConfig, meta);\n    if (jsTree && jsTree.type != \"group\" && jsTree.type != \"switch_group\") {\n      jsTree = wrapInDefaultConj(jsTree, extendedConfig);\n    }\n    logger.debug(\"jsTree:\", jsTree);\n  }\n\n  const immTree = jsTree ? loadTree(jsTree) : undefined;\n\n  if (returnErrors) {\n    return [immTree, meta.errors];\n  } else {\n    if (meta.errors.length)\n      console.warn(\"Errors while importing from SpEL:\", meta.errors);\n    return immTree;\n  }\n};\n\nconst convertCompiled = (expr, meta, parentExpr = null) => {\n  const type = expr.getType();\n  let children = expr.getChildren().map(child => convertCompiled(child, meta, expr));\n\n  // flatize OR/AND\n  if (type == \"op-or\" || type == \"op-and\") {\n    children = children.reduce((acc, child) => {\n      const canFlatize = child.type == type && !child.not;\n      const flat = canFlatize ? child.children : [child];\n      return [...acc, ...flat];\n    }, []);\n  }\n\n  // unwrap NOT\n  if (type == \"op-not\") {\n    if (children.length != 1) {\n      meta.errors.push(`Operator NOT should have 1 child, but got ${children.length}}`);\n    }\n    return {\n      ...children[0],\n      not: !(children[0].not || false)\n    };\n  }\n\n  if (type == \"compound\") {\n    // remove `.?[true]`\n    children = children.filter(child => {\n      const isListFix = child.type == \"selection\" && child.children.length == 1 && child.children[0].type == \"boolean\" && child.children[0].val == true;\n      return !isListFix;\n    });\n    // aggregation\n    // eg. `results.?[product == 'abc'].length`\n    const selection = children.find(child => \n      child.type == \"selection\"\n    );\n    if (selection && selection.children.length != 1) {\n      meta.errors.push(`Selection should have 1 child, but got ${selection.children.length}`);\n    }\n    const filter = selection ? selection.children[0] : null;\n    const lastChild = children[children.length - 1];\n    const isSize = lastChild.type == \"method\" && lastChild.val.methodName == \"size\" \n      || lastChild.type == \"!func\" && lastChild.methodName == \"size\" ;\n    const isLength = lastChild.type == \"property\" && lastChild.val == \"length\";\n    const sourceParts = children.filter(child => \n      child !== selection && child !== lastChild\n    );\n    const source = {\n      type: \"compound\",\n      children: sourceParts\n    };\n    if (isSize || isLength) {\n      return {\n        type: \"!aggr\",\n        filter,\n        source\n      };\n    }\n    // remove `#this`, `#root`\n    children = children.filter(child => {\n      const isThis = child.type == \"variable\" && child.val == \"this\";\n      const isRoot = child.type == \"variable\" && child.val == \"root\";\n      return !(isThis || isRoot);\n    });\n    // indexer\n    children = children.map(child => {\n      if (child.type == \"indexer\" && child.children.length == 1) {\n        return {\n          type: \"indexer\", \n          val: child.children[0].val,\n          itype: child.children[0].type\n        };\n      } else {\n        return child;\n      }\n    });\n    // method\n    if (lastChild.type == \"method\") {\n      const obj = children.filter(child => \n        child !== lastChild\n      );\n      return {\n        type: \"!func\",\n        obj,\n        methodName: lastChild.val.methodName,\n        args: lastChild.val.args\n      };\n    }\n    // !func\n    if (lastChild.type == \"!func\") {\n      const obj = children.filter(child => \n        child !== lastChild\n      );\n      return {\n        ...lastChild,\n        obj,\n      };\n    }\n  }\n\n  // getRaw || getValue\n  let val;\n  try {\n    if (expr.getRaw) { // use my fork\n      val = expr.getRaw();\n    } else if (expr.getValue.length == 0) { // getValue not requires context arg -> can use\n      val = expr.getValue();\n    }\n  } catch(e) {\n    logger.error(\"[spel2js] Error in getValue()\", e);\n  }\n\n  // ternary\n  if (type == \"ternary\") {\n    val = flatizeTernary(children);\n  }\n\n  // convert method/function args\n  if (typeof val === \"object\" && val !== null) {\n    if (val.methodName || val.functionName) {\n      val.args = val.args.map(child => convertCompiled(child, meta, expr));\n    }\n  }\n  // convert list\n  if (type == \"list\") {\n    val = val.map(item => convertCompiled(item, meta, expr));\n\n    // fix whole expression wrapped in `{}`\n    if (!parentExpr && val.length == 1) {\n      return val[0];\n    }\n  }\n  // convert constructor\n  if (type == \"constructorref\") {\n    const qid = children.find(child => child.type == \"qualifiedidentifier\");\n    const cls = qid?.val;\n    if (!cls) {\n      meta.errors.push(`Can't find qualifiedidentifier in constructorref children: ${JSON.stringify(children)}`);\n      return undefined;\n    }\n    const args = children.filter(child => child.type != \"qualifiedidentifier\");\n    return {\n      type: \"!new\",\n      cls,\n      args\n    };\n  }\n  // convert type\n  if (type == \"typeref\") {\n    const qid = children.find(child => child.type == \"qualifiedidentifier\");\n    const cls = qid?.val;\n    if (!cls) {\n      meta.errors.push(`Can't find qualifiedidentifier in typeref children: ${JSON.stringify(children)}`);\n      return undefined;\n    }\n    const _args = children.filter(child => child.type != \"qualifiedidentifier\");\n    return {\n      type: \"!type\",\n      cls\n    };\n  }\n  // convert function/method\n  if (type == \"function\" || type == \"method\") {\n    // `foo()` is method, `#foo()` is function\n    // let's use common property `methodName` and just add `isVar` for function\n    const {functionName, methodName, args} = val;\n    return {\n      type: \"!func\",\n      methodName: functionName || methodName,\n      isVar: type == \"function\",\n      args\n    };\n  }\n\n  return {\n    type,\n    children,\n    val,\n  };\n};\n\nconst flatizeTernary = (children) => {\n  let flat = [];\n  function _processTernaryChildren(tern) {\n    let [cond, if_val, else_val] = tern;\n    flat.push([cond, if_val]);\n    if (else_val?.type == \"ternary\") {\n      _processTernaryChildren(else_val.children);\n    } else {\n      flat.push([undefined, else_val]);\n    }\n  }\n  _processTernaryChildren(children);\n  return flat;\n};\n\nconst buildConv = (config) => {\n  let operators = {};\n  for (let opKey in config.operators) {\n    const opConfig = config.operators[opKey];\n    if (opConfig.spelOps) {\n      // examples: \"==\", \"eq\", \".contains\", \"matches\" (can be used for starts_with, ends_with)\n      opConfig.spelOps.forEach(spelOp => {\n        const opk = spelOp; // + \"/\" + defaultValue(opConfig.cardinality, 1);\n        if (!operators[opk])\n          operators[opk] = [];\n        operators[opk].push(opKey);\n      });\n    } else if (opConfig.spelOp) {\n      const opk = opConfig.spelOp; // + \"/\" + defaultValue(opConfig.cardinality, 1);\n      if (!operators[opk])\n        operators[opk] = [];\n      operators[opk].push(opKey);\n    } else {\n      logger.log(`[spel] No spelOp for operator ${opKey}`);\n    }\n  }\n\n  let conjunctions = {};\n  for (let conjKey in config.conjunctions) {\n    const conjunctionDefinition = config.conjunctions[conjKey];\n    const ck = conjunctionDefinition.spelConj || conjKey.toLowerCase();\n    conjunctions[ck] = conjKey;\n  }\n\n  let funcs = {};\n  for (let funcKey in config.funcs) {\n    const funcConfig = config.funcs[funcKey];\n    let fk;\n    if (typeof funcConfig.spelFunc == \"string\") {\n      fk = funcConfig.spelFunc;\n    }\n    if (fk) {\n      if (!funcs[fk])\n        funcs[fk] = [];\n      funcs[fk].push(funcKey);\n    }\n  }\n\n  return {\n    operators,\n    conjunctions,\n    funcs,\n  };\n};\n\nconst convertPath = (parts, meta) => {\n  let isError = false;\n  const res = parts.map(c => {\n    if (c.type == \"variable\" || c.type == \"property\" || c.type == \"indexer\" && c.itype == \"string\") {\n      return c.val;\n    } else {\n      isError = true;\n      meta.errors.push(`Unexpected item in compound: ${JSON.stringify(c)}`);\n    }\n  });\n  return !isError ? res : undefined;\n};\n\nconst convertArg = (spel, conv, config, meta, parentSpel) => {\n  if (spel == undefined)\n    return undefined;\n  const {fieldSeparator} = config.settings;\n  const literalTypes = {\n    number: \"number\",\n    string: \"text\",\n    boolean: \"boolean\",\n    null: \"null\" // should not be\n  };\n  \n  const groupFieldParts = parentSpel?._groupField ? [parentSpel?._groupField] : [];\n  if (spel.type == \"compound\") {\n    // complex field\n    const parts = convertPath(spel.children, meta);\n    if (!parts) {\n      return undefined;\n    }\n    const fullParts = [...groupFieldParts, ...parts];\n    const isVariable = spel.children?.[0]?.type == \"variable\";\n    return {\n      valueSrc: \"field\",\n      //valueType: todo\n      isVariable,\n      value: fullParts.join(fieldSeparator),\n    };\n  } else if (spel.type == \"variable\" || spel.type == \"property\") {\n    // normal field\n    const fullParts = [...groupFieldParts, spel.val];\n    const isVariable = spel.type == \"variable\";\n    return {\n      valueSrc: \"field\",\n      //valueType: todo\n      isVariable,\n      value: fullParts.join(fieldSeparator),\n    };\n  } else if (literalTypes[spel.type]) {\n    let value = spel.val;\n    let valueType = literalTypes[spel.type];\n    if (parentSpel?.isUnary) {\n      value = -value;\n    }\n    return {\n      valueSrc: \"value\",\n      valueType,\n      value,\n    };\n  } else if (spel.type == \"list\") {\n    const values = spel.val.map(v => convertArg(v, conv, config, meta, spel));\n    const _itemType = values.length ? values[0]?.valueType : null;\n    const value = values.map(v => v?.value);\n    const valueType = \"multiselect\";\n    return {\n      valueSrc: \"value\",\n      valueType,\n      value,\n    };\n  } else if (spel.type == \"!func\") {\n    const {obj, methodName, args, isVar} = spel;\n    \n    // todo: get from conv\n    const funcToOpMap = {\n      [\".contains\"]: \"like\",\n      [\".startsWith\"]: \"starts_with\",\n      [\".endsWith\"]: \"ends_with\",\n      [\"$contains\"]: \"select_any_in\",\n    };\n\n    const convertedArgs = args.map(v => convertArg(v, conv, config, meta, {\n      ...spel,\n      _groupField: parentSpel?._groupField\n    }));\n\n    //todo: make dynamic: use funcToOpMap and check obj type in basic config\n    if (methodName == \"contains\" && obj && obj[0].type == \"list\") {\n      const convertedObj = obj.map(v => convertArg(v, conv, config, meta, spel));\n      // {'yellow', 'green'}.?[true].contains(color)\n      if (!( convertedArgs.length == 1 && convertedArgs[0].valueSrc == \"field\" )) {\n        meta.errors.push(`Expected arg to method ${methodName} to be field but got: ${JSON.stringify(convertedArgs)}`);\n        return undefined;\n      }\n      const field = convertedArgs[0].value;\n      if (!( convertedObj.length == 1 && convertedObj[0].valueType == \"multiselect\" )) {\n        meta.errors.push(`Expected object of method ${methodName} to be inline list but got: ${JSON.stringify(convertedObj)}`);\n        return undefined;\n      }\n      const opKey = funcToOpMap[\"$\"+methodName];\n      const list = convertedObj[0];\n      return buildRule(config, meta, field, opKey, [list]);\n    } else if (funcToOpMap[\".\"+methodName]) {\n      // user.login.startsWith('gg')\n      const opKey = funcToOpMap[\".\"+methodName];\n      const parts = convertPath(obj, meta);\n      if (parts && convertedArgs.length == 1) {\n        const fullParts = [...groupFieldParts, ...parts];\n        const field = fullParts.join(fieldSeparator);\n        return buildRule(config, meta, field, opKey, convertedArgs);\n      }\n    } else if (methodName == \"parse\" && obj && obj[0].type == \"!new\" && obj[0].cls.at(-1) == \"SimpleDateFormat\") {\n      // new java.text.SimpleDateFormat('yyyy-MM-dd').parse('2022-01-15')\n      const args = obj[0].args.map(v => convertArg(v, conv, config, meta, {\n        ...spel,\n        _groupField: parentSpel?._groupField\n      }));\n      if (!( args.length == 1 && args[0].valueType == \"text\" )) {\n        meta.errors.push(`Expected args of ${obj[0].cls.join(\".\")}.${methodName} to be 1 string but got: ${JSON.stringify(args)}`);\n        return undefined;\n      }\n      if (!( convertedArgs.length == 1 && convertedArgs[0].valueType == \"text\" )) {\n        meta.errors.push(`Expected args of ${obj[0].cls.join(\".\")} to be 1 string but got: ${JSON.stringify(convertedArgs)}`);\n        return undefined;\n      }\n      const dateFormat = args[0].value;\n      const dateString = convertedArgs[0].value;\n      const valueType = dateFormat.includes(\" \") ? \"datetime\" : \"date\";\n      const field = null; // todo\n      const widget = valueType;\n      const fieldConfig = getFieldConfig(config, field);\n      const widgetConfig = config.widgets[widget || fieldConfig?.mainWidget];\n      const valueFormat = widgetConfig.valueFormat;\n      const dateVal = moment(dateString, moment.ISO_8601);\n      const value = dateVal.isValid() ? dateVal.format(valueFormat) : undefined;\n      return {\n        valueSrc: \"value\",\n        valueType,\n        value,\n      };\n    } else if (methodName == \"parse\" && obj && obj[0].type == \"!type\" && obj[0].cls.at(-1) == \"LocalTime\") {\n      // time == T(java.time.LocalTime).parse('02:03:00')\n      if (!( convertedArgs.length == 1 && convertedArgs[0].valueType == \"text\" )) {\n        meta.errors.push(`Expected args of ${obj[0].cls.join(\".\")} to be 1 string but got: ${JSON.stringify(convertedArgs)}`);\n        return undefined;\n      }\n      const timeString = convertedArgs[0].value;\n      const valueType = \"time\";\n      const field = null; // todo\n      const widget = valueType;\n      const fieldConfig = getFieldConfig(config, field);\n      const widgetConfig = config.widgets[widget || fieldConfig?.mainWidget];\n      const valueFormat = widgetConfig.valueFormat;\n      const dateVal = moment(timeString, \"HH:mm:ss\");\n      const value = dateVal.isValid() ? dateVal.format(valueFormat) : undefined;\n      return {\n        valueSrc: \"value\",\n        valueType,\n        value,\n      };\n    } else {\n      // todo: conv.funcs\n      meta.errors.push(`Unsupported method ${methodName}`);\n    }\n  } else if (spel.type == \"op-plus\" && parentSpel?.type == \"ternary\") {\n    return buildCaseValueConcat(spel, conv, config, meta);\n  } else {\n    meta.errors.push(`Can't convert arg of type ${spel.type}`);\n  }\n  return undefined;\n};\n\nconst buildRule = (config, meta, field, opKey, convertedArgs) => {\n  if (convertedArgs.filter(v => v === undefined).length) {\n    return undefined;\n  }\n  const fieldConfig = getFieldConfig(config, field);\n  if (!fieldConfig) {\n    meta.errors.push(`No config for field ${field}`);\n    return undefined;\n  }\n  const widget = getWidgetForFieldOp(config, field, opKey);\n  const widgetConfig = config.widgets[widget || fieldConfig.mainWidget];\n  const asyncListValuesArr = convertedArgs.map(v => v.asyncListValues).filter(v => v != undefined);\n  const asyncListValues = asyncListValuesArr.length ? asyncListValuesArr[0] : undefined;\n  let res = {\n    type: \"rule\",\n    id: uuid(),\n    properties: {\n      field: field,\n      operator: opKey,\n      value: convertedArgs.map(v => v.value),\n      valueSrc: convertedArgs.map(v => v.valueSrc),\n      valueType: convertedArgs.map(v => {\n        if (v.valueSrc == \"value\") {\n          return widgetConfig?.type || fieldConfig?.type || v.valueType;\n        }\n        return v.valueType;\n      }),\n      asyncListValues,\n    }\n  };\n  return res;\n};\n\nconst buildRuleGroup = ({groupFilter, groupFieldValue}, opKey, convertedArgs, config, meta) => {\n  if (groupFieldValue.valueSrc != \"field\")\n    throw `Bad groupFieldValue: ${JSON.stringify(groupFieldValue)}`;\n  const groupField = groupFieldValue.value;\n  let groupOpRule = buildRule(config, meta, groupField, opKey, convertedArgs);\n  if (!groupOpRule)\n    return undefined;\n  const fieldConfig = getFieldConfig(config, groupField);\n  const mode = fieldConfig?.mode;\n  let res = {\n    ...(groupFilter || {}),\n    type: \"rule_group\",\n    properties: {\n      ...groupOpRule.properties,\n      ...(groupFilter?.properties || {}),\n      mode\n    }\n  };\n  if (!res.id)\n    res.id = uuid();\n  return res;\n};\n\n\nconst compareArgs = (left, right,  spel, conv, config, meta, parentSpel = null) => {\n  if (left.type == right.type) {\n    if (left.type == \"!aggr\") {\n      const [leftSource, rightSource] = [left.source, right.source].map(v => convertArg(v, conv, config, meta, {\n        ...spel,\n        _groupField: parentSpel?._groupField\n      }));\n      //todo: check same filter\n      return leftSource.value == rightSource.value;\n    } else {\n      const [leftVal, rightVal] = [left, right].map(v => convertArg(v, conv, config, meta, {\n        ...spel,\n        _groupField: parentSpel?._groupField\n      }));\n      return leftVal.value == rightVal.value;\n    }\n  }\n  return false;\n};\n\nconst convertToTree = (spel, conv, config, meta, parentSpel = null) => {\n  if(!spel) return undefined;\n  let res;\n  if (spel.type.indexOf(\"op-\") == 0) {\n    let op = spel.type.slice(\"op-\".length);\n\n    // unary\n    const isUnary = (op == \"minus\" || op == \"plus\") && spel.children.length == 1;\n    if (isUnary) {\n      spel.isUnary = true;\n      return convertToTree(spel.children[0], conv, config, meta, spel);\n    }\n\n    // between\n    let isBetweenNormal = (op == \"and\" && spel.children.length == 2 && spel.children[0].type == \"op-ge\" && spel.children[1].type == \"op-le\");\n    let isBetweenRev = (op == \"or\" && spel.children.length == 2 && spel.children[0].type == \"op-lt\" && spel.children[1].type == \"op-gt\");\n    let isBetween = isBetweenNormal || isBetweenRev;\n    if (isBetween) {\n      const [left, from] = spel.children[0].children;\n      const [right, to] = spel.children[1].children;\n      const isNumbers = from.type == \"number\" && to.type == \"number\";\n      const isSameSource = compareArgs(left, right,  spel, conv, config, meta, parentSpel);\n      if (isNumbers && isSameSource) {\n        const _fromValue = from.val;\n        const _toValue = to.val;\n        const oneSpel = {\n          type: \"op-between\",\n          children: [\n            left,\n            from,\n            to\n          ]\n        };\n        return convertToTree(oneSpel, conv, config, meta, parentSpel);\n      }\n    }\n\n    // find op\n    let opKeys = conv.operators[op];\n    let opKey;\n    // todo: make dynamic, use basic config\n    if (op == \"eq\" && spel.children[1].type == \"null\") {\n      opKey = \"is_null\";\n    } else if (op == \"ne\" && spel.children[1].type == \"null\") {\n      opKey = \"is_not_null\";\n    } else if (op == \"le\" && spel.children[1].type == \"string\" && spel.children[1].val == \"\") {\n      opKey = \"is_empty\";\n      opKeys = [\"is_empty\"];\n    } else if (op == \"gt\" && spel.children[1].type == \"string\" && spel.children[1].val == \"\") {\n      opKey = \"is_not_empty\";\n      opKeys = [\"is_not_empty\"];\n    } else if (op == \"between\") {\n      opKey = \"between\";\n      opKeys = [\"between\"];\n    }\n\n    // convert children\n    const convertChildren = () => spel.children.map(child => \n      convertToTree(child, conv, config, meta, {\n        ...spel,\n        _groupField: parentSpel?._groupField\n      })\n    );\n    \n    if (op == \"and\" || op == \"or\") {\n      const children1 = {};\n      const vals = convertChildren();\n      vals.forEach(v => {\n        if (v) {\n          const id = uuid();\n          v.id = id;\n          if (v.type != undefined) {\n            children1[id] = v;\n          } else {\n            meta.errors.push(`Bad item in AND/OR: ${JSON.stringify(v)}`);\n          }\n        }\n      });\n      res = {\n        type: \"group\",\n        id: uuid(),\n        children1,\n        properties: {\n          conjunction: conv.conjunctions[op],\n          not: spel.not\n        }\n      };\n    } else if (opKeys) {\n      const vals = convertChildren();\n      const fieldObj = vals[0];\n      let convertedArgs = vals.slice(1);\n      opKey = opKeys[0];\n      \n      if (!fieldObj) {\n        // LHS can't be parsed\n      } else if (fieldObj.groupFieldValue) {\n        // 1. group\n        if (fieldObj.groupFieldValue.valueSrc != \"field\") {\n          meta.errors.push(`Expected group field ${JSON.stringify(fieldObj)}`);\n        }\n        const groupField = fieldObj.groupFieldValue.value;\n        \n        // some/all/none\n        const opArg = convertedArgs[0];\n        if (opArg && opArg.groupFieldValue && opArg.groupFieldValue.valueSrc == \"field\" && opArg.groupFieldValue.value == groupField) {\n          // group.?[...].size() == group.size()\n          opKey = \"all\";\n          convertedArgs = [];\n        } else if (opKey == \"equal\" && opArg.valueSrc == \"value\" && opArg.valueType == \"number\" && opArg.value == 0) {\n          opKey = \"none\";\n          convertedArgs = [];\n        } else if (opKey == \"greater\" && opArg.valueSrc == \"value\" && opArg.valueType == \"number\" && opArg.value == 0) {\n          opKey = \"some\";\n          convertedArgs = [];\n        }\n\n        res = buildRuleGroup(fieldObj, opKey, convertedArgs, config, meta);\n      } else {\n        // 2. not group\n        if (fieldObj.valueSrc != \"field\") {\n          meta.errors.push(`Expected field ${JSON.stringify(fieldObj)}`);\n        }\n        const field = fieldObj.value;\n\n        if (opKeys.length > 1) {\n          logger.warn(`[spel] Spel operator ${op} can be mapped to ${opKeys}`);\n\n          //todo: it's naive\n          const widgets = opKeys.map(op => ({op, widget: getWidgetForFieldOp(config, field, op)}));\n          if (op == \"eq\") {\n            const ws = widgets.find(({op, widget}) => (widget && widget != \"field\"));\n            opKey = ws.op;\n          }\n        }\n        res = buildRule(config, meta, field, opKey, convertedArgs);\n      }\n    } else {\n      if (!parentSpel) {\n        // try to parse whole `\"str\" + prop + #var` as ternary\n        res = buildSimpleSwitch(spel, conv, config, meta);\n      }\n      if (!res) {\n        meta.errors.push(`Can't convert op ${op}`);\n      }\n    }\n  } else if (spel.type == \"!aggr\") {\n    const groupFieldValue = convertToTree(spel.source, conv, config, meta, {\n      ...spel, \n      _groupField: parentSpel?._groupField\n    });\n    let groupFilter = convertToTree(spel.filter, conv, config, meta, {\n      ...spel, \n      _groupField: groupFieldValue?.value\n    });\n    if (groupFilter?.type == \"rule\") {\n      groupFilter = wrapInDefaultConj(groupFilter, config);\n    }\n    res = {\n      groupFilter,\n      groupFieldValue\n    };\n    if (!parentSpel) {\n      // !aggr can't be in root, it should be compared with something\n      res = undefined;\n      meta.errors.push(\"Unexpected !aggr in root\");\n    }\n  } else if (spel.type == \"ternary\") {\n    const children1 = {};\n    spel.val.forEach(v => {\n      const [cond, val] = v;\n      const caseI = buildCase(cond, val, conv, config, meta, spel);\n      if (caseI) {\n        children1[caseI.id] = caseI;\n      }\n    });\n    res = {\n      type: \"switch_group\",\n      id: uuid(),\n      children1,\n      properties: {}\n    };\n  } else {\n    res = convertArg(spel, conv, config, meta, parentSpel);\n    if (res && !res.type && !parentSpel) {\n      // try to parse whole `\"1\"` as ternary\n      const sw = buildSimpleSwitch(spel, conv, config, meta);\n      if (sw) {\n        res = sw;\n      } else {\n        res = undefined;\n        meta.errors.push(`Can't convert rule of type ${spel.type}, it looks like var/literal`);\n      }\n    }\n  }\n  return res;\n};\n\nconst buildSimpleSwitch = (val, conv, config, meta) => {\n  let children1 = {};\n  const cond = null;\n  const caseI = buildCase(cond, val, conv, config, meta);\n  if (caseI) {\n    children1[caseI.id] = caseI;\n  }\n  let res = {\n    type: \"switch_group\",\n    id: uuid(),\n    children1,\n    properties: {}\n  };\n  return res;\n};\n\nconst buildCase = (cond, val, conv, config, meta, spel = null) => {\n  const valProperties = buildCaseValProperties(config, meta, conv, val, spel);\n\n  let caseI;\n  if (cond) {\n    caseI = convertToTree(cond, conv, config, meta, spel);\n    if (caseI && caseI.type) {\n      if (caseI.type != \"group\") {\n        caseI = wrapInDefaultConj(caseI, config);\n      }\n      caseI.type = \"case_group\";\n    } else {\n      meta.errors.push(`Unexpected case: ${JSON.stringify(caseI)}`);\n      caseI = undefined;\n    }\n  } else {\n    caseI = {\n      id: uuid(),\n      type: \"case_group\",\n      properties: {}\n    };\n  }\n\n  if (caseI) {\n    caseI.properties = {\n      ...caseI.properties,\n      ...valProperties\n    };\n  }\n\n  return caseI;\n};\n\nconst buildCaseValueConcat = (spel, conv, config, meta) => {\n  let flat = [];\n  function _processConcatChildren(children) {\n    children.map(child => {\n      if (child.type == \"op-plus\") {\n        _processConcatChildren(child.children);\n      } else {\n        const convertedChild = convertArg(child, conv, config, meta, spel);\n        if (convertedChild) {\n          flat.push(convertedChild);\n        } else {\n          meta.errors.push(`Can't convert ${child.type} in concatenation`);\n        }\n      }\n    });\n  }\n  _processConcatChildren(spel.children);\n  return {\n    valueSrc: \"value\",\n    valueType: \"case_value\",\n    value: flat,\n  };\n};\n\nconst buildCaseValProperties = (config, meta, conv, val, spel = null) => {\n  let valProperties = {};\n  let convVal;\n  if (val?.type == \"op-plus\") {\n    convVal = buildCaseValueConcat(val, conv, config, meta);\n  } else {\n    convVal = convertArg(val, conv, config, meta, spel);\n  }\n  const widgetDef = config.widgets[\"case_value\"];\n  const importCaseValue = widgetDef?.spelImportValue;\n  if (importCaseValue) {\n    const [normVal, normErrors] = importCaseValue(convVal);\n    normErrors.map(e => meta.errors.push(e));\n    if (normVal) {\n      valProperties = {\n        value: [normVal],\n        valueSrc: [\"value\"],\n        valueType: [\"case_value\"]\n      };\n    }\n  } else {\n    meta.errors.push(\"No fucntion to import case value\");\n  }\n  return valProperties;\n};\n\nconst wrapInDefaultConjRuleGroup = (rule, parentField, parentFieldConfig, config, conj) => {\n  if (!rule) return undefined;\n  return {\n    type: \"rule_group\",\n    id: uuid(),\n    children1: { [rule.id]: rule },\n    properties: {\n      conjunction: conj || defaultGroupConjunction(config, parentFieldConfig),\n      not: false,\n      field: parentField,\n    }\n  };\n};\n\nconst wrapInDefaultConj = (rule, config, not = false) => {\n  return {\n    type: \"group\",\n    id: uuid(),\n    children1: { [rule.id]: rule },\n    properties: {\n      conjunction: defaultConjunction(config),\n      not: not\n    }\n  };\n};\n","import moment from \"moment\";\n\nconst NOW = {\n  label: \"Now\",\n  returnType: \"datetime\",\n  jsonLogic: \"now\",\n  //todo: document option `jsonLogicCustomOps`\n  //todo: add util to return all used custom ops to be added by user with `jsonLogic.add_operation`\n  jsonLogicCustomOps: {\n    now: () => new Date(),\n  },\n  spelFunc: \"new java.util.Date()\",\n  sqlFormatFunc: () => \"NOW()\",\n  mongoFormatFunc: () => new Date(),\n  formatFunc: () => \"NOW\",\n};\n\nconst RELATIVE_DATETIME = {\n  label: \"Relative\",\n  returnType: \"datetime\",\n  renderBrackets: [\"\", \"\"],\n  renderSeps: [\"\", \"\", \"\"],\n  jsonLogic: ({date, op, val, dim}) => ({\n    \"date_add\": [\n      date,\n      val * (op == \"minus\" ? -1 : +1),\n      dim\n    ]\n  }),\n  jsonLogicImport: (v) => {\n    const date = v[\"date_add\"][0];\n    const val = Math.abs(v[\"date_add\"][1]);\n    const op = v[\"date_add\"][1] >= 0 ? \"plus\" : \"minus\";\n    const dim = v[\"date_add\"][2];\n    return [date, op, val, dim];\n  },\n  jsonLogicCustomOps: {\n    date_add: (date, val, dim) => moment(date).add(val, dim).toDate()\n  },\n  // MySQL\n  //todo: other SQL dialects?\n  sqlFormatFunc: ({date, op, val, dim}) => `DATE_ADD(${date}, INTERVAL ${parseInt(val) * (op == \"minus\" ? -1 : +1)} ${dim.replace(/^'|'$/g, \"\")})`,\n  mongoFormatFunc: null, //todo: support?\n  //todo: spel\n  formatFunc: ({date, op, val, dim}) => (!val ? date : `${date} ${op == \"minus\" ? \"-\" : \"+\"} ${val} ${dim}`),\n  args: {\n    date: {\n      label: \"Date\",\n      type: \"datetime\",\n      defaultValue: {func: \"NOW\", args: []},\n      valueSources: [\"func\", \"field\"],\n    },\n    op: {\n      label: \"Op\",\n      type: \"select\",\n      defaultValue: \"plus\",\n      valueSources: [\"value\"],\n      mainWidgetProps: {\n        customProps: {\n          showSearch: false\n        }\n      },\n      fieldSettings: {\n        listValues: {\n          plus: \"+\",\n          minus: \"-\",\n        },\n      }\n    },\n    val: {\n      label: \"Value\",\n      type: \"number\",\n      fieldSettings: {\n        min: 0,\n      },\n      defaultValue: 0,\n      valueSources: [\"value\"],\n    },\n    dim: {\n      label: \"Dimension\",\n      type: \"select\",\n      defaultValue: \"day\",\n      valueSources: [\"value\"],\n      mainWidgetProps: {\n        customProps: {\n          showSearch: false\n        }\n      },\n      fieldSettings: {\n        listValues: {\n          day: \"day\",\n          week: \"week\",\n          month: \"month\",\n          year: \"year\",\n        },\n      }\n    },\n  }\n};\n\nconst LOWER = {\n  label: \"Lowercase\",\n  mongoFunc: \"$toLower\",\n  jsonLogic: \"toLowerCase\",\n  spelFunc: \".toLowerCase\",\n  //jsonLogicIsMethod: true, // Removed in JsonLogic 2.x due to Prototype Pollution\n  jsonLogicCustomOps: {\n    toLowerCase: (str) => str.toLowerCase(),\n  },\n  returnType: \"text\",\n  args: {\n    str: {\n      label: \"String\",\n      type: \"text\",\n      valueSources: [\"value\", \"field\"],\n    },\n  }\n};\n\nconst UPPER = {\n  label: \"Uppercase\",\n  mongoFunc: \"$toUpper\",\n  jsonLogic: \"toUpperCase\",\n  spelFunc: \".toUpperCase\",\n  //jsonLogicIsMethod: true, // Removed in JsonLogic 2.x due to Prototype Pollution\n  jsonLogicCustomOps: {\n    toUpperCase: (str) => str.toUpperCase(),\n  },\n  returnType: \"text\",\n  args: {\n    str: {\n      label: \"String\",\n      type: \"text\",\n      valueSources: [\"value\", \"field\"],\n    },\n  }\n};\n\nconst LINEAR_REGRESSION = {\n  label: \"Linear regression\",\n  returnType: \"number\",\n  formatFunc: ({coef, bias, val}, _) => `(${coef} * ${val} + ${bias})`,\n  sqlFormatFunc: ({coef, bias, val}) => `(${coef} * ${val} + ${bias})`,\n  spelFormatFunc: ({coef, bias, val}) => `(${coef} * ${val} + ${bias})`,\n  mongoFormatFunc: ({coef, bias, val}) => ({\"$sum\": [{\"$multiply\": [coef, val]}, bias]}),\n  jsonLogic: ({coef, bias, val}) => ({ \"+\": [ {\"*\": [coef, val]}, bias ] }),\n  jsonLogicImport: (v) => {\n    const coef = v[\"+\"][0][\"*\"][0];\n    const val = v[\"+\"][0][\"*\"][1];\n    const bias = v[\"+\"][1];\n    return [coef, val, bias];\n  },\n  renderBrackets: [\"\", \"\"],\n  renderSeps: [\" * \", \" + \"],\n  args: {\n    coef: {\n      label: \"Coef\",\n      type: \"number\",\n      defaultValue: 1,\n      valueSources: [\"value\"],\n    },\n    val: {\n      label: \"Value\",\n      type: \"number\",\n      valueSources: [\"value\", \"field\"],\n    },\n    bias: {\n      label: \"Bias\",\n      type: \"number\",\n      defaultValue: 0,\n      valueSources: [\"value\"],\n    }\n  }\n};\n\nexport {\n  LOWER,\n  UPPER,\n  NOW,\n  RELATIVE_DATETIME,\n  LINEAR_REGRESSION,\n};\n","export { default as Query } from \"./components/QueryContainer\";\nexport { default as Builder } from \"./components/Builder\";\n\nimport * as Export from \"./export\";\nimport * as Import from \"./import\";\nimport * as Widgets from \"./components/widgets/index\";\nimport * as Operators from \"./components/operators\";\nimport * as BasicUtils from \"./utils\";\nimport * as BasicFuncs from \"./config/funcs\";\nconst Utils = {...BasicUtils, ...Export, ...Import};\nexport {Widgets, Operators, Utils, Export, Import, BasicFuncs};\n\nexport {default as BasicConfig} from \"./config/basic\";\n\n","import {listValuesToArray, sleep, mapListValues} from \"./stuff\";\n\nexport const simulateAsyncFetch = (all, cPageSize = 0, delay = 1000) => async (search, offset, meta) => {\n  const pageSize = meta.pageSize != undefined ? meta.pageSize : cPageSize;\n  const filtered = listValuesToArray(all)\n    .filter(({title}) => search == null ? true : title.toUpperCase().indexOf(search.toUpperCase()) != -1);\n  const pages = pageSize ? Math.ceil(filtered.length / pageSize) : 0;\n  const currentOffset = offset || 0;\n  const currentPage = pageSize ? Math.ceil(currentOffset / pageSize) : null;\n  const values = pageSize ? filtered.slice(currentOffset, currentOffset + pageSize) : filtered;\n  const newOffset = pageSize ? currentOffset + values.length : null;\n  const hasMore = pageSize ? (newOffset < filtered.length) : false;\n  console.debug(\"simulateAsyncFetch\", {\n    search, offset, values, hasMore, filtered\n  });\n  await sleep(delay);\n  return {\n    values,\n    hasMore\n  };\n};\n\nexport const mergeListValues = (values, newValues, toStart = false) => {\n  if (!newValues)\n    return values;\n  const old = values || [];\n  const newFiltered = newValues.filter(v => old.find(av => av.value == v.value) == undefined);\n  const merged = toStart ? [...newFiltered, ...old] : [...old, ...newFiltered];\n  return merged;\n};\n\nexport const listValueToOption = (lv) => {\n  if (lv == null) return null;\n  const {title, value, disabled, groupTitle, renderTitle} = lv;\n  let option = {title, value};\n  if (disabled)\n    option.disabled = disabled;\n  if (groupTitle)\n    option.groupTitle = groupTitle;\n  if (renderTitle)\n    option.renderTitle = renderTitle;\n  return option;\n};\n\nexport const getListValue = (selectedValue, listValues) => \n  mapListValues(listValues, (lv) => (lv.value === selectedValue ? lv : null))\n    .filter(v => v !== null)\n    .shift();\n","import merge from \"lodash/merge\";\nimport uuid from \"../utils/uuid\";\nimport mergeWith from \"lodash/mergeWith\";\nimport {settings as defaultSettings} from \"../config/default\";\nimport moment from \"moment\";\nimport {normalizeListValues, mergeArraysSmart} from \"./stuff\";\nimport {getWidgetForFieldOp} from \"./ruleUtils\";\nimport clone from \"clone\";\nimport pick from \"lodash/pick\";\n\n\nconst configKeys = [\"conjunctions\", \"fields\", \"types\", \"operators\", \"widgets\", \"settings\", \"funcs\"];\n\nconst pickConfig = (props) => {\n  return pick(props, configKeys);\n};\n\nexport const createConfigMemo = () => {\n  const configStore = new Map();\n  const maxSize = 2; // current and prev\n  let configId = 0;\n\n  const extendAndStore = (config) => {\n    const extendedConfig = extendConfig(config, ++configId);\n    if ((configStore.size + 1) > maxSize) {\n      configStore.delete(configStore.keys()[0]);\n    }\n    configStore.set(config, extendedConfig);\n    return extendedConfig;\n  };\n\n  const findExtended = (findConfig) => {\n    // strict find:\n    // return configStore.get(findConfig) || configStore.values().find(ec => ec === findConfig);\n\n    for (const savedConfig of configStore.keys()) {\n      const found = configKeys.map(k => savedConfig[k] === findConfig[k]).filter(v => !v).length === 0;\n      if (found) {\n        return configStore.get(savedConfig);\n      }\n    }\n\n    for (const extendedConfig of configStore.values()) {\n      const found = configKeys.map(k => extendedConfig[k] === findConfig[k]).filter(v => !v).length === 0;\n      if (found) {\n        return extendedConfig;\n      }\n    }\n\n    return null;\n  };\n\n  const findOrExtend = (config) => {\n    return findExtended(config) || extendAndStore(config);\n  };\n  \n  return (props) => findOrExtend(pickConfig(props));\n};\n\n\n\nexport const extendConfig = (config, configId) => {\n  //operators, defaultOperator - merge\n  //widgetProps (including valueLabel, valuePlaceholder, hideOperator, operatorInlineLabel) - concrete by widget\n\n  if (config.__configId) {\n    return config;\n  }\n  \n  config = {...config};\n  config.settings = merge({}, defaultSettings, config.settings);\n  config._fieldsCntByType = {};\n  config._funcsCntByType = {};\n\n  config.types = clone(config.types);\n  _extendTypesConfig(config.types, config);\n\n  config.fields = clone(config.fields);\n  config.__fieldNames = {};\n  _extendFieldsConfig(config.fields, config);\n\n  config.funcs = clone(config.funcs);\n  _extendFuncArgsConfig(config.funcs, config);\n\n  moment.locale(config.settings.locale.moment);\n\n  Object.defineProperty(config, \"__configId\", {\n    enumerable: false,\n    writable: false,\n    value: configId || uuid()\n  });\n\n  return config;\n};\n\nfunction _extendTypesConfig(typesConfig, config) {\n  for (let type in typesConfig) {\n    let typeConfig = typesConfig[type];\n    _extendTypeConfig(type, typeConfig, config);\n  }\n}\n\nfunction _extendTypeConfig(type, typeConfig, config) {\n  let operators = null, defaultOperator = null;\n  typeConfig.mainWidget = typeConfig.mainWidget || Object.keys(typeConfig.widgets).filter(w => w != \"field\" && w != \"func\")[0];\n  for (let widget in typeConfig.widgets) {\n    let typeWidgetConfig = typeConfig.widgets[widget];\n    if (typeWidgetConfig.operators) {\n      let typeWidgetOperators = typeWidgetConfig.operators;\n      if (typeConfig.excludeOperators) {\n        typeWidgetOperators = typeWidgetOperators.filter(op => !typeConfig.excludeOperators.includes(op));\n      }\n      operators = mergeArraysSmart(operators, typeWidgetOperators);\n    }\n    if (typeWidgetConfig.defaultOperator)\n      defaultOperator = typeWidgetConfig.defaultOperator;\n    if (widget == typeConfig.mainWidget) {\n      typeWidgetConfig = merge({}, {widgetProps: typeConfig.mainWidgetProps || {}}, typeWidgetConfig);\n    }\n    typeConfig.widgets[widget] = typeWidgetConfig;\n  }\n  if (!typeConfig.valueSources)\n    typeConfig.valueSources = Object.keys(config.settings.valueSourcesInfo);\n  for (let valueSrc of typeConfig.valueSources) {\n    if (valueSrc != \"value\" && !typeConfig.widgets[valueSrc]) {\n      typeConfig.widgets[valueSrc] = {\n      };\n    }\n  }\n  if (!typeConfig.operators && operators)\n    typeConfig.operators = Array.from(new Set(operators)); //unique\n  if (!typeConfig.defaultOperator && defaultOperator)\n    typeConfig.defaultOperator = defaultOperator;\n}\n\nfunction _extendFieldsConfig(subconfig, config, path = []) {\n  for (let field in subconfig) {\n    _extendFieldConfig(subconfig[field], config, [...path, field]);\n    if (subconfig[field].subfields) {\n      _extendFieldsConfig(subconfig[field].subfields, config, [...path, field]);\n    }\n  }\n}\n\nfunction _extendFuncArgsConfig(subconfig, config) {\n  if (!subconfig) return;\n  for (let funcKey in subconfig) {\n    const funcDef = subconfig[funcKey];\n    if (funcDef.returnType) {\n      if (!config._funcsCntByType[funcDef.returnType])\n        config._funcsCntByType[funcDef.returnType] = 0;\n      config._funcsCntByType[funcDef.returnType]++;\n    }\n    for (let argKey in funcDef.args) {\n      _extendFieldConfig(funcDef.args[argKey], config, null, true);\n    }\n\n    // isOptional can be only in the end\n    if (funcDef.args) {\n      const argKeys = Object.keys(funcDef.args);\n      let tmpIsOptional = true;\n      for (const argKey of argKeys.reverse()) {\n        const argDef = funcDef.args[argKey];\n        if (!tmpIsOptional && argDef.isOptional) {\n          delete argDef.isOptional;\n        }\n        if (!argDef.isOptional)\n          tmpIsOptional = false;\n      }\n    }\n\n    if (funcDef.subfields) {\n      _extendFuncArgsConfig(funcDef.subfields, config);\n    }\n  }\n}\n\nfunction _extendFieldConfig(fieldConfig, config, path = null, isFuncArg = false) {\n  let operators = null, defaultOperator = null;\n  const typeConfig = config.types[fieldConfig.type];\n  const excludeOperatorsForField = fieldConfig.excludeOperators || [];\n  if (fieldConfig.type != \"!struct\" && fieldConfig.type != \"!group\") {\n    const keysToPutInFieldSettings = [\"listValues\", \"allowCustomValues\", \"validateValue\"];\n    if (!fieldConfig.fieldSettings)\n      fieldConfig.fieldSettings = {};\n    for (const k of keysToPutInFieldSettings) {\n      if (fieldConfig[k]) {\n        fieldConfig.fieldSettings[k] = fieldConfig[k];\n        delete fieldConfig[k];\n      }\n    }\n\n    if (fieldConfig.fieldSettings.listValues) {\n      fieldConfig.fieldSettings.listValues = normalizeListValues(fieldConfig.fieldSettings.listValues, fieldConfig.type, fieldConfig.fieldSettings);\n    }\n\n    if (!typeConfig) {\n      //console.warn(`No type config for ${fieldConfig.type}`);\n      fieldConfig.disabled = true;\n      return;\n    }\n    if (!isFuncArg) {\n      if (!config._fieldsCntByType[fieldConfig.type])\n        config._fieldsCntByType[fieldConfig.type] = 0;\n      config._fieldsCntByType[fieldConfig.type]++;\n    }\n\n    if (!fieldConfig.widgets)\n      fieldConfig.widgets = {};\n    if (isFuncArg)\n      fieldConfig._isFuncArg = true;\n    fieldConfig.mainWidget = fieldConfig.mainWidget || typeConfig.mainWidget;\n    fieldConfig.valueSources = fieldConfig.valueSources || typeConfig.valueSources;\n    const excludeOperatorsForType = typeConfig.excludeOperators || [];\n    for (let widget in typeConfig.widgets) {\n      let fieldWidgetConfig = fieldConfig.widgets[widget] || {};\n      const typeWidgetConfig = typeConfig.widgets[widget] || {};\n      if (!isFuncArg) {\n        //todo: why I've excluded isFuncArg ?\n        const excludeOperators = [...excludeOperatorsForField, ...excludeOperatorsForType];\n        const shouldIncludeOperators = fieldConfig.preferWidgets\n          && (widget == \"field\" || fieldConfig.preferWidgets.includes(widget))\n          || excludeOperators.length > 0;\n        if (fieldWidgetConfig.operators) {\n          const addOperators = fieldWidgetConfig.operators.filter(o => !excludeOperators.includes(o));\n          operators = [...(operators || []), ...addOperators];\n        } else if (shouldIncludeOperators && typeWidgetConfig.operators) {\n          const addOperators = typeWidgetConfig.operators.filter(o => !excludeOperators.includes(o));\n          operators = [...(operators || []), ...addOperators];\n        }\n        if (fieldWidgetConfig.defaultOperator)\n          defaultOperator = fieldWidgetConfig.defaultOperator;\n      }\n\n      if (widget == fieldConfig.mainWidget) {\n        fieldWidgetConfig = merge({}, {widgetProps: fieldConfig.mainWidgetProps || {}}, fieldWidgetConfig);\n      }\n      fieldConfig.widgets[widget] = fieldWidgetConfig;\n    }\n    if (!isFuncArg) {\n      if (!fieldConfig.operators && operators)\n        fieldConfig.operators = Array.from(new Set(operators));\n      if (!fieldConfig.defaultOperator && defaultOperator)\n        fieldConfig.defaultOperator = defaultOperator;\n    }\n  }\n\n  const computedFieldName = computeFieldName(config, path);\n  if (computedFieldName) {\n    fieldConfig.fieldName = computedFieldName;\n  }\n\n  if (path && fieldConfig.fieldName) {\n    config.__fieldNames[fieldConfig.fieldName] = path;\n  }\n}\n\nexport const getFieldRawConfig = (config, field, fieldsKey = \"fields\", subfieldsKey = \"subfields\") => {\n  if (!field)\n    return null;\n  if (field == \"!case_value\") {\n    return {\n      type: \"case_value\",\n      mainWidget: \"case_value\",\n      widgets: {\n        \"case_value\": config.widgets[\"case_value\"]\n      }\n    };\n  }\n  const fieldSeparator = config.settings.fieldSeparator;\n  //field = normalizeField(config, field);\n  const parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  const targetFields = config[fieldsKey];\n  if (!targetFields)\n    return null;\n\n  let fields = targetFields;\n  let fieldConfig = null;\n  let path = [];\n  for (let i = 0 ; i < parts.length ; i++) {\n    const part = parts[i];\n    path.push(part);\n    const pathKey = path.join(fieldSeparator);\n    fieldConfig = fields[pathKey];\n    if (i < parts.length-1) {\n      if (fieldConfig && fieldConfig[subfieldsKey]) {\n        fields = fieldConfig[subfieldsKey];\n        path = [];\n      } else {\n        fieldConfig = null;\n      }\n    }\n  }\n\n  return fieldConfig;\n};\n\nconst computeFieldName = (config, path) => {\n  if (!path)\n    return null;\n  const fieldSeparator = config.settings.fieldSeparator;\n  let l = [...path], r = [], f, fConfig;\n  while ((f = l.pop()) !== undefined && l.length > 0) {\n    r.unshift(f);\n    fConfig = getFieldRawConfig(config, l);\n    if (fConfig.fieldName) {\n      return [fConfig.fieldName, ...r].join(fieldSeparator);\n    }\n  }\n  return null;\n};\n\nexport const normalizeField = (config, field) => {\n  const fieldSeparator = config.settings.fieldSeparator;\n  const fieldStr = Array.isArray(field) ? field.join(fieldSeparator) : field;\n  if (config.__fieldNames[fieldStr]) {\n    return config.__fieldNames[fieldStr].join(fieldSeparator);\n  }\n  return fieldStr;\n};\n\nexport const getFuncConfig = (config, func) => {\n  if (!func)\n    return null;\n  const funcConfig = getFieldRawConfig(config, func, \"funcs\", \"subfields\");\n  if (!funcConfig)\n    return null; //throw new Error(\"Can't find func \" + func + \", please check your config\");\n  return funcConfig;\n};\n\nexport const getFuncArgConfig = (config, funcKey, argKey) => {\n  const funcConfig = getFuncConfig(config, funcKey);\n  if (!funcConfig)\n    return null; //throw new Error(`Can't find func ${funcKey}, please check your config`);\n  const argConfig = funcConfig.args && funcConfig.args[argKey] || null;\n  if (!argConfig)\n    return null; //throw new Error(`Can't find arg ${argKey} for func ${funcKey}, please check your config`);\n\n  //merge, but don't merge operators (rewrite instead)\n  const typeConfig = config.types[argConfig.type] || {};\n  let ret = mergeWith({}, typeConfig, argConfig || {}, (objValue, srcValue, _key, _object, _source, _stack) => {\n    if (Array.isArray(objValue)) {\n      return srcValue;\n    }\n  });\n\n  return ret;\n};\n\nexport const getFieldConfig = (config, field) => {\n  if (!field)\n    return null;\n  if (typeof field == \"object\" && !field.func && !!field.type)\n    return field;\n  if (typeof field == \"object\" && field.func && field.arg)\n    return getFuncArgConfig(config, field.func, field.arg);\n  const fieldConfig = getFieldRawConfig(config, field);\n  if (!fieldConfig)\n    return null; //throw new Error(\"Can't find field \" + field + \", please check your config\");\n\n  //merge, but don't merge operators (rewrite instead)\n  const typeConfig = config.types[fieldConfig.type] || {};\n  let ret = mergeWith({}, typeConfig, fieldConfig || {}, (objValue, srcValue, _key, _object, _source, _stack) => {\n    if (Array.isArray(objValue)) {\n      return srcValue;\n    }\n  });\n\n  return ret;\n};\n\nexport const getOperatorConfig = (config, operator, field = null) => {\n  if (!operator)\n    return null;\n  const opConfig = config.operators[operator];\n  if (field) {\n    const fieldConfig = getFieldConfig(config, field);\n    const widget = getWidgetForFieldOp(config, field, operator);\n    const widgetConfig = config.widgets[widget] || {};\n    const fieldWidgetConfig = (fieldConfig && fieldConfig.widgets ? fieldConfig.widgets[widget] : {}) || {};\n    const widgetOpProps = (widgetConfig.opProps || {})[operator];\n    const fieldWidgetOpProps = (fieldWidgetConfig.opProps || {})[operator];\n    const mergedOpConfig = merge({}, opConfig, widgetOpProps, fieldWidgetOpProps);\n    return mergedOpConfig;\n  } else {\n    return opConfig;\n  }\n};\n\nexport const getFieldWidgetConfig = (config, field, operator, widget = null, valueSrc = null) => {\n  if (!field)\n    return null;\n  if (!(operator || widget) && valueSrc != \"const\" && field != \"!case_value\")\n    return null;\n  const fieldConfig = getFieldConfig(config, field);\n  if (!widget)\n    widget = getWidgetForFieldOp(config, field, operator, valueSrc);\n  const widgetConfig = config.widgets[widget] || {};\n  const fieldWidgetConfig = (fieldConfig && fieldConfig.widgets ? fieldConfig.widgets[widget] : {}) || {};\n  const fieldWidgetProps = (fieldWidgetConfig.widgetProps || {});\n  const valueFieldSettings = (valueSrc == \"value\" || !valueSrc) && fieldConfig && fieldConfig.fieldSettings || {}; // useful to take 'validateValue'\n  const mergedConfig = merge({}, widgetConfig, fieldWidgetProps, valueFieldSettings);\n  return mergedConfig;\n};\n","import Immutable from \"immutable\";\nimport uuid from \"./uuid\";\nimport {getFieldConfig, getOperatorConfig} from \"./configUtils\";\nimport {getNewValueForFieldOp, getFirstField, getFirstOperator} from \"../utils/ruleUtils\";\n\n\nexport const defaultField = (config, canGetFirst = true, parentRuleGroupPath = null) => {\n  return typeof config.settings.defaultField === \"function\"\n    ? config.settings.defaultField(parentRuleGroupPath) \n    : (config.settings.defaultField || (canGetFirst ? getFirstField(config, parentRuleGroupPath) : null));\n};\n\nexport const defaultOperator = (config, field, canGetFirst = true) => {\n  let fieldConfig = getFieldConfig(config, field);\n  let fieldOperators = fieldConfig && fieldConfig.operators || [];\n  let fieldDefaultOperator = fieldConfig && fieldConfig.defaultOperator;\n  if (!fieldOperators.includes(fieldDefaultOperator))\n    fieldDefaultOperator = null;\n  if (!fieldDefaultOperator && canGetFirst)\n    fieldDefaultOperator = getFirstOperator(config, field);\n  let op = typeof config.settings.defaultOperator === \"function\"\n    ? config.settings.defaultOperator(field, fieldConfig) : fieldDefaultOperator;\n  return op;\n};\n\n//used for complex operators like proximity\nexport const defaultOperatorOptions = (config, operator, field) => {\n  let operatorConfig = operator ? getOperatorConfig(config, operator, field) : null;\n  if (!operatorConfig)\n    return null; //new Immutable.Map();\n  return operatorConfig.options ? new Immutable.Map(\n    operatorConfig.options\n    && operatorConfig.options.defaults || {}\n  ) : null;\n};\n\nexport const defaultRuleProperties = (config, parentRuleGroupPath = null, item = null) => {\n  let field = null, operator = null;\n  const {setDefaultFieldAndOp, showErrorMessage} = config.settings;\n  if (item) {\n    field = item?.properties?.field;\n    operator = item?.properties?.operator;\n  } else if (setDefaultFieldAndOp) {\n    field = defaultField(config, true, parentRuleGroupPath);\n    operator = defaultOperator(config, field);\n  }\n  let current = new Immutable.Map({\n    field: field,\n    operator: operator,\n    value: new Immutable.List(),\n    valueSrc: new Immutable.List(),\n    //used for complex operators like proximity\n    operatorOptions: defaultOperatorOptions(config, operator, field),\n  });\n  if (showErrorMessage) {\n    current = current.set(\"valueError\", new Immutable.List());\n  }\n  \n  if (field && operator) {\n    let {newValue, newValueSrc, newValueType, newValueError} = getNewValueForFieldOp(\n      config, config, current, field, operator, \"operator\", false\n    );\n    current = current\n      .set(\"value\", newValue)\n      .set(\"valueSrc\", newValueSrc)\n      .set(\"valueType\", newValueType);\n    if (showErrorMessage) {\n      current = current\n        .set(\"valueError\", newValueError);\n    }\n  }\n  return current; \n};\n\n\nexport const defaultGroupConjunction = (config, fieldConfig = null) => {\n  fieldConfig = getFieldConfig(config, fieldConfig); // if `fieldConfig` is field name, not config\n  const conjs = fieldConfig && fieldConfig.conjunctions || Object.keys(config.conjunctions);\n  if (conjs.length == 1)\n    return conjs[0];\n  return config.settings.defaultGroupConjunction || config.settings.defaultConjunction || conjs[0];\n};\n\nexport const defaultConjunction = (config) =>\n  config.settings.defaultConjunction || Object.keys(config.conjunctions)[0];\n\nexport const defaultGroupProperties = (config, fieldConfig = null) => new Immutable.Map({\n  conjunction: defaultGroupConjunction(config, fieldConfig),\n  not: false\n});\n\nexport const defaultItemProperties = (config, item) => {\n  return item && item.type == \"group\" \n    ? defaultGroupProperties(config, item?.properties?.field) \n    : defaultRuleProperties(config, null, item);\n};\n\nexport const defaultRule = (id, config) => ({\n  [id]: new Immutable.Map({\n    type: \"rule\",\n    id: id,\n    properties: defaultRuleProperties(config)\n  })\n});\n\nexport const defaultRoot = (config) => {\n  return new Immutable.Map({\n    type: \"group\",\n    id: uuid(),\n    children1: new Immutable.OrderedMap({ ...defaultRule(uuid(), config) }),\n    properties: defaultGroupProperties(config)\n  });\n};\n","let SqlString = require(\"sqlstring\");\n\nSqlString.trim = (val) => {\n  if (val.charAt(0) == \"'\")\n    return val.substring(1, val.length-1);\n  else\n    return val;\n};\n\nSqlString.escapeLike = (val, any_start = true, any_end = true) => {\n  // normal escape\n  let res = SqlString.escape(val);\n  // unwrap ''\n  res = SqlString.trim(res);\n  // escape % and _\n  res = res.replace(/[%_]/g, \"\\\\$&\");\n  // wrap with % for LIKE\n  res = (any_start ? \"%\" : \"\") + res + (any_end ? \"%\" : \"\");\n  // wrap ''\n  res = \"'\" + res + \"'\";\n  return res;\n};\n\nconst sqlEmptyValue = (fieldDef) => {\n  let v = \"''\";\n  const type = fieldDef?.type;\n  if (type == \"date\") {\n    //todo: support other SQL dialects?  0001-01-01 for oracle, 1970-01-01 for timestamp\n    v = \"'0000-00-00'\";\n  } else if (type == \"datetime\") {\n    v = \"'0000-00-00 00:00'\";\n  } else if (type == \"time\") {\n    v = \"'00:00'\";\n  } else if (type == \"number\") {\n    v = \"0\";\n  }\n  return v;\n};\n\nconst mongoEmptyValue = (fieldDef) => {\n  let v = \"\";\n  const type = fieldDef?.type;\n  if (type == \"number\") {\n    v = 0;\n  }\n  return v;\n};\n\n\nconst spelEscapeString = (val) => {\n  // Strings are delimited by single quotes. To put a single quote itself in a string, use two single quote characters. \n  return \"'\" + val.replace(/'/g, \"''\") + \"'\";\n};\n\nconst spelInlineList = (vals, toArray = false) => {\n  // find java type of values\n  let javaType;\n  let jt;\n  const numberJavaTypes = [\"int\", \"float\"];\n  vals.map(v => {\n    if (v !== undefined && v !== null) {\n      if (typeof v === \"string\") {\n        jt = \"String\";\n      } else if (typeof v === \"number\") {\n        jt = Number.isInteger(v) ? \"int\" : \"float\";\n      } else throw new Error(`spelEscape: Can't use value ${v} in array`);\n\n      if (!javaType) {\n        javaType = jt;\n      } else if (javaType != jt) {\n        if (numberJavaTypes.includes(javaType) && numberJavaTypes.includes(jt)) {\n          // found int and float in collecton - use float\n          javaType = \"float\";\n        } else throw new Error(`spelEscape: Can't use different types in array: found ${javaType} and ${jt}`);\n      }\n    }\n  });\n  if (!javaType) {\n    javaType = \"String\"; //default if empty array\n  }\n\n  // for floats we should add 'f' to all items\n  let escapedVals;\n  if (javaType == \"float\") {\n    escapedVals = vals.map(v => spelEscape(v, true));\n  } else {\n    escapedVals = vals.map(v => spelEscape(v));\n  }\n\n  // build inline list or array\n  let res;\n  if (toArray) {\n    res = `new ${javaType}[]{${escapedVals.join(\", \")}}`;\n  } else {\n    res = `{${escapedVals.join(\", \")}}`;\n  }\n  \n  return res;\n};\n\nconst spelFixList = (val) => {\n  // `{1,2}.contains(1)` NOT works\n  // `{1,2}.?[true].contains(1)` works\n  return `${val}.?[true]`;\n};\n\nconst spelEscape = (val, numberToFloat = false, arrayToArray = false) => {\n  // https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/expressions.html#expressions-ref-literal\n  if (val === undefined || val === null) {\n    return \"null\";\n  }\n  switch (typeof val) {\n  case \"boolean\":\n    return (val) ? \"true\" : \"false\";\n  case \"number\":\n    if (!Number.isFinite(val) || isNaN(val))\n      return undefined;\n    return val + (!Number.isInteger(val) || numberToFloat ? \"f\" : \"\");\n  case \"object\":\n    if (Array.isArray(val)) {\n      return spelInlineList(val, arrayToArray);\n    } else {\n      // see `spelFormatValue` for Date, LocalTime\n      throw new Error(\"spelEscape: Object is not supported\");\n    }\n  default: return spelEscapeString(val);\n  }\n};\n\nconst spelFormatConcat = (parts) => {\n  if (parts && Array.isArray(parts) && parts.length) {\n    return parts\n      .map(part => {\n        if (part.type == \"const\") {\n          return spelEscape(part.value);\n        } else if (part.type == \"property\") {\n          return \"\"+part.value;\n        } else if (part.type == \"variable\") {\n          return \"#\"+part.value;\n        } return undefined;\n      })\n      .filter(r => r != undefined)\n      .join(\" + \");\n  } else {\n    return \"null\";\n  }\n};\n\n// `val` is {value, valueType, valueSrc}\n// If `valueType` == \"case_value\", `value` is array of such items (to be considered as concatenation)\nconst spelImportConcat = (val) => {\n  if (val == undefined)\n    return [undefined, []];\n  let errors = [];\n  const parts = val.valueType == \"case_value\" ? val.value : [val];\n  const res = parts.map(child => {\n    if (child.valueSrc == \"value\") {\n      if (child.value === null) {\n        return undefined;\n      } else {\n        return {\n          type: \"const\", \n          value: child.value\n        };\n      }\n    } else if (child.valueSrc == \"field\") {\n      return {\n        type: (child.isVariable ? \"variable\" : \"property\"), \n        value: child.value\n      };\n    } else {\n      errors.push(`Unsupported valueSrc ${child.valueSrc} in concatenation`);\n    }\n  }).filter(v => v != undefined);\n  return [res, errors];\n};\n\nexport {\n  SqlString, sqlEmptyValue, \n  mongoEmptyValue, spelEscape, spelFixList, spelFormatConcat, spelImportConcat\n};\n","\nimport {getFieldConfig, getFuncConfig} from \"../utils/configUtils\";\nimport {filterValueSourcesForField} from \"../utils/ruleUtils\";\nimport Immutable from \"immutable\";\n\n// helpers\nconst isObject = (v) => (typeof v == \"object\" && v !== null && !Array.isArray(v));\n\n/**\n * @param {*} value\n * @param {string} valueSrc - 'value' | 'field' | 'func'\n * @param {object} config\n * @return {* | undefined} - undefined if func value is not complete (missing required arg vals); can return completed value != value\n */\nexport const completeValue = (value, valueSrc, config) => {\n  if (valueSrc == \"func\")\n    return completeFuncValue(value, config);\n  else\n    return value;\n};\n\n/**\n * @param {Immutable.Map} value\n * @param {object} config\n * @return {Immutable.Map | undefined} - undefined if func value is not complete (missing required arg vals); can return completed value != value\n */\nexport const completeFuncValue = (value, config) => {\n  const _checkFuncValue = (value) => {\n    if (!value)\n      return undefined;\n    const funcKey = value.get(\"func\");\n    const funcConfig = funcKey && getFuncConfig(config, funcKey);\n    if (!funcConfig)\n      return undefined;\n    let complValue = value;\n    let tmpHasOptional = false;\n    for (const argKey in funcConfig.args) {\n      const argConfig = funcConfig.args[argKey];\n      const {valueSources, isOptional, defaultValue} = argConfig;\n      const filteredValueSources = filterValueSourcesForField(config, valueSources, argConfig);\n      const args = complValue.get(\"args\");\n      const argDefaultValueSrc = filteredValueSources.length == 1 ? filteredValueSources[0] : undefined;\n      const argVal = args ? args.get(argKey) : undefined;\n      const argValue = argVal ? argVal.get(\"value\") : undefined;\n      const argValueSrc = (argVal ? argVal.get(\"valueSrc\") : undefined) || argDefaultValueSrc;\n      if (argValue !== undefined) {\n        const completeArgValue = completeValue(argValue, argValueSrc, config);\n        if (completeArgValue === undefined) {\n          return undefined;\n        } else if (completeArgValue !== argValue) {\n          complValue = complValue.setIn([\"args\", argKey, \"value\"], completeArgValue);\n        }\n        if (tmpHasOptional) {\n          // has gap\n          return undefined;\n        }\n      } else if (defaultValue !== undefined && !isObject(defaultValue)) {\n        complValue = complValue.setIn([\"args\", argKey, \"value\"], getDefaultArgValue(argConfig));\n        complValue = complValue.setIn([\"args\", argKey, \"valueSrc\"], \"value\");\n      } else if (isOptional) {\n        // optional\n        tmpHasOptional = true;\n      } else {\n        // missing value\n        return undefined;\n      }\n    }\n    return complValue;\n  };\n\n  return _checkFuncValue(value);\n};\n\n\n/**\n * @param {Immutable.Map} value \n * @return {array} - [usedFields, badFields]\n */\nconst getUsedFieldsInFuncValue = (value, config) => {\n  let usedFields = [];\n  let badFields = [];\n\n  const _traverse = (value) => {\n    const args = value && value.get(\"args\");\n    if (!args) return;\n    for (const arg of args.values()) {\n      if (arg.get(\"valueSrc\") == \"field\") {\n        const rightField = arg.get(\"value\");\n        if (rightField) {\n          const rightFieldDefinition = config ? getFieldConfig(config, rightField) : undefined;\n          if (config && !rightFieldDefinition)\n            badFields.push(rightField);\n          else\n            usedFields.push(rightField);\n        }\n      } else if (arg.get(\"valueSrc\") == \"func\") {\n        _traverse(arg.get(\"value\"));\n      }\n    }\n  };\n\n  _traverse(value);\n\n  return [usedFields, badFields];\n};\n\n\n/**\n * Used @ FuncWidget\n * @param {Immutable.Map} value \n * @param {string} funcKey \n * @param {object} config \n */\nexport const setFunc = (value, funcKey, config) => {\n  const fieldSeparator = config.settings.fieldSeparator;\n  value = value || new Immutable.Map();\n  if (Array.isArray(funcKey)) {\n    // fix for cascader\n    funcKey = funcKey.join(fieldSeparator);\n  }\n  value = value.set(\"func\", funcKey);\n  value = value.set(\"args\", new Immutable.Map());\n\n  // defaults\n  const funcConfig = funcKey && getFuncConfig(config, funcKey);\n  if (funcConfig) {\n    for (const argKey in funcConfig.args) {\n      const argConfig = funcConfig.args[argKey];\n      const {valueSources, defaultValue} = argConfig;\n      const filteredValueSources = filterValueSourcesForField(config, valueSources, argConfig);\n      const firstValueSrc = filteredValueSources.length ? filteredValueSources[0] : undefined;\n      const defaultValueSrc = defaultValue ? (isObject(defaultValue) && !!defaultValue.func ? \"func\" : \"value\") : undefined;\n      const argDefaultValueSrc = defaultValueSrc || firstValueSrc;\n      if (defaultValue !== undefined) {\n        value = value.setIn([\"args\", argKey, \"value\"], getDefaultArgValue(argConfig));\n      }\n      if (argDefaultValueSrc) {\n        value = value.setIn([\"args\", argKey, \"valueSrc\"], argDefaultValueSrc);\n      }\n    }\n  }\n\n  return value;\n};\n\nconst getDefaultArgValue = ({defaultValue: value}) => {\n  if (isObject(value) && !Immutable.Map.isMap(value) && value.func) {\n    return Immutable.fromJS(value, function (k, v) {\n      return Immutable.Iterable.isIndexed(v) ? v.toList() : v.toOrderedMap();\n    });\n  }\n  return value;\n};\n\n/**\n* Used @ FuncWidget\n* @param {Immutable.Map} value \n* @param {string} argKey \n* @param {*} argVal \n* @param {object} argConfig \n*/\nexport const setArgValue = (value, argKey, argVal, argConfig, config) => {\n  if (value && value.get(\"func\")) {\n    value = value.setIn([\"args\", argKey, \"value\"], argVal);\n\n    // set default arg value sorce\n    const {valueSources} = argConfig;\n    const filteredValueSources = filterValueSourcesForField(config, valueSources, argConfig);\n    const argDefaultValueSrc = filteredValueSources.length == 1 ? filteredValueSources[0] : undefined;\n    if (argDefaultValueSrc) {\n      value = value.setIn([\"args\", argKey, \"valueSrc\"], argDefaultValueSrc);\n    }\n  }\n  return value;\n};\n\n/**\n* Used @ FuncWidget\n* @param {Immutable.Map} value \n* @param {string} argKey \n* @param {string} argValSrc \n* @param {object} argConfig \n*/\nexport const setArgValueSrc = (value, argKey, argValSrc, _argConfig, _config) => {\n  if (value && value.get(\"func\")) {\n    value = value.setIn([\"args\", argKey], new Immutable.Map({valueSrc: argValSrc}));\n  }\n  return value;\n};\n","import React from \"react\";\nimport mapValues from \"lodash/mapValues\";\nimport {shallowEqual} from \"./stuff\";\n\nexport const liteShouldComponentUpdate = (self, config) => (nextProps, nextState) => {\n  const prevProps = self.props;\n  const prevState = self.state;\n\n  let should = nextProps != prevProps || nextState != prevState;\n  if (should) {\n    if (prevState == nextState && prevProps != nextProps) {\n      let chs = [];\n      for (let k in nextProps) {\n        let changed = (nextProps[k] != prevProps[k]);\n        if (changed) {\n          if (config[k] == \"ignore\")\n            changed = false;\n          else if (config[k] == \"shallow_deep\")\n            changed = !shallowEqual(nextProps[k], prevProps[k], true);\n          else if (config[k] == \"shallow\")\n            changed = !shallowEqual(nextProps[k], prevProps[k]);\n          else if (typeof config[k] == \"function\")\n            changed = config[k](nextProps[k], prevProps[k], nextState);\n        }\n        if (changed)\n          chs.push(k);\n      }\n      if (!chs.length)\n        should = false;\n    }\n  }\n  return should;\n};\n\nexport const pureShouldComponentUpdate = (self) => function(nextProps, nextState) {\n  return (\n    !shallowEqual(self.props, nextProps)\n    || !shallowEqual(self.state, nextState)\n  );\n};\n\nconst canUseUnsafe = () => {\n  const v = React.version.split(\".\").map(parseInt.bind(null, 10));\n  return v[0] == 16 && v[1] >= 3 || v[0] > 16;\n};\n\nexport const useOnPropsChanged = (obj) => {\n  if (canUseUnsafe) {\n    obj.UNSAFE_componentWillReceiveProps = (nextProps) => {\n      obj.onPropsChanged(nextProps);\n    };\n  } else {\n    obj.componentWillReceiveProps = (nextProps) => {\n      obj.onPropsChanged(nextProps);\n    };\n  }\n};\n\nexport const bindActionCreators = (actionCreators, config, dispatch) =>\n  mapValues(actionCreators, (actionCreator) =>\n    (...args) => dispatch(actionCreator(config, ...args))\n  );\n","import {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig, getFieldRawConfig\n} from \"./configUtils\";\nimport {defaultValue, getFirstDefined} from \"../utils/stuff\";\nimport Immutable from \"immutable\";\nimport {validateValue} from \"../utils/validation\";\nimport last from \"lodash/last\";\n\nconst selectTypes = [\n  \"select\",\n  \"multiselect\",\n  \"treeselect\",\n  \"treemultiselect\",\n];\n\n/**\n * @param {object} config\n * @param {object} oldConfig\n * @param {Immutable.Map} current\n * @param {string} newField\n * @param {string} newOperator\n * @param {string} changedProp\n * @return {object} - {canReuseValue, newValue, newValueSrc, newValueType, newValueError}\n */\nexport const getNewValueForFieldOp = function (config, oldConfig = null, current, newField, newOperator, changedProp = null, canFix = true, isEndValue = false) {\n  if (!oldConfig)\n    oldConfig = config;\n  const currentField = current.get(\"field\");\n  const currentOperator = current.get(\"operator\");\n  const currentValue = current.get(\"value\");\n  const currentValueSrc = current.get(\"valueSrc\", new Immutable.List());\n  const currentValueType = current.get(\"valueType\", new Immutable.List());\n  const currentAsyncListValues = current.get(\"asyncListValues\");\n\n  //const isValidatingTree = (changedProp === null);\n  const {convertableWidgets, clearValueOnChangeField, clearValueOnChangeOp, showErrorMessage} = config.settings;\n\n  //const currentOperatorConfig = getOperatorConfig(oldConfig, currentOperator, currentField);\n  const newOperatorConfig = getOperatorConfig(config, newOperator, newField);\n  //const currentOperatorCardinality = currentOperator ? defaultValue(currentOperatorConfig.cardinality, 1) : null;\n  const operatorCardinality = newOperator ? defaultValue(newOperatorConfig.cardinality, 1) : null;\n  const currentFieldConfig = getFieldConfig(oldConfig, currentField);\n  const newFieldConfig = getFieldConfig(config, newField);\n\n  let canReuseValue = currentField && currentOperator && newOperator && currentValue != undefined\n    && (!changedProp \n      || changedProp == \"field\" && !clearValueOnChangeField \n      || changedProp == \"operator\" && !clearValueOnChangeOp)\n    && (currentFieldConfig && newFieldConfig && currentFieldConfig.type == newFieldConfig.type);\n  if (canReuseValue && selectTypes.includes(currentFieldConfig.type) && changedProp == \"field\") {\n    // different fields of select types has different listValues\n    canReuseValue = false;\n  }\n\n  // compare old & new widgets\n  for (let i = 0 ; i < operatorCardinality ; i++) {\n    const vs = currentValueSrc.get(i) || null;\n    const currentWidget = getWidgetForFieldOp(oldConfig, currentField, currentOperator, vs);\n    const newWidget = getWidgetForFieldOp(config, newField, newOperator, vs);\n    // need to also check value widgets if we changed operator and current value source was 'field'\n    // cause for select type op '=' requires single value and op 'in' requires array value\n    const currentValueWidget = vs == \"value\" ? currentWidget : getWidgetForFieldOp(oldConfig, currentField, currentOperator, \"value\");\n    const newValueWidget = vs == \"value\" ? newWidget : getWidgetForFieldOp(config, newField, newOperator, \"value\");\n\n    const canReuseWidget = newValueWidget == currentValueWidget || (convertableWidgets[currentValueWidget] || []).includes(newValueWidget);\n    if (!canReuseWidget)\n      canReuseValue = false;\n  }\n\n  if (currentOperator != newOperator && [currentOperator, newOperator].includes(\"proximity\"))\n    canReuseValue = false;\n\n  const firstWidgetConfig = getFieldWidgetConfig(config, newField, newOperator, null, currentValueSrc.first());\n  const valueSources = getValueSourcesForFieldOp(config, newField, newOperator);\n  \n  let valueFixes = {};\n  let valueErrors = Array.from({length: operatorCardinality}, () => null);\n  if (canReuseValue) {\n    for (let i = 0 ; i < operatorCardinality ; i++) {\n      const v = currentValue.get(i);\n      const vType = currentValueType.get(i) || null;\n      const vSrc = currentValueSrc.get(i) || null;\n      let isValidSrc = (valueSources.find(v => v == vSrc) != null);\n      if (!isValidSrc && i > 0 && vSrc == null)\n        isValidSrc = true; // make exception for range widgets (when changing op from '==' to 'between')\n      const asyncListValues = currentAsyncListValues;\n      const [validateError, fixedValue] = validateValue(\n        config, newField, newField, newOperator, v, vType, vSrc, asyncListValues, canFix, isEndValue\n      );\n      const isValid = !validateError;\n      // Allow bad value with error message\n      // But not on field change - in that case just drop bad value that can't be reused\n      // ? Maybe we should also drop bad value on op change?\n      // For bad multiselect value we have both error message + fixed value.\n      //  If we show error message, it will gone on next tree validation\n      const fixValue = fixedValue !== v;\n      const dropValue = !isValidSrc || !isValid && (changedProp == \"field\" || !showErrorMessage && !fixValue);\n      const showValueError = !!validateError && showErrorMessage && !dropValue && !fixValue;\n      if (showValueError) {\n        valueErrors[i] = validateError;\n      }\n      if (fixValue) {\n        valueFixes[i] = fixedValue;\n      }\n      if (dropValue) {\n        canReuseValue = false;\n        break;\n      }\n    }\n  }\n\n  // reuse value OR get defaultValue for cardinality 1 (it means default range values is not supported yet, todo)\n  let newValue = null, newValueSrc = null, newValueType = null, newValueError = null;\n  newValue = new Immutable.List(Array.from({length: operatorCardinality}, (_ignore, i) => {\n    let v = undefined;\n    if (canReuseValue) {\n      if (i < currentValue.size) {\n        v = currentValue.get(i);\n        if (valueFixes[i] !== undefined) {\n          v = valueFixes[i];\n        }\n      }\n    } else if (operatorCardinality == 1) {\n      v = getFirstDefined([\n        newFieldConfig?.defaultValue,\n        newFieldConfig?.fieldSettings?.defaultValue,\n        firstWidgetConfig?.defaultValue\n      ]);\n    }\n    return v;\n  }));\n\n  newValueSrc = new Immutable.List(Array.from({length: operatorCardinality}, (_ignore, i) => {\n    let vs = null;\n    if (canReuseValue) {\n      if (i < currentValueSrc.size)\n        vs = currentValueSrc.get(i);\n    } else if (valueSources.length == 1) {\n      vs = valueSources[0];\n    } else if (valueSources.length > 1) {\n      vs = valueSources[0];\n    }\n    return vs;\n  }));\n\n  if (showErrorMessage) {\n    if (newOperatorConfig && newOperatorConfig.validateValues && newValueSrc.toJS().filter(vs => vs == \"value\" || vs == null).length == operatorCardinality) {\n      // last element in `valueError` list is for range validation error\n      const jsValues = firstWidgetConfig && firstWidgetConfig.toJS \n        ? newValue.toJS().map(v => firstWidgetConfig.toJS(v, firstWidgetConfig)) \n        : newValue.toJS();\n      const rangeValidateError = newOperatorConfig.validateValues(jsValues);\n      if (showErrorMessage) {\n        valueErrors.push(rangeValidateError);\n      }\n    }\n    newValueError = new Immutable.List(valueErrors);\n  }\n\n  newValueType = new Immutable.List(Array.from({length: operatorCardinality}, (_ignore, i) => {\n    let vt = null;\n    if (canReuseValue) {\n      if (i < currentValueType.size)\n        vt = currentValueType.get(i);\n    } else if (operatorCardinality == 1 && firstWidgetConfig && firstWidgetConfig.type !== undefined) {\n      vt = firstWidgetConfig.type;\n    } else if (operatorCardinality == 1 && newFieldConfig && newFieldConfig.type !== undefined) {\n      vt = newFieldConfig.type == \"!group\" ? \"number\" : newFieldConfig.type;\n    }\n    return vt;\n  }));\n\n  return {canReuseValue, newValue, newValueSrc, newValueType, newValueError, operatorCardinality};\n};\n\nexport const getFirstField = (config, parentRuleGroupPath = null) => {\n  const fieldSeparator = config.settings.fieldSeparator;\n  const parentPathArr = typeof parentRuleGroupPath == \"string\" ? parentRuleGroupPath.split(fieldSeparator) : parentRuleGroupPath;\n  const parentField = parentRuleGroupPath ? getFieldRawConfig(config, parentRuleGroupPath) : config;\n\n  let firstField = parentField, key = null, keysPath = [];\n  do {\n    const subfields = firstField === config ? config.fields : firstField.subfields;\n    if (!subfields || !Object.keys(subfields).length) {\n      firstField = key = null;\n      break;\n    }\n    key = Object.keys(subfields)[0];\n    keysPath.push(key);\n    firstField = subfields[key];\n  } while (firstField.type == \"!struct\" || firstField.type == \"!group\");\n  return (parentPathArr || []).concat(keysPath).join(fieldSeparator);\n};\n\nexport const getOperatorsForField = (config, field) => {\n  const fieldConfig = getFieldConfig(config, field);\n  const fieldOps = fieldConfig ? fieldConfig.operators : [];\n  return fieldOps;\n};\n\nexport const getFirstOperator = (config, field) => {\n  const fieldOps = getOperatorsForField(config, field);\n  return fieldOps ? fieldOps[0] : null;\n};\n\nexport const getFieldPath = (field, config, onlyKeys = false) => {\n  if (!field)\n    return null;\n  const fieldSeparator = config.settings.fieldSeparator;\n  const parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  if (onlyKeys)\n    return parts;\n  else\n    return parts\n      .map((_curr, ind, arr) => arr.slice(0, ind+1))\n      .map((parts) => parts.join(fieldSeparator));\n};\n\nexport const getFuncPathLabels = (field, config, parentField = null) => {\n  return getFieldPathLabels(field, config, parentField, \"funcs\", \"subfields\");\n};\n\nexport const getFieldPathLabels = (field, config, parentField = null, fieldsKey = \"fields\", subfieldsKey = \"subfields\") => {\n  if (!field)\n    return null;\n  const fieldSeparator = config.settings.fieldSeparator;\n  const parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  const parentParts = parentField ? (Array.isArray(parentField) ? parentField : parentField.split(fieldSeparator)) : [];\n  return parts\n    .slice(parentParts.length)\n    .map((_curr, ind, arr) => arr.slice(0, ind+1))\n    .map((parts) => [...parentParts, ...parts].join(fieldSeparator))\n    .map(part => {\n      const cnf = getFieldRawConfig(config, part, fieldsKey, subfieldsKey);\n      return cnf && cnf.label || cnf && last(part.split(fieldSeparator));\n    })\n    .filter(label => label != null);\n};\n\nexport const getFieldPartsConfigs = (field, config, parentField = null) => {\n  if (!field)\n    return null;\n  const parentFieldDef = parentField && getFieldRawConfig(config, parentField) || null;\n  const fieldSeparator = config.settings.fieldSeparator;\n  const parts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  const parentParts = parentField ? (Array.isArray(parentField) ? parentField : parentField.split(fieldSeparator)) : [];\n  return parts\n    .slice(parentParts.length)\n    .map((_curr, ind, arr) => arr.slice(0, ind+1))\n    .map((parts) => ({\n      part: [...parentParts, ...parts].join(fieldSeparator),\n      key: parts[parts.length - 1]\n    }))\n    .map(({part, key}) => {\n      const cnf = getFieldRawConfig(config, part);\n      return {key, cnf};\n    })\n    .map(({key, cnf}, ind, arr) => {\n      const parentCnf = ind > 0 ? arr[ind - 1].cnf : parentFieldDef;\n      return [key, cnf, parentCnf];\n    });\n};\n\nexport const getValueLabel = (config, field, operator, delta, valueSrc = null, isSpecialRange = false) => {\n  const isFuncArg = field && typeof field == \"object\" && !!field.func && !!field.arg;\n  const {showLabels} = config.settings;\n  const fieldConfig = getFieldConfig(config, field);\n  const fieldWidgetConfig = getFieldWidgetConfig(config, field, operator, null, valueSrc) || {};\n  const mergedOpConfig = getOperatorConfig(config, operator, field) || {};\n    \n  const cardinality = isSpecialRange ? 1 : mergedOpConfig.cardinality;\n  let ret = null;\n  if (cardinality > 1) {\n    const valueLabels = fieldWidgetConfig.valueLabels || mergedOpConfig.valueLabels;\n    if (valueLabels)\n      ret = valueLabels[delta];\n    if (ret && typeof ret != \"object\") {\n      ret = {label: ret, placeholder: ret};\n    }\n    if (!ret) {\n      ret = {\n        label: config.settings.valueLabel + \" \" + (delta+1),\n        placeholder: config.settings.valuePlaceholder + \" \" + (delta+1),\n      };\n    }\n  } else {\n    let label = fieldWidgetConfig.valueLabel;\n    let placeholder = fieldWidgetConfig.valuePlaceholder;\n    if (isFuncArg) {\n      if (!label)\n        label = fieldConfig.label || field.arg;\n      if (!placeholder && !showLabels)\n        placeholder = fieldConfig.label || field.arg;\n    }\n\n    ret = {\n      label: label || config.settings.valueLabel, \n      placeholder: placeholder || config.settings.valuePlaceholder,\n    };\n  }\n  return ret;\n};\n\nfunction _getWidgetsAndSrcsForFieldOp (config, field, operator = null, valueSrc = null) {\n  let widgets = [];\n  let valueSrcs = [];\n  if (!field)\n    return {widgets, valueSrcs};\n  const isFuncArg = typeof field == \"object\" && (!!field.func && !!field.arg || field._isFuncArg);\n  const fieldConfig = getFieldConfig(config, field);\n  const opConfig = operator ? config.operators[operator] : null;\n  \n  if (fieldConfig && fieldConfig.widgets) {\n    for (const widget in fieldConfig.widgets) {\n      const widgetConfig = fieldConfig.widgets[widget];\n      // if (!config.widgets[widget]) {\n      //   continue;\n      // }\n      const widgetValueSrc = config.widgets[widget].valueSrc || \"value\";\n      let canAdd = true;\n      if (widget == \"field\") {\n        canAdd = canAdd && filterValueSourcesForField(config, [\"field\"], fieldConfig).length > 0;\n      }\n      if (widget == \"func\") {\n        canAdd = canAdd && filterValueSourcesForField(config, [\"func\"], fieldConfig).length > 0;\n      }\n      // If can't check operators, don't add\n      // Func args don't have operators\n      if (valueSrc == \"value\" && !widgetConfig.operators && !isFuncArg && field != \"!case_value\")\n        canAdd = false;\n      if (widgetConfig.operators && operator)\n        canAdd = canAdd && widgetConfig.operators.indexOf(operator) != -1;\n      if (valueSrc && valueSrc != widgetValueSrc && valueSrc != \"const\")\n        canAdd = false;\n      if (opConfig && opConfig.cardinality == 0 && (widgetValueSrc != \"value\"))\n        canAdd = false;\n      if (canAdd) {\n        widgets.push(widget);\n        let canAddValueSrc = fieldConfig.valueSources && fieldConfig.valueSources.indexOf(widgetValueSrc) != -1;\n        if (opConfig && opConfig.valueSources && opConfig.valueSources.indexOf(widgetValueSrc) == -1)\n          canAddValueSrc = false;\n        if (canAddValueSrc && !valueSrcs.find(v => v == widgetValueSrc))\n          valueSrcs.push(widgetValueSrc);\n      }\n    }\n  }\n\n  const widgetWeight = (w) => {\n    let wg = 0;\n    if (fieldConfig.preferWidgets) {\n      if (fieldConfig.preferWidgets.includes(w))\n        wg += (10 - fieldConfig.preferWidgets.indexOf(w));\n    } else if (w == fieldConfig.mainWidget) {\n      wg += 100;\n    }\n    if (w == \"field\") {\n      wg -= 1;\n    }\n    if (w == \"func\") {\n      wg -= 2;\n    }\n    return wg;\n  };\n\n  widgets.sort((w1, w2) => (widgetWeight(w2) - widgetWeight(w1)));\n    \n  return {widgets, valueSrcs};\n}\n\nexport const getWidgetsForFieldOp = (config, field, operator, valueSrc = null) => {\n  const {widgets} = _getWidgetsAndSrcsForFieldOp(config, field, operator, valueSrc);\n  return widgets;\n};\n\nexport const filterValueSourcesForField = (config, valueSrcs, fieldDefinition) => {\n  if (!fieldDefinition)\n    return valueSrcs;\n  return valueSrcs.filter(vs => {\n    let canAdd = true;\n    if (vs == \"field\") {\n      if (config._fieldsCntByType) {\n        // tip: LHS field can be used as arg in RHS function\n        const minCnt = fieldDefinition._isFuncArg ? 0 : 1;\n        canAdd = canAdd && config._fieldsCntByType[fieldDefinition.type] > minCnt;\n      }\n    }\n    if (vs == \"func\") {\n      if (config._funcsCntByType)\n        canAdd = canAdd && !!config._funcsCntByType[fieldDefinition.type];\n      if (fieldDefinition.funcs)\n        canAdd = canAdd && fieldDefinition.funcs.length > 0;\n    }\n    return canAdd;\n  });\n};\n\nexport const getValueSourcesForFieldOp = (config, field, operator, fieldDefinition = null, leftFieldForFunc = null) => {\n  const {valueSrcs} = _getWidgetsAndSrcsForFieldOp(config, field, operator, null);\n  const filteredValueSrcs = filterValueSourcesForField(config, valueSrcs, fieldDefinition);\n  return filteredValueSrcs;\n};\n\nexport const getWidgetForFieldOp = (config, field, operator, valueSrc = null) => {\n  const {widgets} = _getWidgetsAndSrcsForFieldOp(config, field, operator, valueSrc);\n  let widget = null;\n  if (widgets.length)\n    widget = widgets[0];\n  return widget;\n};\n\nexport const formatFieldName = (field, config, meta, parentField = null) => {\n  if (!field) return;\n  const fieldDef = getFieldConfig(config, field) || {};\n  const {fieldSeparator} = config.settings;\n  const fieldParts = Array.isArray(field) ? field : field.split(fieldSeparator);\n  let fieldName = Array.isArray(field) ? field.join(fieldSeparator) : field;\n  if (fieldDef.tableName) { // legacy\n    const fieldPartsCopy = [...fieldParts];\n    fieldPartsCopy[0] = fieldDef.tableName;\n    fieldName = fieldPartsCopy.join(fieldSeparator);\n  }\n  if (fieldDef.fieldName) {\n    fieldName = fieldDef.fieldName;\n  }\n  if (parentField) {\n    const parentFieldDef = getFieldConfig(config, parentField) || {};\n    let parentFieldName = parentField;\n    if (parentFieldDef.fieldName) {\n      parentFieldName = parentFieldDef.fieldName;\n    }\n    if (fieldName.indexOf(parentFieldName + fieldSeparator) == 0) {\n      fieldName = fieldName.slice((parentFieldName + fieldSeparator).length);\n    } else {\n      meta.errors.push(`Can't cut group ${parentFieldName} from field ${fieldName}`);\n    }\n  }\n  return fieldName;\n};\n\n","import Immutable, { Map } from \"immutable\";\n\n// RegExp.quote = function (str) {\n//     return str.replace(/([.?*+^$[\\]\\\\(){}|-])/g, \"\\\\$1\");\n// };\n\nexport const defaultValue = (value, _default) => {\n  return (typeof value === \"undefined\") ? _default : value;\n};\n\nexport const truncateString = (str, n, useWordBoundary) => {\n  if (!n || str.length <= n) { return str; }\n  var subString = str.substr(0, n-1);\n  return (useWordBoundary \n    ? subString.substr(0, subString.lastIndexOf(\" \")) \n    : subString) + \"...\";\n};\n\nexport const immutableEqual = function(v1, v2) {\n  if (v1 === v2) {\n    return true;\n  } else {\n    return v1.equals(v2);\n  }\n};\n\nexport const deepEqual = function(v1, v2) {\n  if (v1 === v2) {\n    return true;\n  } else if (Map.isMap(v1)) {\n    return v1.equals(v2);\n  } else {\n    return JSON.stringify(v1) == JSON.stringify(v2);\n  }\n};\n\n//Do sets have same values?\nexport const eqSet = function (as, bs) {\n  if (as.size !== bs.size) return false;\n  for (var a of as) if (!bs.has(a)) return false;\n  return true;\n};\n\n\n//Do arrays have same values?\nexport const eqArrSet = function (arr1, arr2) {\n  return eqSet(new Set(arr1), new Set(arr2));\n};\n\nexport const shallowEqual = (a, b, deep = false) => {\n  if (a === b) {\n    return true;\n  } else if (Array.isArray(a))\n    return shallowEqualArrays(a, b, deep);\n  else if (Map.isMap(a))\n    return a.equals(b);\n  else if (typeof a == \"object\")\n    return shallowEqualObjects(a, b, deep);\n  else\n    return a === b;\n};\n\nfunction shallowEqualArrays(arrA, arrB, deep = false) {\n  if (arrA === arrB) {\n    return true;\n  }\n\n  if (!arrA || !arrB) {\n    return false;\n  }\n\n  var len = arrA.length;\n\n  if (arrB.length !== len) {\n    return false;\n  }\n\n  for (var i = 0; i < len; i++) {\n    var isEqual = deep ? shallowEqual(arrA[i], arrB[i], deep) : arrA[i] === arrB[i];\n    if (!isEqual) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction shallowEqualObjects(objA, objB, deep = false) {\n  if (objA === objB) {\n    return true;\n  }\n\n  if (!objA || !objB) {\n    return false;\n  }\n\n  var aKeys = Object.keys(objA);\n  var bKeys = Object.keys(objB);\n  var len = aKeys.length;\n\n  if (bKeys.length !== len) {\n    return false;\n  }\n\n  for (var i = 0; i < len; i++) {\n    var key = aKeys[i];\n    var isEqual = deep ? shallowEqual(objA[key], objB[key], deep) : objA[key] === objB[key];\n    if (!isEqual) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport const escapeRegExp = (string) => {\n  return string.replace(/[.*+?^${}()|[\\]\\\\/]/g, \"\\\\$&\"); // $& means the whole matched string\n};\n\n\nconst isObject = (v) => (typeof v == \"object\" && v !== null); // object or array\nconst listValue = (v, title) => (isObject(v) ? v : {value: v, title: (title !== undefined ? title : v)});\n\n// convert {<value>: <title>, ..} or [value, ..] to normal [{value, title}, ..]\nexport const listValuesToArray = (listValuesObj) => {\n  if (!isObject(listValuesObj))\n    return listValuesObj;\n  if (Array.isArray(listValuesObj))\n    return listValuesObj.map(v => listValue(v));\n  \n  let listValuesArr = [];\n  for (let v in listValuesObj) {\n    const title = listValuesObj[v];\n    listValuesArr.push(listValue(v, title));\n  }\n  return listValuesArr;\n};\n\n// listValues can be {<value>: <title>, ..} or [{value, title}, ..] or [value, ..]\nexport const getItemInListValues = (listValues, value) => {\n  if (Array.isArray(listValues)) {\n    const values = listValues.map(v => listValue(v));\n    return values.find(v => (v.value === value)) || values.find(v => (`${v.value}` === value));\n  } else {\n    return listValues[value] !== undefined ? listValue(value, listValues[value]) : undefined;\n  }\n};\n\nexport const getTitleInListValues = (listValues, value) => {\n  if (listValues == undefined)\n    return value;\n  const it = getItemInListValues(listValues, value);\n  return it !== undefined ? it.title : value;\n};\n\nexport const getValueInListValues = (listValues, value) => {\n  if (listValues == undefined)\n    return value;\n  const it = getItemInListValues(listValues, value);\n  return it !== undefined ? it.value : value;\n};\n\nexport const mapListValues = (listValues, mapFn) => {\n  let ret = [];\n  if (Array.isArray(listValues)) {\n    for (let v of listValues) {\n      const lv = mapFn(listValue(v));\n      if (lv != null)\n        ret.push(lv);\n    }\n  } else {\n    for (let value in listValues) {\n      const lv = mapFn(listValue(value, listValues[value]));\n      if (lv != null)\n        ret.push(lv);\n    }\n  }\n  return ret;\n};\n\nexport const defaultTreeDataMap = {id: \"value\", pId: \"parent\", rootPId: undefined};\n\n// converts from treeData to treeDataSimpleMode format (https://ant.design/components/tree-select/)\n// ! modifies value of `treeData`\nexport const flatizeTreeData = (treeData) => {\n  const tdm = defaultTreeDataMap;\n\n  let rind;\n  let len;\n\n  const _flatize = (node, root, lev) => {\n    if (node.children) {\n      if (lev == 1)\n        node[tdm.pId] = tdm.rootPId; //optional?\n      const childrenCount = node.children.length;\n      for (let c of node.children) {\n        c[tdm.pId] = node[tdm.id];\n        rind++;\n        root.splice(rind, 0, c); //instead of just push\n        len++;\n        _flatize(c, root, lev + 1);\n      }\n      delete node.children;\n      if (childrenCount == 0) {\n        root.splice(rind, 1);\n        rind--;\n        len--;\n      }\n    }\n  };\n\n  if (Array.isArray(treeData)) {\n    len = treeData.length;\n    for (rind = 0 ; rind < len ; rind++) {\n      const c = treeData[rind];\n      if (!isObject(c))\n        continue;\n      if (c[tdm.pId] !== undefined && c[tdm.pId] != tdm.rootPId)\n        continue; //not lev 1\n      _flatize(c, treeData, 1);\n    }\n  }\n  \n  return treeData;\n};\n\nconst getPathInListValues = (listValues, value) => {\n  const tdm = defaultTreeDataMap;\n  const it = getItemInListValues(listValues, value);\n  const parentId = it ? it[tdm.pId] : undefined;\n  const parent = parentId ? listValues.find(v => v[tdm.id] === parentId) : undefined;\n  return parent ? [parent.value, ...getPathInListValues(listValues, parent.value)] : [];\n};\n\nconst getChildrenInListValues = (listValues, value) => {\n  const tdm = defaultTreeDataMap;\n  const it = getItemInListValues(listValues, value);\n  return it ? listValues.filter(v => v[tdm.pId] === it[tdm.id]).map(v => v.value) : [];\n};\n\n// ! modifies value of `treeData`\nconst extendTreeData = (treeData, fieldSettings, isMulti) => {\n  for (let node of treeData) {\n    node.path = getPathInListValues(treeData, node.value);\n    if (fieldSettings.treeSelectOnlyLeafs != false) {\n      const childrenValues = getChildrenInListValues(treeData, node.value);\n      if (!isMulti) {\n        node.selectable = (childrenValues.length == 0);\n      }\n    }\n  }\n  return treeData;\n};\n\nexport const normalizeListValues = (listValues, type, fieldSettings) => {\n  const isTree = [\"treeselect\", \"treemultiselect\"].includes(type);\n  const isMulti = [\"multiselect\", \"treemultiselect\"].includes(type);\n  if (isTree) {\n    listValues = listValuesToArray(listValues);\n    listValues = flatizeTreeData(listValues);\n    listValues = extendTreeData(listValues, fieldSettings, isMulti);\n  }\n  return listValues;\n};\n\nexport const removePrefixPath = (selectedPath, parentPath) => {\n  if (!selectedPath)\n    return selectedPath;\n  let isPrefix = true;\n  for (let i = 0 ; i < parentPath.length ; i++) {\n    const part = parentPath[i];\n    if (selectedPath[i] !== undefined && part == selectedPath[i]) {\n      //ok\n    } else {\n      isPrefix = false;\n      break;\n    }\n  }\n  return isPrefix ? selectedPath.slice(parentPath.length) : selectedPath;\n};\n\nexport const isJsonLogic = (logic) => (\n  typeof logic === \"object\" // An object\n  && logic !== null // but not null\n  && !Array.isArray(logic) // and not an array\n  && Object.keys(logic).length === 1 // with exactly one key\n);\n\nexport function sleep(delay) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, delay);\n  });\n}\n\nexport const isImmutable = (v) => {\n  return typeof v === \"object\" && v !== null && typeof v.toJS === \"function\";\n};\n\nexport function applyToJS(v) {\n  return (isImmutable(v) ? v.toJS() : v);\n}\n\nexport function toImmutableList(v) {\n  return (isImmutable(v) ? v : new Immutable.List(v));\n}\n\n// [1, 4, 9] + [1, 5, 9] => [1, 4, 5, 9]\n// Used for merging arrays of operators for different widgets of 1 type\nexport function mergeArraysSmart(arr1, arr2) {\n  if (!arr1) arr1 = [];\n  if (!arr2) arr2 = [];\n  return arr2\n    .map(op => [op, arr1.indexOf(op)])\n    .map(([op, ind], i, orig) => {\n      if (ind == -1) {\n        const next = orig.slice(i+1);\n        const prev = orig.slice(0, i);\n        const after = prev.reverse().find(([_cop, ci]) => ci != -1);\n        const before = next.find(([_cop, ci]) => ci != -1);\n        if (before)\n          return [op, \"before\", before[0]];\n        else if (after)\n          return [op, \"after\", after[0]];\n        else\n          return [op, \"append\", null];\n      } else {\n      // already exists\n        return null;\n      }\n    })\n    .filter(x => x !== null)\n    .reduce((acc, [newOp, rel, relOp]) => {\n      const ind = acc.indexOf(relOp);\n      if (acc.indexOf(newOp) == -1) {\n        if (ind > -1) {\n        // insert after or before\n          acc.splice( ind + (rel == \"after\" ? 1 : 0), 0, newOp );\n        } else {\n        // insert to end or start\n          acc.splice( (rel == \"append\" ? Infinity : 0), 0, newOp );\n        }\n      }\n      return acc;\n    }, arr1.slice());\n}\n\nconst isDev = () => (typeof process !== \"undefined\" && process.env && process.env.NODE_ENV == \"development\");\n\nexport const getLogger = (devMode = false) => {\n  const verbose = devMode != undefined ? devMode : isDev(); \n  return verbose ? console : {\n    error: () => {},\n    log: () => {},\n    warn: () => {},\n    debug: () => {},\n    info: () => {},\n  };\n};\n\nexport const getFirstDefined = (arr = []) => {\n  let ret;\n  for (let i = 0 ; i < arr.length ; i++) {\n    const v = arr[i];\n    if (v !== undefined) {\n      ret = v;\n      break;\n    }\n  }\n  return ret;\n};\n\nexport const logger = getLogger();\n\n","import Immutable  from \"immutable\";\n\n/**\n * @param {Immutable.List} path\n * @param {...string} suffix\n * @return {Immutable.List}\n */\nexport const expandTreePath = (path, ...suffix) =>\n  path.interpose(\"children1\").withMutations((list) => {\n    list.skip(1);\n    list.push.apply(list, suffix);\n    return list;\n  });\n\n\n/**\n * @param {Immutable.List} path\n * @param {...string} suffix\n * @return {Immutable.List}\n */\nexport const expandTreeSubpath = (path, ...suffix) =>\n  path.interpose(\"children1\").withMutations((list) => {\n    list.push.apply(list, suffix);\n    return list;\n  });\n\n\n/**\n * @param {Immutable.Map} path\n * @param {Immutable.List} path\n * @return {Immutable.Map}\n */\nexport const getItemByPath = (tree, path) => {\n  let children = new Immutable.OrderedMap({ [tree.get(\"id\")] : tree });\n  let res = tree;\n  path.forEach((id) => {\n    res = children.get(id);\n    children = res.get(\"children1\");\n  });\n  return res;\n};\n\n\n/**\n * Remove `path` in every item\n * @param {Immutable.Map} tree\n * @return {Immutable.Map} tree\n */\nexport const removePathsInTree = (tree) => {\n  let newTree = tree;\n\n  function _processNode (item, path) {\n    const itemPath = path.push(item.get(\"id\"));\n    if (item.get(\"path\")) {\n      newTree = newTree.removeIn(expandTreePath(itemPath, \"path\"));\n    }\n\n    const children = item.get(\"children1\");\n    if (children) {\n      children.map((child, _childId) => {\n        _processNode(child, itemPath);\n      });\n    }\n  }\n\n  _processNode(tree, new Immutable.List());\n\n  return newTree;\n};\n\n\n/**\n * Remove `isLocked` in items that inherit parent's `isLocked`\n * @param {Immutable.Map} tree\n * @return {Immutable.Map} tree\n */\nexport const removeIsLockedInTree = (tree) => {\n  let newTree = tree;\n\n  function _processNode (item, path, isParentLocked = false) {\n    const itemPath = path.push(item.get(\"id\"));\n    const isLocked = item.getIn([\"properties\", \"isLocked\"]);\n    if (isParentLocked && isLocked) {\n      newTree = newTree.deleteIn(expandTreePath(itemPath, \"properties\", \"isLocked\"));\n    }\n\n    const children = item.get(\"children1\");\n    if (children) {\n      children.map((child, _childId) => {\n        _processNode(child, itemPath, isLocked || isParentLocked);\n      });\n    }\n  }\n\n  _processNode(tree, new Immutable.List());\n\n  return newTree;\n};\n\n\n/**\n * Set correct `path` and `id` in every item\n * @param {Immutable.Map} tree\n * @return {Immutable.Map} tree\n */\nexport const fixPathsInTree = (tree) => {\n  let newTree = tree;\n\n  function _processNode (item, path, lev, nodeId) {\n    if (!item) return;\n    const currPath = item.get(\"path\");\n    const currId = item.get(\"id\");\n    const itemId = currId || nodeId;\n    const itemPath = path.push(itemId);\n    if (!currPath || !currPath.equals(itemPath)) {\n      newTree = newTree.setIn(expandTreePath(itemPath, \"path\"), itemPath);\n    }\n    if (!currId) {\n      newTree = newTree.setIn(expandTreePath(itemPath, \"id\"), itemId);\n    }\n\n    const children = item.get(\"children1\");\n    if (children) {\n      if (children.constructor.name == \"Map\") {\n        // protect: should me OrderedMap, not Map (issue #501)\n        newTree = newTree.setIn(\n          expandTreePath(itemPath, \"children1\"), \n          new Immutable.OrderedMap(children)\n        );\n      }\n      children.map((child, childId) => {\n        _processNode(child, itemPath, lev + 1, childId);\n      });\n    }\n  }\n\n  _processNode(tree, new Immutable.List(), 0);\n\n\n  return newTree;\n};\n\nexport const fixEmptyGroupsInTree = (tree) => {\n  let newTree = tree;\n\n  function _processNode (item, path, lev, nodeId) {\n    if (!item) return false;\n    const itemId = item.get(\"id\") || nodeId;\n    const itemPath = path.push(itemId);\n\n    const children = item.get(\"children1\");\n    if (children) {\n      const allChildrenGone = children.map((child, childId) => {\n        return _processNode(child, itemPath, lev + 1, childId);\n      }).reduce((curr, v) => (curr && v), true);\n      if ((children.size == 0 || allChildrenGone) && lev > 0) {\n        newTree = newTree.deleteIn(expandTreePath(itemPath));\n        return true;\n      }\n    }\n    return false;\n  }\n\n  _processNode(tree, new Immutable.List(), 0);\n\n\n  return newTree;\n};\n\n/**\n * @param {Immutable.Map} tree\n * @return {Object} {flat, items}\n */\nexport const getFlatTree = (tree) => {\n  let flat = [];\n  let items = {};\n  let realHeight = 0;\n\n  function _flatizeTree (item, path, insideCollapsed, insideLocked, insideRuleGroup, lev, info, parentType, caseId) {\n    const type = item.get(\"type\");\n    const collapsed = item.get(\"collapsed\");\n    const id = item.get(\"id\");\n    const children = item.get(\"children1\");\n    const isLocked = item.getIn([\"properties\", \"isLocked\"]);\n    const childrenIds = children ? children.map((_child, childId) => childId) : null;\n    const isRuleGroup = type == \"rule_group\";\n    // tip: count rule_group as 1 rule\n    const isLeaf = !insideRuleGroup && (!children || isRuleGroup);\n\n    const itemsBefore = flat.length;\n    const top = realHeight;\n    flat.push(id);\n    if (!insideCollapsed)\n      realHeight += 1;\n    info.height = (info.height || 0) + 1;\n\n    items[id] = {\n      type: type,\n      parent: path.length ? path[path.length-1] : null,\n      parentType: parentType,\n      caseId: type == \"case_group\" ? id : caseId,\n      isDefaultCase: type == \"case_group\" && !children,\n      path: path.concat(id),\n      lev: lev,\n      leaf: !children,\n      index: itemsBefore,\n      id: id,\n      children: childrenIds,\n      leafsCount: 0,\n      _top: itemsBefore,\n      _height: (itemsAfter - itemsBefore),\n      top: (insideCollapsed ? null : top),\n      height: height,\n      bottom: (insideCollapsed ? null : top) + height,\n      collapsed: collapsed,\n      node: item,\n      isLocked: isLocked || insideLocked,\n    };\n\n    if (children) {\n      let subinfo = {};\n      children.map((child, _childId) => {\n        _flatizeTree(\n          child, path.concat(id), \n          insideCollapsed || collapsed, insideLocked || isLocked, insideRuleGroup || isRuleGroup,\n          lev + 1, subinfo, type, type == \"case_group\" ? id : caseId\n        );\n      });\n      if (!collapsed) {\n        info.height = (info.height || 0) + (subinfo.height || 0);\n      }\n    }\n    \n    if (caseId && isLeaf) {\n      items[caseId].leafsCount++;\n    }\n\n    const itemsAfter = flat.length;\n    const _bottom = realHeight;\n    const height = info.height;\n        \n    Object.assign(items[id], {\n      _height: (itemsAfter - itemsBefore),\n      height: height,\n      bottom: (insideCollapsed ? null : top) + height,\n    });\n  }\n\n  _flatizeTree(tree, [], false, false, false, 0, {}, null, null);\n\n  for (let i = 0 ; i < flat.length ; i++) {\n    const prevId = i > 0 ? flat[i-1] : null;\n    const nextId = i < (flat.length-1) ? flat[i+1] : null;\n    let item = items[flat[i]];\n    item.prev = prevId;\n    item.next = nextId;\n  }\n\n  return {flat, items};\n};\n\n\n/**\n * Returns count of reorderable(!) nodes\n * @param {Immutable.Map} tree\n * @return {Integer}\n */\nexport const getTotalReordableNodesCountInTree = (tree) => {\n  if (!tree)\n    return -1;\n  let cnt = 0;\n\n  function _processNode (item, path, lev) {\n    let id, children, type;\n    if (typeof item.get === \"function\") {\n      id = item.get(\"id\");\n      children = item.get(\"children1\");\n      type = item.get(\"type\");\n    } else {\n      id = item.id;\n      children = item.children1;\n      type = item.type;\n    }\n    const isRuleGroup = type == \"rule_group\";\n    cnt++;\n    //tip: rules in rule-group can be reordered only inside\n    if (children && !isRuleGroup) {\n      children.map((child, _childId) => {\n        _processNode(child, path.concat(id), lev + 1);\n      });\n    }\n  }\n\n  _processNode(tree, [], 0);\n    \n  return cnt - 1; // -1 for root\n};\n\n/**\n * Returns count of rules (leafs, i.e. don't count groups)\n * @param {Immutable.Map} tree\n * @return {Integer}\n */\nexport const getTotalRulesCountInTree = (tree) => {\n  if (!tree)\n    return -1;\n  let cnt = 0;\n\n  function _processNode (item, path, lev) {\n    let id, children, type;\n    if (typeof item.get === \"function\") {\n      id = item.get(\"id\");\n      children = item.get(\"children1\");\n      type = item.get(\"type\");\n    } else {\n      id = item.id;\n      children = item.children1;\n      type = item.type;\n    }\n    \n    if (type == \"rule\" || type == \"rule_group\") {\n      // tip: count rule_group as 1 rule\n      cnt++;\n    } else if (children) {\n      children.map((child, _childId) => {\n        _processNode(child, path.concat(id), lev + 1);\n      });\n    }\n  }\n\n  _processNode(tree, [], 0);\n    \n  return cnt;\n};\n\nexport const getTreeBadFields = (tree) => {\n  let badFields = [];\n\n  function _processNode (item, path, lev) {\n    const id = item.get(\"id\");\n    const children = item.get(\"children1\");\n    const valueError = item.getIn([\"properties\", \"valueError\"]);\n    const field = item.getIn([\"properties\", \"field\"]);\n    if (valueError && valueError.size > 0 && valueError.filter(v => v != null).size > 0) {\n      badFields.push(field);\n    }\n    if (children) {\n      children.map((child, _childId) => {\n        _processNode(child, path.concat(id), lev + 1);\n      });\n    }\n  }\n\n  if (tree)\n    _processNode(tree, [], 0);\n    \n  return Array.from(new Set(badFields));\n};\n\n\n// Remove fields that can be calced: \"id\", \"path\"\n// Remove empty fields: \"operatorOptions\"\nexport const getLightTree = (tree, children1AsArray = false) => {\n  let newTree = tree;\n\n  function _processNode (item, itemId) {\n    if (item.path)\n      delete item.path;\n    if (!children1AsArray && itemId)\n      delete item.id;\n    let properties = item.properties;\n    if (properties) {\n      if (properties.operatorOptions == null)\n        delete properties.operatorOptions;\n    }\n\n    const children = item.children1;\n    if (children) {\n      for (let id in children) {\n        _processNode(children[id], id);\n      }\n      if (children1AsArray) {\n        item.children1 = Object.values(children);\n      }\n    }\n  }\n\n  _processNode(tree, null);\n\n  return newTree;\n};\n\nexport const getSwitchValues = (tree) => {\n  let vals = [];\n  const children = tree.get(\"children1\");\n  if (children) {\n    children.map((child) => {\n      const value = child.getIn([\"properties\", \"value\"]);\n      let caseValue;\n      if (value && value.size == 1) {\n        caseValue = value.get(0);\n        if (Array.isArray(caseValue) && caseValue.length == 0) {\n          caseValue = null;\n        }\n      } else {\n        caseValue = null;\n      }\n      vals = [...vals, caseValue];\n    });\n  }\n\n  return vals;\n};\n\nexport const isEmptyTree = (tree) => (!tree.get(\"children1\") || tree.get(\"children1\").size == 0);\n\nexport const hasChildren = (tree, path) => tree.getIn(expandTreePath(path, \"children1\")).size > 0;\n","// Had to make uuid use a constant seed so it would generate same sequence across runs. This was needed\n// so server side rendering and client side rendering yield same results (e.g. the uuid is used when rendering\n// the concunctions with their name and id)\nvar query_builder_seed = 0;\nexport default () => {\n  // Generate a random GUID http://stackoverflow.com/a/2117523.\n  const timePart = (new Date().getTime().toString(16)+\"FF\").substr(0,11);\n  const s = \"ssssssss-xxxx-4xxx-yxxx-x\".replace(/[xys]/g, (c) => {\n    const r = c === \"s\" ? Math.floor(Math.random() * 16) : (query_builder_seed++) & 0xf;\n    const v = c === \"x\" ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n  return s + timePart;\n};\n","import {\n  getFieldConfig, getOperatorConfig, getFieldWidgetConfig, getFuncConfig,\n} from \"./configUtils\";\nimport {getOperatorsForField, getWidgetForFieldOp, getNewValueForFieldOp} from \"../utils/ruleUtils\";\nimport {defaultValue, deepEqual, getItemInListValues, logger, immutableEqual} from \"../utils/stuff\";\nimport {defaultOperatorOptions} from \"../utils/defaultUtils\";\nimport {fixPathsInTree} from \"../utils/treeUtils\";\nimport omit from \"lodash/omit\";\nimport { List } from \"immutable\";\n\n\nconst typeOf = (v) => {\n  if (typeof v == \"object\" && v !== null && Array.isArray(v))\n    return \"array\";\n  else\n    return (typeof v);\n};\n\nconst isTypeOf = (v, type) => {\n  if (typeOf(v) == type)\n    return true;\n  if (type == \"number\" && !isNaN(v))\n    return true; //can be casted\n  return false;\n};\n\nexport const createValidationMemo = () => {\n  let originalTree;\n  let validatedTree;\n  let configId;\n\n  return (config, tree, oldConfig) => {\n    if (!tree) {\n      return null;\n    }\n    if (config.__configId === configId && (immutableEqual(tree, originalTree) || immutableEqual(tree, validatedTree))) {\n      return validatedTree;\n    } else {\n      configId = config.__configId;\n      originalTree = tree;\n      validatedTree = validateAndFixTree(tree, null, config, oldConfig || config);\n      return validatedTree;\n    }\n  };\n};\n\nexport const validateAndFixTree = (newTree, _oldTree, newConfig, oldConfig) => {\n  let tree = validateTree(newTree, _oldTree, newConfig, oldConfig);\n  tree = fixPathsInTree(tree);\n  return tree;\n};\n\nexport const validateTree = (tree, _oldTree, config, oldConfig, removeEmptyGroups, removeIncompleteRules) => {\n  if (removeEmptyGroups === undefined) {\n    removeEmptyGroups = config.settings.removeEmptyGroupsOnLoad;\n  }\n  if (removeIncompleteRules === undefined) {\n    removeIncompleteRules = config.settings.removeIncompleteRulesOnLoad;\n  }\n  const c = {\n    config, oldConfig, removeEmptyGroups, removeIncompleteRules\n  };\n  return validateItem(tree, [], null, {}, c);\n};\n\nfunction validateItem (item, path, itemId, meta, c) {\n  const type = item.get(\"type\");\n  const children = item.get(\"children1\");\n\n  if ((type === \"group\" || type === \"rule_group\" || type == \"case_group\" || type == \"switch_group\") && children && children.size) {\n    return validateGroup(item, path, itemId, meta, c);\n  } else if (type === \"rule\") {\n    return validateRule(item, path, itemId, meta, c);\n  } else {\n    return item;\n  }\n}\n\nfunction validateGroup (item, path, itemId, meta, c) {\n  const {removeEmptyGroups} = c;\n  let id = item.get(\"id\");\n  let children = item.get(\"children1\");\n  const oldChildren = children;\n\n  if (!id && itemId) {\n    id = itemId;\n    item = item.set(\"id\", id);\n    meta.sanitized = true;\n  }\n\n  //validate children\n  let submeta = {};\n  children = children\n    .map( (currentChild, childId) => validateItem(currentChild, path.concat(id), childId, submeta, c) );\n  if (removeEmptyGroups)\n    children = children.filter((currentChild) => (currentChild != undefined));\n  let sanitized = submeta.sanitized || (oldChildren.size != children.size);\n  if (!children.size && removeEmptyGroups && path.length) {\n    sanitized = true;\n    item = undefined;\n  }\n\n  if (sanitized)\n    meta.sanitized = true;\n  if (sanitized && item)\n    item = item.set(\"children1\", children);\n  return item;\n}\n\n\nfunction validateRule (item, path, itemId, meta, c) {\n  const {removeIncompleteRules, config, oldConfig} = c;\n  const {showErrorMessage} = config.settings;\n  let id = item.get(\"id\");\n  let properties = item.get(\"properties\");\n  let field = properties.get(\"field\") || null;\n  let operator = properties.get(\"operator\") || null;\n  let operatorOptions = properties.get(\"operatorOptions\");\n  let valueSrc = properties.get(\"valueSrc\");\n  let value = properties.get(\"value\");\n  let valueError = properties.get(\"valueError\");\n  const oldSerialized = {\n    field,\n    operator,\n    operatorOptions: operatorOptions ? operatorOptions.toJS() : {},\n    valueSrc: valueSrc ? valueSrc.toJS() : null,\n    value: value ? value.toJS() : null,\n    valueError: valueError ? valueError.toJS() : null,\n  };\n  let _wasValid = field && operator && value && !value.includes(undefined);\n\n  if (!id && itemId) {\n    id = itemId;\n    item = item.set(\"id\", id);\n    meta.sanitized = true;\n  }\n\n  //validate field\n  const fieldDefinition = field ? getFieldConfig(config, field) : null;\n  if (field && !fieldDefinition) {\n    logger.warn(`No config for field ${field}`);\n    field = null;\n  }\n  if (field == null) {\n    properties = [\"operator\", \"operatorOptions\", \"valueSrc\", \"value\"].reduce((map, key) => map.delete(key), properties);\n    operator = null;\n  }\n\n  //validate operator\n  // Backward compatibility: obsolete operator range_between\n  if (operator == \"range_between\" || operator == \"range_not_between\") {\n    operator = operator == \"range_between\" ? \"between\" : \"not_between\";\n    console.info(`Fixed operator ${properties.get(\"operator\")} to ${operator}`);\n    properties = properties.set(\"operator\", operator);\n  }\n  const operatorDefinition = operator ? getOperatorConfig(config, operator, field) : null;\n  if (operator && !operatorDefinition) {\n    console.warn(`No config for operator ${operator}`);\n    operator = null;\n  }\n  const availOps = field ? getOperatorsForField(config, field) : [];\n  if (!availOps) {\n    console.warn(`Type of field ${field} is not supported`);\n    operator = null;\n  } else if (operator && availOps.indexOf(operator) == -1) {\n    if (operator == \"is_empty\" || operator == \"is_not_empty\") {\n      // Backward compatibility: is_empty #494\n      operator = operator == \"is_empty\" ? \"is_null\" : \"is_not_null\";\n      console.info(`Fixed operator ${properties.get(\"operator\")} to ${operator} for ${field}`);\n      properties = properties.set(\"operator\", operator);\n    } else {\n      console.warn(`Operator ${operator} is not supported for field ${field}`);\n      operator = null;\n    }\n  }\n  if (operator == null) {\n    properties = properties.delete(\"operatorOptions\");\n    properties = properties.delete(\"valueSrc\");\n    properties = properties.delete(\"value\");\n  }\n\n  //validate operator options\n  operatorOptions = properties.get(\"operatorOptions\");\n  let _operatorCardinality = operator ? defaultValue(operatorDefinition.cardinality, 1) : null;\n  if (!operator || operatorOptions && !operatorDefinition.options) {\n    operatorOptions = null;\n    properties = properties.delete(\"operatorOptions\");\n  } else if (operator && !operatorOptions && operatorDefinition.options) {\n    operatorOptions = defaultOperatorOptions(config, operator, field);\n    properties = properties.set(\"operatorOptions\", operatorOptions);\n  }\n\n  //validate values\n  valueSrc = properties.get(\"valueSrc\");\n  value = properties.get(\"value\");\n  const canFix = !showErrorMessage;\n  const isEndValue = true;\n  let {newValue, newValueSrc, newValueError} = getNewValueForFieldOp(config, oldConfig, properties, field, operator, null, canFix, isEndValue);\n  value = newValue;\n  valueSrc = newValueSrc;\n  valueError = newValueError;\n  properties = properties.set(\"value\", value);\n  properties = properties.set(\"valueSrc\", valueSrc);\n  if (showErrorMessage) {\n    properties = properties.set(\"valueError\", valueError);\n  }\n\n  const newSerialized = {\n    field,\n    operator,\n    operatorOptions: operatorOptions ? operatorOptions.toJS() : {},\n    valueSrc: valueSrc ? valueSrc.toJS() : null,\n    value: value ? value.toJS() : null,\n    valueError: valueError ? valueError.toJS() : null,\n  };\n  const sanitized = !deepEqual(oldSerialized, newSerialized);\n  const isComplete = field && operator && value && !value.includes(undefined);\n  if (sanitized)\n    meta.sanitized = true;\n  if (!isComplete && removeIncompleteRules)\n    item = undefined;\n  else if (sanitized)\n    item = item.set(\"properties\", properties);\n\n  return item;\n}\n\n\n/**\n * \n * @param {bool} canFix true is useful for func values to remove bad args\n * @param {bool} isEndValue false if value is in process of editing by user\n * @param {bool} isRawValue false is used only internally from validateFuncValue\n * @return {array} [validError, fixedValue] - if validError === null and canFix == true, fixedValue can differ from value if was fixed\n */\nexport const validateValue = (config, leftField, field, operator, value, valueType, valueSrc, asyncListValues, canFix = false, isEndValue = false, isRawValue = true) => {\n  let validError = null;\n  let fixedValue = value;\n\n  if (value != null) {\n    if (valueSrc == \"field\") {\n      [validError, fixedValue] = validateFieldValue(leftField, field, value, valueSrc, valueType, asyncListValues, config, operator, isEndValue, canFix);\n    } else if (valueSrc == \"func\") {\n      [validError, fixedValue] = validateFuncValue(leftField, field, value, valueSrc, valueType, asyncListValues, config, operator, isEndValue, canFix);\n    } else if (valueSrc == \"value\" || !valueSrc) {\n      [validError, fixedValue] = validateNormalValue(leftField, field, value, valueSrc, valueType, asyncListValues, config, operator, isEndValue, canFix);\n    }\n\n    if (!validError) {\n      const fieldConfig = getFieldConfig(config, field);\n      const w = getWidgetForFieldOp(config, field, operator, valueSrc);\n      const operatorDefinition = operator ? getOperatorConfig(config, operator, field) : null;\n      const fieldWidgetDefinition = omit(getFieldWidgetConfig(config, field, operator, w, valueSrc), [\"factory\"]);\n      const rightFieldDefinition = (valueSrc == \"field\" ? getFieldConfig(config, value) : null);\n      const fieldSettings = fieldWidgetDefinition; // widget definition merged with fieldSettings\n\n      const fn = fieldWidgetDefinition.validateValue;\n      if (typeof fn == \"function\") {\n        const args = [\n          fixedValue, \n          fieldSettings,\n          operator,\n          operatorDefinition\n        ];\n        if (valueSrc == \"field\")\n          args.push(rightFieldDefinition);\n        const validResult = fn(...args);\n        if (typeof validResult == \"boolean\") {\n          if (validResult == false)\n            validError = \"Invalid value\";\n        } else {\n          validError = validResult;\n        }\n      }\n    }\n  }\n\n  if (isRawValue && validError) {\n    console.warn(\"[RAQB validate]\", `Field ${field}: ${validError}`);\n  }\n  \n  return [validError, fixedValue];\n};\n\nconst validateValueInList = (value, listValues, canFix, isEndValue, removeInvalidMultiSelectValuesOnLoad) => {\n  const values = List.isList(value) ? value.toJS() : (value instanceof Array ? [...value] : undefined);\n  if (values) {\n    const [goodValues, badValues] = values.reduce(([goodVals, badVals], val) => {\n      const vv = getItemInListValues(listValues, val);\n      if (vv == undefined) {\n        return [goodVals, [...badVals, val]];\n      } else {\n        return [[...goodVals, vv.value], badVals];\n      }\n    }, [[], []]);\n    const plural = badValues.length > 1;\n    const err = badValues.length ? `${plural ? \"Values\" : \"Value\"} ${badValues.join(\", \")} ${plural ? \"are\" : \"is\"} not in list of values` : null;\n    // always remove bad values at tree validation as user can't unselect them (except AntDesign widget)\n    if (removeInvalidMultiSelectValuesOnLoad !== undefined) {\n      canFix = removeInvalidMultiSelectValuesOnLoad;\n    } else {\n      canFix = canFix || isEndValue;\n    }\n    return [err, canFix ? goodValues : value];\n  } else {\n    const vv = getItemInListValues(listValues, value);\n    if (vv == undefined) {\n      return [`Value ${value} is not in list of values`, value];\n    } else {\n      value = vv.value;\n    }\n    return [null, value];\n  }\n};\n\n/**\n* \n*/\nconst validateNormalValue = (leftField, field, value, valueSrc, valueType, asyncListValues, config, operator = null, isEndValue = false, canFix = false) => {\n  if (field) {\n    const fieldConfig = getFieldConfig(config, field);\n    const w = getWidgetForFieldOp(config, field, operator, valueSrc);\n    const wConfig = config.widgets[w];\n    const wType = wConfig.type;\n    const jsType = wConfig.jsType;\n    const fieldSettings = fieldConfig.fieldSettings;\n\n    if (valueType != wType)\n      return [`Value should have type ${wType}, but got value of type ${valueType}`, value];\n    if (jsType && !isTypeOf(value, jsType) && !fieldSettings.listValues) { //tip: can skip tye check for listValues\n      return [`Value should have JS type ${jsType}, but got value of type ${typeof value}`, value];\n    }\n\n    if (fieldSettings) {\n      const listValues = asyncListValues || fieldSettings.listValues;\n      if (listValues && !fieldSettings.allowCustomValues) {\n        return validateValueInList(value, listValues, canFix, isEndValue, config.settings.removeInvalidMultiSelectValuesOnLoad);\n      }\n      if (fieldSettings.min != null && value < fieldSettings.min) {\n        return [`Value ${value} < min ${fieldSettings.min}`, canFix ? fieldSettings.min : value];\n      }\n      if (fieldSettings.max != null && value > fieldSettings.max) {\n        return [`Value ${value} > max ${fieldSettings.max}`, canFix ? fieldSettings.max : value];\n      }\n    }\n  }\n\n  return [null, value];\n};\n\n\n/**\n* \n*/\nconst validateFieldValue = (leftField, field, value, _valueSrc, valueType, asyncListValues, config, operator = null, isEndValue = false, canFix = false) => {\n  const {fieldSeparator} = config.settings;\n  const isFuncArg = typeof field == \"object\" && field?._isFuncArg;\n  const leftFieldStr = Array.isArray(leftField) ? leftField.join(fieldSeparator) : leftField;\n  const rightFieldStr = Array.isArray(value) ? value.join(fieldSeparator) : value;\n  const rightFieldDefinition = getFieldConfig(config, value);\n  if (!rightFieldDefinition)\n    return [`Unknown field ${value}`, value];\n  if (rightFieldStr == leftFieldStr && !isFuncArg)\n    return [`Can't compare field ${leftField} with itself`, value];\n  if (valueType && valueType != rightFieldDefinition.type)\n    return [`Field ${value} is of type ${rightFieldDefinition.type}, but expected ${valueType}`, value];\n  return [null, value];\n};\n\n/**\n* \n*/\nconst validateFuncValue = (leftField, field, value, _valueSrc, valueType, asyncListValues, config, operator = null, isEndValue = false, canFix = false) => {\n  let fixedValue = value;\n\n  if (value) {\n    const funcKey = value.get(\"func\");\n    if (funcKey) {\n      const funcConfig = getFuncConfig(config, funcKey);\n      if (funcConfig) {\n        if (valueType && funcConfig.returnType != valueType)\n          return [`Function ${funcKey} should return value of type ${funcConfig.returnType}, but got ${valueType}`, value];\n        for (const argKey in funcConfig.args) {\n          const argConfig = funcConfig.args[argKey];\n          const args = fixedValue.get(\"args\");\n          const argVal = args ? args.get(argKey) : undefined;\n          const fieldDef = getFieldConfig(config, argConfig);\n          const argValue = argVal ? argVal.get(\"value\") : undefined;\n          const argValueSrc = argVal ? argVal.get(\"valueSrc\") : undefined;\n          if (argValue !== undefined) {\n            const [argValidError, fixedArgVal] = validateValue(\n              config, leftField, fieldDef, operator, argValue, argConfig.type, argValueSrc, asyncListValues, canFix, isEndValue, false\n            );\n            if (argValidError !== null) {\n              if (canFix) {\n                fixedValue = fixedValue.deleteIn([\"args\", argKey]);\n                if (argConfig.defaultValue !== undefined) {\n                  fixedValue = fixedValue.setIn([\"args\", argKey, \"value\"], argConfig.defaultValue);\n                  fixedValue = fixedValue.setIn([\"args\", argKey, \"valueSrc\"], \"value\");\n                }\n              } else {\n                return [`Invalid value of arg ${argKey} for func ${funcKey}: ${argValidError}`, value];\n              }\n            } else if (fixedArgVal !== argValue) {\n              fixedValue = fixedValue.setIn([\"args\", argKey, \"value\"], fixedArgVal);\n            }\n          } else if (isEndValue && argConfig.defaultValue === undefined && !canFix) {\n            return [`Value of arg ${argKey} for func ${funcKey} is required`, value];\n          }\n        }\n      } else return [`Unknown function ${funcKey}`, value];\n    } // else it's not function value\n  } // empty value\n\n  return [null, fixedValue];\n};\n","var map = {\n\t\"./es-us\": 73099,\n\t\"./es-us.js\": 73099,\n\t\"./ru\": 21753,\n\t\"./ru.js\": 21753,\n\t\"moment/locale/es-us\": 73099,\n\t\"moment/locale/es-us.js\": 73099,\n\t\"moment/locale/ru\": 21753,\n\t\"moment/locale/ru.js\": 21753\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 13837;"],"names":["Proximity","handleChange","value","props","setOption","parseInt","this","defaults","options","config","optionLabel","optionPlaceholder","customProps","minProximity","maxProximity","optionTextBefore","readonly","settings","widgets","defaultProximity","proximity","undefined","showLabels","selectedProximity","get","proxValues","range","map","item","title","Select","select","factory","className","listValues","setValue","placeholder","children","PureComponent","propTypes","PropTypes","defaultProps","delta","isFuncArg","immValue","valueSrc","immValueError","valueError","asyncListValues","isSpecialRange","fieldDefinition","widgetDefinition","widget","widgetValueLabel","valueLabels","textSeparators","setValueHandler","field","operator","parentField","parentFuncs","id","groupId","widgetFactory","fieldWidgetProps","isConst","valueSources","length","defaultValue","fieldSettings","widgetProps","Object","assign","label","placeholders","labelYes","labelNo","Array","isArray","v","getTitleInListValues","join","funcArgDummyOpDef","cardinality","Widget","_setValue","widgetType","__isInternal","oldRange","_onChangeValueSrc","srcKey","setValueSrc","renderWidget","meta","leftField","values","iValues","aField","valueLabel","widgetLabel","key","WidgetFactory","pick","renderValueSources","setValueSrcHandler","valueSourcesInfo","ValueSources","valueSourcesOptions","sourceLabel","valueSourcesPopupTitle","renderSep","sepText","sepLabel","renderWidgetDelta","useOnPropsChanged","onPropsChanged","nextProps","prevProps","k","filter","ch","getMeta","simpleField","fieldFunc","fieldArg","valueSrcs","isForRuleGruop","isCaseValue","func","arg","iValueSrcs","Immutable","getFieldConfig","defaultWidget","getWidgetForFieldOp","operatorDefinition","getWidgetsForFieldOp","getOperatorConfig","isSpecialRangeForSrcField","isTrueSpecialRange","getValueSourcesForFieldOp","getFieldWidgetConfig","singleWidget","type","getValueLabel","bind","name","toUpperCase","Col","dummyFn","DragIcon","xmlns","viewBox","fill","width","height","d","ConfirmFn","Cmp","useConfirm","confirmFn","ValueField","needUpdateItems","items","needUpdateMeta","getItems","canCompareFieldWithField","fieldSeparator","parentFieldPath","split","parentFieldConfig","sourceFields","subfields","fields","filteredFields","filterFields","buildOptions","customPlaceholder","fieldPlaceholder","fieldSeparatorDisplay","selectedKey","isFieldSelected","leftFieldWidgetField","leftFieldWidgetFieldProps","valuePlaceholder","currField","selectedOpts","selectedKeys","getFieldPath","selectedPath","selectedLabel","getFieldLabel","partsLabels","getFieldPathLabels","selectedFullLabel","selectedAltLabel","label2","leftFieldFullkey","clone","expectedType","leftFieldConfig","_filter","list","path","rightFieldKey","subpath","concat","rightFieldFullkey","rightFieldConfig","canUse","fn","keys","optGroupLabel","prefix","fieldKey","fullLabel","altLabel","tooltip","hideForCompare","grouplabel","o","fieldOpts","maxLabelsLength","fieldParts","last","truncateString","renderField","renderProps","setField","FuncSelect","canUseFuncForField","filteredFuncs","filterFuncs","funcs","funcPlaceholder","selectedFuncKey","isFuncSelected","currFunc","getFuncConfig","getFuncLabel","getFuncPathLabels","targetDefinition","funcKey","funcFullkey","funcConfig","returnType","includes","allowSelfNesting","funcOpts","funcParts","renderFunc","FuncWidget","setFunc","setArgValue","argKey","argVal","argDefinition","funcDefinition","args","setArgValueSrc","argValSrc","renderFuncSelect","selectProps","funcLabel","renderArgLabel","showPrefix","renderArgLabelSep","renderArgVal","getIn","defaultValueSource","ArgWidget","renderArgSep","argIndex","renderSeps","renderBracketBefore","renderBrackets","renderBracketAfter","renderFuncArgs","_delta","_widgetType","customRadioYesProps","radioYes","customRadioNoProps","radioNo","onRadioChange","e","target","uuid","id2","checked","disabled","onChange","style","display","htmlFor","maxLength","textValue","val","fullWidth","maxRows","valueFormat","use12Hours","dtValue","moment","format","Date","allowCustomValues","multiple","multiselect","i","opt","selected","push","getMultiSelectValues","omit","mapListValues","hasValue","min","max","step","numberValue","Number","customInputProps","input","customSliderProps","slider","renderOptions","postfix","not","setNot","conjunctionOptions","setConjunction","showNot","notLabel","conjsCount","lessThenTwo","showConj","forceShowConj","isDummyFn","onClick","btnLabel","info","onOk","okText","cancelText","confirm","VanillaProvider","VanillaBooleanWidget","Widgets","VanillaTextWidget","VanillaTextAreaWidget","VanillaDateWidget","VanillaTimeWidget","VanillaDateTimeWidget","VanillaMultiSelectWidget","VanillaSelectWidget","VanillaNumberWidget","VanillaSliderWidget","ValueFieldWidget","ProximityOperator","Operators","mongoFormatOp1","mop","mc","_op","useExpr","valueType","opDef","operatorOptions","fieldDef","$field","startsWith","mv","mongoFormatOp2","mops","valueTypes","operators","equal","labelForFormat","sqlOp","spelOp","spelOps","reversedOp","formatOp","op","isForDisplay","opStr","mongoFormatOp","jsonLogic","elasticSearchQueryType","not_equal","isNotOp","less","less_or_equal","greater","greater_or_equal","like","escapeRegExp","_jsonLogicIsRevArgs","not_like","starts_with","ends_with","between","valFrom","first","valTo","spelFormatOp","validateValues","not_between","is_empty","sqlFormatOp","empty","sqlEmptyValue","mongoEmptyValue","is_not_empty","is_null","is_not_null","select_equals","select_not_equals","select_any_in","select_not_any_in","multiselect_equals","SqlString","jsonLogic2","vals","multiselect_not_equals","val1","val2","prox","aVal1","aVal2","some","filteredSize","all","fullSize","none","stringifyForDisplay","toString","conjunctions","AND","mongoConj","jsonLogicConj","sqlConj","spelConj","spelConjs","reversedConj","formatConj","conj","size","sqlFormatConj","spelFormatConj","omitBrackets","OR","text","jsType","formatValue","wgtDef","JSON","stringify","spelFormatValue","regex","spelEscape","sqlFormatValue","toJS","mongoFormatValue","textarea","number","isFloat","isInteger","valLabel","valsLabels","isCallable","res","spelFixList","date","dateFormat","useKeyboard","dateVal","toDate","isValid","time","timeFormat","elasticSearchFormatValue","queryType","fieldName","script","source","params","datetime","boolean","rightFieldDef","showSearch","case_value","spelImportValue","types","defaultOperator","mainWidget","opProps","defaultSettings","formatField","parts","formatSpelField","partsExt","ind","parent","isSpelVariable","sqlFormatReverse","q","spelFormatReverse","formatReverse","revOperatorDefinition","formatAggr","whereStr","aggrField","aggrFieldDef","cond","rightField","customFieldSelectProps","defaultSliderWidth","defaultSelectWidth","defaultSearchWidth","defaultMaxRows","VanillaFieldSelect","VanillaConjs","VanillaButton","VanillaButtonGroup","VanillaValueSources","vanillaConfirm","VanillaSwitch","renderOperator","renderConjs","renderSwitch","renderButton","renderButtonGroup","renderProvider","renderConfirm","renderSwitchPrefix","renderSize","canReorder","canRegroup","showLock","canDeleteLocked","canLeaveEmptyGroup","shouldCreateEmptyGroup","canShortMongoQuery","removeEmptyGroupsOnLoad","removeIncompleteRulesOnLoad","removeInvalidMultiSelectValuesOnLoad","groupActionsPosition","setOpOnChangeField","groupOperators","convertableWidgets","locale","fieldLabel","operatorLabel","operatorPlaceholder","lockLabel","lockedLabel","deleteLabel","addGroupLabel","addCaseLabel","addDefaultCaseLabel","defaultCaseLabel","addRuleLabel","addSubRuleLabel","delGroupLabel","removeRuleConfirmOptions","removeGroupConfirmOptions","defaultGroupConjunction","groupVarKey","altVarKey","lockedOp","nonCheckedIcon","CheckBoxOutlineBlank","fontSize","checkedIcon","CheckBox","defaultFilterOptions","createFilterOptions","emptyArray","selectedValue","groupBy","filterOptionsConfig","filterOptionsFn","useListValuesAutocomplete","debounceTimeout","open","onOpen","onClose","onInputChange","inputValue","isInitialLoading","isLoading","aPlaceholder","extendOptions","getOptionSelected","getOptionDisabled","getOptionLabel","showCheckboxes","rest","inputWidth","customAutocompleteProps","minWidth","useStyles","makeStyles","theme","classesChip","root","marginTop","marginBottom","useStylesChip","classes","FormControl","Autocomplete","disableCloseOnSelect","freeSolo","loading","readOnly","renderInput","TextField","InputProps","endAdornment","CircularProgress","color","renderTags","getTagProps","option","index","Chip","renderOption","specialValue","renderTitle","Checkbox","icon","marginRight","filterOptions","filtered","itemsToListValues","level","repeat","groupTitle","flat","Infinity","paper","padding","spacing","MaterialTextWidget","inputProps","MaterialTextAreaWidget","multiline","MaterialDateWidget","Picker","KeyboardDatePicker","DatePicker","formatSingleValue","MaterialDateTimeWidget","KeyboardDateTimePicker","DateTimePicker","dateTimeFormat","ampm","MaterialTimeWidget","KeyboardTimePicker","TimePicker","hasSeconds","indexOf","timeValue","views","MaterialSelectWidget","autoWidth","displayEmpty","renderValue","shift","getListValueTitle","MenuItem","MaterialNumberWidget","MaterialSliderWidget","marks","sliderValue","muiMarks","InputCmp","onBlur","SliderCmp","Slider","_e","newValue","valueLabelDisplay","stylesSliderWrapper","marginLeft","paddingLeft","alignItems","MaterialRangeWidget","useEffect","valueFrom","valueTo","setTimeout","oneValue","handleInputBlur","FromInputCmp","ToInputCmp","newValues","stylesInputWrapper","MaterialBooleanWidget","Typography","component","Grid","container","Switch","MaterialMultiSelectWidget","selectedValues","selectedTitles","ListItemText","primary","MaterialAutocompleteWidget","MaterialFieldSelect","findLabel","pop","ListSubheader","disableSticky","MaterialFieldAutocomplete","MaterialAutocomplete","_asyncValues","MaterialButton","typeToOnlyIcon","Delete","Add","typeToIcon","typeToColor","IconButton","Button","startIcon","MaterialButtonGroup","MaterialConjs","ButtonGroup","disableElevation","variant","MaterialSwitch","checkedLabel","hideLabel","showLabel","Lock","LockOpen","FormControlLabel","control","MaterialValueSources","React","anchorEl","setAnchorEl","handleClose","Boolean","event","currentTarget","handleOpen","ExpandMoreSharp","Popover","anchorOrigin","vertical","horizontal","transformOrigin","disablePortal","FormLabel","RadioGroup","Radio","MaterialConfirm","description","confirmationText","cancellationText","then","MaterialUseConfirm","MaterialProvider","settingsTheme","settingsLocale","themeConfig","material","createTheme","base","withProviders","M","utils","MomentUtils","ThemeProvider","MaterialWidgets","BasicConfig","asyncFetch","rangeslider","useLoadMore","useAsyncSearch","forceAsyncSearch","selectedAsyncListValues","staticListValues","knownSpecialValues","loadMoreTitle","loadingMoreTitle","setOpen","asyncFetchMeta","setAsyncFetchMeta","loadingCnt","setLoadingCnt","isLoadingMore","setIsLoadingMore","setInputValue","setAsyncListValues","asyncFectchCnt","componentIsMounted","isSelectedLoadMore","nSelectedAsyncListValues","listValuesToArray","mergeListValues","canInitialLoad","canLoadMore","hasMore","canShowLoadMore","listValueToOption","fetchListValues","isLoadMore","offset","pageSize","newAsyncFetchCnt","current","newMeta","nValues","assumeHasMore","realNewMeta","loadListValues","x","loadListValuesDebounced","debounce","find","newSelectedListValues","getListValue","customItem","newSelectedValues","newInputValue","onSearch","onDropdownVisibleChange","isSpecialValue","valueOrOption","ADD_GROUP","ADD_CASE_GROUP","REMOVE_GROUP","SET_CONJUNCTION","SET_NOT","ADD_RULE","REMOVE_RULE","SET_FIELD","SET_OPERATOR","SET_VALUE","SET_VALUE_SRC","SET_OPERATOR_OPTION","SET_LOCK","SET_TREE","MOVE_ITEM","PLACEMENT_AFTER","PLACEMENT_BEFORE","PLACEMENT_APPEND","PLACEMENT_PREPEND","SET_DRAG_PROGRESS","SET_DRAG_START","SET_DRAG_END","addNewGroup","state","groupUuid","properties","groupPath","canAddNewRule","isDefaultCase","origState","addItem","defaultGroupProperties","merge","setIn","expandTreePath","defaultRuleProperties","fixPathsInTree","removeGroup","removeItem","parentPath","slice","hasChildren","fixEmptyGroupsInTree","isEmptyTree","removeRule","parentOperator","parentOperatorConfig","hasGroupCountRule","isParentRuleGroup","isEmptyParentGroup","canLeaveEmpty","initialEmptyWhere","deleteIn","setLock","lock","removeIsLockedInTree","conjunction","_addChildren1","children1","reduce","it","id1","it1","defaultItemProperties","Error","currentNumber","maxNumber","maxNumberOfCases","maxNumberOfRules","maxNesting","rootType","isTernary","targetItem","caseGroup","take","childrenPath","targetChildren","targetChildrenSize","getTotalRulesCountInTree","canAdd","isLastDefaultCase","newChildren","newChildrenWithLast","mergeIn","moveItem","fromPath","toPath","placement","from","getItemByPath","sourcePath","sourceChildren","to","targetPath","constants","isSameParent","isSourceInsideTarget","deepEqual","toArray","isTargetInsideSource","sourceSubpathFromTarget","targetSubpathFromSource","newTargetChildren","newSourceChildren","updateIn","expandTreeSubpath","_oldChildren","withMutations","r","entries","itemId","set","newField","showErrorMessage","currentType","currentProperties","wasRuleGroup","newFieldConfig","isRuleGroup","isRuleGroupExt","mode","isChangeToAnotherType","currentOperator","currentOperatorOptions","lastOp","newOperator","availOps","getOperatorsForField","strategy","getFirstOperator","console","warn","getNewValueForFieldOp","canReuseValue","newValueSrc","newValueType","operatorCardinality","groupProperties","newValueError","newOperatorOptions","defaultOperatorOptions","setOperator","currentField","operatorConfig","isInternalValueChange","calculatedValueType","calculateValueType","validateValue","validateError","fixedValue","w","fieldWidgetDefinition","_","vs","jsValues","rangeValidateError","isLastEmpty","isLastError","tree","setOperatorOption","checkEmptyGroups","fieldConfig","emptyDrag","dragging","y","h","mousePos","dragStart","getActionMeta","action","actionTypesToIgnore","mapValues","applyToJS","affectedField","getField","setTree","addRule","ruleType","toImmutableList","addDefaultCaseGroup","addCaseGroup","addGroup","setDragProgress","setDragStart","setDragEnd","Query","shouldComponentUpdate","liteShouldComponentUpdate","nextValue","oldValidatedTree","validatedTree","_updateActions","getMemoizedTree","dispatch","actions","bindActionCreators","oldConfig","newTree","newConfig","immutableEqual","__lastAction","renderBuilder","__isInternalValueChange","Component","ConnectedQuery","connect","context","displayName","QueryContainer","prevValue","getMemoizedConfig","createConfigMemo","createValidationMemo","reducer","emptyTree","defaultRoot","emptyState","unset","actionMeta","treeStoreReducer","store","createStore","nextConfig","isConfigChanged","storeValue","getState","isTreeChanged","currentTree","setState","Promise","resolve","get_children","QueryWrapper","classNames","require","GroupOrRule","handleDraggerMouseDown","nodeId","dom","wrapper","onDragStart","isDraggingTempo","isDraggingMe","otherProps","isTrueLocked","styles","top","left","cn","ref","isLocked","Operator","selectedField","selectedOperator","pickBy","_opts","isOpSelected","ops","sort","a","b","OperatorWrapper","selectedFieldPartsLabels","showOperator","showOperatorLabel","selectedFieldWidgetConfig","operatorInlineLabel","Field","hideForSelect","FieldWrapper","classname","OperatorOptions","operatorDefinitions","optionsFactory","basicOptionsProps","optionsCmp","Rule","ConnectedRuleContainer","removeSelf","nextState","prevState","should","pureShouldComponentUpdate","chs","changed","isInDraggingTempo","hasError","reordableNodesCnt","totalRulesCnt","parentReordableNodesCnt","createRuleContainer","RuleContainer","Draggable","selectedFieldConfig","isSelectedGroup","isFieldAndOpSelected","selectedOperatorConfig","selectedOperatorHasOptions","hideOperator","showDragIcon","showWidget","showOperatorOptions","confirmOptions","doRemove","isEmptyCurrentRule","onCancel","immutableFieldsMode","immutableOpsMode","immutableValuesMode","opOpts","renderBeforeWidget","renderAfterWidget","renderRuleError","oneValueError","error","onMouseDown","immutableGroupsMode","Btn","canShrinkValue","BtnGrp","renderOperatorOptions","body","renderError","drag","renderDrag","renderLock","del","renderDel","Group","ConnectedGroupContainer","_selectedConjunction","selectedConjunction","_getConjunctionOptions","oldConjunction","currentNesting","allowFurtherNesting","isRoot","createGroupContainer","groupActionsPositionList","topLeft","topCenter","topRight","bottomLeft","bottomCenter","bottomRight","GroupActions","canAddGroup","canAddRule","canDeleteGroup","position","setLockSwitch","addRuleBtn","addGroupBtn","delGroupBtn","BasicGroup","childrenClassName","renderBeforeActions","BeforeActions","renderAfterActions","AfterActions","renderItem","isEmptyCurrentGroup","isEmpty","isEmptyGroup","isEmptyRule","group","rule","renderHeaderWrapper","renderChildrenWrapper","renderFooterWrapper","showConjs","isOneChild","renderChildren","isGroupTopPosition","renderHeader","renderActions","toList","Item","extraPropsForItem","reordableNodesCntForItem","totalRulesCntForItem","isParentLocked","_item","Conjs","GroupContainer","RuleGroupActions","RuleGroup","RuleGroupExtActions","RuleGroupExt","renderGroupField","SwitchGroupActions","canAddDefault","addCaseGroupBtn","addDefaultCaseGroupBtn","SwitchGroup","hasDefaultCase","c","totalCasesCnt","casesToReorder","canLeaveEmptyCase","canRegroupCases","cnt","getTotalReordableNodesCountInTree","CaseGroup","renderHeaderLeft","renderHeaderCenter","renderCondition","getProperties","toObject","result","typeMap","rule_group","rule_group_ext","switch_group","case_group","isRequired","createSortableContainer","Builder","CanMoveFn","_getEventTarget","__mocked_window","document","window","treeEl","closest","classList","add","groupPadding","treeElContainer","scrollTop","_getScrollParent","tmpAllGroups","_getDraggableNodeEl","_getPlaceholderNodeEl","querySelectorAll","anyGroup","getComputedStyle","getPropertyValue","offsetLeft","offsetTop","offsetWidth","offsetHeight","itemInfo","clientX","clientY","eventTarget","addEventListener","onDrag","onDragEnd","doHandleDrag","startDragging","startMousePos","__mock_dom","dragEl","plhEl","plX","getBoundingClientRect","scrollX","plY","scrollY","startX","startY","startClientX","startClientY","startScrollTop","pos","moved","handleDrag","preventDefault","remove","_cacheEls","removeEventListener","getFlatTree","_prevProps","_prevState","oldPlX","oldPlY","indexId","ignoreCache","el","contains","querySelector","els","getElementsByClassName","node","overflowY","scrollHeight","_isScrollable","parentNode","dragInfo","canMoveFn","dragRect","plhRect","hovRect","treeRect","moveInfo","dragId","dragDirs","hrz","vrt","bottom","hovCNodeEl","trgCoord","right","__mocked_hov_container","hovNodeEl","elementFromPoint","rootGroupContainer","firstChild","isGroup","hovNodeId","getAttribute","hovEl","doAppend","doPrepend","hovHeight","hovII","trgRect","trgEl","trgII","altII","hovInnerEl","hovEl2","hovRect2","hovHeight2","lev","isSamePos","dragLeftOffset","dragLev","Math","round","availMoves","altMoves","isToRoot","isToCase","prevCaseId","prev","caseId","nextCaseId","next","prevCase","nextCase","addCaseII","am","toII","fromCaseII","toCaseII","bestMode","filteredMoves","trg","collapsed","isInside","tmp","toParentII","canMove","levs","curLev","allLevs","closestDragLev","logger","move","fromII","newLev","isBeforeAfter","isPend","isLev1","isParentChange","isStructChange","isForbiddenStructChange","parentType","isLockedChange","isLastFromCase","_height","newRulesInTargetCase","leafsCount","ConnectedSortableContainer","SortableContainer","_updPath","Map","queryBuilderFormat","usedFields","formatItem","formatGroup","formatRule","currentChild","defaultConjunction","rules","condition","hasUndefinedValues","fieldType","typeConfig","formatFieldName","secondField","ruleQuery","jsonLogicFormat","errors","logic","data","ff","p","pdef","ret","conjunctionDefinition","toLowerCase","groupField","groupOperator","groupOperatorDefinition","formattedValue","formatItemValue","isGroup0","resultQuery","formattedField","count","var","formatLogic","isRev","iValueSrc","iValueType","iValue","oldUsedFields","fvalue","currentValue","cValue","completeValue","fieldWidgetDef","fv","operatorDef","formatFunc","formattedArgs","argConfig","argValue","argValueSrc","formattedArgVal","formattedArgsArr","funcName","isMethod","jsonLogicIsMethod","obj","parentFieldDef","parentFieldName","varName","jsonLogicVar","buildFnToFormatOp","formatteOp","isReverseArgs","rangeOps","eqOps","isObject","mongodbFormat","_mongodbFormat","returnErrors","parents","_not","_canWrapExpr","_fieldName","_value","hasParentRuleGroup","realParentPath","groupFieldName","groupFieldDef","canHaveEmptyChildren","f","canShort","acc","totalQuery","filterQuery","as","_f","fvUseExpr","wrapExpr","formatRightField","rightFieldDefinition","fieldPartsLabels","fieldFullLabel","mongoFunc","mongoArgsAsObject","argsCnt","lastArg","argAsyncListValues","mongoFormatFunc","sqlFormat","_sqlFormat","revOpDef","canFormatOp","canFormatRevOp","valFieldDefinition","sqlFunc","sqlFormatFunc","argsStr","spelFormat","_spelFormat","formatSwitch","formatCase","cases","filteredCases","isRuleGroupArray","isSpelArray","realGroupOperator","checkOp","isGroupOpRev","realGroupOperatorDefinition","getSize","groupValue","formatExpression","objectIsFirstArg","sop","realOp","expectedValueType","fieldPartsConfigs","getFieldPartsConfigs","formatFieldFn","fieldPartsMeta","cnf","parentCnf","isSpelMap","isSpelItemMap","spelFunc","spelFormatFunc","queryString","conjStr","aggrArgs","_operator","fop","returnArgs","revOperatorDef","cutParentField","fieldLabel2","funcValue","formattedArgsWithNames","argName","buildEsRule","opConfig","widgetConfig","parameters","textField","determineField","elasticSearchScript","geoPointString","coordsNumberArray","top_left","lat","lon","bottom_right","buildEsGeoPoint","gte","lte","dateTime","lt","gt","buildEsRangeParameters","buildEsWildcardParameters","buildRegexpParameters","buildParameters","bool","must_not","elasticSearchFormat","recursiveFxn","childrenArray","valueSeq","occurrence","combinator","determineOccurrence","resultFlat","buildEsGroup","getTree","immutableTree","light","children1AsArray","getLightTree","loadTree","serTree","isImmutableTree","isTree","jsTreeToImmutable","parse","checkTree","extendedConfig","extendConfig","validateTree","isValidTree","getTreeBadFields","fromJS","outValue","toOrderedMap","valueJs","child","arrayUniq","arr","Set","loadFromJsonLogic","logicTree","_loadFromJsonLogic","conv","buildConv","jsTree","convertFromLogic","wrapInDefaultConj","immTree","opKey","opk","conjKey","fk","varKeys","isJsonLogic","beforeErrorsCnt","isEmptyOp","convertField","convertFunc","convertVal","convertConj","convertOp","afterErrorsCnt","floor","m","s","setMilliseconds","setHours","setMinutes","setSeconds","toISOString","normalizeField","argsArr","opts","funcKeys","fc","jsonLogicImport","parsed","argKeys","complexFields","complexFieldsGroupAncestors","fromEntries","ancs","fp","usedRuleGroups","topLevelFieldsFilter","groupToId","groupAncestors","at","parentFieldParts","shallowEqual","gf","gfc","j","splice","wrapInDefaultConjRuleGroup","parseRule","arity","_parseRule","isRevArgs","opKeys","jlField","having","init","op2","parseRes","havingVals","canRev","convertedArgs","asyncListValuesArr","loadFromSpel","_loadFromSpel","spelStr","compiledExpression","convertedObj","compileRes","SpelExpressionEvaluator","_compiledExpression","convertCompiled","convertToTree","expr","parentExpr","getType","getChildren","selection","lastChild","isSize","methodName","isLength","sourceParts","isThis","itype","getRaw","getValue","flatizeTernary","functionName","qid","cls","isVar","_processTernaryChildren","tern","if_val","else_val","forEach","convertPath","isError","convertArg","spel","parentSpel","literalTypes","string","null","groupFieldParts","_groupField","fullParts","isVariable","isUnary","funcToOpMap","buildRule","dateString","timeString","buildCaseValueConcat","buildRuleGroup","groupFilter","groupFieldValue","groupOpRule","compareArgs","leftSource","rightSource","leftVal","rightVal","isBetweenNormal","isBetweenRev","isBetween","isNumbers","isSameSource","oneSpel","convertChildren","fieldObj","opArg","ws","buildSimpleSwitch","caseI","buildCase","sw","valProperties","buildCaseValProperties","_processConcatChildren","convertedChild","convVal","widgetDef","importCaseValue","normVal","normErrors","NOW","jsonLogicCustomOps","now","RELATIVE_DATETIME","dim","abs","date_add","replace","mainWidgetProps","plus","minus","day","week","month","year","LOWER","str","UPPER","LINEAR_REGRESSION","coef","bias","Utils","BasicUtils","Export","Import","simulateAsyncFetch","cPageSize","delay","search","ceil","currentOffset","newOffset","debug","sleep","toStart","old","newFiltered","av","merged","lv","configKeys","configStore","configId","pickConfig","findConfig","savedConfig","findExtended","extendAndStore","__configId","_fieldsCntByType","_funcsCntByType","typesConfig","_extendTypeConfig","_extendTypesConfig","__fieldNames","_extendFieldsConfig","_extendFuncArgsConfig","defineProperty","enumerable","writable","typeWidgetConfig","typeWidgetOperators","excludeOperators","mergeArraysSmart","subconfig","_extendFieldConfig","funcDef","tmpIsOptional","reverse","argDef","isOptional","excludeOperatorsForField","keysToPutInFieldSettings","normalizeListValues","_isFuncArg","excludeOperatorsForType","fieldWidgetConfig","shouldIncludeOperators","preferWidgets","addOperators","computedFieldName","computeFieldName","getFieldRawConfig","fieldsKey","subfieldsKey","targetFields","part","pathKey","fConfig","l","unshift","fieldStr","getFuncArgConfig","mergeWith","objValue","srcValue","_key","_object","_source","_stack","widgetOpProps","fieldWidgetOpProps","mergedOpConfig","valueFieldSettings","mergedConfig","defaultField","canGetFirst","parentRuleGroupPath","getFirstField","fieldOperators","fieldDefaultOperator","setDefaultFieldAndOp","conjs","defaultRule","trim","charAt","substring","escapeLike","any_start","any_end","escape","spelEscapeString","spelInlineList","javaType","jt","escapedVals","numberJavaTypes","numberToFloat","arrayToArray","isFinite","isNaN","spelFormatConcat","spelImportConcat","completeFuncValue","complValue","tmpHasOptional","filteredValueSources","filterValueSourcesForField","argDefaultValueSrc","completeArgValue","getDefaultArgValue","_checkFuncValue","firstValueSrc","_argConfig","_config","self","canUseUnsafe","UNSAFE_componentWillReceiveProps","componentWillReceiveProps","actionCreators","actionCreator","selectTypes","changedProp","canFix","isEndValue","currentValueSrc","currentValueType","currentAsyncListValues","clearValueOnChangeField","clearValueOnChangeOp","newOperatorConfig","currentFieldConfig","currentWidget","newWidget","currentValueWidget","newValueWidget","canReuseWidget","firstWidgetConfig","valueFixes","valueErrors","vType","vSrc","isValidSrc","fixValue","dropValue","_ignore","getFirstDefined","vt","parentPathArr","firstField","keysPath","fieldOps","onlyKeys","_curr","parentParts","_getWidgetsAndSrcsForFieldOp","widgetValueSrc","canAddValueSrc","widgetWeight","wg","w1","w2","minCnt","filteredValueSrcs","tableName","fieldPartsCopy","_default","n","useWordBoundary","subString","substr","lastIndexOf","v1","v2","equals","deep","shallowEqualArrays","shallowEqualObjects","arrA","arrB","len","isEqual","objA","objB","aKeys","bKeys","listValue","listValuesObj","listValuesArr","getItemInListValues","mapFn","defaultTreeDataMap","pId","rootPId","getPathInListValues","tdm","parentId","getChildrenInListValues","isMulti","treeData","treeSelectOnlyLeafs","childrenValues","selectable","extendTreeData","rind","_flatize","childrenCount","flatizeTreeData","removePrefixPath","isPrefix","isImmutable","arr1","arr2","orig","after","before","newOp","rel","relOp","isDev","process","devMode","verbose","log","getLogger","suffix","interpose","skip","apply","removePathsInTree","_processNode","itemPath","removeIn","_childId","currPath","currId","constructor","childId","allChildrenGone","curr","realHeight","_flatizeTree","insideCollapsed","insideLocked","insideRuleGroup","childrenIds","_child","isLeaf","itemsBefore","leaf","_top","itemsAfter","subinfo","prevId","nextId","badFields","getSwitchValues","caseValue","query_builder_seed","timePart","getTime","random","isTypeOf","typeOf","originalTree","validateAndFixTree","_oldTree","removeEmptyGroups","removeIncompleteRules","validateItem","oldChildren","sanitized","submeta","validateGroup","oldSerialized","newSerialized","isComplete","validateRule","isRawValue","validError","validateFieldValue","validateFuncValue","validateNormalValue","validResult","validateValueInList","List","goodVals","badVals","vv","goodValues","badValues","plural","wConfig","wType","_valueSrc","leftFieldStr","rightFieldStr","argValidError","fixedArgVal","webpackContext","req","webpackContextResolve","__webpack_require__","code","module","exports"],"sourceRoot":""}